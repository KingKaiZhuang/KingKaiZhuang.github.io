{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"source/images/09d01d97-6054-4172-930a-5cf01b8bf9a8.webp","path":"images/09d01d97-6054-4172-930a-5cf01b8bf9a8.webp","modified":0,"renderable":0},{"_id":"source/images/64b6bd08-e4f1-4125-aba5-2886b5bc938a.webp","path":"images/64b6bd08-e4f1-4125-aba5-2886b5bc938a.webp","modified":0,"renderable":0},{"_id":"source/images/Avatar.jpeg","path":"images/Avatar.jpeg","modified":0,"renderable":0},{"_id":"source/images/CPE.webp","path":"images/CPE.webp","modified":0,"renderable":0},{"_id":"source/images/CPE_sub.webp","path":"images/CPE_sub.webp","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-10-29-at-11.41.16@2x-1024x385.png","path":"images/CleanShot-2025-10-29-at-11.41.16@2x-1024x385.png","modified":0,"renderable":0},{"_id":"source/images/CPU-排程.png","path":"images/CPU-排程.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-10-29-at-11.41.16@2x.png","path":"images/CleanShot-2025-10-29-at-11.41.16@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-10-29-at-11.47.42@2x-1024x85.png","path":"images/CleanShot-2025-10-29-at-11.47.42@2x-1024x85.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-10-29-at-11.47.42@2x.png","path":"images/CleanShot-2025-10-29-at-11.47.42@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-10-29-at-11.57.50@2x-1024x45.png","path":"images/CleanShot-2025-10-29-at-11.57.50@2x-1024x45.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-10-29-at-11.57.50@2x.png","path":"images/CleanShot-2025-10-29-at-11.57.50@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-10-29-at-11.59.02@2x-1024x84.png","path":"images/CleanShot-2025-10-29-at-11.59.02@2x-1024x84.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-10-29-at-11.59.02@2x.png","path":"images/CleanShot-2025-10-29-at-11.59.02@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png","path":"images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-14-at-18.10.07@2x.png","path":"images/CleanShot-2025-11-14-at-18.10.07@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-11.42.31@2x-1.png","path":"images/CleanShot-2025-11-15-at-11.42.31@2x-1.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-11.42.31@2x.png","path":"images/CleanShot-2025-11-15-at-11.42.31@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-11.44.53@2x-1024x632.png","path":"images/CleanShot-2025-11-15-at-11.44.53@2x-1024x632.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-11.44.53@2x.png","path":"images/CleanShot-2025-11-15-at-11.44.53@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-11.51.05-1-scaled.png","path":"images/CleanShot-2025-11-15-at-11.51.05-1-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-11.51.05-scaled.png","path":"images/CleanShot-2025-11-15-at-11.51.05-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.02.52-1024x611.png","path":"images/CleanShot-2025-11-15-at-12.02.52-1024x611.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.02.52-scaled.png","path":"images/CleanShot-2025-11-15-at-12.02.52-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.09.41@2x-1024x632.png","path":"images/CleanShot-2025-11-15-at-12.09.41@2x-1024x632.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.09.41@2x.png","path":"images/CleanShot-2025-11-15-at-12.09.41@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.17.01-1024x611.png","path":"images/CleanShot-2025-11-15-at-12.17.01-1024x611.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.17.01-scaled.png","path":"images/CleanShot-2025-11-15-at-12.17.01-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.18.22.png","path":"images/CleanShot-2025-11-15-at-12.18.22.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.20.47-1024x228.png","path":"images/CleanShot-2025-11-15-at-12.20.47-1024x228.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.20.47.png","path":"images/CleanShot-2025-11-15-at-12.20.47.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.21.44-1024x277.png","path":"images/CleanShot-2025-11-15-at-12.21.44-1024x277.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.21.44.png","path":"images/CleanShot-2025-11-15-at-12.21.44.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.23.00-1024x611.png","path":"images/CleanShot-2025-11-15-at-12.23.00-1024x611.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.23.00-scaled.png","path":"images/CleanShot-2025-11-15-at-12.23.00-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.24.17@2x-1.png","path":"images/CleanShot-2025-11-15-at-12.24.17@2x-1.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.24.17@2x-1024x632.png","path":"images/CleanShot-2025-11-15-at-12.24.17@2x-1024x632.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.24.17@2x.png","path":"images/CleanShot-2025-11-15-at-12.24.17@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.26.11@2x.png","path":"images/CleanShot-2025-11-15-at-12.26.11@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.28.08@2x-1024x599.png","path":"images/CleanShot-2025-11-15-at-12.28.08@2x-1024x599.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.28.08@2x.png","path":"images/CleanShot-2025-11-15-at-12.28.08@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.29.00@2x-1024x599.png","path":"images/CleanShot-2025-11-15-at-12.29.00@2x-1024x599.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.29.00@2x.png","path":"images/CleanShot-2025-11-15-at-12.29.00@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.29.35@2x-1024x599.png","path":"images/CleanShot-2025-11-15-at-12.29.35@2x-1024x599.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.29.35@2x.png","path":"images/CleanShot-2025-11-15-at-12.29.35@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.32.25@2x-1.png","path":"images/CleanShot-2025-11-15-at-12.32.25@2x-1.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.32.25@2x-1024x599.png","path":"images/CleanShot-2025-11-15-at-12.32.25@2x-1024x599.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.32.25@2x.png","path":"images/CleanShot-2025-11-15-at-12.32.25@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.36.18@2x-1024x599.png","path":"images/CleanShot-2025-11-15-at-12.36.18@2x-1024x599.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.36.18@2x.png","path":"images/CleanShot-2025-11-15-at-12.36.18@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.48.01@2x-1024x632.png","path":"images/CleanShot-2025-11-15-at-12.48.01@2x-1024x632.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-12.48.01@2x.png","path":"images/CleanShot-2025-11-15-at-12.48.01@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-13.26.07-1024x583.png","path":"images/CleanShot-2025-11-15-at-13.26.07-1024x583.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-13.26.07-scaled.png","path":"images/CleanShot-2025-11-15-at-13.26.07-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-13.40.02@2x-1024x599.png","path":"images/CleanShot-2025-11-15-at-13.40.02@2x-1024x599.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-13.40.02@2x.png","path":"images/CleanShot-2025-11-15-at-13.40.02@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-13.41.36@2x-1024x606.png","path":"images/CleanShot-2025-11-15-at-13.41.36@2x-1024x606.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-13.41.36@2x.png","path":"images/CleanShot-2025-11-15-at-13.41.36@2x.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-13.44.41-scaled.png","path":"images/CleanShot-2025-11-15-at-13.44.41-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-13.44.41-1024x611.png","path":"images/CleanShot-2025-11-15-at-13.44.41-1024x611.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-13.44.56-1024x611.png","path":"images/CleanShot-2025-11-15-at-13.44.56-1024x611.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-13.44.56-scaled.png","path":"images/CleanShot-2025-11-15-at-13.44.56-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-15.00.18-1024x611.png","path":"images/CleanShot-2025-11-15-at-15.00.18-1024x611.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-15.00.18-scaled.png","path":"images/CleanShot-2025-11-15-at-15.00.18-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-15.00.44-1024x611.png","path":"images/CleanShot-2025-11-15-at-15.00.44-1024x611.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-15.00.44-scaled.png","path":"images/CleanShot-2025-11-15-at-15.00.44-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-15.01.04-1024x611.png","path":"images/CleanShot-2025-11-15-at-15.01.04-1024x611.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-15-at-15.01.04-scaled.png","path":"images/CleanShot-2025-11-15-at-15.01.04-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-26-at-20.38.02@2x-scaled.png","path":"images/CleanShot-2025-11-26-at-20.38.02@2x-scaled.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-26-at-21.16.14-1024x662.png","path":"images/CleanShot-2025-11-26-at-21.16.14-1024x662.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-26-at-21.16.14.png","path":"images/CleanShot-2025-11-26-at-21.16.14.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-26-at-21.17.46-1024x664.png","path":"images/CleanShot-2025-11-26-at-21.17.46-1024x664.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-26-at-21.17.46.png","path":"images/CleanShot-2025-11-26-at-21.17.46.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-26-at-21.35.15-1024x667.png","path":"images/CleanShot-2025-11-26-at-21.35.15-1024x667.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-26-at-21.35.15.png","path":"images/CleanShot-2025-11-26-at-21.35.15.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-26-at-22.18.53-1.png","path":"images/CleanShot-2025-11-26-at-22.18.53-1.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-26-at-22.18.53-1024x667.png","path":"images/CleanShot-2025-11-26-at-22.18.53-1024x667.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-26-at-22.18.53.png","path":"images/CleanShot-2025-11-26-at-22.18.53.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-10.33.25-1024x657.png","path":"images/CleanShot-2025-11-27-at-10.33.25-1024x657.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-10.33.25.png","path":"images/CleanShot-2025-11-27-at-10.33.25.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-10.34.45-1024x657.png","path":"images/CleanShot-2025-11-27-at-10.34.45-1024x657.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-10.34.45.png","path":"images/CleanShot-2025-11-27-at-10.34.45.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-12.46.54.png","path":"images/CleanShot-2025-11-27-at-12.46.54.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-12.47.38-1024x664.png","path":"images/CleanShot-2025-11-27-at-12.47.38-1024x664.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-12.47.38.png","path":"images/CleanShot-2025-11-27-at-12.47.38.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-22.33.36.png","path":"images/CleanShot-2025-11-27-at-22.33.36.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-22.43.19-1024x670.png","path":"images/CleanShot-2025-11-27-at-22.43.19-1024x670.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-22.43.19.png","path":"images/CleanShot-2025-11-27-at-22.43.19.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-22.47.08-1024x588.png","path":"images/CleanShot-2025-11-27-at-22.47.08-1024x588.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-27-at-22.47.08.png","path":"images/CleanShot-2025-11-27-at-22.47.08.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-28-at-10.25.54-1024x578.png","path":"images/CleanShot-2025-11-28-at-10.25.54-1024x578.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-28-at-10.25.54.png","path":"images/CleanShot-2025-11-28-at-10.25.54.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-28-at-10.28.43-1024x670.png","path":"images/CleanShot-2025-11-28-at-10.28.43-1024x670.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-28-at-10.28.43.png","path":"images/CleanShot-2025-11-28-at-10.28.43.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-28-at-10.33.17-1024x670.png","path":"images/CleanShot-2025-11-28-at-10.33.17-1024x670.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-28-at-10.33.17.png","path":"images/CleanShot-2025-11-28-at-10.33.17.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-11-28-at-12.17.25.gif","path":"images/CleanShot-2025-11-28-at-12.17.25.gif","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-12-01-at-16.05.16-1024x660.png","path":"images/CleanShot-2025-12-01-at-16.05.16-1024x660.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-12-01-at-16.05.16.png","path":"images/CleanShot-2025-12-01-at-16.05.16.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-12-01-at-16.05.37-1024x660.png","path":"images/CleanShot-2025-12-01-at-16.05.37-1024x660.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-12-01-at-16.05.37.png","path":"images/CleanShot-2025-12-01-at-16.05.37.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-12-04-at-10.55.31.png","path":"images/CleanShot-2025-12-04-at-10.55.31.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-12-04-at-10.56.41.png","path":"images/CleanShot-2025-12-04-at-10.56.41.png","modified":0,"renderable":0},{"_id":"source/images/CleanShot-2025-12-04-at-11.02.07.png","path":"images/CleanShot-2025-12-04-at-11.02.07.png","modified":0,"renderable":0},{"_id":"source/images/Docker.png","path":"images/Docker.png","modified":0,"renderable":0},{"_id":"source/images/Gemini_Generated_Image_8zuhop8zuhop8zuh-1.png","path":"images/Gemini_Generated_Image_8zuhop8zuhop8zuh-1.png","modified":0,"renderable":0},{"_id":"source/images/Gemini_Generated_Image_hqxfm7hqxfm7hqxf.png","path":"images/Gemini_Generated_Image_hqxfm7hqxfm7hqxf.png","modified":0,"renderable":0},{"_id":"source/images/Gemini_Generated_Image_si41pisi41pisi41-1.png","path":"images/Gemini_Generated_Image_si41pisi41pisi41-1.png","modified":0,"renderable":0},{"_id":"source/images/Gemini_Generated_Image_vfctf8vfctf8vfct.png","path":"images/Gemini_Generated_Image_vfctf8vfctf8vfct.png","modified":0,"renderable":0},{"_id":"source/images/LocationApp.png","path":"images/LocationApp.png","modified":0,"renderable":0},{"_id":"source/images/Logo.png","path":"images/Logo.png","modified":0,"renderable":0},{"_id":"source/images/Pytorch.png","path":"images/Pytorch.png","modified":0,"renderable":0},{"_id":"source/images/YOLOv9.png","path":"images/YOLOv9.png","modified":0,"renderable":0},{"_id":"source/images/banner.jpeg","path":"images/banner.jpeg","modified":0,"renderable":0},{"_id":"source/images/favicon.ico","path":"images/favicon.ico","modified":0,"renderable":0},{"_id":"source/images/good-fcp-values-18.svg","path":"images/good-fcp-values-18.svg","modified":0,"renderable":0},{"_id":"source/images/icon.jpeg","path":"images/icon.jpeg","modified":0,"renderable":0},{"_id":"source/images/image-1-1024x557.png","path":"images/image-1-1024x557.png","modified":0,"renderable":0},{"_id":"source/images/image-1.png","path":"images/image-1.png","modified":0,"renderable":0},{"_id":"source/images/image-10.png","path":"images/image-10.png","modified":0,"renderable":0},{"_id":"source/images/image-11-1024x594.png","path":"images/image-11-1024x594.png","modified":0,"renderable":0},{"_id":"source/images/image-11.png","path":"images/image-11.png","modified":0,"renderable":0},{"_id":"source/images/image-12-1024x594.png","path":"images/image-12-1024x594.png","modified":0,"renderable":0},{"_id":"source/images/image-12.png","path":"images/image-12.png","modified":0,"renderable":0},{"_id":"source/images/image-13.png","path":"images/image-13.png","modified":0,"renderable":0},{"_id":"source/images/image-14-1024x336.png","path":"images/image-14-1024x336.png","modified":0,"renderable":0},{"_id":"source/images/image-14-1024x594.png","path":"images/image-14-1024x594.png","modified":0,"renderable":0},{"_id":"source/images/image-14.png","path":"images/image-14.png","modified":0,"renderable":0},{"_id":"source/images/image-15.png","path":"images/image-15.png","modified":0,"renderable":0},{"_id":"source/images/image-16-1024x594.png","path":"images/image-16-1024x594.png","modified":0,"renderable":0},{"_id":"source/images/image-16.png","path":"images/image-16.png","modified":0,"renderable":0},{"_id":"source/images/image-17-1024x593.png","path":"images/image-17-1024x593.png","modified":0,"renderable":0},{"_id":"source/images/image-17.png","path":"images/image-17.png","modified":0,"renderable":0},{"_id":"source/images/image-18-1024x542.png","path":"images/image-18-1024x542.png","modified":0,"renderable":0},{"_id":"source/images/image-18.png","path":"images/image-18.png","modified":0,"renderable":0},{"_id":"source/images/image-19.png","path":"images/image-19.png","modified":0,"renderable":0},{"_id":"source/images/image-2-1024x510.png","path":"images/image-2-1024x510.png","modified":0,"renderable":0},{"_id":"source/images/image-2-scaled.png","path":"images/image-2-scaled.png","modified":0,"renderable":0},{"_id":"source/images/image-2.png","path":"images/image-2.png","modified":0,"renderable":0},{"_id":"source/images/image-20-1024x664.png","path":"images/image-20-1024x664.png","modified":0,"renderable":0},{"_id":"source/images/image-20.png","path":"images/image-20.png","modified":0,"renderable":0},{"_id":"source/images/image-21-1024x459.png","path":"images/image-21-1024x459.png","modified":0,"renderable":0},{"_id":"source/images/image-21.png","path":"images/image-21.png","modified":0,"renderable":0},{"_id":"source/images/image-22-1024x554.png","path":"images/image-22-1024x554.png","modified":0,"renderable":0},{"_id":"source/images/image-22.png","path":"images/image-22.png","modified":0,"renderable":0},{"_id":"source/images/image-23-1024x448.png","path":"images/image-23-1024x448.png","modified":0,"renderable":0},{"_id":"source/images/image-23.png","path":"images/image-23.png","modified":0,"renderable":0},{"_id":"source/images/image-24-1024x604.png","path":"images/image-24-1024x604.png","modified":0,"renderable":0},{"_id":"source/images/image-24.png","path":"images/image-24.png","modified":0,"renderable":0},{"_id":"source/images/image-25.png","path":"images/image-25.png","modified":0,"renderable":0},{"_id":"source/images/image-26.png","path":"images/image-26.png","modified":0,"renderable":0},{"_id":"source/images/image-27.png","path":"images/image-27.png","modified":0,"renderable":0},{"_id":"source/images/image-28.png","path":"images/image-28.png","modified":0,"renderable":0},{"_id":"source/images/image-3-1024x526.png","path":"images/image-3-1024x526.png","modified":0,"renderable":0},{"_id":"source/images/image-3-1024x604.png","path":"images/image-3-1024x604.png","modified":0,"renderable":0},{"_id":"source/images/image-4-1024x604.png","path":"images/image-4-1024x604.png","modified":0,"renderable":0},{"_id":"source/images/image-3.png","path":"images/image-3.png","modified":0,"renderable":0},{"_id":"source/images/image-4.png","path":"images/image-4.png","modified":0,"renderable":0},{"_id":"source/images/image-5-1024x669.png","path":"images/image-5-1024x669.png","modified":0,"renderable":0},{"_id":"source/images/image-5.png","path":"images/image-5.png","modified":0,"renderable":0},{"_id":"source/images/image-6-1024x604.png","path":"images/image-6-1024x604.png","modified":0,"renderable":0},{"_id":"source/images/image-6.png","path":"images/image-6.png","modified":0,"renderable":0},{"_id":"source/images/image-7-1024x136.png","path":"images/image-7-1024x136.png","modified":0,"renderable":0},{"_id":"source/images/image-7.png","path":"images/image-7.png","modified":0,"renderable":0},{"_id":"source/images/image-8-1024x604.png","path":"images/image-8-1024x604.png","modified":0,"renderable":0},{"_id":"source/images/image-8.png","path":"images/image-8.png","modified":0,"renderable":0},{"_id":"source/images/image-9-1024x604.png","path":"images/image-9-1024x604.png","modified":0,"renderable":0},{"_id":"source/images/image-9.png","path":"images/image-9.png","modified":0,"renderable":0},{"_id":"source/images/image.png","path":"images/image.png","modified":0,"renderable":0},{"_id":"source/images/n8n-linode.png","path":"images/n8n-linode.png","modified":0,"renderable":0},{"_id":"source/images/streamlit_yolo.png","path":"images/streamlit_yolo.png","modified":0,"renderable":0},{"_id":"source/images/ubuntu-swap.png","path":"images/ubuntu-swap.png","modified":0,"renderable":0},{"_id":"source/images/unity-data-scene.png","path":"images/unity-data-scene.png","modified":0,"renderable":0},{"_id":"source/images/告別手動備份：WordPress-網站利用-Cron-Rclone-自動同步檔案到-Google-Drive-完整教學.png","path":"images/告別手動備份：WordPress-網站利用-Cron-Rclone-自動同步檔案到-Google-Drive-完整教學.png","modified":0,"renderable":0},{"_id":"source/images/未命名-2-1021x1024.png","path":"images/未命名-2-1021x1024.png","modified":0,"renderable":0},{"_id":"source/images/未命名-2.png","path":"images/未命名-2.png","modified":0,"renderable":0},{"_id":"source/images/螢幕擷取畫面-2025-10-19-214356.png","path":"images/螢幕擷取畫面-2025-10-19-214356.png","modified":0,"renderable":0},{"_id":"source/images/螢幕擷取畫面-2025-11-05-163916-1024x606.png","path":"images/螢幕擷取畫面-2025-11-05-163916-1024x606.png","modified":0,"renderable":0},{"_id":"source/images/螢幕擷取畫面-2025-11-05-163916.png","path":"images/螢幕擷取畫面-2025-11-05-163916.png","modified":0,"renderable":0},{"_id":"source/images/favicon/favicon-32x32.png","path":"images/favicon/favicon-32x32.png","modified":0,"renderable":0},{"_id":"source/images/openai/openai-api1.png","path":"images/openai/openai-api1.png","modified":0,"renderable":0},{"_id":"source/images/openai/openai-api2.png","path":"images/openai/openai-api2.png","modified":0,"renderable":0},{"_id":"source/images/openai/openai-api3.png","path":"images/openai/openai-api3.png","modified":0,"renderable":0},{"_id":"source/images/openai/openai-api4.png","path":"images/openai/openai-api4.png","modified":0,"renderable":0},{"_id":"source/images/openai/openai-api5.png","path":"images/openai/openai-api5.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account1.png","path":"images/Line-Bot/create-account/create-account1.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account10.png","path":"images/Line-Bot/create-account/create-account10.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account11.png","path":"images/Line-Bot/create-account/create-account11.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account2.png","path":"images/Line-Bot/create-account/create-account2.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account3.png","path":"images/Line-Bot/create-account/create-account3.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account4.png","path":"images/Line-Bot/create-account/create-account4.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account5.png","path":"images/Line-Bot/create-account/create-account5.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account6.png","path":"images/Line-Bot/create-account/create-account6.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account8.png","path":"images/Line-Bot/create-account/create-account8.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account7.png","path":"images/Line-Bot/create-account/create-account7.png","modified":0,"renderable":0},{"_id":"source/images/Line-Bot/create-account/create-account9.png","path":"images/Line-Bot/create-account/create-account9.png","modified":0,"renderable":0},{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/butterfly-icon.png","path":"img/butterfly-icon.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/error-page.png","path":"img/error-page.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"source/images/banner01.jpeg","path":"images/banner01.jpeg","modified":0,"renderable":0},{"_id":"source/images/banner02.jpeg","path":"images/banner02.jpeg","modified":0,"renderable":0}],"Cache":[{"_id":"source/index.md","hash":"a4f9e9f2e129b92eff736f559892bf9c7155af5f","modified":1769609845279},{"_id":"source/_data/link.yml","hash":"6aaf04b5c920e403bea8f82e4b3f4d719760e6df","modified":1769609845059},{"_id":"source/_posts/2025-03-30-nginx-cerbot.md","hash":"b5f584554b893b2440e2f70e052447c98029a0d2","modified":1769569169110},{"_id":"source/archives/index.md","hash":"e77e8a7ce253281de7b43100c723317e39d34167","modified":1769609845070},{"_id":"source/_posts/2025-03-31-wordpress-start.md","hash":"e9316b85fb586a8951bdeb9c87005e07ad1f3620","modified":1769569169117},{"_id":"source/_posts/2025-04-04-mac-docker-error.md","hash":"6dd007848b6be8791a6274f63688a9fe1239da0e","modified":1769569169115},{"_id":"source/_posts/2025-10-17-android-locationapp.md","hash":"2675f61f9f425d26cfd7b348a36b1b98ad598c57","modified":1769569169110},{"_id":"source/_posts/2025-10-21-cpu-job-time.md","hash":"b6da8c8d87a7aededf7cdc0ac61533a59ecf5ea2","modified":1769569169108},{"_id":"source/_posts/2025-10-26-yolov9-practice.md","hash":"3c09b9720d194b55f84f4bf29c11be4bcd2afc46","modified":1769569169110},{"_id":"source/_posts/2025-10-20-pytorch-base.md","hash":"6d62267450848dc6dc789b826a8d5bdb555684bc","modified":1769569169109},{"_id":"source/_posts/2025-10-29-training-a-classifier.md","hash":"bf6ce9196458fec61f814321dc1047aaf3951f59","modified":1769569169111},{"_id":"source/_posts/2025-11-05-linode-docker-n8n.md","hash":"343eae4f6b9b9d319965ffa04029fac0637bde63","modified":1769569169116},{"_id":"source/_posts/2025-11-13-ubuntu-swap-setting.md","hash":"c40b32e1f394a921dbd6485bd395d0b41734beea","modified":1769569169113},{"_id":"source/_posts/2025-11-14-wp-cron-backup.md","hash":"e092857a6281be06d3ab47ce5168d843075fda6c","modified":1769569169115},{"_id":"source/_posts/2025-11-15-wp-restore-local.md","hash":"532610add057ae81f10ad778b439125962aa5add","modified":1769569169116},{"_id":"source/_posts/2025-11-24-interest-and-yield.md","hash":"11c0ebbaecfdbd0b0c36a6408de263d1403030b3","modified":1769569169115},{"_id":"source/_posts/2025-11-26-next-js-v16-base.md","hash":"87ec94c41c3a972989e241aae1d569bc070f39d2","modified":1769569169111},{"_id":"source/_posts/2025-12-04-unity-scene-data.md","hash":"66508af15ad95ba1ad92e367807f9bf82183365d","modified":1769569169114},{"_id":"source/_posts/2025-12-01-streamlit-yolo.md","hash":"5e35c49fafdd045105a73d6999eb6dc174d614bc","modified":1769569169113},{"_id":"source/_posts/Daphne 無法抓取 CSS 解決方法.md","hash":"ddaf23f67d4a496e55cae6a5d906b353dd842de3","modified":1769609845059},{"_id":"source/_posts/Django-WebSocket.md","hash":"9e802a901d25f07789f97286d84a472bc09d98ef","modified":1769609845060},{"_id":"source/_posts/Line-Bot與Chatgpt應用-串接replit大神程式.md","hash":"85bf6aade79b07cc2f9caadb9a46081592aefa71","modified":1769609845060},{"_id":"source/_posts/Line-Bot-與-Openai-SQL-成績查詢.md","hash":"c85381d25b3fc2d2860f18378dc69c749601de7c","modified":1769609845060},{"_id":"source/_posts/Line-Bot與Chatgpt應用-建立機器人帳號.md","hash":"03b17bf3ded7be39f9dee333211bea80f70b15d2","modified":1769609845060},{"_id":"source/_posts/Mac-Django-建置環境.md","hash":"c14dddd5b5661de19a8a94f8da6b74c93edcd365","modified":1769609845062},{"_id":"source/_posts/UVA-10041-Vito-s-Family.md","hash":"c9fe54d94df54d9d2551558469b9108849ec585f","modified":1769609845062},{"_id":"source/_posts/Wordpress-動態選單.md","hash":"d23ae994bc88c4b4feeab552e87d10c7c8758e6c","modified":1769609845062},{"_id":"source/_posts/UVA-10420-List-of-Conquests.md","hash":"b9a0b25f7f4137f6fdad6b672659a5589c630cd7","modified":1769609845062},{"_id":"source/_posts/post-1.md","hash":"f3a14c14455f981a39a76801539c5df8d459f3ec","modified":1769609845065},{"_id":"source/_posts/在-Mac-vscode-中使用-Code-Runner-和-C-C-插件來編譯與執行-C-程式.md","hash":"fd562255584fe4c2cf6b0b707a9f1fcd5564dfae","modified":1769609845070},{"_id":"source/_posts/本地專案推送至Bitbucket遠端存放庫.md","hash":"bf0cbcaa50ef809500e813275f5a248e1efa0f58","modified":1769609845070},{"_id":"source/_posts/撰寫 Python 發送成績給學生確認.md","hash":"4922b68cce02a8aa1e4f58e76485bf69b6b50423","modified":1769609845070},{"_id":"source/categories/index.md","hash":"31c3982cdb96ea4f800d73ba278d03fc66a6fe60","modified":1769609845070},{"_id":"source/css/custom.css","hash":"7ad0d410025a9372c584e930f20706dbac869364","modified":1769609845072},{"_id":"source/css/wave.css","hash":"07df44492e73b6945bd97e528b1e00ec0a72f963","modified":1769609845072},{"_id":"source/link/index.md","hash":"3e3593f06cb7fbcb3004c4e8f29fae728a07fb0a","modified":1769609845279},{"_id":"source/tags/index.md","hash":"f381affa75867afcea8cbf6a458df44cf9a579ab","modified":1769609845279},{"_id":"source/images/64b6bd08-e4f1-4125-aba5-2886b5bc938a.webp","hash":"5b627f73a8578537b626194990ccf9e0968eb90f","modified":1769566697482},{"_id":"source/images/09d01d97-6054-4172-930a-5cf01b8bf9a8.webp","hash":"710e15854a35efa9169f959f3e8d9068e52f98ae","modified":1769566695434},{"_id":"source/images/CleanShot-2025-10-29-at-11.47.42@2x-1024x85.png","hash":"a5a6f13bdef6af2125b919210f90e80bdceb48e0","modified":1769566743792},{"_id":"source/images/CleanShot-2025-10-29-at-11.57.50@2x-1024x45.png","hash":"ce0d3bd5c55d00e61f447d171284e692d2802917","modified":1769566744285},{"_id":"source/images/CleanShot-2025-10-29-at-11.47.42@2x.png","hash":"bd971fa34f7bf6537b554a4e210d70988b6e478b","modified":1769566741808},{"_id":"source/images/CleanShot-2025-10-29-at-11.57.50@2x.png","hash":"94f42ba668ec2a0d571c0d31964e2aba24a20654","modified":1769566742271},{"_id":"source/images/CleanShot-2025-10-29-at-11.59.02@2x-1024x84.png","hash":"987043a55a4063e75441c4ed83d1e013c055cd51","modified":1769566744773},{"_id":"source/images/CleanShot-2025-10-29-at-11.59.02@2x.png","hash":"861063f39d8fdc74f82f4e5d68614e41453de69a","modified":1769566742795},{"_id":"source/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png","hash":"781d49464c287c421c2056e981badb348a0d0c97","modified":1769566771454},{"_id":"source/images/CleanShot-2025-11-15-at-11.44.53@2x-1024x632.png","hash":"4ea72fcb145fe46e386e4357276b138a27dc497f","modified":1769566772395},{"_id":"source/images/CleanShot-2025-11-15-at-12.02.52-1024x611.png","hash":"3859571ce9679e3b9edd981c9d3f6c8b93e5abd4","modified":1769566772917},{"_id":"source/images/CleanShot-2025-11-15-at-12.09.41@2x-1024x632.png","hash":"b8a9462350ba6506493a2d5c15ce8a4432158b8b","modified":1769566773400},{"_id":"source/images/CleanShot-2025-11-15-at-12.17.01-1024x611.png","hash":"11c8b208a1a7639b6a19b776b56e9081dddb3955","modified":1769566774022},{"_id":"source/images/CleanShot-2025-11-15-at-12.18.22.png","hash":"a61bf279da345ca900a642c76f72de5492cf4688","modified":1769566761895},{"_id":"source/images/CleanShot-2025-11-15-at-12.20.47.png","hash":"377c174a0fc84baa53d78964c85bce4639d35d89","modified":1769566762268},{"_id":"source/images/CleanShot-2025-11-15-at-12.20.47-1024x228.png","hash":"91f6f382b90db98409293590aa96b9813ad5218a","modified":1769566774361},{"_id":"source/images/CleanShot-2025-11-15-at-12.21.44-1024x277.png","hash":"b7d98c38fcca4727492adae2c9dbaa3de5885067","modified":1769566774923},{"_id":"source/images/CleanShot-2025-11-15-at-12.23.00-1024x611.png","hash":"388934fa0d61136de14d7b4309176e21c8ff7821","modified":1769566775482},{"_id":"source/images/CleanShot-2025-11-15-at-12.24.17@2x-1024x632.png","hash":"ca172ed9875fe1c093a985600f85bc4ff0d23d36","modified":1769566775903},{"_id":"source/images/CleanShot-2025-11-15-at-12.21.44.png","hash":"5cf87a60649b9b69696a2aa42ab612e707439afd","modified":1769566763005},{"_id":"source/images/CleanShot-2025-11-15-at-12.29.35@2x-1024x599.png","hash":"2066b062d846878a547bb26d27bfd74ff1c27f9e","modified":1769566777471},{"_id":"source/images/CleanShot-2025-11-15-at-12.29.00@2x-1024x599.png","hash":"2a2a5fd1f4cba25e2c7224d86ecdd0a3f4bfe177","modified":1769566776889},{"_id":"source/images/CleanShot-2025-11-15-at-12.32.25@2x-1024x599.png","hash":"aaf25f7db6d3b29eab6c8829d6d09523355ac4a5","modified":1769566778031},{"_id":"source/images/CleanShot-2025-11-15-at-12.48.01@2x-1024x632.png","hash":"b1c5d0f759397aa74fe3e9882003e24d015a0dc8","modified":1769566778906},{"_id":"source/images/CleanShot-2025-11-15-at-12.36.18@2x-1024x599.png","hash":"341f0cdde6fa82e3cd5419b258c79e9fd50d6956","modified":1769566778258},{"_id":"source/images/CleanShot-2025-11-15-at-13.26.07-1024x583.png","hash":"a87d3e68207c2b243da80a2a5d2d7ebdb0e4ed67","modified":1769566779419},{"_id":"source/images/CleanShot-2025-11-15-at-13.40.02@2x-1024x599.png","hash":"d03ef0422440b8ecbd1af248d544e8a60058e934","modified":1769566779685},{"_id":"source/images/CleanShot-2025-11-15-at-13.41.36@2x-1024x606.png","hash":"5fb243b1763fb68c77f7c2694a63f6623f434843","modified":1769566780478},{"_id":"source/images/CleanShot-2025-11-15-at-15.00.18-1024x611.png","hash":"c2d6095a51826f3fa8bd1e7e44de9f56af1c04eb","modified":1769566756386},{"_id":"source/images/CleanShot-2025-11-15-at-15.00.44-1024x611.png","hash":"23239c9201049ff3bb9dbd78f2be16dce7c46a77","modified":1769566756865},{"_id":"source/images/CleanShot-2025-11-15-at-15.01.04-1024x611.png","hash":"d7a9122c2d751b065475dff903efbe0a71567d96","modified":1769566757395},{"_id":"source/images/CleanShot-2025-11-26-at-21.16.14-1024x662.png","hash":"15c000f46e68d198af79d55d86000e045e371e88","modified":1769566799819},{"_id":"source/images/CleanShot-2025-11-26-at-21.17.46-1024x664.png","hash":"b575adf00dbd1ae782785c22919e7833e7ed7055","modified":1769566799313},{"_id":"source/images/CleanShot-2025-11-26-at-21.16.14.png","hash":"997d3991252030a4319ab5c7da2ef0e543d7ea93","modified":1769566788786},{"_id":"source/images/CleanShot-2025-11-26-at-21.35.15.png","hash":"83794eeeab1498fa852212d464b80f69327e78ee","modified":1769566790011},{"_id":"source/images/CleanShot-2025-11-26-at-21.35.15-1024x667.png","hash":"d95eb6e4069be9bfdeef7c37f1bafcafa58e5ec6","modified":1769566800314},{"_id":"source/images/CleanShot-2025-11-26-at-22.18.53-1024x667.png","hash":"8143414e09e2041f3363863e8f8a77b0dd3d8acb","modified":1769566801306},{"_id":"source/images/CleanShot-2025-11-27-at-10.33.25.png","hash":"559fbedec2ab8544cae2066e5901171917610f87","modified":1769566792911},{"_id":"source/images/CleanShot-2025-11-27-at-10.33.25-1024x657.png","hash":"edec184d3aeca26398f393269a83804f89cf3d65","modified":1769566802812},{"_id":"source/images/CleanShot-2025-11-27-at-10.34.45-1024x657.png","hash":"ae3c017fdf390e96296b33e631aa7743983d3aeb","modified":1769566802312},{"_id":"source/images/CleanShot-2025-11-27-at-10.34.45.png","hash":"0bc1079381c43c8c79d4a98aedd7b1aedb89cd15","modified":1769566793190},{"_id":"source/images/CleanShot-2025-11-27-at-22.43.19-1024x670.png","hash":"7d2a2f9c46df6bb3b49527c49de7a7c45eef3bfd","modified":1769566804773},{"_id":"source/images/CleanShot-2025-11-27-at-12.47.38-1024x664.png","hash":"90e30bca9ea8fd9352e95394e5c93ace70b31a0c","modified":1769566803321},{"_id":"source/images/CleanShot-2025-11-27-at-22.47.08-1024x588.png","hash":"c710cf32323934825779d38d2a20bc066e558ff5","modified":1769566804301},{"_id":"source/images/CleanShot-2025-11-27-at-22.43.19.png","hash":"f618be6c90fd81cbaf450800666a9023d50f39d6","modified":1769566796001},{"_id":"source/images/CleanShot-2025-11-28-at-10.28.43-1024x670.png","hash":"18c3c8c929924659a4fdce2af98c8551822e491d","modified":1769566805779},{"_id":"source/images/CleanShot-2025-11-28-at-10.25.54-1024x578.png","hash":"768220669ba660d922570203dd2acc12a53bac4e","modified":1769566805059},{"_id":"source/images/CleanShot-2025-11-28-at-10.33.17-1024x670.png","hash":"5c8ba307a791ca42ee447c4e214a0ed2a88dff1d","modified":1769566806064},{"_id":"source/images/CleanShot-2025-12-01-at-16.05.16.png","hash":"43b463770d11cfdf0dd539c9d436343e9411dbda","modified":1769566807167},{"_id":"source/images/CleanShot-2025-12-01-at-16.05.16-1024x660.png","hash":"d38d2b782bb9667e7b2df02904343ff75a5e78fe","modified":1769566809380},{"_id":"source/images/CleanShot-2025-12-01-at-16.05.37-1024x660.png","hash":"9a7c6166a01e35e22c66094ed1514bc529ab9234","modified":1769566809982},{"_id":"source/images/CleanShot-2025-12-04-at-10.55.31.png","hash":"8378d05b8a685cb37e960434ccf39da1035cebb1","modified":1769566810375},{"_id":"source/images/CleanShot-2025-12-04-at-10.56.41.png","hash":"b3721a277775687566c87b4619d1644e6aa02696","modified":1769566810649},{"_id":"source/images/Docker.png","hash":"ecae216d7b79d7d86fed514b7e20fa702c3221aa","modified":1769566697889},{"_id":"source/images/CleanShot-2025-12-04-at-11.02.07.png","hash":"2aa577dfafe51fec376988fbc140eecdcf44001a","modified":1769566811298},{"_id":"source/images/Logo.png","hash":"3f88903fb1e19e29066ce407a2ffa421cf3e64de","modified":1769526904629},{"_id":"source/images/favicon.ico","hash":"5afa977c0e959a965e16cf29d8bd078713f23f24","modified":1769526904633},{"_id":"source/images/good-fcp-values-18.svg","hash":"747f1668c4f0527daa9138129fd7251c10d9c33f","modified":1769566806683},{"_id":"source/images/image-1.png","hash":"3e8714303ada1452b298d19127df4e87a132d6d0","modified":1769566746056},{"_id":"source/images/image-11.png","hash":"56a167032666b8ece9e4f0de718fcc7163f4ad65","modified":1769566784811},{"_id":"source/images/image-10.png","hash":"df9b949d73fc941de339f5f4996055e80cbe7baf","modified":1769566786811},{"_id":"source/images/image-1-1024x557.png","hash":"562888329c3b6f008b4fc6bf71c1669142548b1d","modified":1769566747167},{"_id":"source/images/image-12-1024x594.png","hash":"5b341ee0a81677cdab6b4b5e2de46d125ee7b475","modified":1769566734922},{"_id":"source/images/image-11-1024x594.png","hash":"2c2711d0fb54c2d6b10c6e5288fca07d2df39de8","modified":1769566734387},{"_id":"source/images/image-13.png","hash":"f34fe0bde44e76e0851bc7ed300fa1a8889cfbfc","modified":1769566790063},{"_id":"source/images/image-14.png","hash":"71c316d8ebc4ac6465115b5d2d311ddba610614c","modified":1769566792000},{"_id":"source/images/image-14-1024x336.png","hash":"334933651356f61113be668ec2b66c15c328a2f5","modified":1769566801771},{"_id":"source/images/image-15.png","hash":"f337b34391c0fc65df597ada196aa8eddfc375da","modified":1769566792056},{"_id":"source/images/image-16.png","hash":"a38863f18b8438fac5bddbcb977fee787795af03","modified":1769566787822},{"_id":"source/images/image-17.png","hash":"48d3b2c71eb46b97a1134b99124654f33ce74120","modified":1769566793803},{"_id":"source/images/image-19.png","hash":"f10a75e3bbe0954d0496045fd99d095907b07645","modified":1769566729796},{"_id":"source/images/image-18.png","hash":"d457a5b54ac0a348c7232699b8ca1c119d5da446","modified":1769566798805},{"_id":"source/images/image-2-1024x510.png","hash":"4ec3fb81656d54929a566dbd14a89692de403f3e","modified":1769566754948},{"_id":"source/images/image-20-1024x664.png","hash":"3a50da78ba78287b2d2bd45cd336c03967484f23","modified":1769566737995},{"_id":"source/images/image-21.png","hash":"98c88bb2400ded56bab2c16472b7e3f4907140d5","modified":1769566730886},{"_id":"source/images/image-20.png","hash":"da13de5da8b95e81f2ab1b5b6971922127d8214c","modified":1769566730418},{"_id":"source/images/image-23-1024x448.png","hash":"f9bf8230052cd91004d06c06b2e2475de94b971a","modified":1769566739054},{"_id":"source/images/image-23.png","hash":"3e1214517146407f403ed1fdcde1ac17f41614a6","modified":1769566731909},{"_id":"source/images/image-25.png","hash":"b8447053493d8a0f5e0fbb85624928602e1cee4a","modified":1769566732807},{"_id":"source/images/image-21-1024x459.png","hash":"a0e8f15dfea4e63ebf4b50adc6f86a95b363ad56","modified":1769566737398},{"_id":"source/images/image-26.png","hash":"6f3bdcde1b0761fed7c43705803e456b4222846b","modified":1769566733564},{"_id":"source/images/image-28.png","hash":"58d52e66decd57077fadb5226e12ca722188de6a","modified":1769566740801},{"_id":"source/images/image-27.png","hash":"e38735b017c828a80c651e3d3ed8d09e07e66e59","modified":1769566740412},{"_id":"source/images/image-3-1024x604.png","hash":"06153fd359e999c751cf8f07afc39b643246de35","modified":1769566722183},{"_id":"source/images/image-4-1024x604.png","hash":"424d71caad807a89d697975c516c573b5ec44502","modified":1769566722903},{"_id":"source/images/image-3-1024x526.png","hash":"0b14113ac9cb72579fa5dc62a467cd2274dc5e6f","modified":1769566755497},{"_id":"source/images/image-3.png","hash":"65f936e8936df415a3b93587c7f5acd0589ec580","modified":1769566752369},{"_id":"source/images/image-4.png","hash":"b6194f7282fa50c382a1ffcbefe541815449ae3f","modified":1769566781810},{"_id":"source/images/image-5.png","hash":"078b7c6e26d50262dc24c8b84e45836d25e831d7","modified":1769566782064},{"_id":"source/images/image-5-1024x669.png","hash":"e114e222dbdcf97b84befde090c594a648f636f5","modified":1769566723383},{"_id":"source/images/image-7-1024x136.png","hash":"5c75cb63be0602a52b5267a525cdd91b64c1cb89","modified":1769566785908},{"_id":"source/images/image-6-1024x604.png","hash":"22750ef8d113bbfcd8a2b3606d5bbd50bc2dbe75","modified":1769566723924},{"_id":"source/images/image-6.png","hash":"462a26aef55c11072f4d5b72de3e54c3243c49e9","modified":1769566782777},{"_id":"source/images/image-7.png","hash":"1838a6e840dcfb3ce452489d06022e1fe288b76a","modified":1769566783279},{"_id":"source/images/image-8.png","hash":"258846e4964dcfe74ca072a5356f5e4f69b372e2","modified":1769566783800},{"_id":"source/images/image-8-1024x604.png","hash":"ae337fd82294eb03f3ba7e695b6658b12de3eb1c","modified":1769566724379},{"_id":"source/images/image-9-1024x604.png","hash":"2eb704ce4e98ce81e473792fee7ef70399a3bf15","modified":1769566724906},{"_id":"source/images/image-9.png","hash":"d83e6ee24f43be12afff65e15611a7e5a855b065","modified":1769566784249},{"_id":"source/images/image.png","hash":"074de18c4eb4ee2c0215d11ddd38dccb379aba0d","modified":1769566745407},{"_id":"source/images/streamlit_yolo.png","hash":"a38dc16872b8103bcf7dde4ed901df44a6d9b82d","modified":1769566808515},{"_id":"source/images/未命名-2-1021x1024.png","hash":"f35ef6dadcff906b723a6a00756a50e59079039a","modified":1769566800806},{"_id":"source/images/未命名-2.png","hash":"af03e407ba59a1e769c5d9329523c38818bdaace","modified":1769566787493},{"_id":"source/images/favicon/favicon-32x32.png","hash":"450e687c4fda4ec2c05e02565d2c070ecd9007c0","modified":1769526904633},{"_id":"source/images/螢幕擷取畫面-2025-11-05-163916.png","hash":"dc6b7565343d932de36f080a00abb783b189292e","modified":1769566746528},{"_id":"source/images/螢幕擷取畫面-2025-10-19-214356.png","hash":"c22579145f69d91f0f55a72ff3b207bc6bc4c17c","modified":1769566716759},{"_id":"source/images/螢幕擷取畫面-2025-11-05-163916-1024x606.png","hash":"0b2565cd1bf3c602b8b8a203867ede4ae9b9aa15","modified":1769566747907},{"_id":"source/images/CleanShot-2025-10-29-at-11.41.16@2x-1024x385.png","hash":"cce78db6062f3ef510dab04aab041bf97f577ca9","modified":1769566743514},{"_id":"source/images/CleanShot-2025-10-29-at-11.41.16@2x.png","hash":"06b4d52d73232849bb3b0fba756277eadfd26d90","modified":1769566741453},{"_id":"source/images/CleanShot-2025-11-15-at-11.42.31@2x-1.png","hash":"ea887e53d9c00afc192e2e3453915c5423ad379a","modified":1769566758484},{"_id":"source/images/CleanShot-2025-11-14-at-18.10.07@2x.png","hash":"0b2920e67d3845cbca9079b50646af777f5aa506","modified":1769566751276},{"_id":"source/images/CleanShot-2025-11-15-at-11.42.31@2x.png","hash":"ea887e53d9c00afc192e2e3453915c5423ad379a","modified":1769566757762},{"_id":"source/images/CleanShot-2025-11-15-at-11.44.53@2x.png","hash":"941f4d5e681d47dea90be6a59cb1a1937b10224e","modified":1769566758928},{"_id":"source/images/CleanShot-2025-11-15-at-12.02.52-scaled.png","hash":"87df0261ce2f7ef2ae34909e54471367662649bb","modified":1769566760605},{"_id":"source/images/CleanShot-2025-11-15-at-12.09.41@2x.png","hash":"1cfe39498a5f6f35bd7502b439cf0df82c80535f","modified":1769566761132},{"_id":"source/images/CleanShot-2025-11-15-at-12.24.17@2x-1.png","hash":"ab948737bd5942051a337a4772e6088d8319020e","modified":1769566764661},{"_id":"source/images/CleanShot-2025-11-15-at-12.24.17@2x.png","hash":"ab948737bd5942051a337a4772e6088d8319020e","modified":1769566764170},{"_id":"source/images/CleanShot-2025-11-15-at-12.28.08@2x-1024x599.png","hash":"5f200f0853d25c89f6de9129302b3d0ea99fafff","modified":1769566776541},{"_id":"source/images/CleanShot-2025-11-15-at-12.29.00@2x.png","hash":"8775cdebaf99fe0d772d6a286debcf501795719e","modified":1769566765986},{"_id":"source/images/CleanShot-2025-11-15-at-12.48.01@2x.png","hash":"caee61054eab575754bd7d4e41c20ef95fb39590","modified":1769566768597},{"_id":"source/images/CleanShot-2025-11-15-at-13.40.02@2x.png","hash":"4ea6fae41e168cd53a3b851ba8fd90c38889a1e1","modified":1769566769630},{"_id":"source/images/CleanShot-2025-11-15-at-13.44.56-1024x611.png","hash":"66cd39d151a9d38656bcac7075acf3f80ceb30cc","modified":1769566781516},{"_id":"source/images/CleanShot-2025-11-26-at-20.38.02@2x-scaled.png","hash":"172008853f47188cc12e54f60f11a1d579ba5086","modified":1769566788649},{"_id":"source/images/CleanShot-2025-11-26-at-22.18.53-1.png","hash":"0accaf6c77aeff08ab459f24b4c5cbaabccb0b55","modified":1769566791321},{"_id":"source/images/CleanShot-2025-11-27-at-12.46.54.png","hash":"bfb3baeafe34e581e84e2c69337b4470476def53","modified":1769566794486},{"_id":"source/images/CleanShot-2025-11-26-at-22.18.53.png","hash":"0accaf6c77aeff08ab459f24b4c5cbaabccb0b55","modified":1769566791019},{"_id":"source/images/CleanShot-2025-11-27-at-12.47.38.png","hash":"caa388bad9e99f65a10b632f113f7c117e6a850d","modified":1769566795022},{"_id":"source/images/CleanShot-2025-11-26-at-21.17.46.png","hash":"eed41a11d96f6d4eabe0bdece835a1a860d94abc","modified":1769566789525},{"_id":"source/images/CleanShot-2025-11-27-at-22.33.36.png","hash":"341c24b213140990ce7665867d46c8375d26b804","modified":1769566795579},{"_id":"source/images/CleanShot-2025-11-28-at-10.25.54.png","hash":"d43319c66c07c786b392bf541ad1e538c66b5d65","modified":1769566796794},{"_id":"source/images/CleanShot-2025-11-27-at-22.47.08.png","hash":"164c746f6b88908fe79e309b1d1e39471d553a8d","modified":1769566796629},{"_id":"source/images/CleanShot-2025-11-28-at-10.28.43.png","hash":"cf5369dbe4c1fc7810f086761964e97424fdea09","modified":1769566797454},{"_id":"source/images/CleanShot-2025-11-28-at-10.33.17.png","hash":"4e8fd94cc62dfc6b1e842b346e5928ddeb191738","modified":1769566797981},{"_id":"source/images/CleanShot-2025-12-01-at-16.05.37.png","hash":"f80de591762c0846e9fda9d002e58fafb92ab302","modified":1769566807983},{"_id":"source/images/Gemini_Generated_Image_si41pisi41pisi41-1.png","hash":"0cbf726ea00904a05015c0e51c7d6d36d0167e56","modified":1769566809083},{"_id":"source/images/Gemini_Generated_Image_8zuhop8zuhop8zuh-1.png","hash":"863996fc1695dd9c2bb832c80bdfc1af6156d1d2","modified":1769566785963},{"_id":"source/images/Pytorch.png","hash":"4dd8cc649c923443be6c4fc6557729b4a3bfd20c","modified":1769566739466},{"_id":"source/images/image-14-1024x594.png","hash":"29abf4aeaac9fb616f8f5a93c7b7953f33b73045","modified":1769566735630},{"_id":"source/images/image-16-1024x594.png","hash":"5d8bd552ff185968db689c825cbeeb0d50c63663","modified":1769566736102},{"_id":"source/images/image-17-1024x593.png","hash":"0ec3a3f7933f28cc68e67c177fe101ab20f2abb1","modified":1769566736670},{"_id":"source/images/image-18-1024x542.png","hash":"fe4701d14311d0823353ed24e19191c9c208e385","modified":1769566737108},{"_id":"source/images/image-2.png","hash":"908baa21bfc27b7d240660fe5925fb20a3ec816e","modified":1769566751016},{"_id":"source/images/image-22-1024x554.png","hash":"f451c385191248697bd968b5ef78797128494e05","modified":1769566738397},{"_id":"source/images/image-22.png","hash":"5664f85e4030d5d6fde7b904975162baae905b30","modified":1769566731579},{"_id":"themes/butterfly/LICENSE","hash":"c8bc7df08db9dd3b39c2c2259a163a36cf2f6808","modified":1769568993601},{"_id":"themes/butterfly/.gitignore","hash":"1e843a7254515d97ddb1d1d32ae83ebfae937f54","modified":1769610113511},{"_id":"themes/butterfly/README_CN.md","hash":"5595df16d0b28133a232cb5f45bbcf60798073e9","modified":1769568993602},{"_id":"themes/butterfly/README.md","hash":"4ff8ff47a38674ac55270b844171d7a0a6b52afd","modified":1769610113515},{"_id":"themes/butterfly/package.json","hash":"c3b121a6403087e30b6ed530aa6abb6cd1465315","modified":1769568993611},{"_id":"themes/butterfly/plugins.yml","hash":"9827d948ad26bc13a90862c18090ed2d20761d5a","modified":1769568993611},{"_id":"themes/butterfly/.github/FUNDING.yml","hash":"859c2448942ab4fcf4a2fbdeff52dac8e68a9e96","modified":1769610113508},{"_id":"themes/butterfly/_config.yml","hash":"ab64fb861f4808501c1061ed34f26759f06dfb88","modified":1769568993602},{"_id":"themes/butterfly/languages/default.yml","hash":"97e89708bea9740e7e156b53304d7f4697f6332d","modified":1769568993602},{"_id":"themes/butterfly/languages/en.yml","hash":"6d2a5795862abc121a164e8519e7587bb57af7c7","modified":1769568993602},{"_id":"themes/butterfly/languages/ja.yml","hash":"d97b97ebb8a1c8754373b450d4e81341b5dcd208","modified":1769568993602},{"_id":"themes/butterfly/languages/zh-HK.yml","hash":"e2958e5b72fd2cb33b6706bc1588de6b8d9dde8f","modified":1769568993602},{"_id":"themes/butterfly/languages/ko.yml","hash":"4a959730509b211484b20d9fcabc80a9c7e8cc1f","modified":1769568993602},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"25e717994a3eab37ccb9cf3ae5fec5647b525ced","modified":1769568993602},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"af38319aa58cab193f90ef8caecdb9a26cdd165a","modified":1769568993602},{"_id":"themes/butterfly/layout/archive.pug","hash":"bc77220dfc269b8faad0930e1a4142ebf68165e5","modified":1769568993603},{"_id":"themes/butterfly/layout/category.pug","hash":"a7e9805a781e34e38d27462e6ce2a5821c34bb9f","modified":1769568993603},{"_id":"themes/butterfly/layout/page.pug","hash":"7ce2a49c6c41847de4ccea377ade116339984434","modified":1769568993611},{"_id":"themes/butterfly/layout/tag.pug","hash":"ca5333bd262cb58c195c844b593a0eed0c721766","modified":1769568993611},{"_id":"themes/butterfly/layout/post.pug","hash":"65c4a49c65c3fc4d9dc88b9791a75710c698c3a1","modified":1769568993611},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"e320b40c051bae1549156cd5ea4a51383cf78598","modified":1769568993601},{"_id":"themes/butterfly/.github/workflows/stale.yml","hash":"4040c76547e270aaf184e9b219a44ca41bbb1b9f","modified":1769568993601},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"63ad2249ad09fb3fe21bd5ff9adefb304a7ab24a","modified":1769568993601},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"10ce05c8dbde09f53bdabe40b5388de9ccc71a31","modified":1769568993601},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"6e0f9470b18bd37d4891282ac73d61676b040e8c","modified":1769568993601},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"874bd7496c606edcdc8a6150baff00299dfb9139","modified":1769568993603},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"da95d64f44e1e6b516d1f96f57b4b0a537c29c19","modified":1769568993603},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"1d11e334b22dbbedcb0f751f9ee9789d4416605e","modified":1769568993603},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"908163a8a5e6d0d9e175a2feeecda7bde58ef05a","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"b04541e080f4485c94cad8ff477a0b140b02ddb9","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"3e65b7bf6bccccbba7e15349f0a44f15c64c5b5e","modified":1769568993606},{"_id":"themes/butterfly/scripts/common/postDesc.js","hash":"ba98361b9d469076bfb045e5ff42eaf764a38fb1","modified":1769568993612},{"_id":"themes/butterfly/scripts/events/404.js","hash":"039fc75f363d79669b0b2177d929cdff6f2ef7a4","modified":1769568993612},{"_id":"themes/butterfly/scripts/common/default_config.js","hash":"30897c6ff059924727d05ea2ab306b771fa4d216","modified":1769610113571},{"_id":"themes/butterfly/scripts/events/cdn.js","hash":"9fbab1a8c8709fc8d330bae9ba4b17a5ca5d783a","modified":1769568993612},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"bac639c404588ea62e601ef0bcd368c3bd0119af","modified":1769568993612},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"3617840416f26078117f760579fb544dce07e1bc","modified":1769568993606},{"_id":"themes/butterfly/scripts/events/init.js","hash":"414f2672483c4fea526b5e26291fbcca49251369","modified":1769610113573},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"f59e10305fef59ea3e62a7395106c0927582879d","modified":1769568993612},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"f96ccb349501dd2a268f1b64861600e3dc15e4e8","modified":1769568993613},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"e3280c8f8ba5a8ce2235b78c7f70dbf3bc622979","modified":1769568993613},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"37b5c46198a2d8fbc60af857a7aa6f0929529922","modified":1769568993613},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"a7e3776b7177c168fa5880397e9611fd3d23a995","modified":1769568993613},{"_id":"themes/butterfly/scripts/helpers/getArchiveLength.js","hash":"263b008efe595d841cbf488f6d59f509b7042e30","modified":1769568993613},{"_id":"themes/butterfly/layout/index.pug","hash":"a93004cc8ec8050df603d32a6e6e02cd96fd9875","modified":1769568993611},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"6955e2a64cfa6315f68165b3fb3e8a5aa44ab057","modified":1769568993613},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"f94370706fe2c8b0597a81afe2f3e9c29e919d83","modified":1769568993613},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"44ee8bc90a2e961837d4fcf280366910e88d8c52","modified":1769568993613},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"2f44e1b3ccd170b256eae178299d6fa933a8d490","modified":1769568993614},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"25eefe10189caf3910a0e5d5b2f2043ae9255531","modified":1769568993614},{"_id":"themes/butterfly/scripts/helpers/series.js","hash":"45367c4ce827329867dbcc750ec125da9ccb2cfd","modified":1769568993613},{"_id":"themes/butterfly/scripts/tag/chartjs.js","hash":"195ba802d7e8406c155124a9c939a2318f82938b","modified":1769568993614},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"1ebe936e202c1baee8f6b7862a431e43db807229","modified":1769568993614},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"cf0bc17d0180231167cc6aa8a00fc64f198cb9f9","modified":1769568993614},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"795b83d4664101a762222c80f01def86331b102e","modified":1769568993614},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"89c6c78d2db43b190055d5690741a79bab4f3e7e","modified":1769568993614},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"e68d8d21f3a86e3646907a3685550ee20e8d4a9f","modified":1769568993614},{"_id":"themes/butterfly/scripts/tag/series.js","hash":"40bc9a065e3a1423e0e66f4911e00713ca9f5e9e","modified":1769568993615},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"3c486b149e28edd1a06843f05a5c355000991b82","modified":1769568993615},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"176804f07567aa80f1ed95897a968a996b155dec","modified":1769568993615},{"_id":"themes/butterfly/scripts/tag/score.js","hash":"f2f8a789967cda9559778b1936233dfb46a1f3a3","modified":1769568993615},{"_id":"themes/butterfly/source/css/var.styl","hash":"41e5eb8c62fdf6ba12c98d026d6f26f08a4380e2","modified":1769568993620},{"_id":"themes/butterfly/source/css/index.styl","hash":"b13d96924a5534bff91d75566b196ac87b4fac22","modified":1769568993620},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"fa3d0a64f7fce4aff7928d4ddd95548978ba001c","modified":1769568993614},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1769568993620},{"_id":"themes/butterfly/source/img/favicon.ico","hash":"455ac256580bf31a45813dbbdb87219bfc8bfb04","modified":1769568993622},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"0561cc5c3d252d9b9b0d04a553028e9450965b6b","modified":1769568993622},{"_id":"themes/butterfly/source/img/error-page.png","hash":"d2519710498a871ca3e913c57e2ba20a805b6430","modified":1769568993621},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1769568993622},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"e93a36d3c29b5a02c7f26a23f96e1f84b063cbe8","modified":1769568993603},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"e20c41be7bdc07fdaef7952a2eb953eebd006ceb","modified":1769568993603},{"_id":"themes/butterfly/source/js/utils.js","hash":"257260811cda85073bb5fd9f9ab25d29be9e4aff","modified":1769568993623},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"56a3c32de1a15627ff38c67f1131cdd6ec5ac924","modified":1769568993603},{"_id":"themes/butterfly/source/js/main.js","hash":"4fb88103d8d76e53033d2fac13ea49549699f669","modified":1769568993622},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"c2156c77a011b20fafd34f03ca073397c21b099f","modified":1769568993603},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"f29123e603cbbcc6ce277d4e8f600ba67498077c","modified":1769568993603},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"83ed05ef1e39f2ee70c3fba2cf96e488d8ffec66","modified":1769568993603},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"5168caadc4cf541f5d6676a9c5e8ae47a948f9ad","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/head/structured_data.pug","hash":"49db40e9d3edcf6323e6fe7c074ab09e41453c82","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"1e1a69aa2cbda2e621c741b3802093244b3cc04e","modified":1769568993603},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"44331c9db74b281b5c5c41439d3407a9076df1a1","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"f478a82ba4c15d4f6a5db38eca5c61f7054fa71d","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"e2d31e0f450ad42c47f7ee96375799342bf2f19b","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"733184f88e3a586a5fcc9d193ad500556b6c8eed","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/loading/fullpage-loading.pug","hash":"d4d266eced4b9167bed86bcc5addc327f78cbdcc","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/loading/index.pug","hash":"d76ce71ba106e350670c021a3dcae57547d01830","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"7d799c4694adb6e265e3f4b975d7f7f6a7021a17","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/mixins/indexPostUI.pug","hash":"abc76a3a57ec063cb0ef3330452b76c2fbb59de3","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"efb40388e37cca0b5e7c3c66e811a42f8d32c910","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/loading/pace.pug","hash":"9d2d539555bab495959b9df734ed5c43a9f9e5a9","modified":1769568993604},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/page/404.pug","hash":"15d32c511e4875066fcbe9cb84c3ada07b5a7c41","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/page/shuoshuo.pug","hash":"2cc8f09b56ade6c581398d977fe38c1ecd9ed024","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"ef7afe0df7a3746744ac8185da7163b7406120ca","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/post/outdate-notice.pug","hash":"b7ce9484bc5c97ea6154f0b78fb9b8951fafedbd","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"db92f25ff3fd061882f81bf74ca560ff66983a0c","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"b96c232e5178d927987791d9ae386dd83679535a","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"af99f4f29bbccfa9d640766b6eb9ecf776374097","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"ed79fef5b5025415ea12eaed970f3fe7f6ef9596","modified":1769568993606},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"6b0fa5f048aca8e9cbe56978301af918cf7ac34a","modified":1769568993605},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"43014bfc63583d3ee8808d526dd165848c0ed52f","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"7cf5ea1dc9a7ebbd945ab6d16e829be345a1392b","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"236c3ce26dd76e80b04d457789475c42da5ac0c8","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/third-party/umami_analytics.pug","hash":"c6b9c2d04ae2d87a985cd1f9c1164749a543b714","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"21e019bdc3b1e796bb00976bb29af2d51f873624","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"e5eed62d90a4bc075d0b88bc756d20d5ff41f54f","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"a8312b527493dabbadbb1280760168d3bc909a3b","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"1aba8aa7cd767dc96879d13a13b4c8ceb9023233","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"1dba77d250eeebfb6e293d504352c7e9ea31980b","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"73d33b6930e7944187a4b3403daf25d27077a2dd","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"d8753772889b5d0f4d15639ed6af5e91e53b1d03","modified":1769568993611},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"66e383b4ef374951eb87dd1bf4cdb7a667193fb5","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"7b5ae404a1205546b7de4be42291315cf918f2b3","modified":1769568993611},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"5e9466ad66fc96959c3de75d97ee92134aab5945","modified":1769568993611},{"_id":"themes/butterfly/layout/includes/widget/card_post_series.pug","hash":"e0bb72fa0ce15964b11b8fe421cae3432394e35f","modified":1769568993611},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"bb842d2aa6469d65bf06af1372f0a19a9e4ef44c","modified":1769568993611},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"1dd19a564320d248dbcee7f118a5b96c6466da65","modified":1769568993611},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"45f620cd87b9ef2aa9d1e024e697ed6b4eecff34","modified":1769568993611},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"9426ab6c6fe84a76582dcb4e7762385c7c0a47f4","modified":1769568993615},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"3f96290299c33e7b60c01b2c8b2a5a92be83e12b","modified":1769568993618},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"fcddd80cdeb6aa81f342cd9f0102302f6ba087a8","modified":1769568993611},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"3aaee8878917abb3f438605ee74e2338216e8f88","modified":1769568993615},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"54ef7d3927f96e2b5922d92e98f86e27562d0b63","modified":1769568993615},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"5abe5480d83ff8b452a780a484d50a44091475bf","modified":1769568993618},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"a51edfd3e499e7d38c32241c40e8e4d371efca73","modified":1769568993616},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"0039d67b27ee98a3340e44539e89dee9e231062e","modified":1769568993618},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"205ccc7d0ec6ce1193b46bc0c9ce0385594581fb","modified":1769568993618},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"c4cda7b0c99015df29ce00fdfddd2f7679653754","modified":1769568993618},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"1f8d715faf3b91b53426e38195c0920afb3bfa1c","modified":1769568993618},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"fc26e980fedde31644ebf878967f66ef9ba32be2","modified":1769568993619},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"4681a9d93a20b8de9f58cdbc794702f76f35192b","modified":1769568993619},{"_id":"themes/butterfly/source/css/_page/shuoshuo.styl","hash":"a764c44ce1f17f966b2f439762f038570af00b1b","modified":1769568993619},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"f6d0cfb510a0e351ec20b043d3d3784d0f6c96a4","modified":1769568993619},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"5a8a181324a2f6b7d8240ea871971444403fa554","modified":1769568993619},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"d33d4af89231f4b0f1300bf2e9725344b4fab969","modified":1769568993619},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"1a1766f8ea6a6576ec6129887e55221f540b9358","modified":1769568993618},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"1cb1c5fcdefc55aab674d7d84d057151f8f76577","modified":1769568993616},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"f30720e897322ce818f3def0a3f91eef23478923","modified":1769568993617},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"fbfce4d67cacd1df22fb73d89d008693f59d9d91","modified":1769568993616},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"5692bcf8929f7ef12b10d860da6cb90ca55752c0","modified":1769568993617},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"f0b01bbf321c2c24fdccaee367dd9fd448031a72","modified":1769568993617},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"4cc02bcbaa4a1933a82a9ea57a603fe2d059fc77","modified":1769568993616},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"ef8e8549fe7ad4b99793844a93b4a89f77f417d5","modified":1769568993617},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"7d7554573c005399bc8c2264a85896d2d51be1e1","modified":1769568993617},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"e22bc88ab369c362905b29514d585b1d6bbfc5f3","modified":1769568993617},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"d4e8a938ef2a1f4bf895d187e4fa529c7476e238","modified":1769568993617},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"d148c8c9d9b2e4897cbb74338a1068cdb1c1b64b","modified":1769568993618},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"30d1f809efd252ed0233d96d4374efd2b01d2292","modified":1769568993619},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"fe348f881d7f8b6022015e25fa0050bd6613c779","modified":1769568993619},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"f3fd3c43f16606a7b956fcb94b0d975b2d705fff","modified":1769568993619},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"37944e0c390cd6f63055fdeeb68f337514d87349","modified":1769568993617},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"e84f1de06b818557cc4c45f9958121952ae268b8","modified":1769568993620},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"543eaf9c7df7e0db841e5946ee5f9082c3c46290","modified":1769568993617},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"3be8d0a75e7cc96548667cae0cb6a474279bd0b5","modified":1769568993620},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"985b183db7b7bfd8f9bdb60494549fb7f850348b","modified":1769568993619},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"3a88eedcb694da79e92581ce50cb1a430b1fb615","modified":1769568993620},{"_id":"themes/butterfly/source/css/_tags/series.styl","hash":"0657169849bc4bf4d93b5492ade040c8f58c1901","modified":1769568993620},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"db2e94a2dd24a2777c9a74b35f98c11d71488003","modified":1769568993620},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"8549829fb7d3c21cd9e119884962e8c463a4a267","modified":1769568993620},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"e846ddaef494d46cdfa2379deacfe74fa1cc5264","modified":1769568993620},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/index.pug","hash":"f0a90d8e39915a74b16ef22e851f179415cd7eaa","modified":1769568993606},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"13f37791badfb942f639cc25092ee32d43de31bf","modified":1769568993622},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"4adfe4087d8350a1188135a32a3bf76c6b305787","modified":1769568993622},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"187302dbc916852ff2fdf47061e272c061611dda","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"fa4b4194749d05f7249f365f2b89c0281057ce54","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/common.pug","hash":"27fa75affebc6e84a487c62bceff783bde595256","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/abcjs.pug","hash":"c4113038f4d084c7a0ed6d76e7257af717dea605","modified":1769568993606},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"72e2970b23570e308f8af5d8ba8e5e3321d01bbf","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"a7c07dbc1e970a5b247091458e1ee9b144a3366d","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"d2e12a9fc302a4efe52c90d44896fbd73e193a1f","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"34edfebf0cace0852806be774910ccb0e0914650","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d376ec17fb19fcdcf0d2ad71330190146d3af879","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"b03ee8625149191f9d5d057bbc9824b68d8dd0c4","modified":1769568993606},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d6fff5a7f84c8b09f282f9ddc0020a68a8aac9ea","modified":1769568993606},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"ec6c685080634ac46ffbea1b8f10313388888f43","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"cbfbcf34a24d21ba2b21cf9eedb76f4c3c563c5a","modified":1769568993606},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"716dc463fe4ef5112e7018ed60804125fdfa5cad","modified":1769568993606},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"be45b522286bbc64724341f23a5056ad24d3f796","modified":1769568993606},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"846cabae287ae31b3bbfac3da022475713dd5ecc","modified":1769568993606},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"7884883ec15792f7e54daacb3c62b851dde2b66a","modified":1769568993606},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"fd2320ee25507bb8ef49f932c2d170586b44ea4d","modified":1769568993606},{"_id":"themes/butterfly/layout/includes/third-party/math/chartjs.pug","hash":"732eb1118ea1a73aa5c164d639097c614f8e9953","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"af66d13204030d47537b9e31a6173e63589ce7ff","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"b83db9fa64d42a0bfd97efb660e09be3f166a144","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"4859cfb07d3402d40d3597d324de6cf85613bca7","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"cb5c8b0f2ac19a732ab78e26020dd5c8c70c0642","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"5b29badecbbe828112c001156023fc0566045cf6","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"24d094fd917947c0ca7492fa094328b1a183b873","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/search/docsearch.pug","hash":"013756ff3363344987cc00fc9bd833baf193c341","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"62466b251052cae609b6369d4cb4b6a85320757d","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"c34c1b19b3cfe24ca11c5edfb34613507a9a00c7","modified":1769568993609},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"e8438941085def0591a72fc9b0d705dbf107f54f","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"70364f4a9d9f13d713533a0fe0a9798707f1c1b3","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"f8557548d2ad8dd149c562193991c6c6cda02415","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/third-party/comments/artalk.pug","hash":"9801f581cd1d2aaa3eed8739487b9b3ec395c354","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"c81fa7d8a5cb96d1ae07bfa8c46b84a58161add1","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"f2ea5249b3e6670f6c8c77868f4f42c502e43830","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"8af585e6d6f73ee57114eefad574dc6e8ea9f570","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"58914c58a190e3bc0aa37cb581e77e442b563501","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"332b532bafbaf369fde840883b77e5a23d050a39","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"592b2251db6c1abeb8b0eebe3b2e6d9aa0dec445","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"3abbaaa4ea575c45b3cebffd40bad1acc6ffce84","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"9d84a681289175dec75a85f301d2fc9ce1b2bb7a","modified":1769568993607},{"_id":"themes/butterfly/layout/includes/third-party/comments/remark42.pug","hash":"ea9766439b6b1936306916a8b08d2681afbc8ea9","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"53d99831f29aeb2e336ed1407d79590041f77002","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"30a7d157890de69deab28baa47fb7bb28b040efd","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"24f18b0c67803210d53abbf9c1d454c000b06eee","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"5c944052280c5ed046d2cfeb54b0da8876af0ec6","modified":1769610113560},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"e2bf15357485cd502414b3b20f5b1f762a2fd014","modified":1769568993608},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"e51e896ccb13900de38dc81cf44dc789e2418a12","modified":1769568993610},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"efef352c1d122409575386bf3894dce8e87032e2","modified":1769568993610},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"077ec530831be1d80e93da380406b9f5abd0918a","modified":1769568993616},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"3676e5c2519cffcaf93a12ffef4c4878ffbc39d4","modified":1769568993616},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"de4bb5fc2dfca368b35e4c1109c92f7abc9e2245","modified":1769568993616},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"a91dc5ddbf7b453daef7144bdbf89e6039234077","modified":1769568993616},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"ef52ebf1e8e751a412f9456fdaeee7d88afd9a72","modified":1769568993616},{"_id":"source/images/Avatar.jpeg","hash":"1381e0e5dbf7678c8418d8a07013065ca7c050b3","modified":1769526904617},{"_id":"source/images/CleanShot-2025-11-15-at-12.26.11@2x.png","hash":"2f5af52ae891166fe902675552767244f5fc3af8","modified":1769566765128},{"_id":"source/images/CleanShot-2025-11-15-at-12.28.08@2x.png","hash":"95bbb9212751adb628e8d3d7a5b2b257eb258219","modified":1769566765647},{"_id":"source/images/CleanShot-2025-11-15-at-12.32.25@2x-1.png","hash":"7a03bf0c18e55f95bfcab413ca1184060ade4954","modified":1769566767653},{"_id":"source/images/CleanShot-2025-11-15-at-12.29.35@2x.png","hash":"f116dd9a0c4a909aadec5e7da3d7ad0f7437dae7","modified":1769566766589},{"_id":"source/images/CleanShot-2025-11-15-at-12.32.25@2x.png","hash":"7a03bf0c18e55f95bfcab413ca1184060ade4954","modified":1769566767128},{"_id":"source/images/CleanShot-2025-11-15-at-12.36.18@2x.png","hash":"0ab34d2dad877b0d8cd231d5265183a41afe6135","modified":1769566768138},{"_id":"source/images/CleanShot-2025-11-15-at-13.26.07-scaled.png","hash":"a3509d66c5b91d5be76b3132c89a2e0ace8b2b32","modified":1769566769165},{"_id":"source/images/CleanShot-2025-11-15-at-13.41.36@2x.png","hash":"92f743788efbb9214f7229d253265f793dd250ef","modified":1769566770142},{"_id":"source/images/CleanShot-2025-11-15-at-15.00.18-scaled.png","hash":"9c44c610b9f95ee3b023f53fcf99fe33038a53de","modified":1769566753572},{"_id":"source/images/CleanShot-2025-11-15-at-15.01.04-scaled.png","hash":"334cc0536f26a187bc2b82006061ba4877f45f9f","modified":1769566754366},{"_id":"source/images/CleanShot-2025-11-15-at-15.00.44-scaled.png","hash":"2b1041d41aec8fdaf93ed431abbe43abc3ad0ea7","modified":1769566754175},{"_id":"source/images/LocationApp.png","hash":"e89348ec00f044eded715f9b4f8be69b3d491f71","modified":1769566715563},{"_id":"source/images/CPU-排程.png","hash":"621260c805042818e2662dbafc99367cd3ba520f","modified":1769566722239},{"_id":"source/images/CleanShot-2025-11-15-at-11.51.05-1-scaled.png","hash":"a1abb97e036f64b4c9b18ffd1e26ba95153ccd5e","modified":1769566760211},{"_id":"source/images/CleanShot-2025-11-15-at-11.51.05-scaled.png","hash":"a1abb97e036f64b4c9b18ffd1e26ba95153ccd5e","modified":1769566759699},{"_id":"source/images/CleanShot-2025-11-15-at-12.17.01-scaled.png","hash":"0fa17ed08a0af7ea09084e151eb3f1ed6637ddc4","modified":1769566761748},{"_id":"source/images/CleanShot-2025-11-15-at-12.23.00-scaled.png","hash":"8724d9f31178381a26f6861bd42d3a5afa96e9d4","modified":1769566763641},{"_id":"source/images/CleanShot-2025-11-28-at-12.17.25.gif","hash":"407d6cd73c28e566353e3f28b3c7311d53b8cc37","modified":1769566798093},{"_id":"source/images/icon.jpeg","hash":"3d28a9ffc52529254ffdc31c96ac1c363fae7f74","modified":1769526904634},{"_id":"source/images/image-12.png","hash":"7f15047aeb5d714b132fc41fc65004a643b02dc7","modified":1769566785738},{"_id":"source/images/image-2-scaled.png","hash":"2e4aae66a49186e4ba3e5c45698a8a652c553817","modified":1769566717695},{"_id":"source/images/image-24-1024x604.png","hash":"c1b66a46d3596c15c62837823ce8367e05c19b15","modified":1769566739655},{"_id":"source/images/ubuntu-swap.png","hash":"ee2374bddc69be238700770ae1c031dbacb078f6","modified":1769566750778},{"_id":"source/images/unity-data-scene.png","hash":"9099a0db4ee5f99ad319027d8043e08e549206d7","modified":1769566812262},{"_id":"source/images/Line-Bot/create-account/create-account10.png","hash":"ed2991f4deb0dd0740154ca3f39a0abaf961afdc","modified":1769526904619},{"_id":"source/images/Line-Bot/create-account/create-account1.png","hash":"9f1e0ffe3c1b3ad63330028386a13782660ddcb1","modified":1769526904618},{"_id":"source/images/Line-Bot/create-account/create-account4.png","hash":"38c89231c34fd62fb63baee89ffdf7659a5f6798","modified":1769526904624},{"_id":"source/images/Line-Bot/create-account/create-account8.png","hash":"657ff7185262932c3edbfef9de104111e6800de9","modified":1769526904628},{"_id":"source/images/Line-Bot/create-account/create-account9.png","hash":"94065ffb80467577af8220bd4027076cedf2dd71","modified":1769526904629},{"_id":"source/images/CleanShot-2025-11-15-at-13.44.41-1024x611.png","hash":"99c24be9b01d79153308bd2f3ef237b4c9c7649b","modified":1769566781264},{"_id":"source/images/Gemini_Generated_Image_hqxfm7hqxfm7hqxf.png","hash":"df2f15d3d763048b65e8621a74537bbac7b77d08","modified":1769566753249},{"_id":"source/images/openai/openai-api4.png","hash":"cf6b447ffcebb61706a5897e5c65e23134902acc","modified":1769526904639},{"_id":"source/images/Line-Bot/create-account/create-account3.png","hash":"a55c3dcf1ed981c392d5bb8a2a21bac0d826a4c2","modified":1769526904624},{"_id":"source/images/CPE_sub.webp","hash":"8cb973f3ce4df277aeff21a4ae14fe5f3454a7f5","modified":1769526904618},{"_id":"source/images/CleanShot-2025-11-15-at-13.44.56-scaled.png","hash":"ce49a7d5f139bea9a411eb4b0a61b31dde20338d","modified":1769566771295},{"_id":"source/images/Gemini_Generated_Image_vfctf8vfctf8vfct.png","hash":"ac00f2bcb512e5b3f1f90fd20b58acba24b39dc8","modified":1769566772073},{"_id":"source/images/告別手動備份：WordPress-網站利用-Cron-Rclone-自動同步檔案到-Google-Drive-完整教學.png","hash":"1b1ae12c62815d57e49db509175c8f7d512b33c6","modified":1769566752169},{"_id":"source/images/openai/openai-api1.png","hash":"66b194b66f959432efc174347330cb98f281f0c8","modified":1769526904635},{"_id":"themes/butterfly/source/img/butterfly-icon.png","hash":"f5dd732fed5c3bcd4aa76bac3441bac8485fb432","modified":1769568993621},{"_id":"source/images/YOLOv9.png","hash":"15d050a634c4406e4f1571207dfc4ceb5a9f5ec3","modified":1769566734287},{"_id":"source/images/n8n-linode.png","hash":"f92a03e4f85997f6b7df0c989853f69effaad816","modified":1769566747180},{"_id":"source/images/openai/openai-api5.png","hash":"48618eebe12a18589320dd97e41e016970e2d936","modified":1769526904640},{"_id":"source/images/Line-Bot/create-account/create-account6.png","hash":"c224e7b7ed15cb424a142abb4ac6ccdc62a9dc26","modified":1769526904626},{"_id":"source/images/Line-Bot/create-account/create-account5.png","hash":"1075d37390698d46aeab9e68badd1e4804db686c","modified":1769526904625},{"_id":"source/images/Line-Bot/create-account/create-account7.png","hash":"6258c918de844422a74faa81e7d0e0c5e2339a8e","modified":1769526904628},{"_id":"source/images/openai/openai-api3.png","hash":"214a2456ab1ce22a7338a00caaa4072cd59e1bdb","modified":1769526904638},{"_id":"source/images/Line-Bot/create-account/create-account11.png","hash":"54ccbe5df67ac93255d4262ad93bfeca39cc7e19","modified":1769526904621},{"_id":"source/images/CPE.webp","hash":"4fb5c699f799f447b2059c9f846dce834fe40353","modified":1769526904617},{"_id":"source/images/image-24.png","hash":"c96ece4847e80c9f66dd9e209affc0344d024836","modified":1769566732897},{"_id":"source/images/openai/openai-api2.png","hash":"8006d57e5589be3e5902103dbcb1f19deb9bcb92","modified":1769526904637},{"_id":"source/images/CleanShot-2025-11-15-at-13.44.41-scaled.png","hash":"02df0867a1972791abf68a174b6222fd4d79f5e7","modified":1769566771009},{"_id":"source/images/banner.jpeg","hash":"57ab1135f4d28bb2826b7d76bd4fc66b277265ca","modified":1769611311434},{"_id":"source/images/Line-Bot/create-account/create-account2.png","hash":"745265243bd9ac06cd40f1d63ded063252fbcc97","modified":1769526904623},{"_id":"public/css/custom.css","hash":"cff38b73df6e5b1bf432e0da7de80e2b31db38a9","modified":1769611506873},{"_id":"public/css/wave.css","hash":"2772c32f1ffa36d326eb4010c184ad9f00f917df","modified":1769611506873},{"_id":"public/404.html","hash":"443f386dbc94627bf22d7ce14ea012101d48136a","modified":1769611506873},{"_id":"public/archives/index.html","hash":"36f2f1a7e07a5c0eda6a1ba8cf7cce787b38704d","modified":1769611612356},{"_id":"public/categories/index.html","hash":"38539882ac7a0d633c727483376eddd1ead395ef","modified":1769611612356},{"_id":"public/index.html","hash":"1f871342a9a1a7d2a13ec27228054ae1473109ab","modified":1769611612356},{"_id":"public/link/index.html","hash":"41c3e35c69ad853ab043e006f4ccc5c40aa5aa07","modified":1769611612356},{"_id":"public/tags/index.html","hash":"c512d868a9a088145699574adbcfe7d12b6a31fd","modified":1769611612356},{"_id":"public/2024/09/16/UVA-10041-Vito-s-Family/index.html","hash":"f643458f2d1c9f0c46c39f5b57f000aa5b03f38f","modified":1769611506873},{"_id":"public/2024/09/17/UVA-10420-List-of-Conquests/index.html","hash":"65e73d1d81b98595d5b32adadc603c0af4d72a4d","modified":1769611506873},{"_id":"public/2024/09/19/Line-Bot與Chatgpt應用-建立機器人帳號/index.html","hash":"b66a973f1c8dbf62c72cee4baf5752abbc555968","modified":1769611612356},{"_id":"public/2024/09/22/本地專案推送至Bitbucket遠端存放庫/index.html","hash":"e1e40516572d975c45accfb8c1328e24b617ec84","modified":1769611506873},{"_id":"public/2024/09/26/Line-Bot與Chatgpt應用-串接replit大神程式/index.html","hash":"8d469ab87ae8f54a6c8a7b7e310df70eda64d0c4","modified":1769611612356},{"_id":"public/2024/09/30/在-Mac-vscode-中使用-Code-Runner-和-C-C-插件來編譯與執行-C-程式/index.html","hash":"07c2f21937dbe314c6f7f6682e8bdbe96b8f7a26","modified":1769611506873},{"_id":"public/2024/09/26/Wordpress-動態選單/index.html","hash":"fe15b22f48ea92417ba41d72c0ddb909cd1b8c29","modified":1769611506873},{"_id":"public/2024/10/01/Mac-Django-建置環境/index.html","hash":"60808fb7f5a92c34c7bff48e11a4844351d3b837","modified":1769611506873},{"_id":"public/2024/10/02/Line-Bot-與-Openai-SQL-成績查詢/index.html","hash":"40dfa4501ff2a0f114687277c56943845f76a676","modified":1769611506873},{"_id":"public/2024/10/24/Django-WebSocket/index.html","hash":"708b37e829e18aa9b8aaf9f92370b1b63b2b91db","modified":1769611612356},{"_id":"public/2024/11/02/撰寫 Python 發送成績給學生確認/index.html","hash":"a43216e1a99cf900562b7c727f2f9e42e10816dc","modified":1769611506873},{"_id":"public/2024/11/20/post-1/index.html","hash":"0c54843156929418db0ec3ed054774901243370e","modified":1769611506873},{"_id":"public/2024/11/24/Daphne 無法抓取 CSS 解決方法/index.html","hash":"4efde0344ace3637358101dfa0fa5df2b5c82d1b","modified":1769611612356},{"_id":"public/2025/03/30/2025-03-30-nginx-cerbot/index.html","hash":"f2a6ad8816da3207aeedffed088ef6fc84ecbaab","modified":1769569005591},{"_id":"public/2025/03/31/2025-03-31-wordpress-start/index.html","hash":"ded93ea8d7c4064656e7a3be81824b03c8d7c3e8","modified":1769569005591},{"_id":"public/2025/04/04/2025-04-04-mac-docker-error/index.html","hash":"339573c33007241f4b834777235d1ecb90356f5c","modified":1769569005591},{"_id":"public/2025/10/17/2025-10-17-android-locationapp/index.html","hash":"bc3d6e31a6e4fc6b4b53f5fd581fff8a8af103ee","modified":1769569005591},{"_id":"public/2025/10/20/2025-10-20-pytorch-base/index.html","hash":"179c1b97dc77e0331b96790fec8c231efd23d7e2","modified":1769569005591},{"_id":"public/2025/10/26/2025-10-26-yolov9-practice/index.html","hash":"12b2bfa9c75ce14eb5806ad61f910f5da944d7e8","modified":1769569005591},{"_id":"public/2025/10/29/2025-10-29-training-a-classifier/index.html","hash":"8034c7edc041fcebf6f61c39ac7bcac63ec72abc","modified":1769569005591},{"_id":"public/2025/11/05/2025-11-05-linode-docker-n8n/index.html","hash":"dacc5e7644d8cd2bcccf08feb0a5fcf6bc079515","modified":1769569005591},{"_id":"public/2025/11/15/2025-11-15-wp-restore-local/index.html","hash":"86b4707370258f416fae750f19212ea819b3cafd","modified":1769569005591},{"_id":"public/2025/11/24/2025-11-24-interest-and-yield/index.html","hash":"c89b7f2592ef9c22ac9da10bdfd0c666332d7a81","modified":1769569005591},{"_id":"public/2025/11/26/2025-11-26-next-js-v16-base/index.html","hash":"5e8147dd8a82165a18d0edbd60428c62eb0b872f","modified":1769569005591},{"_id":"public/2025/11/13/2025-11-13-ubuntu-swap-setting/index.html","hash":"7037d4dac2d69907eb6cb4be594a21e588c77dd0","modified":1769569005591},{"_id":"public/2025/12/01/2025-12-01-streamlit-yolo/index.html","hash":"4de5f89298be42bdf65a2d79007ca5e5e7747c53","modified":1769569005591},{"_id":"public/2025/12/04/2025-12-04-unity-scene-data/index.html","hash":"2a15769ad49505d7b62dc7dc641490f0831dba05","modified":1769569005591},{"_id":"public/archives/page/2/index.html","hash":"f99d107c30ee4fce569713fce1911a0f24aecaa5","modified":1769611612356},{"_id":"public/2025/11/14/2025-11-14-wp-cron-backup/index.html","hash":"569d7925b7a17a59d92051b91ac809843d681e35","modified":1769569005591},{"_id":"public/2025/10/21/2025-10-21-cpu-job-time/index.html","hash":"05020cb82331ac6ef73f13047229fff619a81138","modified":1769569005591},{"_id":"public/archives/2024/09/index.html","hash":"129da99c83fbf5c920ffa942a9baefd6fd0556d9","modified":1769611612356},{"_id":"public/archives/2024/page/2/index.html","hash":"1bd5611af43e29a7e6d43143abcca48ae6001eff","modified":1769611612356},{"_id":"public/archives/2024/10/index.html","hash":"9d95acdf2bc0821987a734f18a087642df89cb95","modified":1769611612356},{"_id":"public/archives/2024/index.html","hash":"b342cfa1f60762266bbc2a4029be40b65a6cb369","modified":1769611612356},{"_id":"public/archives/page/3/index.html","hash":"3638f737c888cd3267c1cd30c84b0cd7cc72eed7","modified":1769611612356},{"_id":"public/archives/2024/11/index.html","hash":"bc9b511eb270044b4a56ef3e1dc5a00d62b01b48","modified":1769611612356},{"_id":"public/archives/2025/index.html","hash":"8e630a777adae20dbe9ca90ce21710b6e3f5eef9","modified":1769611612356},{"_id":"public/archives/2025/page/2/index.html","hash":"20e07010bc9f9f02c6d804090d4b156a7a8e004e","modified":1769611612356},{"_id":"public/archives/2025/03/index.html","hash":"cc276478aeea00b44dcd7867305e98f6e7dc3af0","modified":1769611612356},{"_id":"public/archives/2025/10/index.html","hash":"95e4ab333f6fa6e6b2f0798ca650c8d4ceb60394","modified":1769611612356},{"_id":"public/archives/2025/04/index.html","hash":"688c1406b2dc03b28d6fb51f3a6354255b19cf02","modified":1769611612356},{"_id":"public/archives/2025/11/index.html","hash":"e2f73d82e48bdc40c49f31467e8f0047555df6c4","modified":1769611612356},{"_id":"public/archives/2025/12/index.html","hash":"5d58eb7327b361f67ee5a71abd155e055e4918e7","modified":1769611612356},{"_id":"public/categories/vm-setting/index.html","hash":"c0de5318659d2947cff8940a59536ee4c6b62b12","modified":1769611612356},{"_id":"public/categories/docker/index.html","hash":"3df146ed8b3f9fc0fd84f16d69ef6e93a1f8bc9c","modified":1769611612356},{"_id":"public/categories/android-app/index.html","hash":"d5a2592fc8c0652fe7104cf59c449c7858382b9d","modified":1769611612356},{"_id":"public/categories/ai/index.html","hash":"261dda3c035c1e1f1b8e86199d12d87975c9caad","modified":1769611612356},{"_id":"public/categories/vm-setting/wordpress/index.html","hash":"6966de8b4a030fce558e26b6a1e4265d06a134be","modified":1769611612356},{"_id":"public/categories/operating-system/index.html","hash":"b2391062d1ee6287c60f4997007e6ab505a3453a","modified":1769611612356},{"_id":"public/categories/docker/n8n/index.html","hash":"740510d5543c80b1a6e7409f91d5ea6703d76648","modified":1769611612356},{"_id":"public/categories/ubuntu/index.html","hash":"720f002a8b13980f1426bf0dfccdc6971fc2943b","modified":1769611612356},{"_id":"public/categories/android-app/kotlin/index.html","hash":"48f9ba195e7d890890fd39d4789007f7f14d5332","modified":1769611612356},{"_id":"public/categories/financial/index.html","hash":"72a58b65be8d9a2ae3097c2058ceef9234476a11","modified":1769611612356},{"_id":"public/categories/wordpress/index.html","hash":"4fde7501ffccc3811e4d7272195c7fe95f067663","modified":1769611612356},{"_id":"public/categories/ai/pytorch/index.html","hash":"09a705fb92ca4704c299c0d513abde75c95f3d4a","modified":1769611612356},{"_id":"public/categories/next-js/index.html","hash":"a6a64e4263cbd461cfb33a8a5b28236ddfa54c04","modified":1769611612356},{"_id":"public/categories/unity/index.html","hash":"8fbab9f20ab57e9397a2f3d24a2cd9ca6118bd49","modified":1769611612356},{"_id":"public/categories/WebSocket/index.html","hash":"85f8b084ea42ba9b59968f2db861aa3bd746d5ec","modified":1769611612356},{"_id":"public/categories/Line-Bot/index.html","hash":"317a9dee345569d58c11b45abd6dbe487b07dca1","modified":1769611612356},{"_id":"public/categories/Python/index.html","hash":"2ae14d8190e5791ce86d41218de7626686c2cff3","modified":1769611612356},{"_id":"public/categories/程式解題/index.html","hash":"ef3f8785f135a659a35590014df554ed6d7daa50","modified":1769611612356},{"_id":"public/categories/docker/n8n/vm-setting/index.html","hash":"adde3bf29d1c2acadabf3bb1d5c1ad2b6a6b2425","modified":1769611612356},{"_id":"public/categories/ubuntu/vm-setting/index.html","hash":"cf4cd4b402bbd375271e86b271f9dae6b9589943","modified":1769611612356},{"_id":"public/categories/Line-Bot/replit設定/index.html","hash":"06ba8cbc7bb641a3213e67171b1eb3f57bc454be","modified":1769611612356},{"_id":"public/categories/Python/Django/index.html","hash":"6b60e902f09ea753eb926f1c8dc85db16edd5b98","modified":1769611612356},{"_id":"public/categories/Line-Bot/成績查詢練習/index.html","hash":"c0318281a7a4eccf35bd07b62362add2133b4ccc","modified":1769611612356},{"_id":"public/categories/程式解題/CPE49題/index.html","hash":"cc444dc9f187be9d799ed0be9edf60b097a7488e","modified":1769611612356},{"_id":"public/categories/Python/Django/Daphne/index.html","hash":"cfa4f4e8a52a564c13426df555994fb3f5efb14a","modified":1769611612356},{"_id":"public/categories/Line-Bot/建立帳號Line-Bot帳號/index.html","hash":"e13f0cf5b1281a7d8490f60d2c9bfcf5281fb790","modified":1769611612356},{"_id":"public/categories/C/index.html","hash":"248fbbe9723010ef395de9fae2da0309876a3f8a","modified":1769611612356},{"_id":"public/categories/開發環境/index.html","hash":"5b353bfa2afef5039dd18124df6f564f840530e0","modified":1769611612356},{"_id":"public/categories/Python/Email/index.html","hash":"a6d8cf646fe0a6967d9086e75209baa0eb37393e","modified":1769611612356},{"_id":"public/categories/Wordpress/index.html","hash":"782f2a99fd24bd0aa6d6ba198176344d0cab863b","modified":1769611612356},{"_id":"public/categories/C/Vector/index.html","hash":"4332f6ded2699d7dfd6e1baa6856575fcfe2f072","modified":1769611612356},{"_id":"public/categories/遠端存放庫/index.html","hash":"6429cab656b417762e544bb9de7d907a87bddbbb","modified":1769611612356},{"_id":"public/categories/開發環境/使用Mac在vscode執行C/index.html","hash":"8023b79321b9ad6b88ed2c8ad003b6cc5f127e00","modified":1769611612356},{"_id":"public/categories/Wordpress/動態選單/index.html","hash":"5eb4f9894325d7b0ac76417a1d3c9c5bc5274fca","modified":1769611612356},{"_id":"public/categories/遠端存放庫/Bitbucket/index.html","hash":"5f9388c0f8dc3bf71ab0f17c8aeab9e9eb17587f","modified":1769611612356},{"_id":"public/tags/location-app/index.html","hash":"0ac30b9e8253445b183fdde9fd49f09c3094f362","modified":1769611612356},{"_id":"public/page/2/index.html","hash":"f2c2ba39b676e9cb9c298484f549e91509528b8a","modified":1769611612356},{"_id":"public/page/3/index.html","hash":"67023b6b508113de3bc5f33fbcbce5164ef1e587","modified":1769611612356},{"_id":"public/tags/利率/index.html","hash":"27f7541c19f59abcd530ba178f4fa7aa64d45f62","modified":1769611612356},{"_id":"public/tags/wordpress-備份/index.html","hash":"22532684951294a56ce1850e744b038684cbbfaa","modified":1769611612356},{"_id":"public/tags/殖利率/index.html","hash":"97f35d8d428f5c38a54c88317657efe25f45325f","modified":1769611612356},{"_id":"public/tags/streamlit/index.html","hash":"06858cae6b4882496162c54ec552e4a8e49db607","modified":1769611612356},{"_id":"public/tags/yolo/index.html","hash":"b00fe48d4446d2fbf1cd6d23ca685e4eb51ba312","modified":1769611612356},{"_id":"public/tags/Python-Django/index.html","hash":"2e9b71d38c1f278cc0d9478864b5397b7c2178b9","modified":1769611612356},{"_id":"public/tags/CPE/index.html","hash":"a871d3fe17e18823dc858b7b54ac721e40077cee","modified":1769611612356},{"_id":"public/tags/Line-Bot/index.html","hash":"62384dc2f92df8bd225feeeb56dba0928d1fc919","modified":1769611612356},{"_id":"public/tags/C/index.html","hash":"d803bd75b78c0ede2f38fb6b9eb25e22975d49c8","modified":1769611612356},{"_id":"public/tags/開發環境/index.html","hash":"8021c0e578399337a8941e3c5dd50815f494a17d","modified":1769611612356},{"_id":"public/tags/Python-Email/index.html","hash":"9792544308d61f7462f0cf1fb2f5e054cc71740e","modified":1769611612356},{"_id":"public/tags/Wordpress/index.html","hash":"23c65258d765e41f74e8ced9ad2035606cb1b31a","modified":1769611612356},{"_id":"public/tags/Bitbucket/index.html","hash":"485dfea61295f49b63add03c4b5898eeb4f154f5","modified":1769611612356},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1769611506873},{"_id":"public/img/error-page.png","hash":"d2519710498a871ca3e913c57e2ba20a805b6430","modified":1769611506873},{"_id":"public/img/favicon.ico","hash":"455ac256580bf31a45813dbbdb87219bfc8bfb04","modified":1769611506873},{"_id":"public/images/64b6bd08-e4f1-4125-aba5-2886b5bc938a.webp","hash":"5b627f73a8578537b626194990ccf9e0968eb90f","modified":1769611506873},{"_id":"public/images/09d01d97-6054-4172-930a-5cf01b8bf9a8.webp","hash":"710e15854a35efa9169f959f3e8d9068e52f98ae","modified":1769611506873},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1769611506873},{"_id":"public/images/CleanShot-2025-10-29-at-11.47.42@2x.png","hash":"bd971fa34f7bf6537b554a4e210d70988b6e478b","modified":1769611506873},{"_id":"public/images/CleanShot-2025-10-29-at-11.57.50@2x-1024x45.png","hash":"ce0d3bd5c55d00e61f447d171284e692d2802917","modified":1769611506873},{"_id":"public/images/CleanShot-2025-10-29-at-11.57.50@2x.png","hash":"94f42ba668ec2a0d571c0d31964e2aba24a20654","modified":1769611506873},{"_id":"public/images/CleanShot-2025-10-29-at-11.59.02@2x-1024x84.png","hash":"987043a55a4063e75441c4ed83d1e013c055cd51","modified":1769611506873},{"_id":"public/images/CleanShot-2025-10-29-at-11.59.02@2x.png","hash":"861063f39d8fdc74f82f4e5d68614e41453de69a","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png","hash":"781d49464c287c421c2056e981badb348a0d0c97","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-11.44.53@2x-1024x632.png","hash":"4ea72fcb145fe46e386e4357276b138a27dc497f","modified":1769611506873},{"_id":"public/images/CleanShot-2025-10-29-at-11.47.42@2x-1024x85.png","hash":"a5a6f13bdef6af2125b919210f90e80bdceb48e0","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.02.52-1024x611.png","hash":"3859571ce9679e3b9edd981c9d3f6c8b93e5abd4","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.17.01-1024x611.png","hash":"11c8b208a1a7639b6a19b776b56e9081dddb3955","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.18.22.png","hash":"a61bf279da345ca900a642c76f72de5492cf4688","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.20.47.png","hash":"377c174a0fc84baa53d78964c85bce4639d35d89","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.21.44.png","hash":"5cf87a60649b9b69696a2aa42ab612e707439afd","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.21.44-1024x277.png","hash":"b7d98c38fcca4727492adae2c9dbaa3de5885067","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.20.47-1024x228.png","hash":"91f6f382b90db98409293590aa96b9813ad5218a","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.09.41@2x-1024x632.png","hash":"b8a9462350ba6506493a2d5c15ce8a4432158b8b","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.23.00-1024x611.png","hash":"388934fa0d61136de14d7b4309176e21c8ff7821","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.24.17@2x-1024x632.png","hash":"ca172ed9875fe1c093a985600f85bc4ff0d23d36","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.29.00@2x-1024x599.png","hash":"2a2a5fd1f4cba25e2c7224d86ecdd0a3f4bfe177","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.29.35@2x-1024x599.png","hash":"2066b062d846878a547bb26d27bfd74ff1c27f9e","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.36.18@2x-1024x599.png","hash":"341f0cdde6fa82e3cd5419b258c79e9fd50d6956","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.48.01@2x-1024x632.png","hash":"b1c5d0f759397aa74fe3e9882003e24d015a0dc8","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-13.26.07-1024x583.png","hash":"a87d3e68207c2b243da80a2a5d2d7ebdb0e4ed67","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-13.40.02@2x-1024x599.png","hash":"d03ef0422440b8ecbd1af248d544e8a60058e934","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-13.41.36@2x-1024x606.png","hash":"5fb243b1763fb68c77f7c2694a63f6623f434843","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-15.00.18-1024x611.png","hash":"c2d6095a51826f3fa8bd1e7e44de9f56af1c04eb","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-15.00.44-1024x611.png","hash":"23239c9201049ff3bb9dbd78f2be16dce7c46a77","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.32.25@2x-1024x599.png","hash":"aaf25f7db6d3b29eab6c8829d6d09523355ac4a5","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-15.01.04-1024x611.png","hash":"d7a9122c2d751b065475dff903efbe0a71567d96","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-26-at-21.17.46-1024x664.png","hash":"b575adf00dbd1ae782785c22919e7833e7ed7055","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-26-at-21.16.14-1024x662.png","hash":"15c000f46e68d198af79d55d86000e045e371e88","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-26-at-21.35.15.png","hash":"83794eeeab1498fa852212d464b80f69327e78ee","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-26-at-21.35.15-1024x667.png","hash":"d95eb6e4069be9bfdeef7c37f1bafcafa58e5ec6","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-26-at-21.16.14.png","hash":"997d3991252030a4319ab5c7da2ef0e543d7ea93","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-26-at-22.18.53-1024x667.png","hash":"8143414e09e2041f3363863e8f8a77b0dd3d8acb","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-10.33.25-1024x657.png","hash":"edec184d3aeca26398f393269a83804f89cf3d65","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-10.34.45-1024x657.png","hash":"ae3c017fdf390e96296b33e631aa7743983d3aeb","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-10.34.45.png","hash":"0bc1079381c43c8c79d4a98aedd7b1aedb89cd15","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-10.33.25.png","hash":"559fbedec2ab8544cae2066e5901171917610f87","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-12.47.38-1024x664.png","hash":"90e30bca9ea8fd9352e95394e5c93ace70b31a0c","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-22.43.19-1024x670.png","hash":"7d2a2f9c46df6bb3b49527c49de7a7c45eef3bfd","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-22.43.19.png","hash":"f618be6c90fd81cbaf450800666a9023d50f39d6","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-22.47.08-1024x588.png","hash":"c710cf32323934825779d38d2a20bc066e558ff5","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-28-at-10.25.54-1024x578.png","hash":"768220669ba660d922570203dd2acc12a53bac4e","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-28-at-10.28.43-1024x670.png","hash":"18c3c8c929924659a4fdce2af98c8551822e491d","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-28-at-10.33.17-1024x670.png","hash":"5c8ba307a791ca42ee447c4e214a0ed2a88dff1d","modified":1769611506873},{"_id":"public/images/CleanShot-2025-12-01-at-16.05.16-1024x660.png","hash":"d38d2b782bb9667e7b2df02904343ff75a5e78fe","modified":1769611506873},{"_id":"public/images/CleanShot-2025-12-04-at-10.55.31.png","hash":"8378d05b8a685cb37e960434ccf39da1035cebb1","modified":1769611506873},{"_id":"public/images/CleanShot-2025-12-04-at-11.02.07.png","hash":"2aa577dfafe51fec376988fbc140eecdcf44001a","modified":1769611506873},{"_id":"public/images/CleanShot-2025-12-01-at-16.05.37-1024x660.png","hash":"9a7c6166a01e35e22c66094ed1514bc529ab9234","modified":1769611506873},{"_id":"public/images/CleanShot-2025-12-04-at-10.56.41.png","hash":"b3721a277775687566c87b4619d1644e6aa02696","modified":1769611506873},{"_id":"public/images/Docker.png","hash":"ecae216d7b79d7d86fed514b7e20fa702c3221aa","modified":1769611506873},{"_id":"public/images/CleanShot-2025-12-01-at-16.05.16.png","hash":"43b463770d11cfdf0dd539c9d436343e9411dbda","modified":1769611506873},{"_id":"public/images/Logo.png","hash":"3f88903fb1e19e29066ce407a2ffa421cf3e64de","modified":1769611506873},{"_id":"public/images/favicon.ico","hash":"5afa977c0e959a965e16cf29d8bd078713f23f24","modified":1769611506873},{"_id":"public/images/good-fcp-values-18.svg","hash":"747f1668c4f0527daa9138129fd7251c10d9c33f","modified":1769611506873},{"_id":"public/images/image-10.png","hash":"df9b949d73fc941de339f5f4996055e80cbe7baf","modified":1769611506873},{"_id":"public/images/image-1.png","hash":"3e8714303ada1452b298d19127df4e87a132d6d0","modified":1769611506873},{"_id":"public/images/image-11.png","hash":"56a167032666b8ece9e4f0de718fcc7163f4ad65","modified":1769611506873},{"_id":"public/images/image-11-1024x594.png","hash":"2c2711d0fb54c2d6b10c6e5288fca07d2df39de8","modified":1769611506873},{"_id":"public/images/image-13.png","hash":"f34fe0bde44e76e0851bc7ed300fa1a8889cfbfc","modified":1769611506873},{"_id":"public/images/image-1-1024x557.png","hash":"562888329c3b6f008b4fc6bf71c1669142548b1d","modified":1769611506873},{"_id":"public/images/image-12-1024x594.png","hash":"5b341ee0a81677cdab6b4b5e2de46d125ee7b475","modified":1769611506873},{"_id":"public/images/image-14-1024x336.png","hash":"334933651356f61113be668ec2b66c15c328a2f5","modified":1769611506873},{"_id":"public/images/image-15.png","hash":"f337b34391c0fc65df597ada196aa8eddfc375da","modified":1769611506873},{"_id":"public/images/image-16.png","hash":"a38863f18b8438fac5bddbcb977fee787795af03","modified":1769611506873},{"_id":"public/images/image-14.png","hash":"71c316d8ebc4ac6465115b5d2d311ddba610614c","modified":1769611506873},{"_id":"public/images/image-18.png","hash":"d457a5b54ac0a348c7232699b8ca1c119d5da446","modified":1769611506873},{"_id":"public/images/image-2-1024x510.png","hash":"4ec3fb81656d54929a566dbd14a89692de403f3e","modified":1769611506873},{"_id":"public/images/image-17.png","hash":"48d3b2c71eb46b97a1134b99124654f33ce74120","modified":1769611506873},{"_id":"public/images/image-20-1024x664.png","hash":"3a50da78ba78287b2d2bd45cd336c03967484f23","modified":1769611506873},{"_id":"public/images/image-20.png","hash":"da13de5da8b95e81f2ab1b5b6971922127d8214c","modified":1769611506873},{"_id":"public/images/image-21-1024x459.png","hash":"a0e8f15dfea4e63ebf4b50adc6f86a95b363ad56","modified":1769611506873},{"_id":"public/images/image-19.png","hash":"f10a75e3bbe0954d0496045fd99d095907b07645","modified":1769611506873},{"_id":"public/images/image-23.png","hash":"3e1214517146407f403ed1fdcde1ac17f41614a6","modified":1769611506873},{"_id":"public/images/image-21.png","hash":"98c88bb2400ded56bab2c16472b7e3f4907140d5","modified":1769611506873},{"_id":"public/images/image-23-1024x448.png","hash":"f9bf8230052cd91004d06c06b2e2475de94b971a","modified":1769611506873},{"_id":"public/images/image-26.png","hash":"6f3bdcde1b0761fed7c43705803e456b4222846b","modified":1769611506873},{"_id":"public/images/image-25.png","hash":"b8447053493d8a0f5e0fbb85624928602e1cee4a","modified":1769611506873},{"_id":"public/images/image-27.png","hash":"e38735b017c828a80c651e3d3ed8d09e07e66e59","modified":1769611506873},{"_id":"public/images/image-3-1024x604.png","hash":"06153fd359e999c751cf8f07afc39b643246de35","modified":1769611506873},{"_id":"public/images/image-3-1024x526.png","hash":"0b14113ac9cb72579fa5dc62a467cd2274dc5e6f","modified":1769611506873},{"_id":"public/images/image-28.png","hash":"58d52e66decd57077fadb5226e12ca722188de6a","modified":1769611506873},{"_id":"public/images/image-4-1024x604.png","hash":"424d71caad807a89d697975c516c573b5ec44502","modified":1769611506873},{"_id":"public/images/image-3.png","hash":"65f936e8936df415a3b93587c7f5acd0589ec580","modified":1769611506873},{"_id":"public/images/image-4.png","hash":"b6194f7282fa50c382a1ffcbefe541815449ae3f","modified":1769611506873},{"_id":"public/images/image-5.png","hash":"078b7c6e26d50262dc24c8b84e45836d25e831d7","modified":1769611506873},{"_id":"public/images/image-6-1024x604.png","hash":"22750ef8d113bbfcd8a2b3606d5bbd50bc2dbe75","modified":1769611506873},{"_id":"public/images/image-6.png","hash":"462a26aef55c11072f4d5b72de3e54c3243c49e9","modified":1769611506873},{"_id":"public/images/image-7-1024x136.png","hash":"5c75cb63be0602a52b5267a525cdd91b64c1cb89","modified":1769611506873},{"_id":"public/images/image-5-1024x669.png","hash":"e114e222dbdcf97b84befde090c594a648f636f5","modified":1769611506873},{"_id":"public/images/image-7.png","hash":"1838a6e840dcfb3ce452489d06022e1fe288b76a","modified":1769611506873},{"_id":"public/images/image-8.png","hash":"258846e4964dcfe74ca072a5356f5e4f69b372e2","modified":1769611506873},{"_id":"public/images/image-8-1024x604.png","hash":"ae337fd82294eb03f3ba7e695b6658b12de3eb1c","modified":1769611506873},{"_id":"public/images/image-9.png","hash":"d83e6ee24f43be12afff65e15611a7e5a855b065","modified":1769611506873},{"_id":"public/images/image-9-1024x604.png","hash":"2eb704ce4e98ce81e473792fee7ef70399a3bf15","modified":1769611506873},{"_id":"public/images/image.png","hash":"074de18c4eb4ee2c0215d11ddd38dccb379aba0d","modified":1769611506873},{"_id":"public/images/streamlit_yolo.png","hash":"a38dc16872b8103bcf7dde4ed901df44a6d9b82d","modified":1769611506873},{"_id":"public/images/未命名-2-1021x1024.png","hash":"f35ef6dadcff906b723a6a00756a50e59079039a","modified":1769611506873},{"_id":"public/images/螢幕擷取畫面-2025-10-19-214356.png","hash":"c22579145f69d91f0f55a72ff3b207bc6bc4c17c","modified":1769611506873},{"_id":"public/images/螢幕擷取畫面-2025-11-05-163916-1024x606.png","hash":"0b2565cd1bf3c602b8b8a203867ede4ae9b9aa15","modified":1769611506873},{"_id":"public/images/未命名-2.png","hash":"af03e407ba59a1e769c5d9329523c38818bdaace","modified":1769611506873},{"_id":"public/images/favicon/favicon-32x32.png","hash":"450e687c4fda4ec2c05e02565d2c070ecd9007c0","modified":1769611506873},{"_id":"public/images/螢幕擷取畫面-2025-11-05-163916.png","hash":"dc6b7565343d932de36f080a00abb783b189292e","modified":1769611506873},{"_id":"public/images/CleanShot-2025-10-29-at-11.41.16@2x.png","hash":"06b4d52d73232849bb3b0fba756277eadfd26d90","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-14-at-18.10.07@2x.png","hash":"0b2920e67d3845cbca9079b50646af777f5aa506","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-11.42.31@2x-1.png","hash":"ea887e53d9c00afc192e2e3453915c5423ad379a","modified":1769611506873},{"_id":"public/assets/js/Meting.min.js","hash":"a0585220b918d78649a7893279e1ec4fb5abe835","modified":1769611506873},{"_id":"public/assets/js/APlayer.min.js","hash":"22caa28ff6b41a16ff40f15d38f1739e22359478","modified":1769611506873},{"_id":"public/assets/css/APlayer.min.css","hash":"07372a2ba507388d0fed166d761b1c2c2a659dce","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-11.42.31@2x.png","hash":"ea887e53d9c00afc192e2e3453915c5423ad379a","modified":1769611506873},{"_id":"public/images/CleanShot-2025-10-29-at-11.41.16@2x-1024x385.png","hash":"cce78db6062f3ef510dab04aab041bf97f577ca9","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-11.44.53@2x.png","hash":"941f4d5e681d47dea90be6a59cb1a1937b10224e","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.02.52-scaled.png","hash":"87df0261ce2f7ef2ae34909e54471367662649bb","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.09.41@2x.png","hash":"1cfe39498a5f6f35bd7502b439cf0df82c80535f","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.24.17@2x.png","hash":"ab948737bd5942051a337a4772e6088d8319020e","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.24.17@2x-1.png","hash":"ab948737bd5942051a337a4772e6088d8319020e","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.28.08@2x-1024x599.png","hash":"5f200f0853d25c89f6de9129302b3d0ea99fafff","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.29.00@2x.png","hash":"8775cdebaf99fe0d772d6a286debcf501795719e","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.48.01@2x.png","hash":"caee61054eab575754bd7d4e41c20ef95fb39590","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-13.40.02@2x.png","hash":"4ea6fae41e168cd53a3b851ba8fd90c38889a1e1","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-13.44.56-1024x611.png","hash":"66cd39d151a9d38656bcac7075acf3f80ceb30cc","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-26-at-20.38.02@2x-scaled.png","hash":"172008853f47188cc12e54f60f11a1d579ba5086","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-26-at-21.17.46.png","hash":"eed41a11d96f6d4eabe0bdece835a1a860d94abc","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-26-at-22.18.53-1.png","hash":"0accaf6c77aeff08ab459f24b4c5cbaabccb0b55","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-26-at-22.18.53.png","hash":"0accaf6c77aeff08ab459f24b4c5cbaabccb0b55","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-12.46.54.png","hash":"bfb3baeafe34e581e84e2c69337b4470476def53","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-12.47.38.png","hash":"caa388bad9e99f65a10b632f113f7c117e6a850d","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-22.33.36.png","hash":"341c24b213140990ce7665867d46c8375d26b804","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-27-at-22.47.08.png","hash":"164c746f6b88908fe79e309b1d1e39471d553a8d","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-28-at-10.25.54.png","hash":"d43319c66c07c786b392bf541ad1e538c66b5d65","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-28-at-10.33.17.png","hash":"4e8fd94cc62dfc6b1e842b346e5928ddeb191738","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-28-at-10.28.43.png","hash":"cf5369dbe4c1fc7810f086761964e97424fdea09","modified":1769611506873},{"_id":"public/images/CleanShot-2025-12-01-at-16.05.37.png","hash":"f80de591762c0846e9fda9d002e58fafb92ab302","modified":1769611506873},{"_id":"public/images/Gemini_Generated_Image_si41pisi41pisi41-1.png","hash":"0cbf726ea00904a05015c0e51c7d6d36d0167e56","modified":1769611506873},{"_id":"public/images/Pytorch.png","hash":"4dd8cc649c923443be6c4fc6557729b4a3bfd20c","modified":1769611506873},{"_id":"public/images/Gemini_Generated_Image_8zuhop8zuhop8zuh-1.png","hash":"863996fc1695dd9c2bb832c80bdfc1af6156d1d2","modified":1769611506873},{"_id":"public/images/image-14-1024x594.png","hash":"29abf4aeaac9fb616f8f5a93c7b7953f33b73045","modified":1769611506873},{"_id":"public/images/image-16-1024x594.png","hash":"5d8bd552ff185968db689c825cbeeb0d50c63663","modified":1769611506873},{"_id":"public/images/image-17-1024x593.png","hash":"0ec3a3f7933f28cc68e67c177fe101ab20f2abb1","modified":1769611506873},{"_id":"public/images/image-18-1024x542.png","hash":"fe4701d14311d0823353ed24e19191c9c208e385","modified":1769611506873},{"_id":"public/images/image-2.png","hash":"908baa21bfc27b7d240660fe5925fb20a3ec816e","modified":1769611506873},{"_id":"public/images/image-22.png","hash":"5664f85e4030d5d6fde7b904975162baae905b30","modified":1769611506873},{"_id":"public/images/image-22-1024x554.png","hash":"f451c385191248697bd968b5ef78797128494e05","modified":1769611506873},{"_id":"public/css/index.css","hash":"e4c96f940407b2b1a54d0169537a19273b37fa12","modified":1769611506873},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1769611506873},{"_id":"public/js/main.js","hash":"68186d3d5933da41b7177645687237b35d6154a8","modified":1769611506873},{"_id":"public/js/tw_cn.js","hash":"337c417a6e37dfabc920463fa13f65cc3d02f164","modified":1769611506873},{"_id":"public/js/utils.js","hash":"5e47bf8c7ae0b659d6697c464772f311c01b4633","modified":1769611506873},{"_id":"public/js/search/local-search.js","hash":"50ab53c2b11c7c4cc1d9240b749af124ad38bfdc","modified":1769611506873},{"_id":"public/js/search/algolia.js","hash":"02491d2798f07f820962cafaceb07a2f8c97bc41","modified":1769611506873},{"_id":"public/images/Avatar.jpeg","hash":"1381e0e5dbf7678c8418d8a07013065ca7c050b3","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.28.08@2x.png","hash":"95bbb9212751adb628e8d3d7a5b2b257eb258219","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.32.25@2x-1.png","hash":"7a03bf0c18e55f95bfcab413ca1184060ade4954","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.29.35@2x.png","hash":"f116dd9a0c4a909aadec5e7da3d7ad0f7437dae7","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.26.11@2x.png","hash":"2f5af52ae891166fe902675552767244f5fc3af8","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.32.25@2x.png","hash":"7a03bf0c18e55f95bfcab413ca1184060ade4954","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-13.26.07-scaled.png","hash":"a3509d66c5b91d5be76b3132c89a2e0ace8b2b32","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-13.41.36@2x.png","hash":"92f743788efbb9214f7229d253265f793dd250ef","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.36.18@2x.png","hash":"0ab34d2dad877b0d8cd231d5265183a41afe6135","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-15.00.44-scaled.png","hash":"2b1041d41aec8fdaf93ed431abbe43abc3ad0ea7","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-15.01.04-scaled.png","hash":"334cc0536f26a187bc2b82006061ba4877f45f9f","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-15.00.18-scaled.png","hash":"9c44c610b9f95ee3b023f53fcf99fe33038a53de","modified":1769611506873},{"_id":"public/images/LocationApp.png","hash":"e89348ec00f044eded715f9b4f8be69b3d491f71","modified":1769611506873},{"_id":"public/images/CPU-排程.png","hash":"621260c805042818e2662dbafc99367cd3ba520f","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-11.51.05-1-scaled.png","hash":"a1abb97e036f64b4c9b18ffd1e26ba95153ccd5e","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-11.51.05-scaled.png","hash":"a1abb97e036f64b4c9b18ffd1e26ba95153ccd5e","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.17.01-scaled.png","hash":"0fa17ed08a0af7ea09084e151eb3f1ed6637ddc4","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-12.23.00-scaled.png","hash":"8724d9f31178381a26f6861bd42d3a5afa96e9d4","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-28-at-12.17.25.gif","hash":"407d6cd73c28e566353e3f28b3c7311d53b8cc37","modified":1769611506873},{"_id":"public/images/icon.jpeg","hash":"3d28a9ffc52529254ffdc31c96ac1c363fae7f74","modified":1769611506873},{"_id":"public/images/image-12.png","hash":"7f15047aeb5d714b132fc41fc65004a643b02dc7","modified":1769611506873},{"_id":"public/images/image-2-scaled.png","hash":"2e4aae66a49186e4ba3e5c45698a8a652c553817","modified":1769611506873},{"_id":"public/images/image-24-1024x604.png","hash":"c1b66a46d3596c15c62837823ce8367e05c19b15","modified":1769611506873},{"_id":"public/images/ubuntu-swap.png","hash":"ee2374bddc69be238700770ae1c031dbacb078f6","modified":1769611506873},{"_id":"public/images/unity-data-scene.png","hash":"9099a0db4ee5f99ad319027d8043e08e549206d7","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account1.png","hash":"9f1e0ffe3c1b3ad63330028386a13782660ddcb1","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account4.png","hash":"38c89231c34fd62fb63baee89ffdf7659a5f6798","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account10.png","hash":"ed2991f4deb0dd0740154ca3f39a0abaf961afdc","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account9.png","hash":"94065ffb80467577af8220bd4027076cedf2dd71","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account8.png","hash":"657ff7185262932c3edbfef9de104111e6800de9","modified":1769611506873},{"_id":"public/img/butterfly-icon.png","hash":"f5dd732fed5c3bcd4aa76bac3441bac8485fb432","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-13.44.41-1024x611.png","hash":"99c24be9b01d79153308bd2f3ef237b4c9c7649b","modified":1769611506873},{"_id":"public/images/Gemini_Generated_Image_hqxfm7hqxfm7hqxf.png","hash":"df2f15d3d763048b65e8621a74537bbac7b77d08","modified":1769611506873},{"_id":"public/images/openai/openai-api4.png","hash":"cf6b447ffcebb61706a5897e5c65e23134902acc","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account3.png","hash":"a55c3dcf1ed981c392d5bb8a2a21bac0d826a4c2","modified":1769611506873},{"_id":"public/images/CPE_sub.webp","hash":"8cb973f3ce4df277aeff21a4ae14fe5f3454a7f5","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-13.44.56-scaled.png","hash":"ce49a7d5f139bea9a411eb4b0a61b31dde20338d","modified":1769611506873},{"_id":"public/images/Gemini_Generated_Image_vfctf8vfctf8vfct.png","hash":"ac00f2bcb512e5b3f1f90fd20b58acba24b39dc8","modified":1769611506873},{"_id":"public/images/openai/openai-api1.png","hash":"66b194b66f959432efc174347330cb98f281f0c8","modified":1769611506873},{"_id":"public/images/告別手動備份：WordPress-網站利用-Cron-Rclone-自動同步檔案到-Google-Drive-完整教學.png","hash":"1b1ae12c62815d57e49db509175c8f7d512b33c6","modified":1769611506873},{"_id":"public/images/YOLOv9.png","hash":"15d050a634c4406e4f1571207dfc4ceb5a9f5ec3","modified":1769611506873},{"_id":"public/images/n8n-linode.png","hash":"f92a03e4f85997f6b7df0c989853f69effaad816","modified":1769611506873},{"_id":"public/images/openai/openai-api5.png","hash":"48618eebe12a18589320dd97e41e016970e2d936","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account5.png","hash":"1075d37390698d46aeab9e68badd1e4804db686c","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account6.png","hash":"c224e7b7ed15cb424a142abb4ac6ccdc62a9dc26","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account7.png","hash":"6258c918de844422a74faa81e7d0e0c5e2339a8e","modified":1769611506873},{"_id":"public/images/openai/openai-api3.png","hash":"214a2456ab1ce22a7338a00caaa4072cd59e1bdb","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account11.png","hash":"54ccbe5df67ac93255d4262ad93bfeca39cc7e19","modified":1769611506873},{"_id":"public/images/CPE.webp","hash":"4fb5c699f799f447b2059c9f846dce834fe40353","modified":1769611506873},{"_id":"public/images/image-24.png","hash":"c96ece4847e80c9f66dd9e209affc0344d024836","modified":1769611506873},{"_id":"public/images/openai/openai-api2.png","hash":"8006d57e5589be3e5902103dbcb1f19deb9bcb92","modified":1769611506873},{"_id":"public/images/CleanShot-2025-11-15-at-13.44.41-scaled.png","hash":"02df0867a1972791abf68a174b6222fd4d79f5e7","modified":1769611506873},{"_id":"public/images/banner.jpeg","hash":"57ab1135f4d28bb2826b7d76bd4fc66b277265ca","modified":1769611506873},{"_id":"public/images/Line-Bot/create-account/create-account2.png","hash":"745265243bd9ac06cd40f1d63ded063252fbcc97","modified":1769611506873},{"_id":"source/_posts/interest-and-yield.md","hash":"a0840965ee031e198dc94d4aafd8e5524471e021","modified":1769609845064},{"_id":"source/_posts/mac-docker-error.md","hash":"df24b28c328679d8514cb9886bf0d2c80cb23c5b","modified":1769609845064},{"_id":"source/_posts/android-locationapp.md","hash":"8022c3032c52fa55bb8ac71b9fcee45cb56f47d5","modified":1769609845062},{"_id":"source/_posts/cpu-job-time.md","hash":"3af7be669564af5b31e126854fecc309b0f06e03","modified":1769609845062},{"_id":"source/_posts/pytorch-base.md","hash":"e2d7e0aa6793aafbb66ecef80aad1f5be072aab6","modified":1769609845066},{"_id":"source/_posts/next-js-v16-base.md","hash":"72d01b8d3a8003f572565bacf7ec0c959c4c15c7","modified":1769609845065},{"_id":"source/_posts/wordpress-start.md","hash":"888248a8c93ef2a2eb8ba417660f7ebc3b3c19ff","modified":1769609845068},{"_id":"source/_posts/training-a-classifier.md","hash":"cb946105f359a20958d5e11f4574094bf8fe70f8","modified":1769609845067},{"_id":"source/_posts/linode-docker-n8n.md","hash":"ea83ad37c9c6f4b2b445104f8a16a24babc61e83","modified":1769609845064},{"_id":"source/_posts/ubuntu-swap-setting.md","hash":"a25980d861ad81e8d8e009cd4863cf7c91f1b6cf","modified":1769609845067},{"_id":"source/_posts/nginx-cerbot.md","hash":"fb4f71a2ee6228050b7b8b13056ef5cce9ea1721","modified":1769609845065},{"_id":"source/_posts/streamlit-yolo.md","hash":"f8c8aa5f7cae617cb2bb9698bf9811eee0b5c137","modified":1769609845066},{"_id":"source/_posts/wp-cron-backup.md","hash":"44a63e5f98da210bd7e3a7af8e905c383627dd92","modified":1769609845069},{"_id":"source/_posts/wp-restore-local.md","hash":"f37b235b5ba59746c4e42f8bcb508d0f76f141ee","modified":1769609845069},{"_id":"source/_posts/unity-scene-data.md","hash":"c50107b7f34293a4cedf5f7ab5b7fcadde5e7f1e","modified":1769609845068},{"_id":"source/_posts/yolov9-practice.md","hash":"57b0894d0984fcc9add40f015206d872abca7191","modified":1769609845069},{"_id":"public/2025/03/30/nginx-cerbot/index.html","hash":"fff8fd7e1d128fe80ff30ee29861e26f66476222","modified":1769611506873},{"_id":"public/2025/03/31/wordpress-start/index.html","hash":"51501dbeeeb60ec1f156d2ff5f1522e6c359d27f","modified":1769611506873},{"_id":"public/2025/04/04/mac-docker-error/index.html","hash":"b97a1ae60ec078c47bafe5bdc13c4a80e3c1eb17","modified":1769611506873},{"_id":"public/2025/10/17/android-locationapp/index.html","hash":"1f2bab56de87d4851dfe6ce44194fe9f686acfbb","modified":1769611506873},{"_id":"public/2025/10/20/pytorch-base/index.html","hash":"4005b7411b1395040d7682e9100b1f2d3930ed32","modified":1769611506873},{"_id":"public/2025/10/21/cpu-job-time/index.html","hash":"6ee06752bd6109f709c328ed721d8a3648e3e767","modified":1769611506873},{"_id":"public/2025/10/26/yolov9-practice/index.html","hash":"7a533b46838ec1fe925c4b40b3b6e8eb51e19fa1","modified":1769611506873},{"_id":"public/2025/10/29/training-a-classifier/index.html","hash":"fdbce059be98133b8d855337173d567ddbdc50b4","modified":1769611506873},{"_id":"public/2025/11/05/linode-docker-n8n/index.html","hash":"6b0053236ca681f0111b583fa27d9112d02ba216","modified":1769611506873},{"_id":"public/2025/11/13/ubuntu-swap-setting/index.html","hash":"da033d89524d536ac3e6ea73d9705db4e7e05273","modified":1769611506873},{"_id":"public/2025/11/14/wp-cron-backup/index.html","hash":"6eb89a1e13c6a326eddf11952228b6c8baab255f","modified":1769611506873},{"_id":"public/2025/11/15/wp-restore-local/index.html","hash":"658bb4e4cf989aefcedad8d994354b5902256aba","modified":1769611506873},{"_id":"public/2025/11/24/interest-and-yield/index.html","hash":"063df2138125711a586945c48669eb450fa0fd4b","modified":1769611506873},{"_id":"public/2025/11/26/next-js-v16-base/index.html","hash":"b271e57d4e300c9b99741c2194be8ed5c762ff2a","modified":1769611506873},{"_id":"public/2025/12/01/streamlit-yolo/index.html","hash":"033b5a6f0285a12a8b53c779e4191e716cd4504c","modified":1769611506873},{"_id":"public/2025/12/04/unity-scene-data/index.html","hash":"9208c8b259ab6deb771b9f25ddf36bf57dd0f08d","modified":1769611506873},{"_id":"source/images/banner01.jpeg","hash":"e899cd5f0647af5684f39fcbc1a72a28096c465c","modified":1769609845210},{"_id":"source/images/banner02.jpeg","hash":"88c5bd594e53ceffce164c46e399fa81ca3ad0a7","modified":1769610739991},{"_id":"public/images/banner01.jpeg","hash":"e899cd5f0647af5684f39fcbc1a72a28096c465c","modified":1769611506873},{"_id":"public/images/banner02.jpeg","hash":"88c5bd594e53ceffce164c46e399fa81ca3ad0a7","modified":1769611506873}],"Category":[{"name":"vm-setting","_id":"cmkxfp4xu00047z8z1ptr003s"},{"name":"docker","_id":"cmkxfp4xx000b7z8zcd0a35qu"},{"name":"android-app","_id":"cmkxfp4xy000m7z8z8h7qbh2c"},{"name":"ai","_id":"cmkxfp4xz000q7z8z1qyp1npp"},{"name":"operating-system","_id":"cmkxfp4xz000u7z8zd3zbc6zq"},{"name":"wordpress","parent":"cmkxfp4xu00047z8z1ptr003s","_id":"cmkxfp4y100197z8zcyoegupe"},{"name":"n8n","parent":"cmkxfp4xx000b7z8zcd0a35qu","_id":"cmkxfp4y2001f7z8zee3j9op2"},{"name":"ubuntu","_id":"cmkxfp4y2001k7z8z3mr83d8w"},{"name":"kotlin","parent":"cmkxfp4xy000m7z8z8h7qbh2c","_id":"cmkxfp4y2001p7z8z1rhr7h3h"},{"name":"wordpress","_id":"cmkxfp4y3001v7z8zeser3ztp"},{"name":"financial","_id":"cmkxfp4y300227z8zcqv3g4v4"},{"name":"pytorch","parent":"cmkxfp4xz000q7z8z1qyp1npp","_id":"cmkxfp4y300277z8z58irhc0h"},{"name":"next-js","_id":"cmkxfp4y3002b7z8z9voa9h2g"},{"name":"unity","_id":"cmkxfp4y3002f7z8z9e2jgdat"},{"name":"WebSocket","_id":"cmkxfp4y4002k7z8zbelofcak"},{"name":"Line Bot","_id":"cmkxfp4y4002p7z8zbepe5w5i"},{"name":"Python","_id":"cmkxfp4y4002v7z8z25kl0285"},{"name":"程式解題","_id":"cmkxfp4y400307z8zfh6dgkfp"},{"name":"vm-setting","parent":"cmkxfp4y2001f7z8zee3j9op2","_id":"cmkxfp4y400317z8z6fvofko1"},{"name":"vm-setting","parent":"cmkxfp4y2001k7z8z3mr83d8w","_id":"cmkxfp4y400337z8z4ht2fs9r"},{"name":"replit設定","parent":"cmkxfp4y4002p7z8zbepe5w5i","_id":"cmkxfp4y500377z8z8fjpblgc"},{"name":"建立帳號Line Bot帳號","parent":"cmkxfp4y4002p7z8zbepe5w5i","_id":"cmkxfp4y500397z8z3sq0bix0"},{"name":"Django","parent":"cmkxfp4y4002v7z8z25kl0285","_id":"cmkxfp4y5003c7z8zd2c7ewxr"},{"name":"成績查詢練習","parent":"cmkxfp4y4002p7z8zbepe5w5i","_id":"cmkxfp4y5003f7z8z9i8h3qax"},{"name":"CPE49題","parent":"cmkxfp4y400307z8zfh6dgkfp","_id":"cmkxfp4y5003i7z8z5i7qapnx"},{"name":"Daphne","parent":"cmkxfp4y5003c7z8zd2c7ewxr","_id":"cmkxfp4y6003o7z8zgjsz3wsi"},{"name":"C++","_id":"cmkxfp4y8003y7z8z058zh03v"},{"name":"開發環境","_id":"cmkxfp4y800437z8zc1lu0cbf"},{"name":"Email","parent":"cmkxfp4y4002v7z8z25kl0285","_id":"cmkxfp4y800467z8zdz5m8bgg"},{"name":"Wordpress","_id":"cmkxfp4y800497z8z9wfnbo52"},{"name":"Vector","parent":"cmkxfp4y8003y7z8z058zh03v","_id":"cmkxfp4y9004d7z8z6bldhl90"},{"name":"遠端存放庫","_id":"cmkxfp4y9004h7z8zdeba5te4"},{"name":"使用Mac在vscode執行C++","parent":"cmkxfp4y800437z8zc1lu0cbf","_id":"cmkxfp4y9004k7z8z7qfw6ena"},{"name":"動態選單","parent":"cmkxfp4y800497z8z9wfnbo52","_id":"cmkxfp4y9004m7z8z1j7p5c4o"},{"name":"Bitbucket","parent":"cmkxfp4y9004h7z8zdeba5te4","_id":"cmkxfp4y9004o7z8zdkpp76ue"}],"Data":[{"_id":"link","data":[{"class_name":"友情鏈接","class_desc":"那些人，那些事","link_list":[{"name":"Hexo","link":"https://hexo.io/zh-tw/","avatar":"https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg","descr":"快速、簡單且強大的網誌框架"}]},{"class_name":"網站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平台"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平台"}]}]}],"Page":[{"title":"時間軸 (Timeline)","subtitle":"探索過去的記錄","top_img":"https://images.pexels.com/photos/28318918/pexels-photo-28318918.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2","type":"archives","_content":"","source":"archives/index.md","raw":"---\ntitle: \"時間軸 (Timeline)\"\nsubtitle: \"探索過去的記錄\"\ntop_img: \"https://images.pexels.com/photos/28318918/pexels-photo-28318918.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2\"\ntype: \"archives\"\n---\n","date":"2026-01-28T14:17:25.070Z","updated":"2026-01-28T14:17:25.070Z","path":"archives/index.html","_id":"cmkxfp4xr00007z8z9n5y6441","comments":1,"layout":"page","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script>","excerpt":"","more":""},{"type":"categories","layout":"page","title":"所有分類 (Explore All Categories) 📂","date":"2024-09-14T12:51:14.000Z","tags":null,"top_img":"https://images.pexels.com/photos/1750268/pexels-photo-1750268.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2","_content":"","source":"categories/index.md","raw":"---\ntype: \"categories\"\nlayout: page\ntitle: 所有分類 (Explore All Categories) 📂\ndate: 2024-09-14 20:51:14\ntags:\ntop_img: https://images.pexels.com/photos/1750268/pexels-photo-1750268.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2\n---\n","updated":"2026-01-28T14:17:25.070Z","path":"categories/index.html","_id":"cmkxfp4xu00027z8z7gpna6v0","comments":1,"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script>","excerpt":"","more":""},{"title":"Home","date":"2024-09-12T16:00:00.000Z","_content":"\nWelcome to StackPenguin's blog!\n","source":"index.md","raw":"---\ntitle: Home\ndate: 2024-09-13\n---\n\nWelcome to StackPenguin's blog!\n","updated":"2026-01-28T14:17:25.279Z","path":"index.html","_id":"cmkxfp4xv00057z8z18za1cso","comments":1,"layout":"page","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>Welcome to StackPenguin’s blog!</p>\n","excerpt":"","more":"<p>Welcome to StackPenguin’s blog!</p>\n"},{"_content":"#page-header #post-info {\n  bottom: 100px;\n}\n\n#post-info {\n  display: flex;\n  flex-direction: column;\n  /* 讓內容垂直排列 */\n  justify-content: center;\n  /* 置中對齊內容 */\n  align-items: center;\n  /* 置中對齊內容 */\n  text-align: center;\n  /* 文字置中 */\n}\n\n.post-title {\n  font-size: 2.5em;\n  margin-bottom: 30px;\n  /* 調整標題和元數據間的距離 */\n}\n\n#post-meta {\n  display: flex;\n  flex-direction: column;\n  /* 元數據垂直排列 */\n  align-items: center;\n  /* 元數據置中 */\n}\n\n.meta-firstline,\n.meta-secondline {\n  margin-bottom: 10px;\n  /* 增加每行之間的距離 */\n}\n\n/* Footer Color Customization - Tech Style */\n#footer {\n  background: #0a0a0a !important;\n  /* Deep black background */\n  color: #00f3ff !important;\n  /* Neon cyan text */\n  border-top: 1px solid #00f3ff;\n  /* Neon border */\n  box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);\n  /* Subtle glow */\n  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n  /* Clean tech font */\n}\n\n#footer::before {\n  background: transparent !important;\n}\n\n#footer a {\n  color: #fff !important;\n  text-decoration: none;\n  transition: all 0.3s ease;\n}\n\n#footer a:hover {\n  color: #00f3ff !important;\n  text-shadow: 0 0 5px #00f3ff;\n}","source":"css/custom.css","raw":"#page-header #post-info {\n  bottom: 100px;\n}\n\n#post-info {\n  display: flex;\n  flex-direction: column;\n  /* 讓內容垂直排列 */\n  justify-content: center;\n  /* 置中對齊內容 */\n  align-items: center;\n  /* 置中對齊內容 */\n  text-align: center;\n  /* 文字置中 */\n}\n\n.post-title {\n  font-size: 2.5em;\n  margin-bottom: 30px;\n  /* 調整標題和元數據間的距離 */\n}\n\n#post-meta {\n  display: flex;\n  flex-direction: column;\n  /* 元數據垂直排列 */\n  align-items: center;\n  /* 元數據置中 */\n}\n\n.meta-firstline,\n.meta-secondline {\n  margin-bottom: 10px;\n  /* 增加每行之間的距離 */\n}\n\n/* Footer Color Customization - Tech Style */\n#footer {\n  background: #0a0a0a !important;\n  /* Deep black background */\n  color: #00f3ff !important;\n  /* Neon cyan text */\n  border-top: 1px solid #00f3ff;\n  /* Neon border */\n  box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);\n  /* Subtle glow */\n  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n  /* Clean tech font */\n}\n\n#footer::before {\n  background: transparent !important;\n}\n\n#footer a {\n  color: #fff !important;\n  text-decoration: none;\n  transition: all 0.3s ease;\n}\n\n#footer a:hover {\n  color: #00f3ff !important;\n  text-shadow: 0 0 5px #00f3ff;\n}","date":"2026-01-28T14:17:25.072Z","updated":"2026-01-28T14:17:25.072Z","path":"css/custom.css","layout":"false","_id":"cmkxfp4xw00077z8z7hdfheyy","title":"","comments":1,"content":"#page-header #post-info {\n  bottom: 100px;\n}\n\n#post-info {\n  display: flex;\n  flex-direction: column;\n  /* 讓內容垂直排列 */\n  justify-content: center;\n  /* 置中對齊內容 */\n  align-items: center;\n  /* 置中對齊內容 */\n  text-align: center;\n  /* 文字置中 */\n}\n\n.post-title {\n  font-size: 2.5em;\n  margin-bottom: 30px;\n  /* 調整標題和元數據間的距離 */\n}\n\n#post-meta {\n  display: flex;\n  flex-direction: column;\n  /* 元數據垂直排列 */\n  align-items: center;\n  /* 元數據置中 */\n}\n\n.meta-firstline,\n.meta-secondline {\n  margin-bottom: 10px;\n  /* 增加每行之間的距離 */\n}\n\n/* Footer Color Customization - Tech Style */\n#footer {\n  background: #0a0a0a !important;\n  /* Deep black background */\n  color: #00f3ff !important;\n  /* Neon cyan text */\n  border-top: 1px solid #00f3ff;\n  /* Neon border */\n  box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);\n  /* Subtle glow */\n  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n  /* Clean tech font */\n}\n\n#footer::before {\n  background: transparent !important;\n}\n\n#footer a {\n  color: #fff !important;\n  text-decoration: none;\n  transition: all 0.3s ease;\n}\n\n#footer a:hover {\n  color: #00f3ff !important;\n  text-shadow: 0 0 5px #00f3ff;\n}"},{"_content":"/* 波浪css */\n.main-hero-waves-area {\n  width: 100%;\n  position: absolute;\n  left: 0;\n  bottom: -11px;\n  z-index: 5;\n}\n.waves-area .waves-svg {\n  width: 100%;\n  height: 5rem;\n}\n/* Animation */\n\n.parallax > use {\n  animation: move-forever 25s cubic-bezier(0.55, 0.5, 0.45, 0.5) infinite;\n}\n.parallax > use:nth-child(1) {\n  animation-delay: -2s;\n  animation-duration: 7s;\n  fill: #f7f9febd;\n}\n.parallax > use:nth-child(2) {\n  animation-delay: -3s;\n  animation-duration: 10s;\n  fill: #f7f9fe82;\n}\n.parallax > use:nth-child(3) {\n  animation-delay: -4s;\n  animation-duration: 13s;\n  fill: #f7f9fe36;\n}\n.parallax > use:nth-child(4) {\n  animation-delay: -5s;\n  animation-duration: 20s;\n  fill: #f7f9fe;\n}\n/* 黑色模式背景 */\n[data-theme=\"dark\"] .parallax > use:nth-child(1) {\n  animation-delay: -2s;\n  animation-duration: 7s;\n  fill: #18171dc8;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(2) {\n  animation-delay: -3s;\n  animation-duration: 10s;\n  fill: #18171d80;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(3) {\n  animation-delay: -4s;\n  animation-duration: 13s;\n  fill: #18171d3e;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(4) {\n  animation-delay: -5s;\n  animation-duration: 20s;\n  fill: #18171d;\n}\n\n@keyframes move-forever {\n  0% {\n    transform: translate3d(-90px, 0, 0);\n  }\n  100% {\n    transform: translate3d(85px, 0, 0);\n  }\n}\n/*Shrinking for mobile*/\n@media (max-width: 768px) {\n  .waves-area .waves-svg {\n    height: 40px;\n    min-height: 40px;\n  }\n}\n","source":"css/wave.css","raw":"/* 波浪css */\n.main-hero-waves-area {\n  width: 100%;\n  position: absolute;\n  left: 0;\n  bottom: -11px;\n  z-index: 5;\n}\n.waves-area .waves-svg {\n  width: 100%;\n  height: 5rem;\n}\n/* Animation */\n\n.parallax > use {\n  animation: move-forever 25s cubic-bezier(0.55, 0.5, 0.45, 0.5) infinite;\n}\n.parallax > use:nth-child(1) {\n  animation-delay: -2s;\n  animation-duration: 7s;\n  fill: #f7f9febd;\n}\n.parallax > use:nth-child(2) {\n  animation-delay: -3s;\n  animation-duration: 10s;\n  fill: #f7f9fe82;\n}\n.parallax > use:nth-child(3) {\n  animation-delay: -4s;\n  animation-duration: 13s;\n  fill: #f7f9fe36;\n}\n.parallax > use:nth-child(4) {\n  animation-delay: -5s;\n  animation-duration: 20s;\n  fill: #f7f9fe;\n}\n/* 黑色模式背景 */\n[data-theme=\"dark\"] .parallax > use:nth-child(1) {\n  animation-delay: -2s;\n  animation-duration: 7s;\n  fill: #18171dc8;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(2) {\n  animation-delay: -3s;\n  animation-duration: 10s;\n  fill: #18171d80;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(3) {\n  animation-delay: -4s;\n  animation-duration: 13s;\n  fill: #18171d3e;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(4) {\n  animation-delay: -5s;\n  animation-duration: 20s;\n  fill: #18171d;\n}\n\n@keyframes move-forever {\n  0% {\n    transform: translate3d(-90px, 0, 0);\n  }\n  100% {\n    transform: translate3d(85px, 0, 0);\n  }\n}\n/*Shrinking for mobile*/\n@media (max-width: 768px) {\n  .waves-area .waves-svg {\n    height: 40px;\n    min-height: 40px;\n  }\n}\n","date":"2026-01-28T14:17:25.072Z","updated":"2026-01-28T14:17:25.072Z","path":"css/wave.css","layout":"false","_id":"cmkxfp4xw00097z8zd90tf687","title":"","comments":1,"content":"/* 波浪css */\n.main-hero-waves-area {\n  width: 100%;\n  position: absolute;\n  left: 0;\n  bottom: -11px;\n  z-index: 5;\n}\n.waves-area .waves-svg {\n  width: 100%;\n  height: 5rem;\n}\n/* Animation */\n\n.parallax > use {\n  animation: move-forever 25s cubic-bezier(0.55, 0.5, 0.45, 0.5) infinite;\n}\n.parallax > use:nth-child(1) {\n  animation-delay: -2s;\n  animation-duration: 7s;\n  fill: #f7f9febd;\n}\n.parallax > use:nth-child(2) {\n  animation-delay: -3s;\n  animation-duration: 10s;\n  fill: #f7f9fe82;\n}\n.parallax > use:nth-child(3) {\n  animation-delay: -4s;\n  animation-duration: 13s;\n  fill: #f7f9fe36;\n}\n.parallax > use:nth-child(4) {\n  animation-delay: -5s;\n  animation-duration: 20s;\n  fill: #f7f9fe;\n}\n/* 黑色模式背景 */\n[data-theme=\"dark\"] .parallax > use:nth-child(1) {\n  animation-delay: -2s;\n  animation-duration: 7s;\n  fill: #18171dc8;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(2) {\n  animation-delay: -3s;\n  animation-duration: 10s;\n  fill: #18171d80;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(3) {\n  animation-delay: -4s;\n  animation-duration: 13s;\n  fill: #18171d3e;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(4) {\n  animation-delay: -5s;\n  animation-duration: 20s;\n  fill: #18171d;\n}\n\n@keyframes move-forever {\n  0% {\n    transform: translate3d(-90px, 0, 0);\n  }\n  100% {\n    transform: translate3d(85px, 0, 0);\n  }\n}\n/*Shrinking for mobile*/\n@media (max-width: 768px) {\n  .waves-area .waves-svg {\n    height: 40px;\n    min-height: 40px;\n  }\n}\n"},{"title":"友情鏈接","date":"2024-09-16T14:17:49.000Z","type":"link","_content":"","source":"link/index.md","raw":"---\ntitle: 友情鏈接\ndate: 2024-09-16 22:17:49\ntype: \"link\"\n---\n","updated":"2026-01-28T14:17:25.279Z","path":"link/index.html","_id":"cmkxfp4xx000d7z8zfqg5ashf","comments":1,"layout":"page","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script>","excerpt":"","more":""},{"title":"所有標籤 (Explore All Tags) 🏷️","date":"2018-01-04T16:00:00.000Z","type":"tags","orderby":"random","order":1,"top_img":"https://images.pexels.com/photos/354103/pexels-photo-354103.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2","_content":"","source":"tags/index.md","raw":"---\ntitle: 所有標籤 (Explore All Tags) 🏷️\ndate: 2018-01-05 00:00:00\ntype: \"tags\"\norderby: random\norder: 1\ntop_img: https://images.pexels.com/photos/354103/pexels-photo-354103.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2\n---\n","updated":"2026-01-28T14:17:25.279Z","path":"tags/index.html","_id":"cmkxfp4xx000f7z8z10bldivj","comments":1,"layout":"page","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script>","excerpt":"","more":""}],"Post":[{"layout":"post","title":"Django WebSocket 前後端即時通訊","date":"2024-10-24T02:00:30.000Z","top_img":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fwebsocket.webp?alt=media&token=7e9597ac-6eb5-480c-b7ae-862eede0f1ab","cover":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fwebsocket.webp?alt=media&token=7e9597ac-6eb5-480c-b7ae-862eede0f1ab","_content":"\n## 全部步驟總結\n\n1.  **安裝必要的套件**：\n\n    ```bash\n    pip install channels channels_redis\n    ```\n\n    - **channels**：使 Django 支持 WebSocket。\n    - **channels_redis**：用來實現 Channel Layer，讓不同的 WebSocket 連接能夠進行通訊。\n\n2.  **設定 Django 專案**：\n\n    - 在 `settings.py` 中添加 Channels 和 Channel Layer 配置：\n\n    ```python\n    INSTALLED_APPS = [\n        # 其他已安裝的應用\n        'channels',\n        'chat',  # 你的 WebSocket 應用\n    ]\n\n    ASGI_APPLICATION = 'classify.asgi.application'\n\n    CHANNEL_LAYERS = {\n        'default': {\n            'BACKEND': 'channels_redis.core.RedisChannelLayer',\n            'CONFIG': {\n                \"hosts\": [('127.0.0.1', 6379)],  # Redis 默認地址和端口\n            },\n        },\n    }\n    ```\n\n3.  **創建 `asgi.py` 文件**：\n    在 `classify` 專案目錄下，確保 `asgi.py` 設定為：\n\n    ```python\n    import os\n    from django.core.asgi import get_asgi_application\n    from channels.routing import ProtocolTypeRouter, URLRouter\n    from channels.auth import AuthMiddlewareStack\n    from chat import routing\n\n    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'classify.settings')\n\n    application = ProtocolTypeRouter({\n        \"http\": get_asgi_application(),\n        \"websocket\": AuthMiddlewareStack(\n            URLRouter(\n                routing.websocket_urlpatterns\n            )\n        ),\n    })\n    ```\n\n4.  **創建 `chat/routing.py` 文件**：\n    設置 WebSocket 路由：\n\n    ```python\n    from django.urls import path\n    from . import consumers\n\n    websocket_urlpatterns = [\n        path('ws/chat/', consumers.ChatConsumer.as_asgi()),\n    ]\n    ```\n\n5.  **編寫 `chat/consumers.py`**：\n    設計 WebSocket Consumer，可以通過 Channel Layer 發送消息：\n\n    ````python\n    import json\n    from channels.generic.websocket import AsyncWebsocketConsumer\n    from channels.layers import get_channel_layer\n    from asgiref.sync import async_to_sync\n\n        class ChatConsumer(AsyncWebsocketConsumer):\n            async def connect(self):\n                self.room_name = \"chat_room\"\n                self.room_group_name = f\"chat_{self.room_name}\"\n\n                await self.channel_layer.group_add(\n                    self.room_group_name,\n                    self.channel_name\n                )\n                await self.accept()\n\n            async def disconnect(self, close_code):\n                await self.channel_layer.group_discard(\n                    self.room_group_name,\n                    self.channel_name\n                )\n\n            async def receive(self, text_data):\n                text_data_json = json.loads(text_data)\n                message = text_data_json['message']\n\n                await self.channel_layer.group_send(\n                    self.room_group_name,\n                    {\n                        'type': 'chat_message',\n                        'message': message\n                    }\n                )\n\n            async def chat_message(self, event):\n                message = event['message']\n                await self.send(text_data=json.dumps({\n                    'message': message\n                }))\n\n            @staticmethod\n            def send_to_frontend(message):\n                channel_layer = get_channel_layer()\n                async_to_sync(channel_layer.group_send)(\n                    \"chat_chat_room\",\n                    {\n                        'type': 'chat_message',\n                        'message': message\n                    }\n                )\n        ```\n\n    ````\n\n6.  **創建自定義 Django 命令**：\n    在 `chat/management/commands/send_message.py` 中添加：\n\n    ```python\n    from django.core.management.base import BaseCommand\n    from chat.consumers import ChatConsumer\n\n    class Command(BaseCommand):\n        help = 'Send a WebSocket message from backend'\n\n        def handle(self, *args, **kwargs):\n            message = \"這是從後端通過 command 發送的 WebSocket 訊息\"\n            ChatConsumer.send_to_frontend(message)\n            self.stdout.write(self.style.SUCCESS('Message sent successfully'))\n    ```\n\n7.  **運行 Django 項目**：\n    確保 Redis 在運行，然後啟動 Django：\n    ```bash\n    python3 manage.py runserver\n    ```\n8.  **從命令行發送訊息**：\n    使用自定義命令從後端發送訊息：\n    ```bash\n    python3 manage.py send_message\n    ```\n\n## 程式執行順序步驟\n\n### 1. 用戶端建立 WebSocket 連接\n\n當用戶開啟瀏覽器並連接到你的 WebSocket 路徑 `/ws/chat/` 時，會觸發 `ChatConsumer` 的 `connect()` 方法：\n\n- **步驟**：\n  1. 用戶端（例如瀏覽器）使用 JavaScript 建立 WebSocket 連接。\n  2. Django Channels 會啟動 `ChatConsumer` 的 `connect()` 方法。\n  3. 用戶端被加入到 `chat_chat_room` 群組，這是透過 `self.channel_layer.group_add()` 方法實現的。\n  4. 連接成功後，`await self.accept()` 允許 WebSocket 連接繼續。\n- **Redis 的角色**：\n  - Redis 會存儲群組 `chat_chat_room` 的資訊，記錄有哪些 WebSocket 連接屬於這個群組。\n\n### 2. 從後端發送訊息\n\n當你運行以下命令時，將觸發後端發送訊息：\n\n```bash\npython3 manage.py send_message\n```\n\n- **步驟**：\n  1. Django 運行 `send_message` 命令，調用 `ChatConsumer.send_to_frontend()` 方法。\n  2. `send_to_frontend()` 使用 `get_channel_layer()` 取得 Channels Layer，並調用 `async_to_sync(channel_layer.group_send(...))` 發送訊息到 `chat_chat_room`。\n  3. 這個訊息會被放入 Redis，由 Redis 處理接下來的訊息分發。\n\n### 3. 消費者接收訊息\n\n每一個屬於 `chat_chat_room` 群組的 WebSocket 連接，都會收到這條訊息，並觸發 `ChatConsumer` 中的 `chat_message()` 方法：\n\n- **步驟**：\n  1. `chat_message()` 方法會被觸發，接收來自 Redis 的訊息。\n  2. 它將訊息轉換為 JSON 格式，然後通過 `await self.send(...)` 發送給 WebSocket 連接的用戶端。\n\n### 4. 用戶端顯示訊息\n\n前端的 JavaScript 監聽 `onmessage` 事件，並顯示從後端接收到的訊息：\n\n- **步驟**：\n  1. 用戶端的 WebSocket 連接收到來自伺服器的訊息。\n  2. `onmessage` 事件被觸發，並執行對應的 JavaScript 函數來處理這條訊息，例如在控制台打印出來或顯示在網頁上。\n\n### 整體流程總結\n\n1. **建立連接**：用戶端連接到 `/ws/chat/`，被加入到 `chat_chat_room` 群組，Redis 記錄連接資訊。\n2. **後端發送訊息**：你運行 `send_message` 命令，後端通過 Channels Layer 和 Redis 將訊息傳給 `chat_chat_room`。\n3. **訊息分發**：Redis 處理訊息分發，確保所有屬於 `chat_chat_room` 的 WebSocket 連接都收到這條訊息。\n4. **前端接收並顯示**：用戶端接收到訊息，觸發 JavaScript 的 `onmessage` 事件，並在頁面上顯示內容。\n\n### Redis 的功能\n\n- **作為 Channel Layer 的後端**：Redis 被用來存儲和傳遞 WebSocket 訊息。當 Django 需要向某個群組或某個連接發送訊息時，Channels 會把訊息放入 Redis，然後由其他連接取出並傳遞給相應的 WebSocket。\n- **訊息中繼**：Redis 可以在多個 Django 節點之間中繼訊息，這使得即使在高負載或多伺服器環境下，WebSocket 仍然能穩定運作。\n\n### Channel Layer 的功能\n\n- **實現群組通信**：讓不同的 WebSocket 連接（甚至不同伺服器上的連接）可以被分組。通過 `group_add()` 和 `group_send()` 來把訊息發送到特定的群組，使得多人可以即時收到更新。\n- **跨進程通信**：Channel Layer 可以在不同進程間傳遞訊息，允許伺服器間或與背景任務間的即時溝通。\n","source":"_posts/Django-WebSocket.md","raw":"---\nlayout: post\ntitle: Django WebSocket 前後端即時通訊\ndate: 2024-10-24 10:00:30\ntags:\n  - \"Python Django\"\ncategories:\n  - \"WebSocket\"\ntop_img: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fwebsocket.webp?alt=media&token=7e9597ac-6eb5-480c-b7ae-862eede0f1ab\"\ncover: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fwebsocket.webp?alt=media&token=7e9597ac-6eb5-480c-b7ae-862eede0f1ab\"\n---\n\n## 全部步驟總結\n\n1.  **安裝必要的套件**：\n\n    ```bash\n    pip install channels channels_redis\n    ```\n\n    - **channels**：使 Django 支持 WebSocket。\n    - **channels_redis**：用來實現 Channel Layer，讓不同的 WebSocket 連接能夠進行通訊。\n\n2.  **設定 Django 專案**：\n\n    - 在 `settings.py` 中添加 Channels 和 Channel Layer 配置：\n\n    ```python\n    INSTALLED_APPS = [\n        # 其他已安裝的應用\n        'channels',\n        'chat',  # 你的 WebSocket 應用\n    ]\n\n    ASGI_APPLICATION = 'classify.asgi.application'\n\n    CHANNEL_LAYERS = {\n        'default': {\n            'BACKEND': 'channels_redis.core.RedisChannelLayer',\n            'CONFIG': {\n                \"hosts\": [('127.0.0.1', 6379)],  # Redis 默認地址和端口\n            },\n        },\n    }\n    ```\n\n3.  **創建 `asgi.py` 文件**：\n    在 `classify` 專案目錄下，確保 `asgi.py` 設定為：\n\n    ```python\n    import os\n    from django.core.asgi import get_asgi_application\n    from channels.routing import ProtocolTypeRouter, URLRouter\n    from channels.auth import AuthMiddlewareStack\n    from chat import routing\n\n    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'classify.settings')\n\n    application = ProtocolTypeRouter({\n        \"http\": get_asgi_application(),\n        \"websocket\": AuthMiddlewareStack(\n            URLRouter(\n                routing.websocket_urlpatterns\n            )\n        ),\n    })\n    ```\n\n4.  **創建 `chat/routing.py` 文件**：\n    設置 WebSocket 路由：\n\n    ```python\n    from django.urls import path\n    from . import consumers\n\n    websocket_urlpatterns = [\n        path('ws/chat/', consumers.ChatConsumer.as_asgi()),\n    ]\n    ```\n\n5.  **編寫 `chat/consumers.py`**：\n    設計 WebSocket Consumer，可以通過 Channel Layer 發送消息：\n\n    ````python\n    import json\n    from channels.generic.websocket import AsyncWebsocketConsumer\n    from channels.layers import get_channel_layer\n    from asgiref.sync import async_to_sync\n\n        class ChatConsumer(AsyncWebsocketConsumer):\n            async def connect(self):\n                self.room_name = \"chat_room\"\n                self.room_group_name = f\"chat_{self.room_name}\"\n\n                await self.channel_layer.group_add(\n                    self.room_group_name,\n                    self.channel_name\n                )\n                await self.accept()\n\n            async def disconnect(self, close_code):\n                await self.channel_layer.group_discard(\n                    self.room_group_name,\n                    self.channel_name\n                )\n\n            async def receive(self, text_data):\n                text_data_json = json.loads(text_data)\n                message = text_data_json['message']\n\n                await self.channel_layer.group_send(\n                    self.room_group_name,\n                    {\n                        'type': 'chat_message',\n                        'message': message\n                    }\n                )\n\n            async def chat_message(self, event):\n                message = event['message']\n                await self.send(text_data=json.dumps({\n                    'message': message\n                }))\n\n            @staticmethod\n            def send_to_frontend(message):\n                channel_layer = get_channel_layer()\n                async_to_sync(channel_layer.group_send)(\n                    \"chat_chat_room\",\n                    {\n                        'type': 'chat_message',\n                        'message': message\n                    }\n                )\n        ```\n\n    ````\n\n6.  **創建自定義 Django 命令**：\n    在 `chat/management/commands/send_message.py` 中添加：\n\n    ```python\n    from django.core.management.base import BaseCommand\n    from chat.consumers import ChatConsumer\n\n    class Command(BaseCommand):\n        help = 'Send a WebSocket message from backend'\n\n        def handle(self, *args, **kwargs):\n            message = \"這是從後端通過 command 發送的 WebSocket 訊息\"\n            ChatConsumer.send_to_frontend(message)\n            self.stdout.write(self.style.SUCCESS('Message sent successfully'))\n    ```\n\n7.  **運行 Django 項目**：\n    確保 Redis 在運行，然後啟動 Django：\n    ```bash\n    python3 manage.py runserver\n    ```\n8.  **從命令行發送訊息**：\n    使用自定義命令從後端發送訊息：\n    ```bash\n    python3 manage.py send_message\n    ```\n\n## 程式執行順序步驟\n\n### 1. 用戶端建立 WebSocket 連接\n\n當用戶開啟瀏覽器並連接到你的 WebSocket 路徑 `/ws/chat/` 時，會觸發 `ChatConsumer` 的 `connect()` 方法：\n\n- **步驟**：\n  1. 用戶端（例如瀏覽器）使用 JavaScript 建立 WebSocket 連接。\n  2. Django Channels 會啟動 `ChatConsumer` 的 `connect()` 方法。\n  3. 用戶端被加入到 `chat_chat_room` 群組，這是透過 `self.channel_layer.group_add()` 方法實現的。\n  4. 連接成功後，`await self.accept()` 允許 WebSocket 連接繼續。\n- **Redis 的角色**：\n  - Redis 會存儲群組 `chat_chat_room` 的資訊，記錄有哪些 WebSocket 連接屬於這個群組。\n\n### 2. 從後端發送訊息\n\n當你運行以下命令時，將觸發後端發送訊息：\n\n```bash\npython3 manage.py send_message\n```\n\n- **步驟**：\n  1. Django 運行 `send_message` 命令，調用 `ChatConsumer.send_to_frontend()` 方法。\n  2. `send_to_frontend()` 使用 `get_channel_layer()` 取得 Channels Layer，並調用 `async_to_sync(channel_layer.group_send(...))` 發送訊息到 `chat_chat_room`。\n  3. 這個訊息會被放入 Redis，由 Redis 處理接下來的訊息分發。\n\n### 3. 消費者接收訊息\n\n每一個屬於 `chat_chat_room` 群組的 WebSocket 連接，都會收到這條訊息，並觸發 `ChatConsumer` 中的 `chat_message()` 方法：\n\n- **步驟**：\n  1. `chat_message()` 方法會被觸發，接收來自 Redis 的訊息。\n  2. 它將訊息轉換為 JSON 格式，然後通過 `await self.send(...)` 發送給 WebSocket 連接的用戶端。\n\n### 4. 用戶端顯示訊息\n\n前端的 JavaScript 監聽 `onmessage` 事件，並顯示從後端接收到的訊息：\n\n- **步驟**：\n  1. 用戶端的 WebSocket 連接收到來自伺服器的訊息。\n  2. `onmessage` 事件被觸發，並執行對應的 JavaScript 函數來處理這條訊息，例如在控制台打印出來或顯示在網頁上。\n\n### 整體流程總結\n\n1. **建立連接**：用戶端連接到 `/ws/chat/`，被加入到 `chat_chat_room` 群組，Redis 記錄連接資訊。\n2. **後端發送訊息**：你運行 `send_message` 命令，後端通過 Channels Layer 和 Redis 將訊息傳給 `chat_chat_room`。\n3. **訊息分發**：Redis 處理訊息分發，確保所有屬於 `chat_chat_room` 的 WebSocket 連接都收到這條訊息。\n4. **前端接收並顯示**：用戶端接收到訊息，觸發 JavaScript 的 `onmessage` 事件，並在頁面上顯示內容。\n\n### Redis 的功能\n\n- **作為 Channel Layer 的後端**：Redis 被用來存儲和傳遞 WebSocket 訊息。當 Django 需要向某個群組或某個連接發送訊息時，Channels 會把訊息放入 Redis，然後由其他連接取出並傳遞給相應的 WebSocket。\n- **訊息中繼**：Redis 可以在多個 Django 節點之間中繼訊息，這使得即使在高負載或多伺服器環境下，WebSocket 仍然能穩定運作。\n\n### Channel Layer 的功能\n\n- **實現群組通信**：讓不同的 WebSocket 連接（甚至不同伺服器上的連接）可以被分組。通過 `group_add()` 和 `group_send()` 來把訊息發送到特定的群組，使得多人可以即時收到更新。\n- **跨進程通信**：Channel Layer 可以在不同進程間傳遞訊息，允許伺服器間或與背景任務間的即時溝通。\n","slug":"Django-WebSocket","published":1,"updated":"2026-01-28T14:17:25.060Z","_id":"cmkxfp4y000117z8zfx6hh8qj","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"全部步驟總結\"><a href=\"#全部步驟總結\" class=\"headerlink\" title=\"全部步驟總結\"></a>全部步驟總結</h2><ol>\n<li><p><strong>安裝必要的套件</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install channels channels_redis</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>channels</strong>：使 Django 支持 WebSocket。</li>\n<li><strong>channels_redis</strong>：用來實現 Channel Layer，讓不同的 WebSocket 連接能夠進行通訊。</li>\n</ul>\n</li>\n<li><p><strong>設定 Django 專案</strong>：</p>\n<ul>\n<li>在 <code>settings.py</code> 中添加 Channels 和 Channel Layer 配置：</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALLED_APPS = [</span><br><span class=\"line\">    <span class=\"comment\"># 其他已安裝的應用</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;channels&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;chat&#x27;</span>,  <span class=\"comment\"># 你的 WebSocket 應用</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">ASGI_APPLICATION = <span class=\"string\">&#x27;classify.asgi.application&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">CHANNEL_LAYERS = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;default&#x27;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;BACKEND&#x27;</span>: <span class=\"string\">&#x27;channels_redis.core.RedisChannelLayer&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;CONFIG&#x27;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;hosts&quot;</span>: [(<span class=\"string\">&#x27;127.0.0.1&#x27;</span>, <span class=\"number\">6379</span>)],  <span class=\"comment\"># Redis 默認地址和端口</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>創建 <code>asgi.py</code> 文件</strong>：<br>在 <code>classify</code> 專案目錄下，確保 <code>asgi.py</code> 設定為：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.core.asgi <span class=\"keyword\">import</span> get_asgi_application</span><br><span class=\"line\"><span class=\"keyword\">from</span> channels.routing <span class=\"keyword\">import</span> ProtocolTypeRouter, URLRouter</span><br><span class=\"line\"><span class=\"keyword\">from</span> channels.auth <span class=\"keyword\">import</span> AuthMiddlewareStack</span><br><span class=\"line\"><span class=\"keyword\">from</span> chat <span class=\"keyword\">import</span> routing</span><br><span class=\"line\"></span><br><span class=\"line\">os.environ.setdefault(<span class=\"string\">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class=\"string\">&#x27;classify.settings&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">application = ProtocolTypeRouter(&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;http&quot;</span>: get_asgi_application(),</span><br><span class=\"line\">    <span class=\"string\">&quot;websocket&quot;</span>: AuthMiddlewareStack(</span><br><span class=\"line\">        URLRouter(</span><br><span class=\"line\">            routing.websocket_urlpatterns</span><br><span class=\"line\">        )</span><br><span class=\"line\">    ),</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>創建 <code>chat/routing.py</code> 文件</strong>：<br>設置 WebSocket 路由：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.urls <span class=\"keyword\">import</span> path</span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> consumers</span><br><span class=\"line\"></span><br><span class=\"line\">websocket_urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;ws/chat/&#x27;</span>, consumers.ChatConsumer.as_asgi()),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>**編寫 <code>chat/consumers.py</code>**：<br>設計 WebSocket Consumer，可以通過 Channel Layer 發送消息：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">from</span> channels.generic.websocket <span class=\"keyword\">import</span> AsyncWebsocketConsumer</span><br><span class=\"line\"><span class=\"keyword\">from</span> channels.layers <span class=\"keyword\">import</span> get_channel_layer</span><br><span class=\"line\"><span class=\"keyword\">from</span> asgiref.sync <span class=\"keyword\">import</span> async_to_sync</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConsumer</span>(<span class=\"title class_ inherited__\">AsyncWebsocketConsumer</span>):</span><br><span class=\"line\">        <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">connect</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.room_name = <span class=\"string\">&quot;chat_room&quot;</span></span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.room_group_name = <span class=\"string\">f&quot;chat_<span class=\"subst\">&#123;self.room_name&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.channel_layer.group_add(</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.room_group_name,</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.channel_name</span><br><span class=\"line\">            )</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.accept()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">disconnect</span>(<span class=\"params\">self, close_code</span>):</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.channel_layer.group_discard(</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.room_group_name,</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.channel_name</span><br><span class=\"line\">            )</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">receive</span>(<span class=\"params\">self, text_data</span>):</span><br><span class=\"line\">            text_data_json = json.loads(text_data)</span><br><span class=\"line\">            message = text_data_json[<span class=\"string\">&#x27;message&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.channel_layer.group_send(</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.room_group_name,</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;chat_message&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&#x27;message&#x27;</span>: message</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">chat_message</span>(<span class=\"params\">self, event</span>):</span><br><span class=\"line\">            message = event[<span class=\"string\">&#x27;message&#x27;</span>]</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.send(text_data=json.dumps(&#123;</span><br><span class=\"line\">                <span class=\"string\">&#x27;message&#x27;</span>: message</span><br><span class=\"line\">            &#125;))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">        @staticmethod</span></span><br><span class=\"line\">        <span class=\"keyword\">def</span> <span class=\"title function_\">send_to_frontend</span>(<span class=\"params\">message</span>):</span><br><span class=\"line\">            channel_layer = get_channel_layer()</span><br><span class=\"line\">            async_to_sync(channel_layer.group_send)(</span><br><span class=\"line\">                <span class=\"string\">&quot;chat_chat_room&quot;</span>,</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;chat_message&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&#x27;message&#x27;</span>: message</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\">    ```</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>創建自定義 Django 命令</strong>：<br>在 <code>chat/management/commands/send_message.py</code> 中添加：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.core.management.base <span class=\"keyword\">import</span> BaseCommand</span><br><span class=\"line\"><span class=\"keyword\">from</span> chat.consumers <span class=\"keyword\">import</span> ChatConsumer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Command</span>(<span class=\"title class_ inherited__\">BaseCommand</span>):</span><br><span class=\"line\">    <span class=\"built_in\">help</span> = <span class=\"string\">&#x27;Send a WebSocket message from backend&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">handle</span>(<span class=\"params\">self, *args, **kwargs</span>):</span><br><span class=\"line\">        message = <span class=\"string\">&quot;這是從後端通過 command 發送的 WebSocket 訊息&quot;</span></span><br><span class=\"line\">        ChatConsumer.send_to_frontend(message)</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.stdout.write(<span class=\"variable language_\">self</span>.style.SUCCESS(<span class=\"string\">&#x27;Message sent successfully&#x27;</span>))</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>運行 Django 項目</strong>：<br>確保 Redis 在運行，然後啟動 Django：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 manage.py runserver</span><br></pre></td></tr></table></figure></li>\n<li><p><strong>從命令行發送訊息</strong>：<br>使用自定義命令從後端發送訊息：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 manage.py send_message</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"程式執行順序步驟\"><a href=\"#程式執行順序步驟\" class=\"headerlink\" title=\"程式執行順序步驟\"></a>程式執行順序步驟</h2><h3 id=\"1-用戶端建立-WebSocket-連接\"><a href=\"#1-用戶端建立-WebSocket-連接\" class=\"headerlink\" title=\"1. 用戶端建立 WebSocket 連接\"></a>1. 用戶端建立 WebSocket 連接</h3><p>當用戶開啟瀏覽器並連接到你的 WebSocket 路徑 <code>/ws/chat/</code> 時，會觸發 <code>ChatConsumer</code> 的 <code>connect()</code> 方法：</p>\n<ul>\n<li><strong>步驟</strong>：<ol>\n<li>用戶端（例如瀏覽器）使用 JavaScript 建立 WebSocket 連接。</li>\n<li>Django Channels 會啟動 <code>ChatConsumer</code> 的 <code>connect()</code> 方法。</li>\n<li>用戶端被加入到 <code>chat_chat_room</code> 群組，這是透過 <code>self.channel_layer.group_add()</code> 方法實現的。</li>\n<li>連接成功後，<code>await self.accept()</code> 允許 WebSocket 連接繼續。</li>\n</ol>\n</li>\n<li><strong>Redis 的角色</strong>：<ul>\n<li>Redis 會存儲群組 <code>chat_chat_room</code> 的資訊，記錄有哪些 WebSocket 連接屬於這個群組。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-從後端發送訊息\"><a href=\"#2-從後端發送訊息\" class=\"headerlink\" title=\"2. 從後端發送訊息\"></a>2. 從後端發送訊息</h3><p>當你運行以下命令時，將觸發後端發送訊息：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 manage.py send_message</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>步驟</strong>：<ol>\n<li>Django 運行 <code>send_message</code> 命令，調用 <code>ChatConsumer.send_to_frontend()</code> 方法。</li>\n<li><code>send_to_frontend()</code> 使用 <code>get_channel_layer()</code> 取得 Channels Layer，並調用 <code>async_to_sync(channel_layer.group_send(...))</code> 發送訊息到 <code>chat_chat_room</code>。</li>\n<li>這個訊息會被放入 Redis，由 Redis 處理接下來的訊息分發。</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"3-消費者接收訊息\"><a href=\"#3-消費者接收訊息\" class=\"headerlink\" title=\"3. 消費者接收訊息\"></a>3. 消費者接收訊息</h3><p>每一個屬於 <code>chat_chat_room</code> 群組的 WebSocket 連接，都會收到這條訊息，並觸發 <code>ChatConsumer</code> 中的 <code>chat_message()</code> 方法：</p>\n<ul>\n<li><strong>步驟</strong>：<ol>\n<li><code>chat_message()</code> 方法會被觸發，接收來自 Redis 的訊息。</li>\n<li>它將訊息轉換為 JSON 格式，然後通過 <code>await self.send(...)</code> 發送給 WebSocket 連接的用戶端。</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"4-用戶端顯示訊息\"><a href=\"#4-用戶端顯示訊息\" class=\"headerlink\" title=\"4. 用戶端顯示訊息\"></a>4. 用戶端顯示訊息</h3><p>前端的 JavaScript 監聽 <code>onmessage</code> 事件，並顯示從後端接收到的訊息：</p>\n<ul>\n<li><strong>步驟</strong>：<ol>\n<li>用戶端的 WebSocket 連接收到來自伺服器的訊息。</li>\n<li><code>onmessage</code> 事件被觸發，並執行對應的 JavaScript 函數來處理這條訊息，例如在控制台打印出來或顯示在網頁上。</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"整體流程總結\"><a href=\"#整體流程總結\" class=\"headerlink\" title=\"整體流程總結\"></a>整體流程總結</h3><ol>\n<li><strong>建立連接</strong>：用戶端連接到 <code>/ws/chat/</code>，被加入到 <code>chat_chat_room</code> 群組，Redis 記錄連接資訊。</li>\n<li><strong>後端發送訊息</strong>：你運行 <code>send_message</code> 命令，後端通過 Channels Layer 和 Redis 將訊息傳給 <code>chat_chat_room</code>。</li>\n<li><strong>訊息分發</strong>：Redis 處理訊息分發，確保所有屬於 <code>chat_chat_room</code> 的 WebSocket 連接都收到這條訊息。</li>\n<li><strong>前端接收並顯示</strong>：用戶端接收到訊息，觸發 JavaScript 的 <code>onmessage</code> 事件，並在頁面上顯示內容。</li>\n</ol>\n<h3 id=\"Redis-的功能\"><a href=\"#Redis-的功能\" class=\"headerlink\" title=\"Redis 的功能\"></a>Redis 的功能</h3><ul>\n<li><strong>作為 Channel Layer 的後端</strong>：Redis 被用來存儲和傳遞 WebSocket 訊息。當 Django 需要向某個群組或某個連接發送訊息時，Channels 會把訊息放入 Redis，然後由其他連接取出並傳遞給相應的 WebSocket。</li>\n<li><strong>訊息中繼</strong>：Redis 可以在多個 Django 節點之間中繼訊息，這使得即使在高負載或多伺服器環境下，WebSocket 仍然能穩定運作。</li>\n</ul>\n<h3 id=\"Channel-Layer-的功能\"><a href=\"#Channel-Layer-的功能\" class=\"headerlink\" title=\"Channel Layer 的功能\"></a>Channel Layer 的功能</h3><ul>\n<li><strong>實現群組通信</strong>：讓不同的 WebSocket 連接（甚至不同伺服器上的連接）可以被分組。通過 <code>group_add()</code> 和 <code>group_send()</code> 來把訊息發送到特定的群組，使得多人可以即時收到更新。</li>\n<li><strong>跨進程通信</strong>：Channel Layer 可以在不同進程間傳遞訊息，允許伺服器間或與背景任務間的即時溝通。</li>\n</ul>\n","excerpt":"","more":"<h2 id=\"全部步驟總結\"><a href=\"#全部步驟總結\" class=\"headerlink\" title=\"全部步驟總結\"></a>全部步驟總結</h2><ol>\n<li><p><strong>安裝必要的套件</strong>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install channels channels_redis</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>channels</strong>：使 Django 支持 WebSocket。</li>\n<li><strong>channels_redis</strong>：用來實現 Channel Layer，讓不同的 WebSocket 連接能夠進行通訊。</li>\n</ul>\n</li>\n<li><p><strong>設定 Django 專案</strong>：</p>\n<ul>\n<li>在 <code>settings.py</code> 中添加 Channels 和 Channel Layer 配置：</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INSTALLED_APPS = [</span><br><span class=\"line\">    <span class=\"comment\"># 其他已安裝的應用</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;channels&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;chat&#x27;</span>,  <span class=\"comment\"># 你的 WebSocket 應用</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">ASGI_APPLICATION = <span class=\"string\">&#x27;classify.asgi.application&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">CHANNEL_LAYERS = &#123;</span><br><span class=\"line\">    <span class=\"string\">&#x27;default&#x27;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&#x27;BACKEND&#x27;</span>: <span class=\"string\">&#x27;channels_redis.core.RedisChannelLayer&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;CONFIG&#x27;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;hosts&quot;</span>: [(<span class=\"string\">&#x27;127.0.0.1&#x27;</span>, <span class=\"number\">6379</span>)],  <span class=\"comment\"># Redis 默認地址和端口</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>創建 <code>asgi.py</code> 文件</strong>：<br>在 <code>classify</code> 專案目錄下，確保 <code>asgi.py</code> 設定為：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> django.core.asgi <span class=\"keyword\">import</span> get_asgi_application</span><br><span class=\"line\"><span class=\"keyword\">from</span> channels.routing <span class=\"keyword\">import</span> ProtocolTypeRouter, URLRouter</span><br><span class=\"line\"><span class=\"keyword\">from</span> channels.auth <span class=\"keyword\">import</span> AuthMiddlewareStack</span><br><span class=\"line\"><span class=\"keyword\">from</span> chat <span class=\"keyword\">import</span> routing</span><br><span class=\"line\"></span><br><span class=\"line\">os.environ.setdefault(<span class=\"string\">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class=\"string\">&#x27;classify.settings&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">application = ProtocolTypeRouter(&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;http&quot;</span>: get_asgi_application(),</span><br><span class=\"line\">    <span class=\"string\">&quot;websocket&quot;</span>: AuthMiddlewareStack(</span><br><span class=\"line\">        URLRouter(</span><br><span class=\"line\">            routing.websocket_urlpatterns</span><br><span class=\"line\">        )</span><br><span class=\"line\">    ),</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>創建 <code>chat/routing.py</code> 文件</strong>：<br>設置 WebSocket 路由：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.urls <span class=\"keyword\">import</span> path</span><br><span class=\"line\"><span class=\"keyword\">from</span> . <span class=\"keyword\">import</span> consumers</span><br><span class=\"line\"></span><br><span class=\"line\">websocket_urlpatterns = [</span><br><span class=\"line\">    path(<span class=\"string\">&#x27;ws/chat/&#x27;</span>, consumers.ChatConsumer.as_asgi()),</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>**編寫 <code>chat/consumers.py</code>**：<br>設計 WebSocket Consumer，可以通過 Channel Layer 發送消息：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">from</span> channels.generic.websocket <span class=\"keyword\">import</span> AsyncWebsocketConsumer</span><br><span class=\"line\"><span class=\"keyword\">from</span> channels.layers <span class=\"keyword\">import</span> get_channel_layer</span><br><span class=\"line\"><span class=\"keyword\">from</span> asgiref.sync <span class=\"keyword\">import</span> async_to_sync</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">class</span> <span class=\"title class_\">ChatConsumer</span>(<span class=\"title class_ inherited__\">AsyncWebsocketConsumer</span>):</span><br><span class=\"line\">        <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">connect</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.room_name = <span class=\"string\">&quot;chat_room&quot;</span></span><br><span class=\"line\">            <span class=\"variable language_\">self</span>.room_group_name = <span class=\"string\">f&quot;chat_<span class=\"subst\">&#123;self.room_name&#125;</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.channel_layer.group_add(</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.room_group_name,</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.channel_name</span><br><span class=\"line\">            )</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.accept()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">disconnect</span>(<span class=\"params\">self, close_code</span>):</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.channel_layer.group_discard(</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.room_group_name,</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.channel_name</span><br><span class=\"line\">            )</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">receive</span>(<span class=\"params\">self, text_data</span>):</span><br><span class=\"line\">            text_data_json = json.loads(text_data)</span><br><span class=\"line\">            message = text_data_json[<span class=\"string\">&#x27;message&#x27;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.channel_layer.group_send(</span><br><span class=\"line\">                <span class=\"variable language_\">self</span>.room_group_name,</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;chat_message&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&#x27;message&#x27;</span>: message</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">async</span> <span class=\"keyword\">def</span> <span class=\"title function_\">chat_message</span>(<span class=\"params\">self, event</span>):</span><br><span class=\"line\">            message = event[<span class=\"string\">&#x27;message&#x27;</span>]</span><br><span class=\"line\">            <span class=\"keyword\">await</span> <span class=\"variable language_\">self</span>.send(text_data=json.dumps(&#123;</span><br><span class=\"line\">                <span class=\"string\">&#x27;message&#x27;</span>: message</span><br><span class=\"line\">            &#125;))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">        @staticmethod</span></span><br><span class=\"line\">        <span class=\"keyword\">def</span> <span class=\"title function_\">send_to_frontend</span>(<span class=\"params\">message</span>):</span><br><span class=\"line\">            channel_layer = get_channel_layer()</span><br><span class=\"line\">            async_to_sync(channel_layer.group_send)(</span><br><span class=\"line\">                <span class=\"string\">&quot;chat_chat_room&quot;</span>,</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">&#x27;type&#x27;</span>: <span class=\"string\">&#x27;chat_message&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&#x27;message&#x27;</span>: message</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\">    ```</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>創建自定義 Django 命令</strong>：<br>在 <code>chat/management/commands/send_message.py</code> 中添加：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> django.core.management.base <span class=\"keyword\">import</span> BaseCommand</span><br><span class=\"line\"><span class=\"keyword\">from</span> chat.consumers <span class=\"keyword\">import</span> ChatConsumer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Command</span>(<span class=\"title class_ inherited__\">BaseCommand</span>):</span><br><span class=\"line\">    <span class=\"built_in\">help</span> = <span class=\"string\">&#x27;Send a WebSocket message from backend&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">handle</span>(<span class=\"params\">self, *args, **kwargs</span>):</span><br><span class=\"line\">        message = <span class=\"string\">&quot;這是從後端通過 command 發送的 WebSocket 訊息&quot;</span></span><br><span class=\"line\">        ChatConsumer.send_to_frontend(message)</span><br><span class=\"line\">        <span class=\"variable language_\">self</span>.stdout.write(<span class=\"variable language_\">self</span>.style.SUCCESS(<span class=\"string\">&#x27;Message sent successfully&#x27;</span>))</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>運行 Django 項目</strong>：<br>確保 Redis 在運行，然後啟動 Django：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 manage.py runserver</span><br></pre></td></tr></table></figure></li>\n<li><p><strong>從命令行發送訊息</strong>：<br>使用自定義命令從後端發送訊息：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 manage.py send_message</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"程式執行順序步驟\"><a href=\"#程式執行順序步驟\" class=\"headerlink\" title=\"程式執行順序步驟\"></a>程式執行順序步驟</h2><h3 id=\"1-用戶端建立-WebSocket-連接\"><a href=\"#1-用戶端建立-WebSocket-連接\" class=\"headerlink\" title=\"1. 用戶端建立 WebSocket 連接\"></a>1. 用戶端建立 WebSocket 連接</h3><p>當用戶開啟瀏覽器並連接到你的 WebSocket 路徑 <code>/ws/chat/</code> 時，會觸發 <code>ChatConsumer</code> 的 <code>connect()</code> 方法：</p>\n<ul>\n<li><strong>步驟</strong>：<ol>\n<li>用戶端（例如瀏覽器）使用 JavaScript 建立 WebSocket 連接。</li>\n<li>Django Channels 會啟動 <code>ChatConsumer</code> 的 <code>connect()</code> 方法。</li>\n<li>用戶端被加入到 <code>chat_chat_room</code> 群組，這是透過 <code>self.channel_layer.group_add()</code> 方法實現的。</li>\n<li>連接成功後，<code>await self.accept()</code> 允許 WebSocket 連接繼續。</li>\n</ol>\n</li>\n<li><strong>Redis 的角色</strong>：<ul>\n<li>Redis 會存儲群組 <code>chat_chat_room</code> 的資訊，記錄有哪些 WebSocket 連接屬於這個群組。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-從後端發送訊息\"><a href=\"#2-從後端發送訊息\" class=\"headerlink\" title=\"2. 從後端發送訊息\"></a>2. 從後端發送訊息</h3><p>當你運行以下命令時，將觸發後端發送訊息：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 manage.py send_message</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>步驟</strong>：<ol>\n<li>Django 運行 <code>send_message</code> 命令，調用 <code>ChatConsumer.send_to_frontend()</code> 方法。</li>\n<li><code>send_to_frontend()</code> 使用 <code>get_channel_layer()</code> 取得 Channels Layer，並調用 <code>async_to_sync(channel_layer.group_send(...))</code> 發送訊息到 <code>chat_chat_room</code>。</li>\n<li>這個訊息會被放入 Redis，由 Redis 處理接下來的訊息分發。</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"3-消費者接收訊息\"><a href=\"#3-消費者接收訊息\" class=\"headerlink\" title=\"3. 消費者接收訊息\"></a>3. 消費者接收訊息</h3><p>每一個屬於 <code>chat_chat_room</code> 群組的 WebSocket 連接，都會收到這條訊息，並觸發 <code>ChatConsumer</code> 中的 <code>chat_message()</code> 方法：</p>\n<ul>\n<li><strong>步驟</strong>：<ol>\n<li><code>chat_message()</code> 方法會被觸發，接收來自 Redis 的訊息。</li>\n<li>它將訊息轉換為 JSON 格式，然後通過 <code>await self.send(...)</code> 發送給 WebSocket 連接的用戶端。</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"4-用戶端顯示訊息\"><a href=\"#4-用戶端顯示訊息\" class=\"headerlink\" title=\"4. 用戶端顯示訊息\"></a>4. 用戶端顯示訊息</h3><p>前端的 JavaScript 監聽 <code>onmessage</code> 事件，並顯示從後端接收到的訊息：</p>\n<ul>\n<li><strong>步驟</strong>：<ol>\n<li>用戶端的 WebSocket 連接收到來自伺服器的訊息。</li>\n<li><code>onmessage</code> 事件被觸發，並執行對應的 JavaScript 函數來處理這條訊息，例如在控制台打印出來或顯示在網頁上。</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"整體流程總結\"><a href=\"#整體流程總結\" class=\"headerlink\" title=\"整體流程總結\"></a>整體流程總結</h3><ol>\n<li><strong>建立連接</strong>：用戶端連接到 <code>/ws/chat/</code>，被加入到 <code>chat_chat_room</code> 群組，Redis 記錄連接資訊。</li>\n<li><strong>後端發送訊息</strong>：你運行 <code>send_message</code> 命令，後端通過 Channels Layer 和 Redis 將訊息傳給 <code>chat_chat_room</code>。</li>\n<li><strong>訊息分發</strong>：Redis 處理訊息分發，確保所有屬於 <code>chat_chat_room</code> 的 WebSocket 連接都收到這條訊息。</li>\n<li><strong>前端接收並顯示</strong>：用戶端接收到訊息，觸發 JavaScript 的 <code>onmessage</code> 事件，並在頁面上顯示內容。</li>\n</ol>\n<h3 id=\"Redis-的功能\"><a href=\"#Redis-的功能\" class=\"headerlink\" title=\"Redis 的功能\"></a>Redis 的功能</h3><ul>\n<li><strong>作為 Channel Layer 的後端</strong>：Redis 被用來存儲和傳遞 WebSocket 訊息。當 Django 需要向某個群組或某個連接發送訊息時，Channels 會把訊息放入 Redis，然後由其他連接取出並傳遞給相應的 WebSocket。</li>\n<li><strong>訊息中繼</strong>：Redis 可以在多個 Django 節點之間中繼訊息，這使得即使在高負載或多伺服器環境下，WebSocket 仍然能穩定運作。</li>\n</ul>\n<h3 id=\"Channel-Layer-的功能\"><a href=\"#Channel-Layer-的功能\" class=\"headerlink\" title=\"Channel Layer 的功能\"></a>Channel Layer 的功能</h3><ul>\n<li><strong>實現群組通信</strong>：讓不同的 WebSocket 連接（甚至不同伺服器上的連接）可以被分組。通過 <code>group_add()</code> 和 <code>group_send()</code> 來把訊息發送到特定的群組，使得多人可以即時收到更新。</li>\n<li><strong>跨進程通信</strong>：Channel Layer 可以在不同進程間傳遞訊息，允許伺服器間或與背景任務間的即時溝通。</li>\n</ul>\n"},{"layout":"post","title":"Line Bot 與 Chatgpt應用 02 - 執行程式","date":"2024-09-26T12:42:52.000Z","top_img":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Fbanner.webp?alt=media&token=04b3ef21-5ea8-4c0d-9a96-318f3eeb974a","cover":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Fbanner.webp?alt=media&token=04b3ef21-5ea8-4c0d-9a96-318f3eeb974a","_content":"\n# Line Bot 和 GPT 實戰教學\n\n本教學將帶領你使用 Replit 平台運行由 GPT 支援的 Line Bot，並逐步指導你如何設定和執行這個 Python 程式碼。\n\n## 步驟 1: 進入 Replit 並複製專案\n\n首先，進入 Replit 上的大神已經寫好的 Python 程式碼頁面。\n\n[![Replit Python 程式碼](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python1.png?alt=media&token=55d33712-10f8-4ecb-a4f9-efa01177c7c1)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python1.png?alt=media&token=55d33712-10f8-4ecb-a4f9-efa01177c7c1)\n\n點擊以下連結，進入 Replit 上的專案頁面並進行複製 (fork) 到你自己的工作區：\n\n[GPTDev_LINE_bot - Replit](https://replit.com/@uncletieke/GPTDevLINEbot)\n\n## 步驟 2: 複製專案到自己的工作區\n\n點擊 \"Fork\" 按鈕將專案複製到你的 Replit 帳戶中：\n\n[![Fork 按鈕](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python2.png?alt=media&token=ec3babd7-6fbd-4559-ae12-0678b9651292)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python2.png?alt=media&token=ec3babd7-6fbd-4559-ae12-0678b9651292)\n\n## 步驟 3: 設定環境變數\n\n在 Replit 的專案設定中，輸入以下三個環境變數：\n\n- `LINE_SECRET`：你在 Line 開發者後台取得的 Secret\n- `LINE_TOKEN`：你在 Line 開發者後台取得的 Token\n- `OPENAI_API_KEY`：你從 OpenAI 取得的 API Key\n\n如圖所示：\n\n[![環境變數設定](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python3.png?alt=media&token=42bc5756-6ab9-4447-b3d8-dc7f0445fcca)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python3.png?alt=media&token=42bc5756-6ab9-4447-b3d8-dc7f0445fcca)\n\n> **提示**: 如果你不知道如何取得這三個值，請私訊我以獲得幫助。\n\n## 步驟 4: 執行專案\n\n設定好環境變數後，點擊 \"Run\" 按鈕來執行程式。\n\n[![執行專案](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python5.png?alt=media&token=bb70af8f-177f-438f-a869-5c18eee774ff)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python5.png?alt=media&token=bb70af8f-177f-438f-a869-5c18eee774ff)\n\n## 完成\n\n恭喜你，現在你的 Line Bot 已經與 GPT 整合並運行成功了！你可以開始與你的 Bot 互動，並根據需求進行進一步的開發。\n","source":"_posts/Line-Bot與Chatgpt應用-串接replit大神程式.md","raw":"---\nlayout: post\ntitle: Line Bot 與 Chatgpt應用 02 - 執行程式\ndate: 2024-09-26 20:42:52\ntags:\n  - \"Line Bot\"\ncategories:\n  - \"Line Bot\"\n  - \"replit設定\"\ntop_img: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Fbanner.webp?alt=media&token=04b3ef21-5ea8-4c0d-9a96-318f3eeb974a\"\ncover: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Fbanner.webp?alt=media&token=04b3ef21-5ea8-4c0d-9a96-318f3eeb974a\"\n---\n\n# Line Bot 和 GPT 實戰教學\n\n本教學將帶領你使用 Replit 平台運行由 GPT 支援的 Line Bot，並逐步指導你如何設定和執行這個 Python 程式碼。\n\n## 步驟 1: 進入 Replit 並複製專案\n\n首先，進入 Replit 上的大神已經寫好的 Python 程式碼頁面。\n\n[![Replit Python 程式碼](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python1.png?alt=media&token=55d33712-10f8-4ecb-a4f9-efa01177c7c1)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python1.png?alt=media&token=55d33712-10f8-4ecb-a4f9-efa01177c7c1)\n\n點擊以下連結，進入 Replit 上的專案頁面並進行複製 (fork) 到你自己的工作區：\n\n[GPTDev_LINE_bot - Replit](https://replit.com/@uncletieke/GPTDevLINEbot)\n\n## 步驟 2: 複製專案到自己的工作區\n\n點擊 \"Fork\" 按鈕將專案複製到你的 Replit 帳戶中：\n\n[![Fork 按鈕](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python2.png?alt=media&token=ec3babd7-6fbd-4559-ae12-0678b9651292)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python2.png?alt=media&token=ec3babd7-6fbd-4559-ae12-0678b9651292)\n\n## 步驟 3: 設定環境變數\n\n在 Replit 的專案設定中，輸入以下三個環境變數：\n\n- `LINE_SECRET`：你在 Line 開發者後台取得的 Secret\n- `LINE_TOKEN`：你在 Line 開發者後台取得的 Token\n- `OPENAI_API_KEY`：你從 OpenAI 取得的 API Key\n\n如圖所示：\n\n[![環境變數設定](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python3.png?alt=media&token=42bc5756-6ab9-4447-b3d8-dc7f0445fcca)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python3.png?alt=media&token=42bc5756-6ab9-4447-b3d8-dc7f0445fcca)\n\n> **提示**: 如果你不知道如何取得這三個值，請私訊我以獲得幫助。\n\n## 步驟 4: 執行專案\n\n設定好環境變數後，點擊 \"Run\" 按鈕來執行程式。\n\n[![執行專案](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python5.png?alt=media&token=bb70af8f-177f-438f-a869-5c18eee774ff)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python5.png?alt=media&token=bb70af8f-177f-438f-a869-5c18eee774ff)\n\n## 完成\n\n恭喜你，現在你的 Line Bot 已經與 GPT 整合並運行成功了！你可以開始與你的 Bot 互動，並根據需求進行進一步的開發。\n","slug":"Line-Bot與Chatgpt應用-串接replit大神程式","published":1,"updated":"2026-01-28T14:17:25.060Z","_id":"cmkxfp4y000137z8z3t9th87q","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h1 id=\"Line-Bot-和-GPT-實戰教學\"><a href=\"#Line-Bot-和-GPT-實戰教學\" class=\"headerlink\" title=\"Line Bot 和 GPT 實戰教學\"></a>Line Bot 和 GPT 實戰教學</h1><p>本教學將帶領你使用 Replit 平台運行由 GPT 支援的 Line Bot，並逐步指導你如何設定和執行這個 Python 程式碼。</p>\n<h2 id=\"步驟-1-進入-Replit-並複製專案\"><a href=\"#步驟-1-進入-Replit-並複製專案\" class=\"headerlink\" title=\"步驟 1: 進入 Replit 並複製專案\"></a>步驟 1: 進入 Replit 並複製專案</h2><p>首先，進入 Replit 上的大神已經寫好的 Python 程式碼頁面。</p>\n<p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python1.png?alt=media&token=55d33712-10f8-4ecb-a4f9-efa01177c7c1\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python1.png?alt=media&token=55d33712-10f8-4ecb-a4f9-efa01177c7c1\" alt=\"Replit Python 程式碼\"></a></p>\n<p>點擊以下連結，進入 Replit 上的專案頁面並進行複製 (fork) 到你自己的工作區：</p>\n<p><a href=\"https://replit.com/@uncletieke/GPTDevLINEbot\">GPTDev_LINE_bot - Replit</a></p>\n<h2 id=\"步驟-2-複製專案到自己的工作區\"><a href=\"#步驟-2-複製專案到自己的工作區\" class=\"headerlink\" title=\"步驟 2: 複製專案到自己的工作區\"></a>步驟 2: 複製專案到自己的工作區</h2><p>點擊 “Fork” 按鈕將專案複製到你的 Replit 帳戶中：</p>\n<p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python2.png?alt=media&token=ec3babd7-6fbd-4559-ae12-0678b9651292\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python2.png?alt=media&token=ec3babd7-6fbd-4559-ae12-0678b9651292\" alt=\"Fork 按鈕\"></a></p>\n<h2 id=\"步驟-3-設定環境變數\"><a href=\"#步驟-3-設定環境變數\" class=\"headerlink\" title=\"步驟 3: 設定環境變數\"></a>步驟 3: 設定環境變數</h2><p>在 Replit 的專案設定中，輸入以下三個環境變數：</p>\n<ul>\n<li><code>LINE_SECRET</code>：你在 Line 開發者後台取得的 Secret</li>\n<li><code>LINE_TOKEN</code>：你在 Line 開發者後台取得的 Token</li>\n<li><code>OPENAI_API_KEY</code>：你從 OpenAI 取得的 API Key</li>\n</ul>\n<p>如圖所示：</p>\n<p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python3.png?alt=media&token=42bc5756-6ab9-4447-b3d8-dc7f0445fcca\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python3.png?alt=media&token=42bc5756-6ab9-4447-b3d8-dc7f0445fcca\" alt=\"環境變數設定\"></a></p>\n<blockquote>\n<p><strong>提示</strong>: 如果你不知道如何取得這三個值，請私訊我以獲得幫助。</p>\n</blockquote>\n<h2 id=\"步驟-4-執行專案\"><a href=\"#步驟-4-執行專案\" class=\"headerlink\" title=\"步驟 4: 執行專案\"></a>步驟 4: 執行專案</h2><p>設定好環境變數後，點擊 “Run” 按鈕來執行程式。</p>\n<p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python5.png?alt=media&token=bb70af8f-177f-438f-a869-5c18eee774ff\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python5.png?alt=media&token=bb70af8f-177f-438f-a869-5c18eee774ff\" alt=\"執行專案\"></a></p>\n<h2 id=\"完成\"><a href=\"#完成\" class=\"headerlink\" title=\"完成\"></a>完成</h2><p>恭喜你，現在你的 Line Bot 已經與 GPT 整合並運行成功了！你可以開始與你的 Bot 互動，並根據需求進行進一步的開發。</p>\n","excerpt":"","more":"<h1 id=\"Line-Bot-和-GPT-實戰教學\"><a href=\"#Line-Bot-和-GPT-實戰教學\" class=\"headerlink\" title=\"Line Bot 和 GPT 實戰教學\"></a>Line Bot 和 GPT 實戰教學</h1><p>本教學將帶領你使用 Replit 平台運行由 GPT 支援的 Line Bot，並逐步指導你如何設定和執行這個 Python 程式碼。</p>\n<h2 id=\"步驟-1-進入-Replit-並複製專案\"><a href=\"#步驟-1-進入-Replit-並複製專案\" class=\"headerlink\" title=\"步驟 1: 進入 Replit 並複製專案\"></a>步驟 1: 進入 Replit 並複製專案</h2><p>首先，進入 Replit 上的大神已經寫好的 Python 程式碼頁面。</p>\n<p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python1.png?alt=media&token=55d33712-10f8-4ecb-a4f9-efa01177c7c1\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python1.png?alt=media&token=55d33712-10f8-4ecb-a4f9-efa01177c7c1\" alt=\"Replit Python 程式碼\"></a></p>\n<p>點擊以下連結，進入 Replit 上的專案頁面並進行複製 (fork) 到你自己的工作區：</p>\n<p><a href=\"https://replit.com/@uncletieke/GPTDevLINEbot\">GPTDev_LINE_bot - Replit</a></p>\n<h2 id=\"步驟-2-複製專案到自己的工作區\"><a href=\"#步驟-2-複製專案到自己的工作區\" class=\"headerlink\" title=\"步驟 2: 複製專案到自己的工作區\"></a>步驟 2: 複製專案到自己的工作區</h2><p>點擊 “Fork” 按鈕將專案複製到你的 Replit 帳戶中：</p>\n<p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python2.png?alt=media&token=ec3babd7-6fbd-4559-ae12-0678b9651292\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python2.png?alt=media&token=ec3babd7-6fbd-4559-ae12-0678b9651292\" alt=\"Fork 按鈕\"></a></p>\n<h2 id=\"步驟-3-設定環境變數\"><a href=\"#步驟-3-設定環境變數\" class=\"headerlink\" title=\"步驟 3: 設定環境變數\"></a>步驟 3: 設定環境變數</h2><p>在 Replit 的專案設定中，輸入以下三個環境變數：</p>\n<ul>\n<li><code>LINE_SECRET</code>：你在 Line 開發者後台取得的 Secret</li>\n<li><code>LINE_TOKEN</code>：你在 Line 開發者後台取得的 Token</li>\n<li><code>OPENAI_API_KEY</code>：你從 OpenAI 取得的 API Key</li>\n</ul>\n<p>如圖所示：</p>\n<p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python3.png?alt=media&token=42bc5756-6ab9-4447-b3d8-dc7f0445fcca\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python3.png?alt=media&token=42bc5756-6ab9-4447-b3d8-dc7f0445fcca\" alt=\"環境變數設定\"></a></p>\n<blockquote>\n<p><strong>提示</strong>: 如果你不知道如何取得這三個值，請私訊我以獲得幫助。</p>\n</blockquote>\n<h2 id=\"步驟-4-執行專案\"><a href=\"#步驟-4-執行專案\" class=\"headerlink\" title=\"步驟 4: 執行專案\"></a>步驟 4: 執行專案</h2><p>設定好環境變數後，點擊 “Run” 按鈕來執行程式。</p>\n<p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python5.png?alt=media&token=bb70af8f-177f-438f-a869-5c18eee774ff\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Freplit-python%2Freplit-python5.png?alt=media&token=bb70af8f-177f-438f-a869-5c18eee774ff\" alt=\"執行專案\"></a></p>\n<h2 id=\"完成\"><a href=\"#完成\" class=\"headerlink\" title=\"完成\"></a>完成</h2><p>恭喜你，現在你的 Line Bot 已經與 GPT 整合並運行成功了！你可以開始與你的 Bot 互動，並根據需求進行進一步的開發。</p>\n"},{"layout":"post","title":"Line Bot 與 Chatgpt應用 01 - 建立帳號","date":"2024-09-19T02:49:52.000Z","top_img":"/images/Line-Bot/create-account/create-account2.png","cover":"/images/Line-Bot/create-account/create-account2.png","_content":"\n# Line Bot 建立流程\n\n我們將一步一步指導你如何建立一個新的 Line Bot 帳戶，並完成基本設定。\n\n## 1. 進入 Line Business 頁面\n\n首先，前往 [Line Business](https://developers.line.biz/en/?status=success) 官方網站，這是 Line Bot 開發者專用的後台管理平台。\n\n![create-account01](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account1.png?alt=media&token=1a48bf32-ef29-4e39-b16a-55598225e676)\n\n## 2. 登入並進入 Console\n\n在頁面的右上角，找到並點擊 **Console** 按鈕，進入 Line Bot 後台控制台。\n\n![create-account02](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account2.png?alt=media&token=efd7f776-8637-4fe2-8b39-39dc8709367f)\n\n## 3. 進入後台控制台\n\n系統會將你引導至後台管理畫面，在這裡可以管理和創建你的 Line Bot 專案。\n\n![create-account03](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account3.png?alt=media&token=bf809ba3-4017-4dfd-9ae0-26057f312fd5)\n\n## 4. 選擇 Providers\n\n在控制台頁面中，找到並點擊 **Providers**，我都想成這是用來管理多個專案的文件資料夾。\n\n![create-account04](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account4.png?alt=media&token=9d91588e-425e-45f1-ac3c-7cba2fd19e2e)\n\n## 5. 創建新的 Provider\n\n輸入一個你定義的 Provider 名稱。\n\n![create-account05](/images/Line-Bot/create-account/create-account5.png)\n\n## 6. 創建 Message API Channel\n\n選擇你剛剛創建的 Provider，接著在頁面中間位置找到並點擊 **Create a Message API channel**，以創建一個 Message API 機器人來管理訊息傳遞。\n\n![create-account06](/images/Line-Bot/create-account/create-account6.png)\n\n## 7. 創建 Line Official Account\n\n系統會引導你創建一個 **Line Official Account**，這是你的 Line Bot 與使用者互動所需的官方帳號，點擊 **Create a Line Official Account** 來開始。\n\n![create-account07](/images/Line-Bot/create-account/create-account7.png)\n\n## 8. 填寫帳號基本資訊\n\n系統會要求你填寫 Line Official Account 的基本資訊，如名稱、類別、國家等。根據實際需求進行填寫。\n\n![create-account08](/images/Line-Bot/create-account/create-account8.png)\n\n## 9. 確認並創建\n\n確認你所填寫的資訊無誤後，點擊 **確定** 以完成帳號創建。\n\n![create-account09](/images/Line-Bot/create-account/create-account9.png)\n\n## 10. 完成 Line Bot 設定\n\n創建完成後，系統會顯示一個確認訊息，代表你的 Line Bot 已成功建立。\n\n![create-account10](/images/Line-Bot/create-account/create-account10.png)\n\n## 11. 設定 Line Bot\n\n最後，你可以進入 Line Bot 的設定介面，進行 webhook URL 設定、回應訊息設定等。\n\n![create-account12](/images/Line-Bot/create-account/create-account11.png)\n","source":"_posts/Line-Bot與Chatgpt應用-建立機器人帳號.md","raw":"---\nlayout: post\ntitle: Line Bot 與 Chatgpt應用 01 - 建立帳號\ndate: 2024-09-19 10:49:52\ntags:\n  - \"Line Bot\"\ncategories:\n  - \"Line Bot\"\n  - \"建立帳號Line Bot帳號\"\ntop_img: /images/Line-Bot/create-account/create-account2.png\ncover: /images/Line-Bot/create-account/create-account2.png\n---\n\n# Line Bot 建立流程\n\n我們將一步一步指導你如何建立一個新的 Line Bot 帳戶，並完成基本設定。\n\n## 1. 進入 Line Business 頁面\n\n首先，前往 [Line Business](https://developers.line.biz/en/?status=success) 官方網站，這是 Line Bot 開發者專用的後台管理平台。\n\n![create-account01](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account1.png?alt=media&token=1a48bf32-ef29-4e39-b16a-55598225e676)\n\n## 2. 登入並進入 Console\n\n在頁面的右上角，找到並點擊 **Console** 按鈕，進入 Line Bot 後台控制台。\n\n![create-account02](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account2.png?alt=media&token=efd7f776-8637-4fe2-8b39-39dc8709367f)\n\n## 3. 進入後台控制台\n\n系統會將你引導至後台管理畫面，在這裡可以管理和創建你的 Line Bot 專案。\n\n![create-account03](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account3.png?alt=media&token=bf809ba3-4017-4dfd-9ae0-26057f312fd5)\n\n## 4. 選擇 Providers\n\n在控制台頁面中，找到並點擊 **Providers**，我都想成這是用來管理多個專案的文件資料夾。\n\n![create-account04](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account4.png?alt=media&token=9d91588e-425e-45f1-ac3c-7cba2fd19e2e)\n\n## 5. 創建新的 Provider\n\n輸入一個你定義的 Provider 名稱。\n\n![create-account05](/images/Line-Bot/create-account/create-account5.png)\n\n## 6. 創建 Message API Channel\n\n選擇你剛剛創建的 Provider，接著在頁面中間位置找到並點擊 **Create a Message API channel**，以創建一個 Message API 機器人來管理訊息傳遞。\n\n![create-account06](/images/Line-Bot/create-account/create-account6.png)\n\n## 7. 創建 Line Official Account\n\n系統會引導你創建一個 **Line Official Account**，這是你的 Line Bot 與使用者互動所需的官方帳號，點擊 **Create a Line Official Account** 來開始。\n\n![create-account07](/images/Line-Bot/create-account/create-account7.png)\n\n## 8. 填寫帳號基本資訊\n\n系統會要求你填寫 Line Official Account 的基本資訊，如名稱、類別、國家等。根據實際需求進行填寫。\n\n![create-account08](/images/Line-Bot/create-account/create-account8.png)\n\n## 9. 確認並創建\n\n確認你所填寫的資訊無誤後，點擊 **確定** 以完成帳號創建。\n\n![create-account09](/images/Line-Bot/create-account/create-account9.png)\n\n## 10. 完成 Line Bot 設定\n\n創建完成後，系統會顯示一個確認訊息，代表你的 Line Bot 已成功建立。\n\n![create-account10](/images/Line-Bot/create-account/create-account10.png)\n\n## 11. 設定 Line Bot\n\n最後，你可以進入 Line Bot 的設定介面，進行 webhook URL 設定、回應訊息設定等。\n\n![create-account12](/images/Line-Bot/create-account/create-account11.png)\n","slug":"Line-Bot與Chatgpt應用-建立機器人帳號","published":1,"updated":"2026-01-28T14:17:25.060Z","_id":"cmkxfp4y100167z8z4gr2bg0k","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h1 id=\"Line-Bot-建立流程\"><a href=\"#Line-Bot-建立流程\" class=\"headerlink\" title=\"Line Bot 建立流程\"></a>Line Bot 建立流程</h1><p>我們將一步一步指導你如何建立一個新的 Line Bot 帳戶，並完成基本設定。</p>\n<h2 id=\"1-進入-Line-Business-頁面\"><a href=\"#1-進入-Line-Business-頁面\" class=\"headerlink\" title=\"1. 進入 Line Business 頁面\"></a>1. 進入 Line Business 頁面</h2><p>首先，前往 <a href=\"https://developers.line.biz/en/?status=success\">Line Business</a> 官方網站，這是 Line Bot 開發者專用的後台管理平台。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account1.png?alt=media&token=1a48bf32-ef29-4e39-b16a-55598225e676\" alt=\"create-account01\"></p>\n<h2 id=\"2-登入並進入-Console\"><a href=\"#2-登入並進入-Console\" class=\"headerlink\" title=\"2. 登入並進入 Console\"></a>2. 登入並進入 Console</h2><p>在頁面的右上角，找到並點擊 <strong>Console</strong> 按鈕，進入 Line Bot 後台控制台。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account2.png?alt=media&token=efd7f776-8637-4fe2-8b39-39dc8709367f\" alt=\"create-account02\"></p>\n<h2 id=\"3-進入後台控制台\"><a href=\"#3-進入後台控制台\" class=\"headerlink\" title=\"3. 進入後台控制台\"></a>3. 進入後台控制台</h2><p>系統會將你引導至後台管理畫面，在這裡可以管理和創建你的 Line Bot 專案。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account3.png?alt=media&token=bf809ba3-4017-4dfd-9ae0-26057f312fd5\" alt=\"create-account03\"></p>\n<h2 id=\"4-選擇-Providers\"><a href=\"#4-選擇-Providers\" class=\"headerlink\" title=\"4. 選擇 Providers\"></a>4. 選擇 Providers</h2><p>在控制台頁面中，找到並點擊 <strong>Providers</strong>，我都想成這是用來管理多個專案的文件資料夾。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account4.png?alt=media&token=9d91588e-425e-45f1-ac3c-7cba2fd19e2e\" alt=\"create-account04\"></p>\n<h2 id=\"5-創建新的-Provider\"><a href=\"#5-創建新的-Provider\" class=\"headerlink\" title=\"5. 創建新的 Provider\"></a>5. 創建新的 Provider</h2><p>輸入一個你定義的 Provider 名稱。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account5.png\" alt=\"create-account05\"></p>\n<h2 id=\"6-創建-Message-API-Channel\"><a href=\"#6-創建-Message-API-Channel\" class=\"headerlink\" title=\"6. 創建 Message API Channel\"></a>6. 創建 Message API Channel</h2><p>選擇你剛剛創建的 Provider，接著在頁面中間位置找到並點擊 <strong>Create a Message API channel</strong>，以創建一個 Message API 機器人來管理訊息傳遞。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account6.png\" alt=\"create-account06\"></p>\n<h2 id=\"7-創建-Line-Official-Account\"><a href=\"#7-創建-Line-Official-Account\" class=\"headerlink\" title=\"7. 創建 Line Official Account\"></a>7. 創建 Line Official Account</h2><p>系統會引導你創建一個 <strong>Line Official Account</strong>，這是你的 Line Bot 與使用者互動所需的官方帳號，點擊 <strong>Create a Line Official Account</strong> 來開始。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account7.png\" alt=\"create-account07\"></p>\n<h2 id=\"8-填寫帳號基本資訊\"><a href=\"#8-填寫帳號基本資訊\" class=\"headerlink\" title=\"8. 填寫帳號基本資訊\"></a>8. 填寫帳號基本資訊</h2><p>系統會要求你填寫 Line Official Account 的基本資訊，如名稱、類別、國家等。根據實際需求進行填寫。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account8.png\" alt=\"create-account08\"></p>\n<h2 id=\"9-確認並創建\"><a href=\"#9-確認並創建\" class=\"headerlink\" title=\"9. 確認並創建\"></a>9. 確認並創建</h2><p>確認你所填寫的資訊無誤後，點擊 <strong>確定</strong> 以完成帳號創建。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account9.png\" alt=\"create-account09\"></p>\n<h2 id=\"10-完成-Line-Bot-設定\"><a href=\"#10-完成-Line-Bot-設定\" class=\"headerlink\" title=\"10. 完成 Line Bot 設定\"></a>10. 完成 Line Bot 設定</h2><p>創建完成後，系統會顯示一個確認訊息，代表你的 Line Bot 已成功建立。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account10.png\" alt=\"create-account10\"></p>\n<h2 id=\"11-設定-Line-Bot\"><a href=\"#11-設定-Line-Bot\" class=\"headerlink\" title=\"11. 設定 Line Bot\"></a>11. 設定 Line Bot</h2><p>最後，你可以進入 Line Bot 的設定介面，進行 webhook URL 設定、回應訊息設定等。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account11.png\" alt=\"create-account12\"></p>\n","excerpt":"","more":"<h1 id=\"Line-Bot-建立流程\"><a href=\"#Line-Bot-建立流程\" class=\"headerlink\" title=\"Line Bot 建立流程\"></a>Line Bot 建立流程</h1><p>我們將一步一步指導你如何建立一個新的 Line Bot 帳戶，並完成基本設定。</p>\n<h2 id=\"1-進入-Line-Business-頁面\"><a href=\"#1-進入-Line-Business-頁面\" class=\"headerlink\" title=\"1. 進入 Line Business 頁面\"></a>1. 進入 Line Business 頁面</h2><p>首先，前往 <a href=\"https://developers.line.biz/en/?status=success\">Line Business</a> 官方網站，這是 Line Bot 開發者專用的後台管理平台。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account1.png?alt=media&token=1a48bf32-ef29-4e39-b16a-55598225e676\" alt=\"create-account01\"></p>\n<h2 id=\"2-登入並進入-Console\"><a href=\"#2-登入並進入-Console\" class=\"headerlink\" title=\"2. 登入並進入 Console\"></a>2. 登入並進入 Console</h2><p>在頁面的右上角，找到並點擊 <strong>Console</strong> 按鈕，進入 Line Bot 後台控制台。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account2.png?alt=media&token=efd7f776-8637-4fe2-8b39-39dc8709367f\" alt=\"create-account02\"></p>\n<h2 id=\"3-進入後台控制台\"><a href=\"#3-進入後台控制台\" class=\"headerlink\" title=\"3. 進入後台控制台\"></a>3. 進入後台控制台</h2><p>系統會將你引導至後台管理畫面，在這裡可以管理和創建你的 Line Bot 專案。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account3.png?alt=media&token=bf809ba3-4017-4dfd-9ae0-26057f312fd5\" alt=\"create-account03\"></p>\n<h2 id=\"4-選擇-Providers\"><a href=\"#4-選擇-Providers\" class=\"headerlink\" title=\"4. 選擇 Providers\"></a>4. 選擇 Providers</h2><p>在控制台頁面中，找到並點擊 <strong>Providers</strong>，我都想成這是用來管理多個專案的文件資料夾。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fcreate-account4.png?alt=media&token=9d91588e-425e-45f1-ac3c-7cba2fd19e2e\" alt=\"create-account04\"></p>\n<h2 id=\"5-創建新的-Provider\"><a href=\"#5-創建新的-Provider\" class=\"headerlink\" title=\"5. 創建新的 Provider\"></a>5. 創建新的 Provider</h2><p>輸入一個你定義的 Provider 名稱。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account5.png\" alt=\"create-account05\"></p>\n<h2 id=\"6-創建-Message-API-Channel\"><a href=\"#6-創建-Message-API-Channel\" class=\"headerlink\" title=\"6. 創建 Message API Channel\"></a>6. 創建 Message API Channel</h2><p>選擇你剛剛創建的 Provider，接著在頁面中間位置找到並點擊 <strong>Create a Message API channel</strong>，以創建一個 Message API 機器人來管理訊息傳遞。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account6.png\" alt=\"create-account06\"></p>\n<h2 id=\"7-創建-Line-Official-Account\"><a href=\"#7-創建-Line-Official-Account\" class=\"headerlink\" title=\"7. 創建 Line Official Account\"></a>7. 創建 Line Official Account</h2><p>系統會引導你創建一個 <strong>Line Official Account</strong>，這是你的 Line Bot 與使用者互動所需的官方帳號，點擊 <strong>Create a Line Official Account</strong> 來開始。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account7.png\" alt=\"create-account07\"></p>\n<h2 id=\"8-填寫帳號基本資訊\"><a href=\"#8-填寫帳號基本資訊\" class=\"headerlink\" title=\"8. 填寫帳號基本資訊\"></a>8. 填寫帳號基本資訊</h2><p>系統會要求你填寫 Line Official Account 的基本資訊，如名稱、類別、國家等。根據實際需求進行填寫。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account8.png\" alt=\"create-account08\"></p>\n<h2 id=\"9-確認並創建\"><a href=\"#9-確認並創建\" class=\"headerlink\" title=\"9. 確認並創建\"></a>9. 確認並創建</h2><p>確認你所填寫的資訊無誤後，點擊 <strong>確定</strong> 以完成帳號創建。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account9.png\" alt=\"create-account09\"></p>\n<h2 id=\"10-完成-Line-Bot-設定\"><a href=\"#10-完成-Line-Bot-設定\" class=\"headerlink\" title=\"10. 完成 Line Bot 設定\"></a>10. 完成 Line Bot 設定</h2><p>創建完成後，系統會顯示一個確認訊息，代表你的 Line Bot 已成功建立。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account10.png\" alt=\"create-account10\"></p>\n<h2 id=\"11-設定-Line-Bot\"><a href=\"#11-設定-Line-Bot\" class=\"headerlink\" title=\"11. 設定 Line Bot\"></a>11. 設定 Line Bot</h2><p>最後，你可以進入 Line Bot 的設定介面，進行 webhook URL 設定、回應訊息設定等。</p>\n<p><img src=\"/images/Line-Bot/create-account/create-account11.png\" alt=\"create-account12\"></p>\n"},{"layout":"post","title":"Daphne 無法抓取 CSS 解決方法","date":"2024-11-24T13:19:31.000Z","top_img":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fcss.webp?alt=media&token=d4e8572d-3c73-4b4e-9c53-8241ed36820d","cover":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fcss.webp?alt=media&token=d4e8572d-3c73-4b4e-9c53-8241ed36820d","_content":"\n### **背景**\n\nDaphne 是用於運行 Django ASGI 應用的服務器。它主要負責處理 WebSocket 和 HTTP 請求，但 Daphne 本身不直接提供靜態文件服務（如 CSS、JS）。這通常導致在使用 Daphne 部署 Django 應用時，訪問 `/static/` 路徑返回 404 錯誤。\n\n---\n\n### **問題現象**\n\n當使用 Daphne 啟動應用並訪問 Django 的後台管理介面或靜態頁面時，靜態文件無法正常加載，終端可能顯示以下錯誤：\n\n```jsx\nNot Found: /static/admin/css/login.css\nNot Found: /static/admin/css/base.css\n```\n\n---\n\n### **問題原因**\n\nDaphne 不處理靜態文件。Django 預設需要 `collectstatic` 將所有靜態文件集中到一個目錄，並需要一個服務器（如 WhiteNoise 或 Nginx）來提供靜態文件支持。\n\n---\n\n### **解決方法**\n\n### **方法 1：使用 WhiteNoise 提供靜態文件**\n\nWhiteNoise 是一個用於提供靜態文件的中介軟體，適合簡單的部署需求。\n\n### **步驟 1：安裝 WhiteNoise**\n\n在虛擬環境中安裝 WhiteNoise：\n\n```bash\npip install whitenoise\n```\n\n### **步驟 2：配置 WhiteNoise**\n\n修改你的 `settings.py` 文件，添加以下配置：\n\n1. **啟用 WhiteNoise 中介**\n\n   ```python\n   MIDDLEWARE = [\n       'django.middleware.security.SecurityMiddleware',\n       'whitenoise.middleware.WhiteNoiseMiddleware',  # 添加這一行\n       'django.contrib.sessions.middleware.SessionMiddleware',\n       'django.middleware.common.CommonMiddleware',\n       'django.middleware.csrf.CsrfViewMiddleware',\n       'django.contrib.auth.middleware.AuthenticationMiddleware',\n       'django.contrib.messages.middleware.MessageMiddleware',\n       'django.middleware.clickjacking.XFrameOptionsMiddleware',\n   ]\n   ```\n\n2. **設置 `STATIC_ROOT` 和 `STATICFILES_STORAGE`**\n\n   ```python\n   STATIC_URL = '/static/'\n   STATIC_ROOT = BASE_DIR / 'staticfiles'  # 靜態文件的集中目錄\n\n   # 啟用壓縮和緩存\n   STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'\n   ```\n\n### **步驟 3：收集靜態文件**\n\n執行以下命令，將所有靜態文件收集到 `STATIC_ROOT` 指定的目錄：\n\n```bash\npython manage.py collectstatic\n```\n\n### **步驟 4：啟動應用**\n\n使用 Daphne 啟動應用：\n\n```bash\ndaphne -b 127.0.0.1 -p 8000 classify.asgi:application\n```\n\n訪問應用後，確認靜態文件是否正常加載。\n","source":"_posts/Daphne 無法抓取 CSS 解決方法.md","raw":"---\nlayout: post\ntitle: Daphne 無法抓取 CSS 解決方法\ndate: 2024-11-24 21:19:31\ntags:\n  - \"Python Django\"\ncategories:\n  - \"Python\"\n  - \"Django\"\n  - \"Daphne\"\ntop_img: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fcss.webp?alt=media&token=d4e8572d-3c73-4b4e-9c53-8241ed36820d\"\ncover: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fcss.webp?alt=media&token=d4e8572d-3c73-4b4e-9c53-8241ed36820d\"\n---\n\n### **背景**\n\nDaphne 是用於運行 Django ASGI 應用的服務器。它主要負責處理 WebSocket 和 HTTP 請求，但 Daphne 本身不直接提供靜態文件服務（如 CSS、JS）。這通常導致在使用 Daphne 部署 Django 應用時，訪問 `/static/` 路徑返回 404 錯誤。\n\n---\n\n### **問題現象**\n\n當使用 Daphne 啟動應用並訪問 Django 的後台管理介面或靜態頁面時，靜態文件無法正常加載，終端可能顯示以下錯誤：\n\n```jsx\nNot Found: /static/admin/css/login.css\nNot Found: /static/admin/css/base.css\n```\n\n---\n\n### **問題原因**\n\nDaphne 不處理靜態文件。Django 預設需要 `collectstatic` 將所有靜態文件集中到一個目錄，並需要一個服務器（如 WhiteNoise 或 Nginx）來提供靜態文件支持。\n\n---\n\n### **解決方法**\n\n### **方法 1：使用 WhiteNoise 提供靜態文件**\n\nWhiteNoise 是一個用於提供靜態文件的中介軟體，適合簡單的部署需求。\n\n### **步驟 1：安裝 WhiteNoise**\n\n在虛擬環境中安裝 WhiteNoise：\n\n```bash\npip install whitenoise\n```\n\n### **步驟 2：配置 WhiteNoise**\n\n修改你的 `settings.py` 文件，添加以下配置：\n\n1. **啟用 WhiteNoise 中介**\n\n   ```python\n   MIDDLEWARE = [\n       'django.middleware.security.SecurityMiddleware',\n       'whitenoise.middleware.WhiteNoiseMiddleware',  # 添加這一行\n       'django.contrib.sessions.middleware.SessionMiddleware',\n       'django.middleware.common.CommonMiddleware',\n       'django.middleware.csrf.CsrfViewMiddleware',\n       'django.contrib.auth.middleware.AuthenticationMiddleware',\n       'django.contrib.messages.middleware.MessageMiddleware',\n       'django.middleware.clickjacking.XFrameOptionsMiddleware',\n   ]\n   ```\n\n2. **設置 `STATIC_ROOT` 和 `STATICFILES_STORAGE`**\n\n   ```python\n   STATIC_URL = '/static/'\n   STATIC_ROOT = BASE_DIR / 'staticfiles'  # 靜態文件的集中目錄\n\n   # 啟用壓縮和緩存\n   STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'\n   ```\n\n### **步驟 3：收集靜態文件**\n\n執行以下命令，將所有靜態文件收集到 `STATIC_ROOT` 指定的目錄：\n\n```bash\npython manage.py collectstatic\n```\n\n### **步驟 4：啟動應用**\n\n使用 Daphne 啟動應用：\n\n```bash\ndaphne -b 127.0.0.1 -p 8000 classify.asgi:application\n```\n\n訪問應用後，確認靜態文件是否正常加載。\n","slug":"Daphne 無法抓取 CSS 解決方法","published":1,"updated":"2026-01-28T14:17:25.059Z","_id":"cmkxfp4y100187z8z4sbgcp63","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a><strong>背景</strong></h3><p>Daphne 是用於運行 Django ASGI 應用的服務器。它主要負責處理 WebSocket 和 HTTP 請求，但 Daphne 本身不直接提供靜態文件服務（如 CSS、JS）。這通常導致在使用 Daphne 部署 Django 應用時，訪問 <code>/static/</code> 路徑返回 404 錯誤。</p>\n<hr>\n<h3 id=\"問題現象\"><a href=\"#問題現象\" class=\"headerlink\" title=\"問題現象\"></a><strong>問題現象</strong></h3><p>當使用 Daphne 啟動應用並訪問 Django 的後台管理介面或靜態頁面時，靜態文件無法正常加載，終端可能顯示以下錯誤：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Not</span> <span class=\"title class_\">Found</span>: <span class=\"regexp\">/static/</span>admin/css/login.<span class=\"property\">css</span></span><br><span class=\"line\"><span class=\"title class_\">Not</span> <span class=\"title class_\">Found</span>: <span class=\"regexp\">/static/</span>admin/css/base.<span class=\"property\">css</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"問題原因\"><a href=\"#問題原因\" class=\"headerlink\" title=\"問題原因\"></a><strong>問題原因</strong></h3><p>Daphne 不處理靜態文件。Django 預設需要 <code>collectstatic</code> 將所有靜態文件集中到一個目錄，並需要一個服務器（如 WhiteNoise 或 Nginx）來提供靜態文件支持。</p>\n<hr>\n<h3 id=\"解決方法\"><a href=\"#解決方法\" class=\"headerlink\" title=\"解決方法\"></a><strong>解決方法</strong></h3><h3 id=\"方法-1：使用-WhiteNoise-提供靜態文件\"><a href=\"#方法-1：使用-WhiteNoise-提供靜態文件\" class=\"headerlink\" title=\"方法 1：使用 WhiteNoise 提供靜態文件\"></a><strong>方法 1：使用 WhiteNoise 提供靜態文件</strong></h3><p>WhiteNoise 是一個用於提供靜態文件的中介軟體，適合簡單的部署需求。</p>\n<h3 id=\"步驟-1：安裝-WhiteNoise\"><a href=\"#步驟-1：安裝-WhiteNoise\" class=\"headerlink\" title=\"步驟 1：安裝 WhiteNoise\"></a><strong>步驟 1：安裝 WhiteNoise</strong></h3><p>在虛擬環境中安裝 WhiteNoise：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install whitenoise</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"步驟-2：配置-WhiteNoise\"><a href=\"#步驟-2：配置-WhiteNoise\" class=\"headerlink\" title=\"步驟 2：配置 WhiteNoise\"></a><strong>步驟 2：配置 WhiteNoise</strong></h3><p>修改你的 <code>settings.py</code> 文件，添加以下配置：</p>\n<ol>\n<li><p><strong>啟用 WhiteNoise 中介</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MIDDLEWARE = [</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;whitenoise.middleware.WhiteNoiseMiddleware&#x27;</span>,  <span class=\"comment\"># 添加這一行</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>設置 <code>STATIC_ROOT</code> 和 <code>STATICFILES_STORAGE</code></strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">STATIC_URL = <span class=\"string\">&#x27;/static/&#x27;</span></span><br><span class=\"line\">STATIC_ROOT = BASE_DIR / <span class=\"string\">&#x27;staticfiles&#x27;</span>  <span class=\"comment\"># 靜態文件的集中目錄</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 啟用壓縮和緩存</span></span><br><span class=\"line\">STATICFILES_STORAGE = <span class=\"string\">&#x27;whitenoise.storage.CompressedManifestStaticFilesStorage&#x27;</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"步驟-3：收集靜態文件\"><a href=\"#步驟-3：收集靜態文件\" class=\"headerlink\" title=\"步驟 3：收集靜態文件\"></a><strong>步驟 3：收集靜態文件</strong></h3><p>執行以下命令，將所有靜態文件收集到 <code>STATIC_ROOT</code> 指定的目錄：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py collectstatic</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"步驟-4：啟動應用\"><a href=\"#步驟-4：啟動應用\" class=\"headerlink\" title=\"步驟 4：啟動應用\"></a><strong>步驟 4：啟動應用</strong></h3><p>使用 Daphne 啟動應用：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">daphne -b 127.0.0.1 -p 8000 classify.asgi:application</span><br></pre></td></tr></table></figure>\n\n<p>訪問應用後，確認靜態文件是否正常加載。</p>\n","excerpt":"","more":"<h3 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a><strong>背景</strong></h3><p>Daphne 是用於運行 Django ASGI 應用的服務器。它主要負責處理 WebSocket 和 HTTP 請求，但 Daphne 本身不直接提供靜態文件服務（如 CSS、JS）。這通常導致在使用 Daphne 部署 Django 應用時，訪問 <code>/static/</code> 路徑返回 404 錯誤。</p>\n<hr>\n<h3 id=\"問題現象\"><a href=\"#問題現象\" class=\"headerlink\" title=\"問題現象\"></a><strong>問題現象</strong></h3><p>當使用 Daphne 啟動應用並訪問 Django 的後台管理介面或靜態頁面時，靜態文件無法正常加載，終端可能顯示以下錯誤：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Not</span> <span class=\"title class_\">Found</span>: <span class=\"regexp\">/static/</span>admin/css/login.<span class=\"property\">css</span></span><br><span class=\"line\"><span class=\"title class_\">Not</span> <span class=\"title class_\">Found</span>: <span class=\"regexp\">/static/</span>admin/css/base.<span class=\"property\">css</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"問題原因\"><a href=\"#問題原因\" class=\"headerlink\" title=\"問題原因\"></a><strong>問題原因</strong></h3><p>Daphne 不處理靜態文件。Django 預設需要 <code>collectstatic</code> 將所有靜態文件集中到一個目錄，並需要一個服務器（如 WhiteNoise 或 Nginx）來提供靜態文件支持。</p>\n<hr>\n<h3 id=\"解決方法\"><a href=\"#解決方法\" class=\"headerlink\" title=\"解決方法\"></a><strong>解決方法</strong></h3><h3 id=\"方法-1：使用-WhiteNoise-提供靜態文件\"><a href=\"#方法-1：使用-WhiteNoise-提供靜態文件\" class=\"headerlink\" title=\"方法 1：使用 WhiteNoise 提供靜態文件\"></a><strong>方法 1：使用 WhiteNoise 提供靜態文件</strong></h3><p>WhiteNoise 是一個用於提供靜態文件的中介軟體，適合簡單的部署需求。</p>\n<h3 id=\"步驟-1：安裝-WhiteNoise\"><a href=\"#步驟-1：安裝-WhiteNoise\" class=\"headerlink\" title=\"步驟 1：安裝 WhiteNoise\"></a><strong>步驟 1：安裝 WhiteNoise</strong></h3><p>在虛擬環境中安裝 WhiteNoise：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install whitenoise</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"步驟-2：配置-WhiteNoise\"><a href=\"#步驟-2：配置-WhiteNoise\" class=\"headerlink\" title=\"步驟 2：配置 WhiteNoise\"></a><strong>步驟 2：配置 WhiteNoise</strong></h3><p>修改你的 <code>settings.py</code> 文件，添加以下配置：</p>\n<ol>\n<li><p><strong>啟用 WhiteNoise 中介</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MIDDLEWARE = [</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;whitenoise.middleware.WhiteNoiseMiddleware&#x27;</span>,  <span class=\"comment\"># 添加這一行</span></span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class=\"line\">    <span class=\"string\">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>設置 <code>STATIC_ROOT</code> 和 <code>STATICFILES_STORAGE</code></strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">STATIC_URL = <span class=\"string\">&#x27;/static/&#x27;</span></span><br><span class=\"line\">STATIC_ROOT = BASE_DIR / <span class=\"string\">&#x27;staticfiles&#x27;</span>  <span class=\"comment\"># 靜態文件的集中目錄</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 啟用壓縮和緩存</span></span><br><span class=\"line\">STATICFILES_STORAGE = <span class=\"string\">&#x27;whitenoise.storage.CompressedManifestStaticFilesStorage&#x27;</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"步驟-3：收集靜態文件\"><a href=\"#步驟-3：收集靜態文件\" class=\"headerlink\" title=\"步驟 3：收集靜態文件\"></a><strong>步驟 3：收集靜態文件</strong></h3><p>執行以下命令，將所有靜態文件收集到 <code>STATIC_ROOT</code> 指定的目錄：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python manage.py collectstatic</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"步驟-4：啟動應用\"><a href=\"#步驟-4：啟動應用\" class=\"headerlink\" title=\"步驟 4：啟動應用\"></a><strong>步驟 4：啟動應用</strong></h3><p>使用 Daphne 啟動應用：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">daphne -b 127.0.0.1 -p 8000 classify.asgi:application</span><br></pre></td></tr></table></figure>\n\n<p>訪問應用後，確認靜態文件是否正常加載。</p>\n"},{"layout":"post","title":"Line Bot 與 Openai & SQL 03 - 成績查詢","date":"2024-10-02T08:30:06.000Z","top_img":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Flinebot-student.webp?alt=media&token=b991afe3-27a4-4d32-a1d7-5b34b8849a11","cover":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Flinebot-student.webp?alt=media&token=b991afe3-27a4-4d32-a1d7-5b34b8849a11","_content":"\n參考來源 : https://www.youtube.com/watch?v=IfzY0axpjD8&t=333s\n\n## 基於 LINE Bot 與 OpenAI 的 MySQL 學生成績管理系統教學文件\n\n### 目錄\n\n1. 前言\n2. 系統需求與工具\n3. 資料庫設計與結構\n4. 插入 15 位學生的資料\n5. 為每位學生插入成績\n6. 使用 OpenAI 生成 SQL 語句\n7. LINE Bot 與 OpenAI 整合\n8. 查詢學生成績\n9. 常見問題與解決方案\n10. 結論\n\n---\n\n### 1. 前言\n\n本教學文件將指導您如何建立一個基於 MySQL 的學生成績管理系統，並通過 LINE Bot 與 OpenAI 的整合來查詢和管理數據。我們將介紹如何使用 LINE Bot 接收訊息、OpenAI 自動生成 SQL 語句，並通過 MySQL 查詢學生的成績。\n\n---\n\n### 2. 系統需求與工具\n\n**系統需求：**\n\n- 安裝了 MySQL 伺服器\n- Python 3 環境（Flask、OpenAI 和 LINE Bot SDK）\n- MySQL 客戶端或管理工具（如 MySQL Workbench）\n- OpenAI API 金鑰\n- LINE Bot API 金鑰\n\n**工具：**\n\n- MySQL 伺服器\n- MySQL Workbench 或命令行工具\n- LINE Bot 設定\n- OpenAI API 設定\n\n---\n\n### 3. 資料庫設計與結構\n\n在本系統中，我們將創建兩個資料表：一個用來存儲學生的基本信息，另一個用來存儲學生的成績。\n\n### `student` 資料表結構：\n\n```sql\nCREATE TABLE student (\n    sno INT PRIMARY KEY,     -- 學號\n    class VARCHAR(50),       -- 班級\n    name VARCHAR(100),       -- 學生姓名\n    sex VARCHAR(10),         -- 性別\n    address VARCHAR(255),    -- 地址\n    memo TEXT                -- 備註\n);\n\n```\n\n### `score` 資料表結構：\n\n```sql\nCREATE TABLE score (\n    sno INT,                 -- 學號 (外鍵)\n    class VARCHAR(50),       -- 班級\n    subject VARCHAR(100),    -- 科目\n    score INT                -- 成績\n);\n\n```\n\n這兩個資料表使用 `sno` 欄位關聯，來管理學生的基本信息和成績。\n\n---\n\n### 4. 插入 15 位學生的資料\n\n接下來，我們將插入 15 位學生的資料：\n\n```sql\nINSERT INTO student (sno, class, name, sex, address, memo) VALUES\n(1, 'Class 1', 'John Doe', 'M', '123 Street A', 'Excellent performance'),\n(2, 'Class 2', 'Jane Smith', 'F', '456 Street B', 'Needs improvement in math'),\n(3, 'Class 3', 'Alice Brown', 'F', '789 Street C', 'Top student'),\n(4, 'Class 1', 'Bob Johnson', 'M', '1010 Street D', 'New student'),\n(5, 'Class 2', 'Charlie Davis', 'M', '1111 Street E', 'Struggles with homework'),\n(6, 'Class 3', 'Diana White', 'F', '1212 Street F', 'Shows great potential'),\n(7, 'Class 1', 'Evan Green', 'M', '1313 Street G', 'Good participation'),\n(8, 'Class 2', 'Fiona Blue', 'F', '1414 Street H', 'Excellent attendance'),\n(9, 'Class 3', 'George Black', 'M', '1515 Street I', 'Needs focus on studies'),\n(10, 'Class 1', 'Hannah Yellow', 'F', '1616 Street J', 'Very creative'),\n(11, 'Class 2', 'Ivan Orange', 'M', '1717 Street K', 'Great in sports'),\n(12, 'Class 3', 'Jenny Purple', 'F', '1818 Street L', 'Good academic performance'),\n(13, 'Class 1', 'Kevin Red', 'M', '1919 Street M', 'Enthusiastic in class'),\n(14, 'Class 2', 'Lily Pink', 'F', '2020 Street N', 'Hardworking student'),\n(15, 'Class 3', 'Michael Cyan', 'M', '2121 Street O', 'Quick learner');\n```\n\n![student DB](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-studens.png?alt=media&token=af046ad4-c41a-4823-88c8-d196058d3f32)\n\n### 5. 為每位學生插入成績\n\n接下來，我們為每位學生插入 `數學` 和 `國文` 的成績：\n\n```sql\nINSERT INTO score (sno, class, subject, score) VALUES\n(1, 'Class 1', '數學', 85),\n(1, 'Class 1', '國文', 90),\n(2, 'Class 2', '數學', 78),\n(2, 'Class 2', '國文', 88),\n(3, 'Class 3', '數學', 92),\n(3, 'Class 3', '國文', 95),\n(4, 'Class 1', '數學', 76),\n(4, 'Class 1', '國文', 85),\n(5, 'Class 2', '數學', 82),\n(5, 'Class 2', '國文', 89),\n(6, 'Class 3', '數學', 88),\n(6, 'Class 3', '國文', 91),\n(7, 'Class 1', '數學', 90),\n(7, 'Class 1', '國文', 87),\n(8, 'Class 2', '數學', 85),\n(8, 'Class 2', '國文', 92),\n(9, 'Class 3', '數學', 80),\n(9, 'Class 3', '國文', 90),\n(10, 'Class 1', '數學', 87),\n(10, 'Class 1', '國文', 88),\n(11, 'Class 2', '數學', 89),\n(11, 'Class 2', '國文', 91),\n(12, 'Class 3', '數學', 94),\n(12, 'Class 3', '國文', 96),\n(13, 'Class 1', '數學', 75),\n(13, 'Class 1', '國文', 85),\n(14, 'Class 2', '數學', 88),\n(14, 'Class 2', '國文', 92),\n(15, 'Class 3', '數學', 93),\n(15, 'Class 3', '國文', 95);\n```\n\n[![student-score](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-score.png?alt=media&token=745ae4d1-f357-40d7-b972-81c299714061)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-score.png?alt=media&token=745ae4d1-f357-40d7-b972-81c299714061)\n\n---\n\n### 6. 使用 OpenAI 生成 SQL 語句\n\n當 LINE Bot 接收到查詢訊息時，會呼叫 OpenAI API 自動生成 SQL 查詢語句。以下是範例的整合程式碼片段：\n\n```python\nresponse = openai.ChatCompletion.create(\n    model=\"gpt-4o-mini\",\n    messages=[\n        {\"role\": \"system\", \"content\": \"You are a helpful assistant that helps users query a MySQL database.\"},\n        {\"role\": \"user\", \"content\": event.message.text}\n    ],\n    temperature=0,\n    max_tokens=400,\n    top_p=1,\n    frequency_penalty=0,\n    presence_penalty=0\n)\n\n```\n\n---\n\n### 7. LINE Bot 與 OpenAI 整合完整程式碼\n\n整合 LINE Bot 與 OpenAI API，並將接收到的查詢請求轉換為 SQL 查詢並從 MySQL 資料庫中提取資料。以下是完整的程式碼片段：\n\n```python\nimport openai\nfrom flask import Flask, request, abort\nfrom linebot import LineBotApi, WebhookHandler\nfrom linebot.exceptions import InvalidSignatureError\nfrom linebot.models import MessageEvent, TextMessage, TextSendMessage\nimport pymysql\nimport re\n\napp = Flask(__name__)\n\n# 設定 Linebot 的 Channel Access Token 和 Channel Secret\n# 目前是 鈞皓科技 的 LineBot\nline_bot_api = LineBotApi('')\nhandler = WebhookHandler('')\n\n# 設定 OpenAI API 金鑰\nopenai.api_key = ''\n\n# 資料庫連接設定\ndb_settings = {\n    \"host\": \"127.0.0.1\",\n    \"port\": 3306,\n    \"user\": \"root\",\n    \"password\": \"password\",\n    \"db\": \"studentdb\",\n    \"charset\": \"utf8\"\n}\n\n@app.route(\"/\")\ndef root():\n    return \"Hello, World!\"\n\n@app.route(\"/callback\", methods=['POST'])\ndef callback():\n    signature = request.headers['X-Line-Signature']\n    body = request.get_data(as_text=True)\n    app.logger.info(\"Request body: \" + body)\n\n    try:\n        print(\"Request body: \" + signature)\n        handler.handle(body, signature)\n    except InvalidSignatureError:\n        abort(400)\n\n    return 'OK'\n\n@handler.add(MessageEvent, message=TextMessage)\ndef handle_message(event):\n    try:\n        # 呼叫 OpenAI ChatCompletion API 來生成 SQL 語句\n        response = openai.ChatCompletion.create(\n            model=\"gpt-4o-mini\",\n            messages=[\n                {\"role\": \"system\", \"content\": \"You are a helpful assistant that helps users query a MySQL database.\"},\n                {\"role\": \"user\", \"content\": event.message.text}\n            ],\n            temperature=0,\n            max_tokens=400,\n            top_p=1,\n            frequency_penalty=0,\n            presence_penalty=0\n        )\n\n        # 處理 OpenAI 回應，過濾掉非 SQL 的部分\n        response_text = response.choices[0].message['content'].strip()\n\n        # 使用正則表達式過濾掉註解和解釋部分，只保留 SQL 語句\n        sql_match = re.search(r\"SELECT.*?;\", response_text, re.DOTALL)\n        if sql_match:\n            response_sql = sql_match.group(0).strip()  # 提取到 SQL 語句\n        else:\n            response_sql = \"\"  # 如果沒有找到有效的 SQL，設為空\n\n        # 檢查是否有生成有效的 SQL 語句\n        if response_sql:\n            # 串接資料庫並執行 SQL 查詢\n            conn = pymysql.connect(**db_settings)\n            with conn.cursor() as cursor:\n                command = response_sql.replace(\"\\n\", \" \")  # 移除多餘的換行符號\n                print(\"Executing SQL:\", command)\n                cursor.execute(command)\n                result = cursor.fetchall()\n\n            # 格式化查詢結果\n            line_data = \"class\\tsubject\\tscore\\n\"\n            line_data += \"-------------------\\n\"\n\n            for row in result:\n                line_data += f\"{row[0]}\\t{row[1]}\\t{row[2]}\\n\"\n\n            # 回傳結果給 LINE 用戶\n            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=response_sql + '\\n' + line_data))\n        else:\n            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=\"未能生成有效的 SQL 查詢語句。\"))\n\n    except Exception as e:\n        print(\"Error:\", e)\n        line_bot_api.reply_message(event.reply_token, TextSendMessage(text=\"發生錯誤，請稍後再試。\"))\n\nif __name__ == \"__main__\":\n    app.run()\n\n```\n\n### 8. Demo 時間\n\n[![linebot-demo](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2F%E6%88%AA%E5%9C%96%202024-10-02%20%E6%99%9A%E4%B8%8A8.14.39.png?alt=media&token=de5ac121-8dc2-4912-be23-0ac4a82635ca)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2F%E6%88%AA%E5%9C%96%202024-10-02%20%E6%99%9A%E4%B8%8A8.14.39.png?alt=media&token=de5ac121-8dc2-4912-be23-0ac4a82635ca)\n","source":"_posts/Line-Bot-與-Openai-SQL-成績查詢.md","raw":"---\nlayout: post\ntitle: Line Bot 與 Openai & SQL 03 - 成績查詢\ndate: 2024-10-02 16:30:06\ntags:\n  - \"Line Bot\"\ncategories:\n  - \"Line Bot\"\n  - \"成績查詢練習\"\ntop_img: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Flinebot-student.webp?alt=media&token=b991afe3-27a4-4d32-a1d7-5b34b8849a11\"\ncover: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Flinebot-student.webp?alt=media&token=b991afe3-27a4-4d32-a1d7-5b34b8849a11\"\n---\n\n參考來源 : https://www.youtube.com/watch?v=IfzY0axpjD8&t=333s\n\n## 基於 LINE Bot 與 OpenAI 的 MySQL 學生成績管理系統教學文件\n\n### 目錄\n\n1. 前言\n2. 系統需求與工具\n3. 資料庫設計與結構\n4. 插入 15 位學生的資料\n5. 為每位學生插入成績\n6. 使用 OpenAI 生成 SQL 語句\n7. LINE Bot 與 OpenAI 整合\n8. 查詢學生成績\n9. 常見問題與解決方案\n10. 結論\n\n---\n\n### 1. 前言\n\n本教學文件將指導您如何建立一個基於 MySQL 的學生成績管理系統，並通過 LINE Bot 與 OpenAI 的整合來查詢和管理數據。我們將介紹如何使用 LINE Bot 接收訊息、OpenAI 自動生成 SQL 語句，並通過 MySQL 查詢學生的成績。\n\n---\n\n### 2. 系統需求與工具\n\n**系統需求：**\n\n- 安裝了 MySQL 伺服器\n- Python 3 環境（Flask、OpenAI 和 LINE Bot SDK）\n- MySQL 客戶端或管理工具（如 MySQL Workbench）\n- OpenAI API 金鑰\n- LINE Bot API 金鑰\n\n**工具：**\n\n- MySQL 伺服器\n- MySQL Workbench 或命令行工具\n- LINE Bot 設定\n- OpenAI API 設定\n\n---\n\n### 3. 資料庫設計與結構\n\n在本系統中，我們將創建兩個資料表：一個用來存儲學生的基本信息，另一個用來存儲學生的成績。\n\n### `student` 資料表結構：\n\n```sql\nCREATE TABLE student (\n    sno INT PRIMARY KEY,     -- 學號\n    class VARCHAR(50),       -- 班級\n    name VARCHAR(100),       -- 學生姓名\n    sex VARCHAR(10),         -- 性別\n    address VARCHAR(255),    -- 地址\n    memo TEXT                -- 備註\n);\n\n```\n\n### `score` 資料表結構：\n\n```sql\nCREATE TABLE score (\n    sno INT,                 -- 學號 (外鍵)\n    class VARCHAR(50),       -- 班級\n    subject VARCHAR(100),    -- 科目\n    score INT                -- 成績\n);\n\n```\n\n這兩個資料表使用 `sno` 欄位關聯，來管理學生的基本信息和成績。\n\n---\n\n### 4. 插入 15 位學生的資料\n\n接下來，我們將插入 15 位學生的資料：\n\n```sql\nINSERT INTO student (sno, class, name, sex, address, memo) VALUES\n(1, 'Class 1', 'John Doe', 'M', '123 Street A', 'Excellent performance'),\n(2, 'Class 2', 'Jane Smith', 'F', '456 Street B', 'Needs improvement in math'),\n(3, 'Class 3', 'Alice Brown', 'F', '789 Street C', 'Top student'),\n(4, 'Class 1', 'Bob Johnson', 'M', '1010 Street D', 'New student'),\n(5, 'Class 2', 'Charlie Davis', 'M', '1111 Street E', 'Struggles with homework'),\n(6, 'Class 3', 'Diana White', 'F', '1212 Street F', 'Shows great potential'),\n(7, 'Class 1', 'Evan Green', 'M', '1313 Street G', 'Good participation'),\n(8, 'Class 2', 'Fiona Blue', 'F', '1414 Street H', 'Excellent attendance'),\n(9, 'Class 3', 'George Black', 'M', '1515 Street I', 'Needs focus on studies'),\n(10, 'Class 1', 'Hannah Yellow', 'F', '1616 Street J', 'Very creative'),\n(11, 'Class 2', 'Ivan Orange', 'M', '1717 Street K', 'Great in sports'),\n(12, 'Class 3', 'Jenny Purple', 'F', '1818 Street L', 'Good academic performance'),\n(13, 'Class 1', 'Kevin Red', 'M', '1919 Street M', 'Enthusiastic in class'),\n(14, 'Class 2', 'Lily Pink', 'F', '2020 Street N', 'Hardworking student'),\n(15, 'Class 3', 'Michael Cyan', 'M', '2121 Street O', 'Quick learner');\n```\n\n![student DB](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-studens.png?alt=media&token=af046ad4-c41a-4823-88c8-d196058d3f32)\n\n### 5. 為每位學生插入成績\n\n接下來，我們為每位學生插入 `數學` 和 `國文` 的成績：\n\n```sql\nINSERT INTO score (sno, class, subject, score) VALUES\n(1, 'Class 1', '數學', 85),\n(1, 'Class 1', '國文', 90),\n(2, 'Class 2', '數學', 78),\n(2, 'Class 2', '國文', 88),\n(3, 'Class 3', '數學', 92),\n(3, 'Class 3', '國文', 95),\n(4, 'Class 1', '數學', 76),\n(4, 'Class 1', '國文', 85),\n(5, 'Class 2', '數學', 82),\n(5, 'Class 2', '國文', 89),\n(6, 'Class 3', '數學', 88),\n(6, 'Class 3', '國文', 91),\n(7, 'Class 1', '數學', 90),\n(7, 'Class 1', '國文', 87),\n(8, 'Class 2', '數學', 85),\n(8, 'Class 2', '國文', 92),\n(9, 'Class 3', '數學', 80),\n(9, 'Class 3', '國文', 90),\n(10, 'Class 1', '數學', 87),\n(10, 'Class 1', '國文', 88),\n(11, 'Class 2', '數學', 89),\n(11, 'Class 2', '國文', 91),\n(12, 'Class 3', '數學', 94),\n(12, 'Class 3', '國文', 96),\n(13, 'Class 1', '數學', 75),\n(13, 'Class 1', '國文', 85),\n(14, 'Class 2', '數學', 88),\n(14, 'Class 2', '國文', 92),\n(15, 'Class 3', '數學', 93),\n(15, 'Class 3', '國文', 95);\n```\n\n[![student-score](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-score.png?alt=media&token=745ae4d1-f357-40d7-b972-81c299714061)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-score.png?alt=media&token=745ae4d1-f357-40d7-b972-81c299714061)\n\n---\n\n### 6. 使用 OpenAI 生成 SQL 語句\n\n當 LINE Bot 接收到查詢訊息時，會呼叫 OpenAI API 自動生成 SQL 查詢語句。以下是範例的整合程式碼片段：\n\n```python\nresponse = openai.ChatCompletion.create(\n    model=\"gpt-4o-mini\",\n    messages=[\n        {\"role\": \"system\", \"content\": \"You are a helpful assistant that helps users query a MySQL database.\"},\n        {\"role\": \"user\", \"content\": event.message.text}\n    ],\n    temperature=0,\n    max_tokens=400,\n    top_p=1,\n    frequency_penalty=0,\n    presence_penalty=0\n)\n\n```\n\n---\n\n### 7. LINE Bot 與 OpenAI 整合完整程式碼\n\n整合 LINE Bot 與 OpenAI API，並將接收到的查詢請求轉換為 SQL 查詢並從 MySQL 資料庫中提取資料。以下是完整的程式碼片段：\n\n```python\nimport openai\nfrom flask import Flask, request, abort\nfrom linebot import LineBotApi, WebhookHandler\nfrom linebot.exceptions import InvalidSignatureError\nfrom linebot.models import MessageEvent, TextMessage, TextSendMessage\nimport pymysql\nimport re\n\napp = Flask(__name__)\n\n# 設定 Linebot 的 Channel Access Token 和 Channel Secret\n# 目前是 鈞皓科技 的 LineBot\nline_bot_api = LineBotApi('')\nhandler = WebhookHandler('')\n\n# 設定 OpenAI API 金鑰\nopenai.api_key = ''\n\n# 資料庫連接設定\ndb_settings = {\n    \"host\": \"127.0.0.1\",\n    \"port\": 3306,\n    \"user\": \"root\",\n    \"password\": \"password\",\n    \"db\": \"studentdb\",\n    \"charset\": \"utf8\"\n}\n\n@app.route(\"/\")\ndef root():\n    return \"Hello, World!\"\n\n@app.route(\"/callback\", methods=['POST'])\ndef callback():\n    signature = request.headers['X-Line-Signature']\n    body = request.get_data(as_text=True)\n    app.logger.info(\"Request body: \" + body)\n\n    try:\n        print(\"Request body: \" + signature)\n        handler.handle(body, signature)\n    except InvalidSignatureError:\n        abort(400)\n\n    return 'OK'\n\n@handler.add(MessageEvent, message=TextMessage)\ndef handle_message(event):\n    try:\n        # 呼叫 OpenAI ChatCompletion API 來生成 SQL 語句\n        response = openai.ChatCompletion.create(\n            model=\"gpt-4o-mini\",\n            messages=[\n                {\"role\": \"system\", \"content\": \"You are a helpful assistant that helps users query a MySQL database.\"},\n                {\"role\": \"user\", \"content\": event.message.text}\n            ],\n            temperature=0,\n            max_tokens=400,\n            top_p=1,\n            frequency_penalty=0,\n            presence_penalty=0\n        )\n\n        # 處理 OpenAI 回應，過濾掉非 SQL 的部分\n        response_text = response.choices[0].message['content'].strip()\n\n        # 使用正則表達式過濾掉註解和解釋部分，只保留 SQL 語句\n        sql_match = re.search(r\"SELECT.*?;\", response_text, re.DOTALL)\n        if sql_match:\n            response_sql = sql_match.group(0).strip()  # 提取到 SQL 語句\n        else:\n            response_sql = \"\"  # 如果沒有找到有效的 SQL，設為空\n\n        # 檢查是否有生成有效的 SQL 語句\n        if response_sql:\n            # 串接資料庫並執行 SQL 查詢\n            conn = pymysql.connect(**db_settings)\n            with conn.cursor() as cursor:\n                command = response_sql.replace(\"\\n\", \" \")  # 移除多餘的換行符號\n                print(\"Executing SQL:\", command)\n                cursor.execute(command)\n                result = cursor.fetchall()\n\n            # 格式化查詢結果\n            line_data = \"class\\tsubject\\tscore\\n\"\n            line_data += \"-------------------\\n\"\n\n            for row in result:\n                line_data += f\"{row[0]}\\t{row[1]}\\t{row[2]}\\n\"\n\n            # 回傳結果給 LINE 用戶\n            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=response_sql + '\\n' + line_data))\n        else:\n            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=\"未能生成有效的 SQL 查詢語句。\"))\n\n    except Exception as e:\n        print(\"Error:\", e)\n        line_bot_api.reply_message(event.reply_token, TextSendMessage(text=\"發生錯誤，請稍後再試。\"))\n\nif __name__ == \"__main__\":\n    app.run()\n\n```\n\n### 8. Demo 時間\n\n[![linebot-demo](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2F%E6%88%AA%E5%9C%96%202024-10-02%20%E6%99%9A%E4%B8%8A8.14.39.png?alt=media&token=de5ac121-8dc2-4912-be23-0ac4a82635ca)](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2F%E6%88%AA%E5%9C%96%202024-10-02%20%E6%99%9A%E4%B8%8A8.14.39.png?alt=media&token=de5ac121-8dc2-4912-be23-0ac4a82635ca)\n","slug":"Line-Bot-與-Openai-SQL-成績查詢","published":1,"updated":"2026-01-28T14:17:25.060Z","_id":"cmkxfp4y1001b7z8zcaey0t99","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>參考來源 : <a href=\"https://www.youtube.com/watch?v=IfzY0axpjD8&t=333s\">https://www.youtube.com/watch?v=IfzY0axpjD8&amp;t=333s</a></p>\n<h2 id=\"基於-LINE-Bot-與-OpenAI-的-MySQL-學生成績管理系統教學文件\"><a href=\"#基於-LINE-Bot-與-OpenAI-的-MySQL-學生成績管理系統教學文件\" class=\"headerlink\" title=\"基於 LINE Bot 與 OpenAI 的 MySQL 學生成績管理系統教學文件\"></a>基於 LINE Bot 與 OpenAI 的 MySQL 學生成績管理系統教學文件</h2><h3 id=\"目錄\"><a href=\"#目錄\" class=\"headerlink\" title=\"目錄\"></a>目錄</h3><ol>\n<li>前言</li>\n<li>系統需求與工具</li>\n<li>資料庫設計與結構</li>\n<li>插入 15 位學生的資料</li>\n<li>為每位學生插入成績</li>\n<li>使用 OpenAI 生成 SQL 語句</li>\n<li>LINE Bot 與 OpenAI 整合</li>\n<li>查詢學生成績</li>\n<li>常見問題與解決方案</li>\n<li>結論</li>\n</ol>\n<hr>\n<h3 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1. 前言\"></a>1. 前言</h3><p>本教學文件將指導您如何建立一個基於 MySQL 的學生成績管理系統，並通過 LINE Bot 與 OpenAI 的整合來查詢和管理數據。我們將介紹如何使用 LINE Bot 接收訊息、OpenAI 自動生成 SQL 語句，並通過 MySQL 查詢學生的成績。</p>\n<hr>\n<h3 id=\"2-系統需求與工具\"><a href=\"#2-系統需求與工具\" class=\"headerlink\" title=\"2. 系統需求與工具\"></a>2. 系統需求與工具</h3><p><strong>系統需求：</strong></p>\n<ul>\n<li>安裝了 MySQL 伺服器</li>\n<li>Python 3 環境（Flask、OpenAI 和 LINE Bot SDK）</li>\n<li>MySQL 客戶端或管理工具（如 MySQL Workbench）</li>\n<li>OpenAI API 金鑰</li>\n<li>LINE Bot API 金鑰</li>\n</ul>\n<p><strong>工具：</strong></p>\n<ul>\n<li>MySQL 伺服器</li>\n<li>MySQL Workbench 或命令行工具</li>\n<li>LINE Bot 設定</li>\n<li>OpenAI API 設定</li>\n</ul>\n<hr>\n<h3 id=\"3-資料庫設計與結構\"><a href=\"#3-資料庫設計與結構\" class=\"headerlink\" title=\"3. 資料庫設計與結構\"></a>3. 資料庫設計與結構</h3><p>在本系統中，我們將創建兩個資料表：一個用來存儲學生的基本信息，另一個用來存儲學生的成績。</p>\n<h3 id=\"student-資料表結構：\"><a href=\"#student-資料表結構：\" class=\"headerlink\" title=\"student 資料表結構：\"></a><code>student</code> 資料表結構：</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> student (</span><br><span class=\"line\">    sno <span class=\"type\">INT</span> <span class=\"keyword\">PRIMARY</span> KEY,     <span class=\"comment\">-- 學號</span></span><br><span class=\"line\">    class <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>),       <span class=\"comment\">-- 班級</span></span><br><span class=\"line\">    name <span class=\"type\">VARCHAR</span>(<span class=\"number\">100</span>),       <span class=\"comment\">-- 學生姓名</span></span><br><span class=\"line\">    sex <span class=\"type\">VARCHAR</span>(<span class=\"number\">10</span>),         <span class=\"comment\">-- 性別</span></span><br><span class=\"line\">    address <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>),    <span class=\"comment\">-- 地址</span></span><br><span class=\"line\">    memo TEXT                <span class=\"comment\">-- 備註</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"score-資料表結構：\"><a href=\"#score-資料表結構：\" class=\"headerlink\" title=\"score 資料表結構：\"></a><code>score</code> 資料表結構：</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> score (</span><br><span class=\"line\">    sno <span class=\"type\">INT</span>,                 <span class=\"comment\">-- 學號 (外鍵)</span></span><br><span class=\"line\">    class <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>),       <span class=\"comment\">-- 班級</span></span><br><span class=\"line\">    subject <span class=\"type\">VARCHAR</span>(<span class=\"number\">100</span>),    <span class=\"comment\">-- 科目</span></span><br><span class=\"line\">    score <span class=\"type\">INT</span>                <span class=\"comment\">-- 成績</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>這兩個資料表使用 <code>sno</code> 欄位關聯，來管理學生的基本信息和成績。</p>\n<hr>\n<h3 id=\"4-插入-15-位學生的資料\"><a href=\"#4-插入-15-位學生的資料\" class=\"headerlink\" title=\"4. 插入 15 位學生的資料\"></a>4. 插入 15 位學生的資料</h3><p>接下來，我們將插入 15 位學生的資料：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> student (sno, class, name, sex, address, memo) <span class=\"keyword\">VALUES</span></span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;John Doe&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;123 Street A&#x27;</span>, <span class=\"string\">&#x27;Excellent performance&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">2</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;Jane Smith&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;456 Street B&#x27;</span>, <span class=\"string\">&#x27;Needs improvement in math&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">3</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;Alice Brown&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;789 Street C&#x27;</span>, <span class=\"string\">&#x27;Top student&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">4</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;Bob Johnson&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1010 Street D&#x27;</span>, <span class=\"string\">&#x27;New student&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">5</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;Charlie Davis&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1111 Street E&#x27;</span>, <span class=\"string\">&#x27;Struggles with homework&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">6</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;Diana White&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;1212 Street F&#x27;</span>, <span class=\"string\">&#x27;Shows great potential&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">7</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;Evan Green&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1313 Street G&#x27;</span>, <span class=\"string\">&#x27;Good participation&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">8</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;Fiona Blue&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;1414 Street H&#x27;</span>, <span class=\"string\">&#x27;Excellent attendance&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">9</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;George Black&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1515 Street I&#x27;</span>, <span class=\"string\">&#x27;Needs focus on studies&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">10</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;Hannah Yellow&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;1616 Street J&#x27;</span>, <span class=\"string\">&#x27;Very creative&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">11</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;Ivan Orange&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1717 Street K&#x27;</span>, <span class=\"string\">&#x27;Great in sports&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">12</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;Jenny Purple&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;1818 Street L&#x27;</span>, <span class=\"string\">&#x27;Good academic performance&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">13</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;Kevin Red&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1919 Street M&#x27;</span>, <span class=\"string\">&#x27;Enthusiastic in class&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">14</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;Lily Pink&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;2020 Street N&#x27;</span>, <span class=\"string\">&#x27;Hardworking student&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">15</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;Michael Cyan&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;2121 Street O&#x27;</span>, <span class=\"string\">&#x27;Quick learner&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-studens.png?alt=media&token=af046ad4-c41a-4823-88c8-d196058d3f32\" alt=\"student DB\"></p>\n<h3 id=\"5-為每位學生插入成績\"><a href=\"#5-為每位學生插入成績\" class=\"headerlink\" title=\"5. 為每位學生插入成績\"></a>5. 為每位學生插入成績</h3><p>接下來，我們為每位學生插入 <code>數學</code> 和 <code>國文</code> 的成績：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> score (sno, class, subject, score) <span class=\"keyword\">VALUES</span></span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">85</span>),</span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">90</span>),</span><br><span class=\"line\">(<span class=\"number\">2</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">78</span>),</span><br><span class=\"line\">(<span class=\"number\">2</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">88</span>),</span><br><span class=\"line\">(<span class=\"number\">3</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">92</span>),</span><br><span class=\"line\">(<span class=\"number\">3</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">95</span>),</span><br><span class=\"line\">(<span class=\"number\">4</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">76</span>),</span><br><span class=\"line\">(<span class=\"number\">4</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">85</span>),</span><br><span class=\"line\">(<span class=\"number\">5</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">82</span>),</span><br><span class=\"line\">(<span class=\"number\">5</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">89</span>),</span><br><span class=\"line\">(<span class=\"number\">6</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">88</span>),</span><br><span class=\"line\">(<span class=\"number\">6</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">91</span>),</span><br><span class=\"line\">(<span class=\"number\">7</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">90</span>),</span><br><span class=\"line\">(<span class=\"number\">7</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">87</span>),</span><br><span class=\"line\">(<span class=\"number\">8</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">85</span>),</span><br><span class=\"line\">(<span class=\"number\">8</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">92</span>),</span><br><span class=\"line\">(<span class=\"number\">9</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">80</span>),</span><br><span class=\"line\">(<span class=\"number\">9</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">90</span>),</span><br><span class=\"line\">(<span class=\"number\">10</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">87</span>),</span><br><span class=\"line\">(<span class=\"number\">10</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">88</span>),</span><br><span class=\"line\">(<span class=\"number\">11</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">89</span>),</span><br><span class=\"line\">(<span class=\"number\">11</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">91</span>),</span><br><span class=\"line\">(<span class=\"number\">12</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">94</span>),</span><br><span class=\"line\">(<span class=\"number\">12</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">96</span>),</span><br><span class=\"line\">(<span class=\"number\">13</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">75</span>),</span><br><span class=\"line\">(<span class=\"number\">13</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">85</span>),</span><br><span class=\"line\">(<span class=\"number\">14</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">88</span>),</span><br><span class=\"line\">(<span class=\"number\">14</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">92</span>),</span><br><span class=\"line\">(<span class=\"number\">15</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">93</span>),</span><br><span class=\"line\">(<span class=\"number\">15</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">95</span>);</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-score.png?alt=media&token=745ae4d1-f357-40d7-b972-81c299714061\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-score.png?alt=media&token=745ae4d1-f357-40d7-b972-81c299714061\" alt=\"student-score\"></a></p>\n<hr>\n<h3 id=\"6-使用-OpenAI-生成-SQL-語句\"><a href=\"#6-使用-OpenAI-生成-SQL-語句\" class=\"headerlink\" title=\"6. 使用 OpenAI 生成 SQL 語句\"></a>6. 使用 OpenAI 生成 SQL 語句</h3><p>當 LINE Bot 接收到查詢訊息時，會呼叫 OpenAI API 自動生成 SQL 查詢語句。以下是範例的整合程式碼片段：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">response = openai.ChatCompletion.create(</span><br><span class=\"line\">    model=<span class=\"string\">&quot;gpt-4o-mini&quot;</span>,</span><br><span class=\"line\">    messages=[</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;system&quot;</span>, <span class=\"string\">&quot;content&quot;</span>: <span class=\"string\">&quot;You are a helpful assistant that helps users query a MySQL database.&quot;</span>&#125;,</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;user&quot;</span>, <span class=\"string\">&quot;content&quot;</span>: event.message.text&#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    temperature=<span class=\"number\">0</span>,</span><br><span class=\"line\">    max_tokens=<span class=\"number\">400</span>,</span><br><span class=\"line\">    top_p=<span class=\"number\">1</span>,</span><br><span class=\"line\">    frequency_penalty=<span class=\"number\">0</span>,</span><br><span class=\"line\">    presence_penalty=<span class=\"number\">0</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"7-LINE-Bot-與-OpenAI-整合完整程式碼\"><a href=\"#7-LINE-Bot-與-OpenAI-整合完整程式碼\" class=\"headerlink\" title=\"7. LINE Bot 與 OpenAI 整合完整程式碼\"></a>7. LINE Bot 與 OpenAI 整合完整程式碼</h3><p>整合 LINE Bot 與 OpenAI API，並將接收到的查詢請求轉換為 SQL 查詢並從 MySQL 資料庫中提取資料。以下是完整的程式碼片段：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> openai</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, request, abort</span><br><span class=\"line\"><span class=\"keyword\">from</span> linebot <span class=\"keyword\">import</span> LineBotApi, WebhookHandler</span><br><span class=\"line\"><span class=\"keyword\">from</span> linebot.exceptions <span class=\"keyword\">import</span> InvalidSignatureError</span><br><span class=\"line\"><span class=\"keyword\">from</span> linebot.models <span class=\"keyword\">import</span> MessageEvent, TextMessage, TextSendMessage</span><br><span class=\"line\"><span class=\"keyword\">import</span> pymysql</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 設定 Linebot 的 Channel Access Token 和 Channel Secret</span></span><br><span class=\"line\"><span class=\"comment\"># 目前是 鈞皓科技 的 LineBot</span></span><br><span class=\"line\">line_bot_api = LineBotApi(<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">handler = WebhookHandler(<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 設定 OpenAI API 金鑰</span></span><br><span class=\"line\">openai.api_key = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 資料庫連接設定</span></span><br><span class=\"line\">db_settings = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;host&quot;</span>: <span class=\"string\">&quot;127.0.0.1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;port&quot;</span>: <span class=\"number\">3306</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;user&quot;</span>: <span class=\"string\">&quot;root&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;password&quot;</span>: <span class=\"string\">&quot;password&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;db&quot;</span>: <span class=\"string\">&quot;studentdb&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;charset&quot;</span>: <span class=\"string\">&quot;utf8&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">root</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello, World!&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/callback&quot;</span>, methods=[<span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">callback</span>():</span><br><span class=\"line\">    signature = request.headers[<span class=\"string\">&#x27;X-Line-Signature&#x27;</span>]</span><br><span class=\"line\">    body = request.get_data(as_text=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    app.logger.info(<span class=\"string\">&quot;Request body: &quot;</span> + body)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Request body: &quot;</span> + signature)</span><br><span class=\"line\">        handler.handle(body, signature)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> InvalidSignatureError:</span><br><span class=\"line\">        abort(<span class=\"number\">400</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;OK&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@handler.add(<span class=\"params\">MessageEvent, message=TextMessage</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">handle_message</span>(<span class=\"params\">event</span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 呼叫 OpenAI ChatCompletion API 來生成 SQL 語句</span></span><br><span class=\"line\">        response = openai.ChatCompletion.create(</span><br><span class=\"line\">            model=<span class=\"string\">&quot;gpt-4o-mini&quot;</span>,</span><br><span class=\"line\">            messages=[</span><br><span class=\"line\">                &#123;<span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;system&quot;</span>, <span class=\"string\">&quot;content&quot;</span>: <span class=\"string\">&quot;You are a helpful assistant that helps users query a MySQL database.&quot;</span>&#125;,</span><br><span class=\"line\">                &#123;<span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;user&quot;</span>, <span class=\"string\">&quot;content&quot;</span>: event.message.text&#125;</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            temperature=<span class=\"number\">0</span>,</span><br><span class=\"line\">            max_tokens=<span class=\"number\">400</span>,</span><br><span class=\"line\">            top_p=<span class=\"number\">1</span>,</span><br><span class=\"line\">            frequency_penalty=<span class=\"number\">0</span>,</span><br><span class=\"line\">            presence_penalty=<span class=\"number\">0</span></span><br><span class=\"line\">        )</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 處理 OpenAI 回應，過濾掉非 SQL 的部分</span></span><br><span class=\"line\">        response_text = response.choices[<span class=\"number\">0</span>].message[<span class=\"string\">&#x27;content&#x27;</span>].strip()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 使用正則表達式過濾掉註解和解釋部分，只保留 SQL 語句</span></span><br><span class=\"line\">        sql_match = re.search(<span class=\"string\">r&quot;SELECT.*?;&quot;</span>, response_text, re.DOTALL)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> sql_match:</span><br><span class=\"line\">            response_sql = sql_match.group(<span class=\"number\">0</span>).strip()  <span class=\"comment\"># 提取到 SQL 語句</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            response_sql = <span class=\"string\">&quot;&quot;</span>  <span class=\"comment\"># 如果沒有找到有效的 SQL，設為空</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 檢查是否有生成有效的 SQL 語句</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> response_sql:</span><br><span class=\"line\">            <span class=\"comment\"># 串接資料庫並執行 SQL 查詢</span></span><br><span class=\"line\">            conn = pymysql.connect(**db_settings)</span><br><span class=\"line\">            <span class=\"keyword\">with</span> conn.cursor() <span class=\"keyword\">as</span> cursor:</span><br><span class=\"line\">                command = response_sql.replace(<span class=\"string\">&quot;\\n&quot;</span>, <span class=\"string\">&quot; &quot;</span>)  <span class=\"comment\"># 移除多餘的換行符號</span></span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Executing SQL:&quot;</span>, command)</span><br><span class=\"line\">                cursor.execute(command)</span><br><span class=\"line\">                result = cursor.fetchall()</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 格式化查詢結果</span></span><br><span class=\"line\">            line_data = <span class=\"string\">&quot;class\\tsubject\\tscore\\n&quot;</span></span><br><span class=\"line\">            line_data += <span class=\"string\">&quot;-------------------\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">                line_data += <span class=\"string\">f&quot;<span class=\"subst\">&#123;row[<span class=\"number\">0</span>]&#125;</span>\\t<span class=\"subst\">&#123;row[<span class=\"number\">1</span>]&#125;</span>\\t<span class=\"subst\">&#123;row[<span class=\"number\">2</span>]&#125;</span>\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 回傳結果給 LINE 用戶</span></span><br><span class=\"line\">            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=response_sql + <span class=\"string\">&#x27;\\n&#x27;</span> + line_data))</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=<span class=\"string\">&quot;未能生成有效的 SQL 查詢語句。&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Error:&quot;</span>, e)</span><br><span class=\"line\">        line_bot_api.reply_message(event.reply_token, TextSendMessage(text=<span class=\"string\">&quot;發生錯誤，請稍後再試。&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    app.run()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8-Demo-時間\"><a href=\"#8-Demo-時間\" class=\"headerlink\" title=\"8. Demo 時間\"></a>8. Demo 時間</h3><p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2F%E6%88%AA%E5%9C%96%202024-10-02%20%E6%99%9A%E4%B8%8A8.14.39.png?alt=media&token=de5ac121-8dc2-4912-be23-0ac4a82635ca\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2F%E6%88%AA%E5%9C%96%202024-10-02%20%E6%99%9A%E4%B8%8A8.14.39.png?alt=media&token=de5ac121-8dc2-4912-be23-0ac4a82635ca\" alt=\"linebot-demo\"></a></p>\n","excerpt":"","more":"<p>參考來源 : <a href=\"https://www.youtube.com/watch?v=IfzY0axpjD8&t=333s\">https://www.youtube.com/watch?v=IfzY0axpjD8&amp;t=333s</a></p>\n<h2 id=\"基於-LINE-Bot-與-OpenAI-的-MySQL-學生成績管理系統教學文件\"><a href=\"#基於-LINE-Bot-與-OpenAI-的-MySQL-學生成績管理系統教學文件\" class=\"headerlink\" title=\"基於 LINE Bot 與 OpenAI 的 MySQL 學生成績管理系統教學文件\"></a>基於 LINE Bot 與 OpenAI 的 MySQL 學生成績管理系統教學文件</h2><h3 id=\"目錄\"><a href=\"#目錄\" class=\"headerlink\" title=\"目錄\"></a>目錄</h3><ol>\n<li>前言</li>\n<li>系統需求與工具</li>\n<li>資料庫設計與結構</li>\n<li>插入 15 位學生的資料</li>\n<li>為每位學生插入成績</li>\n<li>使用 OpenAI 生成 SQL 語句</li>\n<li>LINE Bot 與 OpenAI 整合</li>\n<li>查詢學生成績</li>\n<li>常見問題與解決方案</li>\n<li>結論</li>\n</ol>\n<hr>\n<h3 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1. 前言\"></a>1. 前言</h3><p>本教學文件將指導您如何建立一個基於 MySQL 的學生成績管理系統，並通過 LINE Bot 與 OpenAI 的整合來查詢和管理數據。我們將介紹如何使用 LINE Bot 接收訊息、OpenAI 自動生成 SQL 語句，並通過 MySQL 查詢學生的成績。</p>\n<hr>\n<h3 id=\"2-系統需求與工具\"><a href=\"#2-系統需求與工具\" class=\"headerlink\" title=\"2. 系統需求與工具\"></a>2. 系統需求與工具</h3><p><strong>系統需求：</strong></p>\n<ul>\n<li>安裝了 MySQL 伺服器</li>\n<li>Python 3 環境（Flask、OpenAI 和 LINE Bot SDK）</li>\n<li>MySQL 客戶端或管理工具（如 MySQL Workbench）</li>\n<li>OpenAI API 金鑰</li>\n<li>LINE Bot API 金鑰</li>\n</ul>\n<p><strong>工具：</strong></p>\n<ul>\n<li>MySQL 伺服器</li>\n<li>MySQL Workbench 或命令行工具</li>\n<li>LINE Bot 設定</li>\n<li>OpenAI API 設定</li>\n</ul>\n<hr>\n<h3 id=\"3-資料庫設計與結構\"><a href=\"#3-資料庫設計與結構\" class=\"headerlink\" title=\"3. 資料庫設計與結構\"></a>3. 資料庫設計與結構</h3><p>在本系統中，我們將創建兩個資料表：一個用來存儲學生的基本信息，另一個用來存儲學生的成績。</p>\n<h3 id=\"student-資料表結構：\"><a href=\"#student-資料表結構：\" class=\"headerlink\" title=\"student 資料表結構：\"></a><code>student</code> 資料表結構：</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> student (</span><br><span class=\"line\">    sno <span class=\"type\">INT</span> <span class=\"keyword\">PRIMARY</span> KEY,     <span class=\"comment\">-- 學號</span></span><br><span class=\"line\">    class <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>),       <span class=\"comment\">-- 班級</span></span><br><span class=\"line\">    name <span class=\"type\">VARCHAR</span>(<span class=\"number\">100</span>),       <span class=\"comment\">-- 學生姓名</span></span><br><span class=\"line\">    sex <span class=\"type\">VARCHAR</span>(<span class=\"number\">10</span>),         <span class=\"comment\">-- 性別</span></span><br><span class=\"line\">    address <span class=\"type\">VARCHAR</span>(<span class=\"number\">255</span>),    <span class=\"comment\">-- 地址</span></span><br><span class=\"line\">    memo TEXT                <span class=\"comment\">-- 備註</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"score-資料表結構：\"><a href=\"#score-資料表結構：\" class=\"headerlink\" title=\"score 資料表結構：\"></a><code>score</code> 資料表結構：</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> score (</span><br><span class=\"line\">    sno <span class=\"type\">INT</span>,                 <span class=\"comment\">-- 學號 (外鍵)</span></span><br><span class=\"line\">    class <span class=\"type\">VARCHAR</span>(<span class=\"number\">50</span>),       <span class=\"comment\">-- 班級</span></span><br><span class=\"line\">    subject <span class=\"type\">VARCHAR</span>(<span class=\"number\">100</span>),    <span class=\"comment\">-- 科目</span></span><br><span class=\"line\">    score <span class=\"type\">INT</span>                <span class=\"comment\">-- 成績</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>這兩個資料表使用 <code>sno</code> 欄位關聯，來管理學生的基本信息和成績。</p>\n<hr>\n<h3 id=\"4-插入-15-位學生的資料\"><a href=\"#4-插入-15-位學生的資料\" class=\"headerlink\" title=\"4. 插入 15 位學生的資料\"></a>4. 插入 15 位學生的資料</h3><p>接下來，我們將插入 15 位學生的資料：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> student (sno, class, name, sex, address, memo) <span class=\"keyword\">VALUES</span></span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;John Doe&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;123 Street A&#x27;</span>, <span class=\"string\">&#x27;Excellent performance&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">2</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;Jane Smith&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;456 Street B&#x27;</span>, <span class=\"string\">&#x27;Needs improvement in math&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">3</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;Alice Brown&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;789 Street C&#x27;</span>, <span class=\"string\">&#x27;Top student&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">4</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;Bob Johnson&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1010 Street D&#x27;</span>, <span class=\"string\">&#x27;New student&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">5</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;Charlie Davis&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1111 Street E&#x27;</span>, <span class=\"string\">&#x27;Struggles with homework&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">6</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;Diana White&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;1212 Street F&#x27;</span>, <span class=\"string\">&#x27;Shows great potential&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">7</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;Evan Green&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1313 Street G&#x27;</span>, <span class=\"string\">&#x27;Good participation&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">8</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;Fiona Blue&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;1414 Street H&#x27;</span>, <span class=\"string\">&#x27;Excellent attendance&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">9</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;George Black&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1515 Street I&#x27;</span>, <span class=\"string\">&#x27;Needs focus on studies&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">10</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;Hannah Yellow&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;1616 Street J&#x27;</span>, <span class=\"string\">&#x27;Very creative&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">11</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;Ivan Orange&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1717 Street K&#x27;</span>, <span class=\"string\">&#x27;Great in sports&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">12</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;Jenny Purple&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;1818 Street L&#x27;</span>, <span class=\"string\">&#x27;Good academic performance&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">13</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;Kevin Red&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;1919 Street M&#x27;</span>, <span class=\"string\">&#x27;Enthusiastic in class&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">14</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;Lily Pink&#x27;</span>, <span class=\"string\">&#x27;F&#x27;</span>, <span class=\"string\">&#x27;2020 Street N&#x27;</span>, <span class=\"string\">&#x27;Hardworking student&#x27;</span>),</span><br><span class=\"line\">(<span class=\"number\">15</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;Michael Cyan&#x27;</span>, <span class=\"string\">&#x27;M&#x27;</span>, <span class=\"string\">&#x27;2121 Street O&#x27;</span>, <span class=\"string\">&#x27;Quick learner&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-studens.png?alt=media&token=af046ad4-c41a-4823-88c8-d196058d3f32\" alt=\"student DB\"></p>\n<h3 id=\"5-為每位學生插入成績\"><a href=\"#5-為每位學生插入成績\" class=\"headerlink\" title=\"5. 為每位學生插入成績\"></a>5. 為每位學生插入成績</h3><p>接下來，我們為每位學生插入 <code>數學</code> 和 <code>國文</code> 的成績：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> score (sno, class, subject, score) <span class=\"keyword\">VALUES</span></span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">85</span>),</span><br><span class=\"line\">(<span class=\"number\">1</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">90</span>),</span><br><span class=\"line\">(<span class=\"number\">2</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">78</span>),</span><br><span class=\"line\">(<span class=\"number\">2</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">88</span>),</span><br><span class=\"line\">(<span class=\"number\">3</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">92</span>),</span><br><span class=\"line\">(<span class=\"number\">3</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">95</span>),</span><br><span class=\"line\">(<span class=\"number\">4</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">76</span>),</span><br><span class=\"line\">(<span class=\"number\">4</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">85</span>),</span><br><span class=\"line\">(<span class=\"number\">5</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">82</span>),</span><br><span class=\"line\">(<span class=\"number\">5</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">89</span>),</span><br><span class=\"line\">(<span class=\"number\">6</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">88</span>),</span><br><span class=\"line\">(<span class=\"number\">6</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">91</span>),</span><br><span class=\"line\">(<span class=\"number\">7</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">90</span>),</span><br><span class=\"line\">(<span class=\"number\">7</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">87</span>),</span><br><span class=\"line\">(<span class=\"number\">8</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">85</span>),</span><br><span class=\"line\">(<span class=\"number\">8</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">92</span>),</span><br><span class=\"line\">(<span class=\"number\">9</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">80</span>),</span><br><span class=\"line\">(<span class=\"number\">9</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">90</span>),</span><br><span class=\"line\">(<span class=\"number\">10</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">87</span>),</span><br><span class=\"line\">(<span class=\"number\">10</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">88</span>),</span><br><span class=\"line\">(<span class=\"number\">11</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">89</span>),</span><br><span class=\"line\">(<span class=\"number\">11</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">91</span>),</span><br><span class=\"line\">(<span class=\"number\">12</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">94</span>),</span><br><span class=\"line\">(<span class=\"number\">12</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">96</span>),</span><br><span class=\"line\">(<span class=\"number\">13</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">75</span>),</span><br><span class=\"line\">(<span class=\"number\">13</span>, <span class=\"string\">&#x27;Class 1&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">85</span>),</span><br><span class=\"line\">(<span class=\"number\">14</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">88</span>),</span><br><span class=\"line\">(<span class=\"number\">14</span>, <span class=\"string\">&#x27;Class 2&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">92</span>),</span><br><span class=\"line\">(<span class=\"number\">15</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;數學&#x27;</span>, <span class=\"number\">93</span>),</span><br><span class=\"line\">(<span class=\"number\">15</span>, <span class=\"string\">&#x27;Class 3&#x27;</span>, <span class=\"string\">&#x27;國文&#x27;</span>, <span class=\"number\">95</span>);</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-score.png?alt=media&token=745ae4d1-f357-40d7-b972-81c299714061\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2Fstudent-score.png?alt=media&token=745ae4d1-f357-40d7-b972-81c299714061\" alt=\"student-score\"></a></p>\n<hr>\n<h3 id=\"6-使用-OpenAI-生成-SQL-語句\"><a href=\"#6-使用-OpenAI-生成-SQL-語句\" class=\"headerlink\" title=\"6. 使用 OpenAI 生成 SQL 語句\"></a>6. 使用 OpenAI 生成 SQL 語句</h3><p>當 LINE Bot 接收到查詢訊息時，會呼叫 OpenAI API 自動生成 SQL 查詢語句。以下是範例的整合程式碼片段：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">response = openai.ChatCompletion.create(</span><br><span class=\"line\">    model=<span class=\"string\">&quot;gpt-4o-mini&quot;</span>,</span><br><span class=\"line\">    messages=[</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;system&quot;</span>, <span class=\"string\">&quot;content&quot;</span>: <span class=\"string\">&quot;You are a helpful assistant that helps users query a MySQL database.&quot;</span>&#125;,</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;user&quot;</span>, <span class=\"string\">&quot;content&quot;</span>: event.message.text&#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    temperature=<span class=\"number\">0</span>,</span><br><span class=\"line\">    max_tokens=<span class=\"number\">400</span>,</span><br><span class=\"line\">    top_p=<span class=\"number\">1</span>,</span><br><span class=\"line\">    frequency_penalty=<span class=\"number\">0</span>,</span><br><span class=\"line\">    presence_penalty=<span class=\"number\">0</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"7-LINE-Bot-與-OpenAI-整合完整程式碼\"><a href=\"#7-LINE-Bot-與-OpenAI-整合完整程式碼\" class=\"headerlink\" title=\"7. LINE Bot 與 OpenAI 整合完整程式碼\"></a>7. LINE Bot 與 OpenAI 整合完整程式碼</h3><p>整合 LINE Bot 與 OpenAI API，並將接收到的查詢請求轉換為 SQL 查詢並從 MySQL 資料庫中提取資料。以下是完整的程式碼片段：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> openai</span><br><span class=\"line\"><span class=\"keyword\">from</span> flask <span class=\"keyword\">import</span> Flask, request, abort</span><br><span class=\"line\"><span class=\"keyword\">from</span> linebot <span class=\"keyword\">import</span> LineBotApi, WebhookHandler</span><br><span class=\"line\"><span class=\"keyword\">from</span> linebot.exceptions <span class=\"keyword\">import</span> InvalidSignatureError</span><br><span class=\"line\"><span class=\"keyword\">from</span> linebot.models <span class=\"keyword\">import</span> MessageEvent, TextMessage, TextSendMessage</span><br><span class=\"line\"><span class=\"keyword\">import</span> pymysql</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">app = Flask(__name__)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 設定 Linebot 的 Channel Access Token 和 Channel Secret</span></span><br><span class=\"line\"><span class=\"comment\"># 目前是 鈞皓科技 的 LineBot</span></span><br><span class=\"line\">line_bot_api = LineBotApi(<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\">handler = WebhookHandler(<span class=\"string\">&#x27;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 設定 OpenAI API 金鑰</span></span><br><span class=\"line\">openai.api_key = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 資料庫連接設定</span></span><br><span class=\"line\">db_settings = &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;host&quot;</span>: <span class=\"string\">&quot;127.0.0.1&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;port&quot;</span>: <span class=\"number\">3306</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;user&quot;</span>: <span class=\"string\">&quot;root&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;password&quot;</span>: <span class=\"string\">&quot;password&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;db&quot;</span>: <span class=\"string\">&quot;studentdb&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;charset&quot;</span>: <span class=\"string\">&quot;utf8&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">root</span>():</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;Hello, World!&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@app.route(<span class=\"params\"><span class=\"string\">&quot;/callback&quot;</span>, methods=[<span class=\"string\">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">callback</span>():</span><br><span class=\"line\">    signature = request.headers[<span class=\"string\">&#x27;X-Line-Signature&#x27;</span>]</span><br><span class=\"line\">    body = request.get_data(as_text=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    app.logger.info(<span class=\"string\">&quot;Request body: &quot;</span> + body)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Request body: &quot;</span> + signature)</span><br><span class=\"line\">        handler.handle(body, signature)</span><br><span class=\"line\">    <span class=\"keyword\">except</span> InvalidSignatureError:</span><br><span class=\"line\">        abort(<span class=\"number\">400</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;OK&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@handler.add(<span class=\"params\">MessageEvent, message=TextMessage</span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">handle_message</span>(<span class=\"params\">event</span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"comment\"># 呼叫 OpenAI ChatCompletion API 來生成 SQL 語句</span></span><br><span class=\"line\">        response = openai.ChatCompletion.create(</span><br><span class=\"line\">            model=<span class=\"string\">&quot;gpt-4o-mini&quot;</span>,</span><br><span class=\"line\">            messages=[</span><br><span class=\"line\">                &#123;<span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;system&quot;</span>, <span class=\"string\">&quot;content&quot;</span>: <span class=\"string\">&quot;You are a helpful assistant that helps users query a MySQL database.&quot;</span>&#125;,</span><br><span class=\"line\">                &#123;<span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;user&quot;</span>, <span class=\"string\">&quot;content&quot;</span>: event.message.text&#125;</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            temperature=<span class=\"number\">0</span>,</span><br><span class=\"line\">            max_tokens=<span class=\"number\">400</span>,</span><br><span class=\"line\">            top_p=<span class=\"number\">1</span>,</span><br><span class=\"line\">            frequency_penalty=<span class=\"number\">0</span>,</span><br><span class=\"line\">            presence_penalty=<span class=\"number\">0</span></span><br><span class=\"line\">        )</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 處理 OpenAI 回應，過濾掉非 SQL 的部分</span></span><br><span class=\"line\">        response_text = response.choices[<span class=\"number\">0</span>].message[<span class=\"string\">&#x27;content&#x27;</span>].strip()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 使用正則表達式過濾掉註解和解釋部分，只保留 SQL 語句</span></span><br><span class=\"line\">        sql_match = re.search(<span class=\"string\">r&quot;SELECT.*?;&quot;</span>, response_text, re.DOTALL)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> sql_match:</span><br><span class=\"line\">            response_sql = sql_match.group(<span class=\"number\">0</span>).strip()  <span class=\"comment\"># 提取到 SQL 語句</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            response_sql = <span class=\"string\">&quot;&quot;</span>  <span class=\"comment\"># 如果沒有找到有效的 SQL，設為空</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 檢查是否有生成有效的 SQL 語句</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> response_sql:</span><br><span class=\"line\">            <span class=\"comment\"># 串接資料庫並執行 SQL 查詢</span></span><br><span class=\"line\">            conn = pymysql.connect(**db_settings)</span><br><span class=\"line\">            <span class=\"keyword\">with</span> conn.cursor() <span class=\"keyword\">as</span> cursor:</span><br><span class=\"line\">                command = response_sql.replace(<span class=\"string\">&quot;\\n&quot;</span>, <span class=\"string\">&quot; &quot;</span>)  <span class=\"comment\"># 移除多餘的換行符號</span></span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Executing SQL:&quot;</span>, command)</span><br><span class=\"line\">                cursor.execute(command)</span><br><span class=\"line\">                result = cursor.fetchall()</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 格式化查詢結果</span></span><br><span class=\"line\">            line_data = <span class=\"string\">&quot;class\\tsubject\\tscore\\n&quot;</span></span><br><span class=\"line\">            line_data += <span class=\"string\">&quot;-------------------\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> result:</span><br><span class=\"line\">                line_data += <span class=\"string\">f&quot;<span class=\"subst\">&#123;row[<span class=\"number\">0</span>]&#125;</span>\\t<span class=\"subst\">&#123;row[<span class=\"number\">1</span>]&#125;</span>\\t<span class=\"subst\">&#123;row[<span class=\"number\">2</span>]&#125;</span>\\n&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\"># 回傳結果給 LINE 用戶</span></span><br><span class=\"line\">            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=response_sql + <span class=\"string\">&#x27;\\n&#x27;</span> + line_data))</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            line_bot_api.reply_message(event.reply_token, TextSendMessage(text=<span class=\"string\">&quot;未能生成有效的 SQL 查詢語句。&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">except</span> Exception <span class=\"keyword\">as</span> e:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Error:&quot;</span>, e)</span><br><span class=\"line\">        line_bot_api.reply_message(event.reply_token, TextSendMessage(text=<span class=\"string\">&quot;發生錯誤，請稍後再試。&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    app.run()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8-Demo-時間\"><a href=\"#8-Demo-時間\" class=\"headerlink\" title=\"8. Demo 時間\"></a>8. Demo 時間</h3><p><a href=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2F%E6%88%AA%E5%9C%96%202024-10-02%20%E6%99%9A%E4%B8%8A8.14.39.png?alt=media&token=de5ac121-8dc2-4912-be23-0ac4a82635ca\"><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FLine-Bot%E5%92%8Cgpt%E5%AF%A6%E6%88%B0%E6%95%99%E5%AD%B8%2Fstudent-score%2F%E6%88%AA%E5%9C%96%202024-10-02%20%E6%99%9A%E4%B8%8A8.14.39.png?alt=media&token=de5ac121-8dc2-4912-be23-0ac4a82635ca\" alt=\"linebot-demo\"></a></p>\n"},{"layout":"post","title":"Mac Django 建置環境","date":"2024-10-01T05:43:31.000Z","top_img":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fdjango%20logo.jpeg?alt=media&token=8bc6ff88-240d-4df6-af8f-3e33bf72140f","cover":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fdjango%20logo.jpeg?alt=media&token=8bc6ff88-240d-4df6-af8f-3e33bf72140f","_content":"\n### **macOS 上下載並安裝 Django 教學指南（不使用虛擬環境，並加入 PATH 教學）**\n\n#### **步驟 1：確認安裝 Homebrew（可選）**\n\n如果你還沒有安裝 Homebrew，可以按照以下指令來安裝。Homebrew 是 macOS 上的包管理器，方便你安裝和管理軟件：\n\n1. 打開「終端機」(Terminal)，輸入以下指令來安裝 Homebrew：\n   ```bash\n   /bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n   ```\n2. 等待 Homebrew 安裝完成，然後更新 Homebrew：\n   ```bash\n   brew update\n   ```\n\n#### **步驟 2：安裝 Python 3**\n\n1. 確認是否已安裝 Python 3：\n   ```bash\n   python3 --version\n   ```\n   如果沒有安裝或版本過舊，可以使用 Homebrew 安裝最新的 Python 3：\n   ```bash\n   brew install python3\n   ```\n\n#### **步驟 3：安裝 Django**\n\n1. 確保 Python 3 已經安裝，然後使用 `pip3` 安裝 Django：\n\n   ```bash\n   pip3 install django\n   ```\n\n2. 安裝完成後，檢查 Django 是否已安裝成功：\n   ```bash\n   django-admin --version\n   ```\n   如果指令執行成功，會顯示 Django 的版本號，例如 `4.2.16`。\n\n#### **步驟 4：創建 Django 專案**\n\n1. 使用 `django-admin` 創建一個新專案。首先，進入你想要創建專案的目錄，然後執行以下指令：\n\n   ```bash\n   django-admin startproject <project-name>\n   ```\n\n   例如：\n\n   ```bash\n   django-admin startproject mysite\n   ```\n\n2. 進入專案目錄並運行開發伺服器：\n   ```bash\n   cd mysite\n   python3 manage.py runserver\n   ```\n   終端應顯示伺服器正在 `http://127.0.0.1:8000/` 運行。打開瀏覽器並輸入這個地址來查看 Django 的初始畫面。\n\n#### **步驟 5：解決常見錯誤**\n\n##### **`django-admin: command not found` 問題解決**\n\n如果安裝 Django 後出現 `django-admin: command not found` 錯誤，這可能是因為 Python 的執行檔沒有在系統的 PATH 中。請依照以下步驟來手動加入 PATH：\n\n1. 找到 `django-admin` 安裝路徑。根據你之前提供的資訊，Django 安裝在以下路徑：\n\n   ```\n   /Users/zhuang/Library/Python/3.9/bin\n   ```\n\n2. 在終端機中暫時添加此路徑到 PATH：\n\n   ```bash\n   export PATH=\"$PATH:/Users/zhuang/Library/Python/3.9/bin\"\n   ```\n\n3. 要使這個變更永久生效，打開或編輯 `~/.zshrc` 檔案，並將以下內容添加到檔案末尾：\n\n   ```bash\n   export PATH=\"$PATH:/Users/zhuang/Library/Python/3.9/bin\"\n   ```\n\n4. 保存檔案後，執行以下指令來使變更生效：\n\n   ```bash\n   source ~/.zshrc\n   ```\n\n5. 完成後，檢查是否可以正常使用 `django-admin`：\n   ```bash\n   django-admin --version\n   ```\n\n#### **總結**\n\n這樣你就能在 macOS 上成功下載、安裝並配置 Django，並解決了 PATH 相關的問題。\n","source":"_posts/Mac-Django-建置環境.md","raw":"---\nlayout: post\ntitle: Mac Django 建置環境\ndate: 2024-10-01 13:43:31\ntags:\n  - \"Python Django\"\ncategories:\n  - \"Python\"\n  - \"Django\"\ntop_img: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fdjango%20logo.jpeg?alt=media&token=8bc6ff88-240d-4df6-af8f-3e33bf72140f\"\ncover: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FDjango%2Fdjango%20logo.jpeg?alt=media&token=8bc6ff88-240d-4df6-af8f-3e33bf72140f\"\n---\n\n### **macOS 上下載並安裝 Django 教學指南（不使用虛擬環境，並加入 PATH 教學）**\n\n#### **步驟 1：確認安裝 Homebrew（可選）**\n\n如果你還沒有安裝 Homebrew，可以按照以下指令來安裝。Homebrew 是 macOS 上的包管理器，方便你安裝和管理軟件：\n\n1. 打開「終端機」(Terminal)，輸入以下指令來安裝 Homebrew：\n   ```bash\n   /bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n   ```\n2. 等待 Homebrew 安裝完成，然後更新 Homebrew：\n   ```bash\n   brew update\n   ```\n\n#### **步驟 2：安裝 Python 3**\n\n1. 確認是否已安裝 Python 3：\n   ```bash\n   python3 --version\n   ```\n   如果沒有安裝或版本過舊，可以使用 Homebrew 安裝最新的 Python 3：\n   ```bash\n   brew install python3\n   ```\n\n#### **步驟 3：安裝 Django**\n\n1. 確保 Python 3 已經安裝，然後使用 `pip3` 安裝 Django：\n\n   ```bash\n   pip3 install django\n   ```\n\n2. 安裝完成後，檢查 Django 是否已安裝成功：\n   ```bash\n   django-admin --version\n   ```\n   如果指令執行成功，會顯示 Django 的版本號，例如 `4.2.16`。\n\n#### **步驟 4：創建 Django 專案**\n\n1. 使用 `django-admin` 創建一個新專案。首先，進入你想要創建專案的目錄，然後執行以下指令：\n\n   ```bash\n   django-admin startproject <project-name>\n   ```\n\n   例如：\n\n   ```bash\n   django-admin startproject mysite\n   ```\n\n2. 進入專案目錄並運行開發伺服器：\n   ```bash\n   cd mysite\n   python3 manage.py runserver\n   ```\n   終端應顯示伺服器正在 `http://127.0.0.1:8000/` 運行。打開瀏覽器並輸入這個地址來查看 Django 的初始畫面。\n\n#### **步驟 5：解決常見錯誤**\n\n##### **`django-admin: command not found` 問題解決**\n\n如果安裝 Django 後出現 `django-admin: command not found` 錯誤，這可能是因為 Python 的執行檔沒有在系統的 PATH 中。請依照以下步驟來手動加入 PATH：\n\n1. 找到 `django-admin` 安裝路徑。根據你之前提供的資訊，Django 安裝在以下路徑：\n\n   ```\n   /Users/zhuang/Library/Python/3.9/bin\n   ```\n\n2. 在終端機中暫時添加此路徑到 PATH：\n\n   ```bash\n   export PATH=\"$PATH:/Users/zhuang/Library/Python/3.9/bin\"\n   ```\n\n3. 要使這個變更永久生效，打開或編輯 `~/.zshrc` 檔案，並將以下內容添加到檔案末尾：\n\n   ```bash\n   export PATH=\"$PATH:/Users/zhuang/Library/Python/3.9/bin\"\n   ```\n\n4. 保存檔案後，執行以下指令來使變更生效：\n\n   ```bash\n   source ~/.zshrc\n   ```\n\n5. 完成後，檢查是否可以正常使用 `django-admin`：\n   ```bash\n   django-admin --version\n   ```\n\n#### **總結**\n\n這樣你就能在 macOS 上成功下載、安裝並配置 Django，並解決了 PATH 相關的問題。\n","slug":"Mac-Django-建置環境","published":1,"updated":"2026-01-28T14:17:25.062Z","_id":"cmkxfp4y1001e7z8z74ma6040","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"macOS-上下載並安裝-Django-教學指南（不使用虛擬環境，並加入-PATH-教學）\"><a href=\"#macOS-上下載並安裝-Django-教學指南（不使用虛擬環境，並加入-PATH-教學）\" class=\"headerlink\" title=\"macOS 上下載並安裝 Django 教學指南（不使用虛擬環境，並加入 PATH 教學）\"></a><strong>macOS 上下載並安裝 Django 教學指南（不使用虛擬環境，並加入 PATH 教學）</strong></h3><h4 id=\"步驟-1：確認安裝-Homebrew（可選）\"><a href=\"#步驟-1：確認安裝-Homebrew（可選）\" class=\"headerlink\" title=\"步驟 1：確認安裝 Homebrew（可選）\"></a><strong>步驟 1：確認安裝 Homebrew（可選）</strong></h4><p>如果你還沒有安裝 Homebrew，可以按照以下指令來安裝。Homebrew 是 macOS 上的包管理器，方便你安裝和管理軟件：</p>\n<ol>\n<li>打開「終端機」(Terminal)，輸入以下指令來安裝 Homebrew：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure></li>\n<li>等待 Homebrew 安裝完成，然後更新 Homebrew：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew update</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"步驟-2：安裝-Python-3\"><a href=\"#步驟-2：安裝-Python-3\" class=\"headerlink\" title=\"步驟 2：安裝 Python 3\"></a><strong>步驟 2：安裝 Python 3</strong></h4><ol>\n<li>確認是否已安裝 Python 3：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 --version</span><br></pre></td></tr></table></figure>\n如果沒有安裝或版本過舊，可以使用 Homebrew 安裝最新的 Python 3：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install python3</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"步驟-3：安裝-Django\"><a href=\"#步驟-3：安裝-Django\" class=\"headerlink\" title=\"步驟 3：安裝 Django\"></a><strong>步驟 3：安裝 Django</strong></h4><ol>\n<li><p>確保 Python 3 已經安裝，然後使用 <code>pip3</code> 安裝 Django：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install django</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安裝完成後，檢查 Django 是否已安裝成功：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin --version</span><br></pre></td></tr></table></figure>\n<p>如果指令執行成功，會顯示 Django 的版本號，例如 <code>4.2.16</code>。</p>\n</li>\n</ol>\n<h4 id=\"步驟-4：創建-Django-專案\"><a href=\"#步驟-4：創建-Django-專案\" class=\"headerlink\" title=\"步驟 4：創建 Django 專案\"></a><strong>步驟 4：創建 Django 專案</strong></h4><ol>\n<li><p>使用 <code>django-admin</code> 創建一個新專案。首先，進入你想要創建專案的目錄，然後執行以下指令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin startproject &lt;project-name&gt;</span><br></pre></td></tr></table></figure>\n\n<p>例如：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin startproject mysite</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>進入專案目錄並運行開發伺服器：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> mysite</span><br><span class=\"line\">python3 manage.py runserver</span><br></pre></td></tr></table></figure>\n<p>終端應顯示伺服器正在 <code>http://127.0.0.1:8000/</code> 運行。打開瀏覽器並輸入這個地址來查看 Django 的初始畫面。</p>\n</li>\n</ol>\n<h4 id=\"步驟-5：解決常見錯誤\"><a href=\"#步驟-5：解決常見錯誤\" class=\"headerlink\" title=\"步驟 5：解決常見錯誤\"></a><strong>步驟 5：解決常見錯誤</strong></h4><h5 id=\"django-admin-command-not-found-問題解決\"><a href=\"#django-admin-command-not-found-問題解決\" class=\"headerlink\" title=\"django-admin: command not found 問題解決\"></a><strong><code>django-admin: command not found</code> 問題解決</strong></h5><p>如果安裝 Django 後出現 <code>django-admin: command not found</code> 錯誤，這可能是因為 Python 的執行檔沒有在系統的 PATH 中。請依照以下步驟來手動加入 PATH：</p>\n<ol>\n<li><p>找到 <code>django-admin</code> 安裝路徑。根據你之前提供的資訊，Django 安裝在以下路徑：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/Users/zhuang/Library/Python/3.9/bin</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在終端機中暫時添加此路徑到 PATH：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"string\">&quot;<span class=\"variable\">$PATH</span>:/Users/zhuang/Library/Python/3.9/bin&quot;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>要使這個變更永久生效，打開或編輯 <code>~/.zshrc</code> 檔案，並將以下內容添加到檔案末尾：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"string\">&quot;<span class=\"variable\">$PATH</span>:/Users/zhuang/Library/Python/3.9/bin&quot;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>保存檔案後，執行以下指令來使變更生效：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>完成後，檢查是否可以正常使用 <code>django-admin</code>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin --version</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"總結\"><a href=\"#總結\" class=\"headerlink\" title=\"總結\"></a><strong>總結</strong></h4><p>這樣你就能在 macOS 上成功下載、安裝並配置 Django，並解決了 PATH 相關的問題。</p>\n","excerpt":"","more":"<h3 id=\"macOS-上下載並安裝-Django-教學指南（不使用虛擬環境，並加入-PATH-教學）\"><a href=\"#macOS-上下載並安裝-Django-教學指南（不使用虛擬環境，並加入-PATH-教學）\" class=\"headerlink\" title=\"macOS 上下載並安裝 Django 教學指南（不使用虛擬環境，並加入 PATH 教學）\"></a><strong>macOS 上下載並安裝 Django 教學指南（不使用虛擬環境，並加入 PATH 教學）</strong></h3><h4 id=\"步驟-1：確認安裝-Homebrew（可選）\"><a href=\"#步驟-1：確認安裝-Homebrew（可選）\" class=\"headerlink\" title=\"步驟 1：確認安裝 Homebrew（可選）\"></a><strong>步驟 1：確認安裝 Homebrew（可選）</strong></h4><p>如果你還沒有安裝 Homebrew，可以按照以下指令來安裝。Homebrew 是 macOS 上的包管理器，方便你安裝和管理軟件：</p>\n<ol>\n<li>打開「終端機」(Terminal)，輸入以下指令來安裝 Homebrew：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/bin/bash -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure></li>\n<li>等待 Homebrew 安裝完成，然後更新 Homebrew：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew update</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"步驟-2：安裝-Python-3\"><a href=\"#步驟-2：安裝-Python-3\" class=\"headerlink\" title=\"步驟 2：安裝 Python 3\"></a><strong>步驟 2：安裝 Python 3</strong></h4><ol>\n<li>確認是否已安裝 Python 3：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python3 --version</span><br></pre></td></tr></table></figure>\n如果沒有安裝或版本過舊，可以使用 Homebrew 安裝最新的 Python 3：<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install python3</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"步驟-3：安裝-Django\"><a href=\"#步驟-3：安裝-Django\" class=\"headerlink\" title=\"步驟 3：安裝 Django\"></a><strong>步驟 3：安裝 Django</strong></h4><ol>\n<li><p>確保 Python 3 已經安裝，然後使用 <code>pip3</code> 安裝 Django：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip3 install django</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安裝完成後，檢查 Django 是否已安裝成功：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin --version</span><br></pre></td></tr></table></figure>\n<p>如果指令執行成功，會顯示 Django 的版本號，例如 <code>4.2.16</code>。</p>\n</li>\n</ol>\n<h4 id=\"步驟-4：創建-Django-專案\"><a href=\"#步驟-4：創建-Django-專案\" class=\"headerlink\" title=\"步驟 4：創建 Django 專案\"></a><strong>步驟 4：創建 Django 專案</strong></h4><ol>\n<li><p>使用 <code>django-admin</code> 創建一個新專案。首先，進入你想要創建專案的目錄，然後執行以下指令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin startproject &lt;project-name&gt;</span><br></pre></td></tr></table></figure>\n\n<p>例如：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin startproject mysite</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>進入專案目錄並運行開發伺服器：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> mysite</span><br><span class=\"line\">python3 manage.py runserver</span><br></pre></td></tr></table></figure>\n<p>終端應顯示伺服器正在 <code>http://127.0.0.1:8000/</code> 運行。打開瀏覽器並輸入這個地址來查看 Django 的初始畫面。</p>\n</li>\n</ol>\n<h4 id=\"步驟-5：解決常見錯誤\"><a href=\"#步驟-5：解決常見錯誤\" class=\"headerlink\" title=\"步驟 5：解決常見錯誤\"></a><strong>步驟 5：解決常見錯誤</strong></h4><h5 id=\"django-admin-command-not-found-問題解決\"><a href=\"#django-admin-command-not-found-問題解決\" class=\"headerlink\" title=\"django-admin: command not found 問題解決\"></a><strong><code>django-admin: command not found</code> 問題解決</strong></h5><p>如果安裝 Django 後出現 <code>django-admin: command not found</code> 錯誤，這可能是因為 Python 的執行檔沒有在系統的 PATH 中。請依照以下步驟來手動加入 PATH：</p>\n<ol>\n<li><p>找到 <code>django-admin</code> 安裝路徑。根據你之前提供的資訊，Django 安裝在以下路徑：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/Users/zhuang/Library/Python/3.9/bin</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在終端機中暫時添加此路徑到 PATH：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"string\">&quot;<span class=\"variable\">$PATH</span>:/Users/zhuang/Library/Python/3.9/bin&quot;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>要使這個變更永久生效，打開或編輯 <code>~/.zshrc</code> 檔案，並將以下內容添加到檔案末尾：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"string\">&quot;<span class=\"variable\">$PATH</span>:/Users/zhuang/Library/Python/3.9/bin&quot;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>保存檔案後，執行以下指令來使變更生效：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>完成後，檢查是否可以正常使用 <code>django-admin</code>：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">django-admin --version</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"總結\"><a href=\"#總結\" class=\"headerlink\" title=\"總結\"></a><strong>總結</strong></h4><p>這樣你就能在 macOS 上成功下載、安裝並配置 Django，並解決了 PATH 相關的問題。</p>\n"},{"layout":"post","title":"UVA 10420 - List of Conquests","date":"2024-09-17T06:39:31.000Z","top_img":"/images/CPE_sub.webp","cover":"/images/CPE.webp","_content":"\n## 題目描述\n\n題要求我們統計來自不同國家的名字出現次數。輸入包括多行，每行以一個國家名稱開頭，後接一個人名。我們只需要統計每個國家出現的次數，而不需要考慮人名。\n\n- 題目來源：[UVA 10420 - List of Conquests](https://onlinejudge.org/external/104/10420.pdf)\n\n## 解題思路\n\n1. **輸入處理**：每行的輸入以國家名稱開頭，後面跟著人名。我們只需要提取每行中的國家名稱並忽略後面的內容。\n2. **統計國家出現次數**：我們可以使用 `map` 來儲存國家名稱和對應的出現次數。\n3. **排序與輸出**：`map` 會自動根據國家名稱字典序進行排序，因此輸出時會直接按順序列出。\n\n### 步驟：\n\n1. **讀取輸入行數**：首先讀取輸入的總行數。\n2. **讀取每行的國家名稱**：使用 `getline()` 函數讀取整行，並透過 `find()` 函數找到第一個空格來提取國家名稱。\n3. **統計國家出現次數**：利用 `map` 來儲存每個國家的出現次數。\n4. **輸出結果**：遍歷 `map`，輸出國家名稱及其出現次數。\n\n## 程式碼\n\n```cpp\n#include <iostream>\n#include <map>\n#include <string>\nusing namespace std;\n\nint main()\n{\n    int number;\n    string country;\n    cin >> number;\n    cin.ignore();\n\n    map<string, int> country_count;\n\n    while(number--) {\n        string line;\n        getline(cin, line);\n        int pos = line.find(' ');\n        country = line.substr(0, pos);\n        country_count[country]++;\n    }\n\n    // 輸出結果\n    for(const pair<string, int>& entry : country_count) {\n        cout << entry.first << \" \" << entry.second << endl;\n    }\n\n    return 0;\n}\n```\n","source":"_posts/UVA-10420-List-of-Conquests.md","raw":"---\nlayout: post\ntitle: UVA 10420 - List of Conquests\ndate: 2024-09-17 14:39:31\ntags:\n  - \"CPE\"\ncategories:\n  - \"程式解題\"\n  - \"CPE49題\"\ntop_img: /images/CPE_sub.webp\ncover: /images/CPE.webp\n---\n\n## 題目描述\n\n題要求我們統計來自不同國家的名字出現次數。輸入包括多行，每行以一個國家名稱開頭，後接一個人名。我們只需要統計每個國家出現的次數，而不需要考慮人名。\n\n- 題目來源：[UVA 10420 - List of Conquests](https://onlinejudge.org/external/104/10420.pdf)\n\n## 解題思路\n\n1. **輸入處理**：每行的輸入以國家名稱開頭，後面跟著人名。我們只需要提取每行中的國家名稱並忽略後面的內容。\n2. **統計國家出現次數**：我們可以使用 `map` 來儲存國家名稱和對應的出現次數。\n3. **排序與輸出**：`map` 會自動根據國家名稱字典序進行排序，因此輸出時會直接按順序列出。\n\n### 步驟：\n\n1. **讀取輸入行數**：首先讀取輸入的總行數。\n2. **讀取每行的國家名稱**：使用 `getline()` 函數讀取整行，並透過 `find()` 函數找到第一個空格來提取國家名稱。\n3. **統計國家出現次數**：利用 `map` 來儲存每個國家的出現次數。\n4. **輸出結果**：遍歷 `map`，輸出國家名稱及其出現次數。\n\n## 程式碼\n\n```cpp\n#include <iostream>\n#include <map>\n#include <string>\nusing namespace std;\n\nint main()\n{\n    int number;\n    string country;\n    cin >> number;\n    cin.ignore();\n\n    map<string, int> country_count;\n\n    while(number--) {\n        string line;\n        getline(cin, line);\n        int pos = line.find(' ');\n        country = line.substr(0, pos);\n        country_count[country]++;\n    }\n\n    // 輸出結果\n    for(const pair<string, int>& entry : country_count) {\n        cout << entry.first << \" \" << entry.second << endl;\n    }\n\n    return 0;\n}\n```\n","slug":"UVA-10420-List-of-Conquests","published":1,"updated":"2026-01-28T14:17:25.062Z","_id":"cmkxfp4y2001g7z8z1oez9cwh","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"題目描述\"><a href=\"#題目描述\" class=\"headerlink\" title=\"題目描述\"></a>題目描述</h2><p>題要求我們統計來自不同國家的名字出現次數。輸入包括多行，每行以一個國家名稱開頭，後接一個人名。我們只需要統計每個國家出現的次數，而不需要考慮人名。</p>\n<ul>\n<li>題目來源：<a href=\"https://onlinejudge.org/external/104/10420.pdf\">UVA 10420 - List of Conquests</a></li>\n</ul>\n<h2 id=\"解題思路\"><a href=\"#解題思路\" class=\"headerlink\" title=\"解題思路\"></a>解題思路</h2><ol>\n<li><strong>輸入處理</strong>：每行的輸入以國家名稱開頭，後面跟著人名。我們只需要提取每行中的國家名稱並忽略後面的內容。</li>\n<li><strong>統計國家出現次數</strong>：我們可以使用 <code>map</code> 來儲存國家名稱和對應的出現次數。</li>\n<li><strong>排序與輸出</strong>：<code>map</code> 會自動根據國家名稱字典序進行排序，因此輸出時會直接按順序列出。</li>\n</ol>\n<h3 id=\"步驟：\"><a href=\"#步驟：\" class=\"headerlink\" title=\"步驟：\"></a>步驟：</h3><ol>\n<li><strong>讀取輸入行數</strong>：首先讀取輸入的總行數。</li>\n<li><strong>讀取每行的國家名稱</strong>：使用 <code>getline()</code> 函數讀取整行，並透過 <code>find()</code> 函數找到第一個空格來提取國家名稱。</li>\n<li><strong>統計國家出現次數</strong>：利用 <code>map</code> 來儲存每個國家的出現次數。</li>\n<li><strong>輸出結果</strong>：遍歷 <code>map</code>，輸出國家名稱及其出現次數。</li>\n</ol>\n<h2 id=\"程式碼\"><a href=\"#程式碼\" class=\"headerlink\" title=\"程式碼\"></a>程式碼</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;string&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> number;</span><br><span class=\"line\">    string country;</span><br><span class=\"line\">    cin &gt;&gt; number;</span><br><span class=\"line\">    cin.<span class=\"built_in\">ignore</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    map&lt;string, <span class=\"type\">int</span>&gt; country_count;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(number--) &#123;</span><br><span class=\"line\">        string line;</span><br><span class=\"line\">        <span class=\"built_in\">getline</span>(cin, line);</span><br><span class=\"line\">        <span class=\"type\">int</span> pos = line.<span class=\"built_in\">find</span>(<span class=\"string\">&#x27; &#x27;</span>);</span><br><span class=\"line\">        country = line.<span class=\"built_in\">substr</span>(<span class=\"number\">0</span>, pos);</span><br><span class=\"line\">        country_count[country]++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 輸出結果</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">const</span> pair&lt;string, <span class=\"type\">int</span>&gt;&amp; entry : country_count) &#123;</span><br><span class=\"line\">        cout &lt;&lt; entry.first &lt;&lt; <span class=\"string\">&quot; &quot;</span> &lt;&lt; entry.second &lt;&lt; endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","excerpt":"","more":"<h2 id=\"題目描述\"><a href=\"#題目描述\" class=\"headerlink\" title=\"題目描述\"></a>題目描述</h2><p>題要求我們統計來自不同國家的名字出現次數。輸入包括多行，每行以一個國家名稱開頭，後接一個人名。我們只需要統計每個國家出現的次數，而不需要考慮人名。</p>\n<ul>\n<li>題目來源：<a href=\"https://onlinejudge.org/external/104/10420.pdf\">UVA 10420 - List of Conquests</a></li>\n</ul>\n<h2 id=\"解題思路\"><a href=\"#解題思路\" class=\"headerlink\" title=\"解題思路\"></a>解題思路</h2><ol>\n<li><strong>輸入處理</strong>：每行的輸入以國家名稱開頭，後面跟著人名。我們只需要提取每行中的國家名稱並忽略後面的內容。</li>\n<li><strong>統計國家出現次數</strong>：我們可以使用 <code>map</code> 來儲存國家名稱和對應的出現次數。</li>\n<li><strong>排序與輸出</strong>：<code>map</code> 會自動根據國家名稱字典序進行排序，因此輸出時會直接按順序列出。</li>\n</ol>\n<h3 id=\"步驟：\"><a href=\"#步驟：\" class=\"headerlink\" title=\"步驟：\"></a>步驟：</h3><ol>\n<li><strong>讀取輸入行數</strong>：首先讀取輸入的總行數。</li>\n<li><strong>讀取每行的國家名稱</strong>：使用 <code>getline()</code> 函數讀取整行，並透過 <code>find()</code> 函數找到第一個空格來提取國家名稱。</li>\n<li><strong>統計國家出現次數</strong>：利用 <code>map</code> 來儲存每個國家的出現次數。</li>\n<li><strong>輸出結果</strong>：遍歷 <code>map</code>，輸出國家名稱及其出現次數。</li>\n</ol>\n<h2 id=\"程式碼\"><a href=\"#程式碼\" class=\"headerlink\" title=\"程式碼\"></a>程式碼</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;map&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;string&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> number;</span><br><span class=\"line\">    string country;</span><br><span class=\"line\">    cin &gt;&gt; number;</span><br><span class=\"line\">    cin.<span class=\"built_in\">ignore</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    map&lt;string, <span class=\"type\">int</span>&gt; country_count;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(number--) &#123;</span><br><span class=\"line\">        string line;</span><br><span class=\"line\">        <span class=\"built_in\">getline</span>(cin, line);</span><br><span class=\"line\">        <span class=\"type\">int</span> pos = line.<span class=\"built_in\">find</span>(<span class=\"string\">&#x27; &#x27;</span>);</span><br><span class=\"line\">        country = line.<span class=\"built_in\">substr</span>(<span class=\"number\">0</span>, pos);</span><br><span class=\"line\">        country_count[country]++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 輸出結果</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">const</span> pair&lt;string, <span class=\"type\">int</span>&gt;&amp; entry : country_count) &#123;</span><br><span class=\"line\">        cout &lt;&lt; entry.first &lt;&lt; <span class=\"string\">&quot; &quot;</span> &lt;&lt; entry.second &lt;&lt; endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"layout":"post","title":"UVA 10041 - Vito's Family","date":"2024-09-16T15:49:32.000Z","top_img":"/images/CPE_sub.webp","cover":"/images/CPE.webp","_content":"\n題目來源：[UVA 10041 - Vito's Family](https://onlinejudge.org/external/100/10041.pdf)\n\n## 題目描述\n\nVito 的家族住在同一條街上，但每個人的住址可能不同。Vito 想找到一個住址，使得該住址到家族成員所有住址的總距離最小。給定每位家族成員的住址，找出這個最佳的住址，並計算最小總距離。\n\n## 解題思路\n\n本題的核心在於如何選擇一個最佳住址，使得所有成員到該住址的總距離最小。最佳的住址是所有家族成員住址的中位數，因為中位數在統計學中能最小化絕對差距的總和。\n\n### 步驟：\n\n1. **輸入測試案例數量**。\n2. **輸入家族成員數量與其住址**。\n3. **對住址進行排序，找出中位數作為最佳住址**。\n4. **計算每個住址與中位數之間的距離總和**。\n5. **輸出最小總距離**。\n\n## 程式碼\n\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <vector>\nusing namespace std;\n\nint main()\n{\n    int testCases;\n    cin >> testCases;\n\n    while(testCases--) {\n        int numRelatives;\n        cin >> numRelatives;\n\n        vector<int> addresses(numRelatives);\n        for(int i = 0; i < numRelatives; i++) {\n            cin >> addresses[i];\n        }\n\n        // 排序住址，找到中位數\n        sort(addresses.begin(), addresses.end());\n        int medianAddress = addresses[numRelatives / 2];\n        int totalDistance = 0;\n\n        // 計算總距離\n        for(int i = 0; i < numRelatives; i++) {\n            totalDistance += abs(addresses[i] - medianAddress);\n        }\n\n        // 輸出結果\n        cout << totalDistance << endl;\n    }\n\n    return 0;\n}\n```\n","source":"_posts/UVA-10041-Vito-s-Family.md","raw":"---\nlayout: post\ntitle: UVA 10041 - Vito's Family\ndate: 2024-09-16 23:49:32\ntags:\n  - \"CPE\"\ncategories:\n  - \"程式解題\"\n  - \"CPE49題\"\ntop_img: /images/CPE_sub.webp\ncover: /images/CPE.webp\n---\n\n題目來源：[UVA 10041 - Vito's Family](https://onlinejudge.org/external/100/10041.pdf)\n\n## 題目描述\n\nVito 的家族住在同一條街上，但每個人的住址可能不同。Vito 想找到一個住址，使得該住址到家族成員所有住址的總距離最小。給定每位家族成員的住址，找出這個最佳的住址，並計算最小總距離。\n\n## 解題思路\n\n本題的核心在於如何選擇一個最佳住址，使得所有成員到該住址的總距離最小。最佳的住址是所有家族成員住址的中位數，因為中位數在統計學中能最小化絕對差距的總和。\n\n### 步驟：\n\n1. **輸入測試案例數量**。\n2. **輸入家族成員數量與其住址**。\n3. **對住址進行排序，找出中位數作為最佳住址**。\n4. **計算每個住址與中位數之間的距離總和**。\n5. **輸出最小總距離**。\n\n## 程式碼\n\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <vector>\nusing namespace std;\n\nint main()\n{\n    int testCases;\n    cin >> testCases;\n\n    while(testCases--) {\n        int numRelatives;\n        cin >> numRelatives;\n\n        vector<int> addresses(numRelatives);\n        for(int i = 0; i < numRelatives; i++) {\n            cin >> addresses[i];\n        }\n\n        // 排序住址，找到中位數\n        sort(addresses.begin(), addresses.end());\n        int medianAddress = addresses[numRelatives / 2];\n        int totalDistance = 0;\n\n        // 計算總距離\n        for(int i = 0; i < numRelatives; i++) {\n            totalDistance += abs(addresses[i] - medianAddress);\n        }\n\n        // 輸出結果\n        cout << totalDistance << endl;\n    }\n\n    return 0;\n}\n```\n","slug":"UVA-10041-Vito-s-Family","published":1,"updated":"2026-01-28T14:17:25.062Z","_id":"cmkxfp4y2001h7z8z865o9u3l","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>題目來源：<a href=\"https://onlinejudge.org/external/100/10041.pdf\">UVA 10041 - Vito’s Family</a></p>\n<h2 id=\"題目描述\"><a href=\"#題目描述\" class=\"headerlink\" title=\"題目描述\"></a>題目描述</h2><p>Vito 的家族住在同一條街上，但每個人的住址可能不同。Vito 想找到一個住址，使得該住址到家族成員所有住址的總距離最小。給定每位家族成員的住址，找出這個最佳的住址，並計算最小總距離。</p>\n<h2 id=\"解題思路\"><a href=\"#解題思路\" class=\"headerlink\" title=\"解題思路\"></a>解題思路</h2><p>本題的核心在於如何選擇一個最佳住址，使得所有成員到該住址的總距離最小。最佳的住址是所有家族成員住址的中位數，因為中位數在統計學中能最小化絕對差距的總和。</p>\n<h3 id=\"步驟：\"><a href=\"#步驟：\" class=\"headerlink\" title=\"步驟：\"></a>步驟：</h3><ol>\n<li><strong>輸入測試案例數量</strong>。</li>\n<li><strong>輸入家族成員數量與其住址</strong>。</li>\n<li><strong>對住址進行排序，找出中位數作為最佳住址</strong>。</li>\n<li><strong>計算每個住址與中位數之間的距離總和</strong>。</li>\n<li><strong>輸出最小總距離</strong>。</li>\n</ol>\n<h2 id=\"程式碼\"><a href=\"#程式碼\" class=\"headerlink\" title=\"程式碼\"></a>程式碼</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> testCases;</span><br><span class=\"line\">    cin &gt;&gt; testCases;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(testCases--) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> numRelatives;</span><br><span class=\"line\">        cin &gt;&gt; numRelatives;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\">vector&lt;<span class=\"type\">int</span>&gt; <span class=\"title\">addresses</span><span class=\"params\">(numRelatives)</span></span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; numRelatives; i++) &#123;</span><br><span class=\"line\">            cin &gt;&gt; addresses[i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 排序住址，找到中位數</span></span><br><span class=\"line\">        <span class=\"built_in\">sort</span>(addresses.<span class=\"built_in\">begin</span>(), addresses.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        <span class=\"type\">int</span> medianAddress = addresses[numRelatives / <span class=\"number\">2</span>];</span><br><span class=\"line\">        <span class=\"type\">int</span> totalDistance = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 計算總距離</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; numRelatives; i++) &#123;</span><br><span class=\"line\">            totalDistance += <span class=\"built_in\">abs</span>(addresses[i] - medianAddress);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 輸出結果</span></span><br><span class=\"line\">        cout &lt;&lt; totalDistance &lt;&lt; endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","excerpt":"","more":"<p>題目來源：<a href=\"https://onlinejudge.org/external/100/10041.pdf\">UVA 10041 - Vito’s Family</a></p>\n<h2 id=\"題目描述\"><a href=\"#題目描述\" class=\"headerlink\" title=\"題目描述\"></a>題目描述</h2><p>Vito 的家族住在同一條街上，但每個人的住址可能不同。Vito 想找到一個住址，使得該住址到家族成員所有住址的總距離最小。給定每位家族成員的住址，找出這個最佳的住址，並計算最小總距離。</p>\n<h2 id=\"解題思路\"><a href=\"#解題思路\" class=\"headerlink\" title=\"解題思路\"></a>解題思路</h2><p>本題的核心在於如何選擇一個最佳住址，使得所有成員到該住址的總距離最小。最佳的住址是所有家族成員住址的中位數，因為中位數在統計學中能最小化絕對差距的總和。</p>\n<h3 id=\"步驟：\"><a href=\"#步驟：\" class=\"headerlink\" title=\"步驟：\"></a>步驟：</h3><ol>\n<li><strong>輸入測試案例數量</strong>。</li>\n<li><strong>輸入家族成員數量與其住址</strong>。</li>\n<li><strong>對住址進行排序，找出中位數作為最佳住址</strong>。</li>\n<li><strong>計算每個住址與中位數之間的距離總和</strong>。</li>\n<li><strong>輸出最小總距離</strong>。</li>\n</ol>\n<h2 id=\"程式碼\"><a href=\"#程式碼\" class=\"headerlink\" title=\"程式碼\"></a>程式碼</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> testCases;</span><br><span class=\"line\">    cin &gt;&gt; testCases;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(testCases--) &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> numRelatives;</span><br><span class=\"line\">        cin &gt;&gt; numRelatives;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\">vector&lt;<span class=\"type\">int</span>&gt; <span class=\"title\">addresses</span><span class=\"params\">(numRelatives)</span></span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; numRelatives; i++) &#123;</span><br><span class=\"line\">            cin &gt;&gt; addresses[i];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 排序住址，找到中位數</span></span><br><span class=\"line\">        <span class=\"built_in\">sort</span>(addresses.<span class=\"built_in\">begin</span>(), addresses.<span class=\"built_in\">end</span>());</span><br><span class=\"line\">        <span class=\"type\">int</span> medianAddress = addresses[numRelatives / <span class=\"number\">2</span>];</span><br><span class=\"line\">        <span class=\"type\">int</span> totalDistance = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 計算總距離</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; numRelatives; i++) &#123;</span><br><span class=\"line\">            totalDistance += <span class=\"built_in\">abs</span>(addresses[i] - medianAddress);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 輸出結果</span></span><br><span class=\"line\">        cout &lt;&lt; totalDistance &lt;&lt; endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"layout":"post","title":"C++ 筆記 - Vector 使用方式","date":"2024-11-20T15:22:52.000Z","top_img":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FC%2B%2B%20%E7%AD%86%E8%A8%98%2Fvector.webp?alt=media&token=13648a6d-cbd4-4420-974c-bc2c56ae85c4","cover":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FC%2B%2B%20%E7%AD%86%E8%A8%98%2Fvector.webp?alt=media&token=13648a6d-cbd4-4420-974c-bc2c56ae85c4","_content":"\n# Vector 實戰教學\n\n### **1. `vector` 的基本操作**\n\n### **定義與初始化**\n\n```cpp\n#include <iostream>\n#include <vector>\nusing namespace std;\n\nint main() {\n    // 定義一個空的 vector\n    vector<int> vec;\n\n    // 定義並初始化\n    vector<int> vec2 = {1, 2, 3, 4, 5};\n\n    // 定義固定大小的 vector，初始值為 0\n    vector<int> vec3(5, 0); // 5 個元素，每個元素初始值為 0\n\n    // 輸出 vec2 的內容\n    for (int x : vec2) {\n        cout << x << \" \";\n    }\n\n    return 0;\n}\n\n```\n\n**輸出：**\n\n```\n1 2 3 4 5\n```\n\n---\n\n### **2. 動態增加和刪除元素**\n\n### **增加元素**\n\n- 使用 `push_back()` 在尾部添加元素。\n- 使用 `insert()` 在特定位置插入元素。\n\n### **刪除元素**\n\n- 使用 `pop_back()` 刪除尾部元素。\n- 使用 `erase()` 刪除指定位置的元素。\n\n```cpp\n#include <iostream>\n#include <vector>\n\nusing namespace std;\n\nint main() {\n    vector<int> vec = {1, 2, 3, 4, 5};\n\n    // 在尾部添加元素\n    vec.push_back(6);\n\n    // 在位置 2 插入元素 10\n    vec.insert(vec.begin() + 2, 10);\n\n    // 刪除尾部元素\n    vec.pop_back();\n\n    // 刪除位置 2 的元素\n    vec.erase(vec.begin() + 2);\n\n    // 輸出內容\n    for (int x : vec) {\n        cout << x << \" \";\n    }\n\n    return 0;\n}\n```\n\n**輸出：**\n\n```\n1 2 3 4 5\n```\n\n---\n\n### **3. 常用方法與屬性**\n\n### **方法**\n\n| 方法名               | 功能                                                |\n| -------------------- | --------------------------------------------------- |\n| `push_back(value)`   | 在尾部添加一個元素                                  |\n| `pop_back()`         | 刪除尾部元素                                        |\n| `insert(pos, value)` | 在 `pos` 位置插入一個元素                           |\n| `erase(pos)`         | 刪除 `pos` 位置的元素                               |\n| `clear()`            | 刪除所有元素                                        |\n| `size()`             | 返回當前元素數量                                    |\n| `empty()`            | 判斷是否為空                                        |\n| `resize(n, value)`   | 調整大小為 `n`，多出部分用 `value` 填充（默認為 0） |\n| `front()`            | 返回第一個元素                                      |\n| `back()`             | 返回最後一個元素                                    |\n| `at(index)`          | 返回索引 `index` 處的元素，帶範圍檢查               |\n\n---\n\n### **範例：檢查方法的用法**\n\n```cpp\n#include <iostream>\n#include <vector>\n\nusing namespace std;\n\nint main() {\n    vector<int> vec = {1, 2, 3, 4, 5};\n\n    // 大小和是否為空\n    cout << \"Size: \" << vec.size() << endl;\n    cout << \"Is empty: \" << (vec.empty() ? \"Yes\" : \"No\") << endl;\n\n    // 訪問元素\n    cout << \"First element: \" << vec.front() << endl;\n    cout << \"Last element: \" << vec.back() << endl;\n    cout << \"Element at index 2: \" << vec.at(2) << endl;\n\n    // 清空 vector\n    vec.clear();\n    cout << \"Size after clear: \" << vec.size() << endl;\n\n    return 0;\n}\n\n```\n\n**輸出：**\n\n```yaml\nSize: 5\nIs empty: No\nFirst element: 1\nLast element: 5\nElement at index 2: 3\nSize after clear: 0\n```\n","source":"_posts/post-1.md","raw":"---\nlayout: post\ntitle: C++ 筆記 - Vector 使用方式\ndate: 2024-11-20 23:22:52\ntags:\n  - \"C++\"\ncategories:\n  - \"C++\"\n  - \"Vector\"\ntop_img: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FC%2B%2B%20%E7%AD%86%E8%A8%98%2Fvector.webp?alt=media&token=13648a6d-cbd4-4420-974c-bc2c56ae85c4\"\ncover: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2FC%2B%2B%20%E7%AD%86%E8%A8%98%2Fvector.webp?alt=media&token=13648a6d-cbd4-4420-974c-bc2c56ae85c4\"\n---\n\n# Vector 實戰教學\n\n### **1. `vector` 的基本操作**\n\n### **定義與初始化**\n\n```cpp\n#include <iostream>\n#include <vector>\nusing namespace std;\n\nint main() {\n    // 定義一個空的 vector\n    vector<int> vec;\n\n    // 定義並初始化\n    vector<int> vec2 = {1, 2, 3, 4, 5};\n\n    // 定義固定大小的 vector，初始值為 0\n    vector<int> vec3(5, 0); // 5 個元素，每個元素初始值為 0\n\n    // 輸出 vec2 的內容\n    for (int x : vec2) {\n        cout << x << \" \";\n    }\n\n    return 0;\n}\n\n```\n\n**輸出：**\n\n```\n1 2 3 4 5\n```\n\n---\n\n### **2. 動態增加和刪除元素**\n\n### **增加元素**\n\n- 使用 `push_back()` 在尾部添加元素。\n- 使用 `insert()` 在特定位置插入元素。\n\n### **刪除元素**\n\n- 使用 `pop_back()` 刪除尾部元素。\n- 使用 `erase()` 刪除指定位置的元素。\n\n```cpp\n#include <iostream>\n#include <vector>\n\nusing namespace std;\n\nint main() {\n    vector<int> vec = {1, 2, 3, 4, 5};\n\n    // 在尾部添加元素\n    vec.push_back(6);\n\n    // 在位置 2 插入元素 10\n    vec.insert(vec.begin() + 2, 10);\n\n    // 刪除尾部元素\n    vec.pop_back();\n\n    // 刪除位置 2 的元素\n    vec.erase(vec.begin() + 2);\n\n    // 輸出內容\n    for (int x : vec) {\n        cout << x << \" \";\n    }\n\n    return 0;\n}\n```\n\n**輸出：**\n\n```\n1 2 3 4 5\n```\n\n---\n\n### **3. 常用方法與屬性**\n\n### **方法**\n\n| 方法名               | 功能                                                |\n| -------------------- | --------------------------------------------------- |\n| `push_back(value)`   | 在尾部添加一個元素                                  |\n| `pop_back()`         | 刪除尾部元素                                        |\n| `insert(pos, value)` | 在 `pos` 位置插入一個元素                           |\n| `erase(pos)`         | 刪除 `pos` 位置的元素                               |\n| `clear()`            | 刪除所有元素                                        |\n| `size()`             | 返回當前元素數量                                    |\n| `empty()`            | 判斷是否為空                                        |\n| `resize(n, value)`   | 調整大小為 `n`，多出部分用 `value` 填充（默認為 0） |\n| `front()`            | 返回第一個元素                                      |\n| `back()`             | 返回最後一個元素                                    |\n| `at(index)`          | 返回索引 `index` 處的元素，帶範圍檢查               |\n\n---\n\n### **範例：檢查方法的用法**\n\n```cpp\n#include <iostream>\n#include <vector>\n\nusing namespace std;\n\nint main() {\n    vector<int> vec = {1, 2, 3, 4, 5};\n\n    // 大小和是否為空\n    cout << \"Size: \" << vec.size() << endl;\n    cout << \"Is empty: \" << (vec.empty() ? \"Yes\" : \"No\") << endl;\n\n    // 訪問元素\n    cout << \"First element: \" << vec.front() << endl;\n    cout << \"Last element: \" << vec.back() << endl;\n    cout << \"Element at index 2: \" << vec.at(2) << endl;\n\n    // 清空 vector\n    vec.clear();\n    cout << \"Size after clear: \" << vec.size() << endl;\n\n    return 0;\n}\n\n```\n\n**輸出：**\n\n```yaml\nSize: 5\nIs empty: No\nFirst element: 1\nLast element: 5\nElement at index 2: 3\nSize after clear: 0\n```\n","slug":"post-1","published":1,"updated":"2026-01-28T14:17:25.065Z","_id":"cmkxfp4y7003w7z8z71oz3hm5","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h1 id=\"Vector-實戰教學\"><a href=\"#Vector-實戰教學\" class=\"headerlink\" title=\"Vector 實戰教學\"></a>Vector 實戰教學</h1><h3 id=\"1-vector-的基本操作\"><a href=\"#1-vector-的基本操作\" class=\"headerlink\" title=\"1. vector 的基本操作\"></a><strong>1. <code>vector</code> 的基本操作</strong></h3><h3 id=\"定義與初始化\"><a href=\"#定義與初始化\" class=\"headerlink\" title=\"定義與初始化\"></a><strong>定義與初始化</strong></h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 定義一個空的 vector</span></span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; vec;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定義並初始化</span></span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; vec2 = &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定義固定大小的 vector，初始值為 0</span></span><br><span class=\"line\">    <span class=\"function\">vector&lt;<span class=\"type\">int</span>&gt; <span class=\"title\">vec3</span><span class=\"params\">(<span class=\"number\">5</span>, <span class=\"number\">0</span>)</span></span>; <span class=\"comment\">// 5 個元素，每個元素初始值為 0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 輸出 vec2 的內容</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> x : vec2) &#123;</span><br><span class=\"line\">        cout &lt;&lt; x &lt;&lt; <span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>輸出：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 2 3 4 5</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-動態增加和刪除元素\"><a href=\"#2-動態增加和刪除元素\" class=\"headerlink\" title=\"2. 動態增加和刪除元素\"></a><strong>2. 動態增加和刪除元素</strong></h3><h3 id=\"增加元素\"><a href=\"#增加元素\" class=\"headerlink\" title=\"增加元素\"></a><strong>增加元素</strong></h3><ul>\n<li>使用 <code>push_back()</code> 在尾部添加元素。</li>\n<li>使用 <code>insert()</code> 在特定位置插入元素。</li>\n</ul>\n<h3 id=\"刪除元素\"><a href=\"#刪除元素\" class=\"headerlink\" title=\"刪除元素\"></a><strong>刪除元素</strong></h3><ul>\n<li>使用 <code>pop_back()</code> 刪除尾部元素。</li>\n<li>使用 <code>erase()</code> 刪除指定位置的元素。</li>\n</ul>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; vec = &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 在尾部添加元素</span></span><br><span class=\"line\">    vec.<span class=\"built_in\">push_back</span>(<span class=\"number\">6</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 在位置 2 插入元素 10</span></span><br><span class=\"line\">    vec.<span class=\"built_in\">insert</span>(vec.<span class=\"built_in\">begin</span>() + <span class=\"number\">2</span>, <span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 刪除尾部元素</span></span><br><span class=\"line\">    vec.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 刪除位置 2 的元素</span></span><br><span class=\"line\">    vec.<span class=\"built_in\">erase</span>(vec.<span class=\"built_in\">begin</span>() + <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 輸出內容</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> x : vec) &#123;</span><br><span class=\"line\">        cout &lt;&lt; x &lt;&lt; <span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>輸出：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 2 3 4 5</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3-常用方法與屬性\"><a href=\"#3-常用方法與屬性\" class=\"headerlink\" title=\"3. 常用方法與屬性\"></a><strong>3. 常用方法與屬性</strong></h3><h3 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a><strong>方法</strong></h3><table>\n<thead>\n<tr>\n<th>方法名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>push_back(value)</code></td>\n<td>在尾部添加一個元素</td>\n</tr>\n<tr>\n<td><code>pop_back()</code></td>\n<td>刪除尾部元素</td>\n</tr>\n<tr>\n<td><code>insert(pos, value)</code></td>\n<td>在 <code>pos</code> 位置插入一個元素</td>\n</tr>\n<tr>\n<td><code>erase(pos)</code></td>\n<td>刪除 <code>pos</code> 位置的元素</td>\n</tr>\n<tr>\n<td><code>clear()</code></td>\n<td>刪除所有元素</td>\n</tr>\n<tr>\n<td><code>size()</code></td>\n<td>返回當前元素數量</td>\n</tr>\n<tr>\n<td><code>empty()</code></td>\n<td>判斷是否為空</td>\n</tr>\n<tr>\n<td><code>resize(n, value)</code></td>\n<td>調整大小為 <code>n</code>，多出部分用 <code>value</code> 填充（默認為 0）</td>\n</tr>\n<tr>\n<td><code>front()</code></td>\n<td>返回第一個元素</td>\n</tr>\n<tr>\n<td><code>back()</code></td>\n<td>返回最後一個元素</td>\n</tr>\n<tr>\n<td><code>at(index)</code></td>\n<td>返回索引 <code>index</code> 處的元素，帶範圍檢查</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"範例：檢查方法的用法\"><a href=\"#範例：檢查方法的用法\" class=\"headerlink\" title=\"範例：檢查方法的用法\"></a><strong>範例：檢查方法的用法</strong></h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; vec = &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 大小和是否為空</span></span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Size: &quot;</span> &lt;&lt; vec.<span class=\"built_in\">size</span>() &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Is empty: &quot;</span> &lt;&lt; (vec.<span class=\"built_in\">empty</span>() ? <span class=\"string\">&quot;Yes&quot;</span> : <span class=\"string\">&quot;No&quot;</span>) &lt;&lt; endl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 訪問元素</span></span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;First element: &quot;</span> &lt;&lt; vec.<span class=\"built_in\">front</span>() &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Last element: &quot;</span> &lt;&lt; vec.<span class=\"built_in\">back</span>() &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Element at index 2: &quot;</span> &lt;&lt; vec.<span class=\"built_in\">at</span>(<span class=\"number\">2</span>) &lt;&lt; endl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 清空 vector</span></span><br><span class=\"line\">    vec.<span class=\"built_in\">clear</span>();</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Size after clear: &quot;</span> &lt;&lt; vec.<span class=\"built_in\">size</span>() &lt;&lt; endl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>輸出：</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">Size:</span> <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"attr\">Is empty:</span> <span class=\"literal\">No</span></span><br><span class=\"line\"><span class=\"attr\">First element:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">Last element:</span> <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"attr\">Element at index 2:</span> <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"attr\">Size after clear:</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n","excerpt":"","more":"<h1 id=\"Vector-實戰教學\"><a href=\"#Vector-實戰教學\" class=\"headerlink\" title=\"Vector 實戰教學\"></a>Vector 實戰教學</h1><h3 id=\"1-vector-的基本操作\"><a href=\"#1-vector-的基本操作\" class=\"headerlink\" title=\"1. vector 的基本操作\"></a><strong>1. <code>vector</code> 的基本操作</strong></h3><h3 id=\"定義與初始化\"><a href=\"#定義與初始化\" class=\"headerlink\" title=\"定義與初始化\"></a><strong>定義與初始化</strong></h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 定義一個空的 vector</span></span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; vec;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定義並初始化</span></span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; vec2 = &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 定義固定大小的 vector，初始值為 0</span></span><br><span class=\"line\">    <span class=\"function\">vector&lt;<span class=\"type\">int</span>&gt; <span class=\"title\">vec3</span><span class=\"params\">(<span class=\"number\">5</span>, <span class=\"number\">0</span>)</span></span>; <span class=\"comment\">// 5 個元素，每個元素初始值為 0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 輸出 vec2 的內容</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> x : vec2) &#123;</span><br><span class=\"line\">        cout &lt;&lt; x &lt;&lt; <span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>輸出：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 2 3 4 5</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"2-動態增加和刪除元素\"><a href=\"#2-動態增加和刪除元素\" class=\"headerlink\" title=\"2. 動態增加和刪除元素\"></a><strong>2. 動態增加和刪除元素</strong></h3><h3 id=\"增加元素\"><a href=\"#增加元素\" class=\"headerlink\" title=\"增加元素\"></a><strong>增加元素</strong></h3><ul>\n<li>使用 <code>push_back()</code> 在尾部添加元素。</li>\n<li>使用 <code>insert()</code> 在特定位置插入元素。</li>\n</ul>\n<h3 id=\"刪除元素\"><a href=\"#刪除元素\" class=\"headerlink\" title=\"刪除元素\"></a><strong>刪除元素</strong></h3><ul>\n<li>使用 <code>pop_back()</code> 刪除尾部元素。</li>\n<li>使用 <code>erase()</code> 刪除指定位置的元素。</li>\n</ul>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; vec = &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 在尾部添加元素</span></span><br><span class=\"line\">    vec.<span class=\"built_in\">push_back</span>(<span class=\"number\">6</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 在位置 2 插入元素 10</span></span><br><span class=\"line\">    vec.<span class=\"built_in\">insert</span>(vec.<span class=\"built_in\">begin</span>() + <span class=\"number\">2</span>, <span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 刪除尾部元素</span></span><br><span class=\"line\">    vec.<span class=\"built_in\">pop_back</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 刪除位置 2 的元素</span></span><br><span class=\"line\">    vec.<span class=\"built_in\">erase</span>(vec.<span class=\"built_in\">begin</span>() + <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 輸出內容</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> x : vec) &#123;</span><br><span class=\"line\">        cout &lt;&lt; x &lt;&lt; <span class=\"string\">&quot; &quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>輸出：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 2 3 4 5</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"3-常用方法與屬性\"><a href=\"#3-常用方法與屬性\" class=\"headerlink\" title=\"3. 常用方法與屬性\"></a><strong>3. 常用方法與屬性</strong></h3><h3 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a><strong>方法</strong></h3><table>\n<thead>\n<tr>\n<th>方法名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>push_back(value)</code></td>\n<td>在尾部添加一個元素</td>\n</tr>\n<tr>\n<td><code>pop_back()</code></td>\n<td>刪除尾部元素</td>\n</tr>\n<tr>\n<td><code>insert(pos, value)</code></td>\n<td>在 <code>pos</code> 位置插入一個元素</td>\n</tr>\n<tr>\n<td><code>erase(pos)</code></td>\n<td>刪除 <code>pos</code> 位置的元素</td>\n</tr>\n<tr>\n<td><code>clear()</code></td>\n<td>刪除所有元素</td>\n</tr>\n<tr>\n<td><code>size()</code></td>\n<td>返回當前元素數量</td>\n</tr>\n<tr>\n<td><code>empty()</code></td>\n<td>判斷是否為空</td>\n</tr>\n<tr>\n<td><code>resize(n, value)</code></td>\n<td>調整大小為 <code>n</code>，多出部分用 <code>value</code> 填充（默認為 0）</td>\n</tr>\n<tr>\n<td><code>front()</code></td>\n<td>返回第一個元素</td>\n</tr>\n<tr>\n<td><code>back()</code></td>\n<td>返回最後一個元素</td>\n</tr>\n<tr>\n<td><code>at(index)</code></td>\n<td>返回索引 <code>index</code> 處的元素，帶範圍檢查</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"範例：檢查方法的用法\"><a href=\"#範例：檢查方法的用法\" class=\"headerlink\" title=\"範例：檢查方法的用法\"></a><strong>範例：檢查方法的用法</strong></h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    vector&lt;<span class=\"type\">int</span>&gt; vec = &#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 大小和是否為空</span></span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Size: &quot;</span> &lt;&lt; vec.<span class=\"built_in\">size</span>() &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Is empty: &quot;</span> &lt;&lt; (vec.<span class=\"built_in\">empty</span>() ? <span class=\"string\">&quot;Yes&quot;</span> : <span class=\"string\">&quot;No&quot;</span>) &lt;&lt; endl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 訪問元素</span></span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;First element: &quot;</span> &lt;&lt; vec.<span class=\"built_in\">front</span>() &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Last element: &quot;</span> &lt;&lt; vec.<span class=\"built_in\">back</span>() &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Element at index 2: &quot;</span> &lt;&lt; vec.<span class=\"built_in\">at</span>(<span class=\"number\">2</span>) &lt;&lt; endl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 清空 vector</span></span><br><span class=\"line\">    vec.<span class=\"built_in\">clear</span>();</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Size after clear: &quot;</span> &lt;&lt; vec.<span class=\"built_in\">size</span>() &lt;&lt; endl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>輸出：</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">Size:</span> <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"attr\">Is empty:</span> <span class=\"literal\">No</span></span><br><span class=\"line\"><span class=\"attr\">First element:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">Last element:</span> <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"attr\">Element at index 2:</span> <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"attr\">Size after clear:</span> <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n"},{"layout":"post","title":"在 Mac vscode 中使用 Code Runner 和 C/C++ 插件來編譯與執行 C++ 程式","date":"2024-09-30T15:22:52.000Z","top_img":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Flogo.webp?alt=media&token=81620eff-892d-4194-9b04-d8ddf12fae6c","cover":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Flogo.webp?alt=media&token=81620eff-892d-4194-9b04-d8ddf12fae6c","_content":"\n今天在學校老師突然派一個 c++作業，結果我電腦還沒裝 C++環境，讀檔案一直出問題，我決定今天好好寫一個 Mac 在 vscode 中執行 C++ 的教學。\n\n---\n\n### 在 Mac 上使用 VSCode 的 Code Runner 和 C/C++ 插件來編譯與執行 C++ 程式\n\n這個教學將詳細說明如何使用 **VSCode** 的 **Code Runner** 和 **C/C++ 插件** 來編譯與執行 C++ 程式，並介紹幾個常見功能按鈕的說明。\n\n---\n\n### 1. 確認安裝 Clang 編譯器\n\n**補充：在使用 Clang 之前，必須確保你的 Mac 上已經安裝了 Xcode 或 Xcode Command Line Tools，因為 Clang 是隨 Xcode 一起安裝的。**\n\n### **確認是否已安裝 Xcode**\n\n- 打開 **終端**（Terminal）並輸入以下指令來確認 Xcode 是否已安裝：如果已經安裝，你會看到提示訊息告訴你 Xcode Command Line Tools 已經安裝。如果尚未安裝，系統將自動引導你進行安裝。\n  ```bash\n  xcode-select --install\n  ```\n\n### **檢查 Clang 版本**\n\n1. 打開 **終端**（Terminal）。\n2. 輸入以下指令來檢查 Clang 的版本：\n\n   ```bash\n   clang --version\n   ```\n\n3. 如果 Clang 已安裝，終端會顯示如下類似的版本資訊：\n\n   ```yaml\n   Apple clang version 14.0.3 (clang-1403.0.22.14.1)\n   Target: x86_64-apple-darwin22.5.0\n   Thread model: posix\n   InstalledDir: /Library/Developer/CommandLineTools/usr/bin\n   ```\n\n---\n\n### 2. 使用 Code Runner 和 C/C++ 插件執行 C++ 程式\n\n在進行程式開發之前，你需要在 **VSCode** 中安裝 **Code Runner** 和 **C/C++ 插件**。\n\n### **安裝 Code Runner 插件**\n\n1. 在 **VSCode** 中打開擴展市場，搜尋 **Code Runner**，然後點擊 **Install** 安裝插件。\n\n   - [Code Runner 插件下載](https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner)\n\n   ![Code Runner 插件畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B2.png?alt=media&token=e98ba65b-edb2-4297-9624-958312ecacb9)\n\n### **安裝 C/C++ 插件**\n\n1. 在 **VSCode** 中搜尋 **C/C++**，然後點擊 **Install** 安裝插件。\n\n   - [C/C++ 插件下載](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools)\n\n   ![C/C++ 插件畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B1.png?alt=media&token=1c42e65c-d4b0-4e61-862a-78d16a519637)\n\n---\n\n### 3. 編寫與運行 C++ 程式\n\n1. **創建 C++ 檔案**：\n\n   - 在 **VSCode** 中創建一個新檔案 `hello.cpp`，並寫入以下 C++ 代碼：\n\n     ```cpp\n     cpp\n     複製程式碼\n     #include <iostream>using namespace std;\n\n     int main() {\n         string greeting = \"Hello, World!\";\n         string welcome = \"Welcome to C++ programming!\";\n         string message = \"Let's learn and have fun!\";\n         int year = 2023;\n         double version = 1.0;\n         char initial = 'C';\n\n         cout << greeting << endl;\n         cout << welcome << endl;\n         cout << message << endl;\n         cout << \"Current year: \" << year << endl;\n         cout << \"Version: \" << version << endl;\n         cout << \"Initial: \" << initial << endl;\n\n         for (int i = 1; i <= 14; ++i) {\n             cout << \"This is line number \" << i + 6 << endl;\n         }\n\n         return 0;\n     }\n\n     ```\n\n2. **執行程式碼**：\n\n   - 使用 **Code Runner** 插件，你可以直接運行程式碼，無需手動編譯。按下 **執行按鈕**（Run Code）。\n   - 程式的輸出會顯示在 **VSCode** 的終端中。\n\n   ![執行 C++ 程式畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B3.png?alt=media&token=f0a05a16-640f-4afc-9e49-0845bb5f7328)\n\n   ![執行結果畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B4.png?alt=media&token=b54995aa-fb3d-43ba-9aae-96d777de5f59)\n\n---\n\n### 4. 功能按鈕的使用說明\n\n在你使用 **Code Runner** 和 **C/C++ 插件** 時，可能會看到以下幾個選項：\n\n1. **CompileRun: Compile with default flags & Run with default arguments**\n   - 使用預設的編譯選項來編譯並執行程式。\n2. **Debug C/C++ File**\n   - 啟動 C/C++ 的除錯模式，允許你設置斷點、逐步執行程式並檢查變數。\n3. **Run Code**\n   - 使用 **Code Runner** 插件直接運行程式，不需手動編譯，適合快速測試。\n4. **CompileRun: Debug**\n   - 使用除錯模式進行編譯和執行，便於進行問題排查。\n5. **Run C/C++ File**\n   - 專門針對 C/C++ 檔案進行執行，通常會先編譯再運行。\n\n這些功能按鈕能讓你靈活選擇是否快速測試、完整編譯或進行除錯，根據需求選擇合適的功能即可。\n\n![功能按鈕選項畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B5.png?alt=media&token=16237bbf-7d95-4230-965b-d06e511aa7b5)\n\n---\n\n### 5. 執行結果\n\n當你成功編譯和執行程式後，應該會在 **VSCode** 終端中看到以下輸出：\n\n```vbnet\nvbnet\n複製程式碼\nHello, World!\nWelcome to C++ programming!\nLet's learn and have fun!\nCurrent year: 2023\nVersion: 1.0\nInitial: C\nThis is line number 7\nThis is line number 8\n...\nThis is line number 20\n\n```\n\n---\n\n### Debug 逐行教學\n\n當你進入 **Debug 模式** 後，可以逐行檢查程式的運行情況。以下是一個變數在 Debug 模式下顯示的範例：\n\n1. 可以看到變數 `greeting` 及其值已在右側顯示。\n\n   ![Debug 模式畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B6.png?alt=media&token=e0b4e072-a7ef-43a6-9845-65716b722a96)\n","source":"_posts/在-Mac-vscode-中使用-Code-Runner-和-C-C-插件來編譯與執行-C-程式.md","raw":"---\nlayout: post\ntitle: 在 Mac vscode 中使用 Code Runner 和 C/C++ 插件來編譯與執行 C++ 程式\ndate: 2024-09-30 23:22:52\ntags:\n  - \"開發環境\"\ncategories:\n  - \"開發環境\"\n  - \"使用Mac在vscode執行C++\"\ntop_img: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Flogo.webp?alt=media&token=81620eff-892d-4194-9b04-d8ddf12fae6c\"\ncover: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Flogo.webp?alt=media&token=81620eff-892d-4194-9b04-d8ddf12fae6c\"\n---\n\n今天在學校老師突然派一個 c++作業，結果我電腦還沒裝 C++環境，讀檔案一直出問題，我決定今天好好寫一個 Mac 在 vscode 中執行 C++ 的教學。\n\n---\n\n### 在 Mac 上使用 VSCode 的 Code Runner 和 C/C++ 插件來編譯與執行 C++ 程式\n\n這個教學將詳細說明如何使用 **VSCode** 的 **Code Runner** 和 **C/C++ 插件** 來編譯與執行 C++ 程式，並介紹幾個常見功能按鈕的說明。\n\n---\n\n### 1. 確認安裝 Clang 編譯器\n\n**補充：在使用 Clang 之前，必須確保你的 Mac 上已經安裝了 Xcode 或 Xcode Command Line Tools，因為 Clang 是隨 Xcode 一起安裝的。**\n\n### **確認是否已安裝 Xcode**\n\n- 打開 **終端**（Terminal）並輸入以下指令來確認 Xcode 是否已安裝：如果已經安裝，你會看到提示訊息告訴你 Xcode Command Line Tools 已經安裝。如果尚未安裝，系統將自動引導你進行安裝。\n  ```bash\n  xcode-select --install\n  ```\n\n### **檢查 Clang 版本**\n\n1. 打開 **終端**（Terminal）。\n2. 輸入以下指令來檢查 Clang 的版本：\n\n   ```bash\n   clang --version\n   ```\n\n3. 如果 Clang 已安裝，終端會顯示如下類似的版本資訊：\n\n   ```yaml\n   Apple clang version 14.0.3 (clang-1403.0.22.14.1)\n   Target: x86_64-apple-darwin22.5.0\n   Thread model: posix\n   InstalledDir: /Library/Developer/CommandLineTools/usr/bin\n   ```\n\n---\n\n### 2. 使用 Code Runner 和 C/C++ 插件執行 C++ 程式\n\n在進行程式開發之前，你需要在 **VSCode** 中安裝 **Code Runner** 和 **C/C++ 插件**。\n\n### **安裝 Code Runner 插件**\n\n1. 在 **VSCode** 中打開擴展市場，搜尋 **Code Runner**，然後點擊 **Install** 安裝插件。\n\n   - [Code Runner 插件下載](https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner)\n\n   ![Code Runner 插件畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B2.png?alt=media&token=e98ba65b-edb2-4297-9624-958312ecacb9)\n\n### **安裝 C/C++ 插件**\n\n1. 在 **VSCode** 中搜尋 **C/C++**，然後點擊 **Install** 安裝插件。\n\n   - [C/C++ 插件下載](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools)\n\n   ![C/C++ 插件畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B1.png?alt=media&token=1c42e65c-d4b0-4e61-862a-78d16a519637)\n\n---\n\n### 3. 編寫與運行 C++ 程式\n\n1. **創建 C++ 檔案**：\n\n   - 在 **VSCode** 中創建一個新檔案 `hello.cpp`，並寫入以下 C++ 代碼：\n\n     ```cpp\n     cpp\n     複製程式碼\n     #include <iostream>using namespace std;\n\n     int main() {\n         string greeting = \"Hello, World!\";\n         string welcome = \"Welcome to C++ programming!\";\n         string message = \"Let's learn and have fun!\";\n         int year = 2023;\n         double version = 1.0;\n         char initial = 'C';\n\n         cout << greeting << endl;\n         cout << welcome << endl;\n         cout << message << endl;\n         cout << \"Current year: \" << year << endl;\n         cout << \"Version: \" << version << endl;\n         cout << \"Initial: \" << initial << endl;\n\n         for (int i = 1; i <= 14; ++i) {\n             cout << \"This is line number \" << i + 6 << endl;\n         }\n\n         return 0;\n     }\n\n     ```\n\n2. **執行程式碼**：\n\n   - 使用 **Code Runner** 插件，你可以直接運行程式碼，無需手動編譯。按下 **執行按鈕**（Run Code）。\n   - 程式的輸出會顯示在 **VSCode** 的終端中。\n\n   ![執行 C++ 程式畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B3.png?alt=media&token=f0a05a16-640f-4afc-9e49-0845bb5f7328)\n\n   ![執行結果畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B4.png?alt=media&token=b54995aa-fb3d-43ba-9aae-96d777de5f59)\n\n---\n\n### 4. 功能按鈕的使用說明\n\n在你使用 **Code Runner** 和 **C/C++ 插件** 時，可能會看到以下幾個選項：\n\n1. **CompileRun: Compile with default flags & Run with default arguments**\n   - 使用預設的編譯選項來編譯並執行程式。\n2. **Debug C/C++ File**\n   - 啟動 C/C++ 的除錯模式，允許你設置斷點、逐步執行程式並檢查變數。\n3. **Run Code**\n   - 使用 **Code Runner** 插件直接運行程式，不需手動編譯，適合快速測試。\n4. **CompileRun: Debug**\n   - 使用除錯模式進行編譯和執行，便於進行問題排查。\n5. **Run C/C++ File**\n   - 專門針對 C/C++ 檔案進行執行，通常會先編譯再運行。\n\n這些功能按鈕能讓你靈活選擇是否快速測試、完整編譯或進行除錯，根據需求選擇合適的功能即可。\n\n![功能按鈕選項畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B5.png?alt=media&token=16237bbf-7d95-4230-965b-d06e511aa7b5)\n\n---\n\n### 5. 執行結果\n\n當你成功編譯和執行程式後，應該會在 **VSCode** 終端中看到以下輸出：\n\n```vbnet\nvbnet\n複製程式碼\nHello, World!\nWelcome to C++ programming!\nLet's learn and have fun!\nCurrent year: 2023\nVersion: 1.0\nInitial: C\nThis is line number 7\nThis is line number 8\n...\nThis is line number 20\n\n```\n\n---\n\n### Debug 逐行教學\n\n當你進入 **Debug 模式** 後，可以逐行檢查程式的運行情況。以下是一個變數在 Debug 模式下顯示的範例：\n\n1. 可以看到變數 `greeting` 及其值已在右側顯示。\n\n   ![Debug 模式畫面](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B6.png?alt=media&token=e0b4e072-a7ef-43a6-9845-65716b722a96)\n","slug":"在-Mac-vscode-中使用-Code-Runner-和-C-C-插件來編譯與執行-C-程式","published":1,"updated":"2026-01-28T14:17:25.070Z","_id":"cmkxfp4y7003x7z8z5xe58mie","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>今天在學校老師突然派一個 c++作業，結果我電腦還沒裝 C++環境，讀檔案一直出問題，我決定今天好好寫一個 Mac 在 vscode 中執行 C++ 的教學。</p>\n<hr>\n<h3 id=\"在-Mac-上使用-VSCode-的-Code-Runner-和-C-C-插件來編譯與執行-C-程式\"><a href=\"#在-Mac-上使用-VSCode-的-Code-Runner-和-C-C-插件來編譯與執行-C-程式\" class=\"headerlink\" title=\"在 Mac 上使用 VSCode 的 Code Runner 和 C&#x2F;C++ 插件來編譯與執行 C++ 程式\"></a>在 Mac 上使用 VSCode 的 Code Runner 和 C&#x2F;C++ 插件來編譯與執行 C++ 程式</h3><p>這個教學將詳細說明如何使用 <strong>VSCode</strong> 的 <strong>Code Runner</strong> 和 <strong>C&#x2F;C++ 插件</strong> 來編譯與執行 C++ 程式，並介紹幾個常見功能按鈕的說明。</p>\n<hr>\n<h3 id=\"1-確認安裝-Clang-編譯器\"><a href=\"#1-確認安裝-Clang-編譯器\" class=\"headerlink\" title=\"1. 確認安裝 Clang 編譯器\"></a>1. 確認安裝 Clang 編譯器</h3><p><strong>補充：在使用 Clang 之前，必須確保你的 Mac 上已經安裝了 Xcode 或 Xcode Command Line Tools，因為 Clang 是隨 Xcode 一起安裝的。</strong></p>\n<h3 id=\"確認是否已安裝-Xcode\"><a href=\"#確認是否已安裝-Xcode\" class=\"headerlink\" title=\"確認是否已安裝 Xcode\"></a><strong>確認是否已安裝 Xcode</strong></h3><ul>\n<li>打開 <strong>終端</strong>（Terminal）並輸入以下指令來確認 Xcode 是否已安裝：如果已經安裝，你會看到提示訊息告訴你 Xcode Command Line Tools 已經安裝。如果尚未安裝，系統將自動引導你進行安裝。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcode-select --install</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"檢查-Clang-版本\"><a href=\"#檢查-Clang-版本\" class=\"headerlink\" title=\"檢查 Clang 版本\"></a><strong>檢查 Clang 版本</strong></h3><ol>\n<li><p>打開 <strong>終端</strong>（Terminal）。</p>\n</li>\n<li><p>輸入以下指令來檢查 Clang 的版本：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">clang --version</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>如果 Clang 已安裝，終端會顯示如下類似的版本資訊：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Apple</span> <span class=\"string\">clang</span> <span class=\"string\">version</span> <span class=\"number\">14.0</span><span class=\"number\">.3</span> <span class=\"string\">(clang-1403.0.22.14.1)</span></span><br><span class=\"line\"><span class=\"attr\">Target:</span> <span class=\"string\">x86_64-apple-darwin22.5.0</span></span><br><span class=\"line\"><span class=\"attr\">Thread model:</span> <span class=\"string\">posix</span></span><br><span class=\"line\"><span class=\"attr\">InstalledDir:</span> <span class=\"string\">/Library/Developer/CommandLineTools/usr/bin</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<hr>\n<h3 id=\"2-使用-Code-Runner-和-C-C-插件執行-C-程式\"><a href=\"#2-使用-Code-Runner-和-C-C-插件執行-C-程式\" class=\"headerlink\" title=\"2. 使用 Code Runner 和 C&#x2F;C++ 插件執行 C++ 程式\"></a>2. 使用 Code Runner 和 C&#x2F;C++ 插件執行 C++ 程式</h3><p>在進行程式開發之前，你需要在 <strong>VSCode</strong> 中安裝 <strong>Code Runner</strong> 和 <strong>C&#x2F;C++ 插件</strong>。</p>\n<h3 id=\"安裝-Code-Runner-插件\"><a href=\"#安裝-Code-Runner-插件\" class=\"headerlink\" title=\"安裝 Code Runner 插件\"></a><strong>安裝 Code Runner 插件</strong></h3><ol>\n<li><p>在 <strong>VSCode</strong> 中打開擴展市場，搜尋 <strong>Code Runner</strong>，然後點擊 <strong>Install</strong> 安裝插件。</p>\n<ul>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner\">Code Runner 插件下載</a></li>\n</ul>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B2.png?alt=media&token=e98ba65b-edb2-4297-9624-958312ecacb9\" alt=\"Code Runner 插件畫面\"></p>\n</li>\n</ol>\n<h3 id=\"安裝-C-C-插件\"><a href=\"#安裝-C-C-插件\" class=\"headerlink\" title=\"安裝 C&#x2F;C++ 插件\"></a><strong>安裝 C&#x2F;C++ 插件</strong></h3><ol>\n<li><p>在 <strong>VSCode</strong> 中搜尋 **C&#x2F;C++**，然後點擊 <strong>Install</strong> 安裝插件。</p>\n<ul>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools\">C&#x2F;C++ 插件下載</a></li>\n</ul>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B1.png?alt=media&token=1c42e65c-d4b0-4e61-862a-78d16a519637\" alt=\"C/C++ 插件畫面\"></p>\n</li>\n</ol>\n<hr>\n<h3 id=\"3-編寫與運行-C-程式\"><a href=\"#3-編寫與運行-C-程式\" class=\"headerlink\" title=\"3. 編寫與運行 C++ 程式\"></a>3. 編寫與運行 C++ 程式</h3><ol>\n<li><p><strong>創建 C++ 檔案</strong>：</p>\n<ul>\n<li><p>在 <strong>VSCode</strong> 中創建一個新檔案 <code>hello.cpp</code>，並寫入以下 C++ 代碼：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cpp</span><br><span class=\"line\">複製程式碼</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span>using namespace std;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    string greeting = <span class=\"string\">&quot;Hello, World!&quot;</span>;</span><br><span class=\"line\">    string welcome = <span class=\"string\">&quot;Welcome to C++ programming!&quot;</span>;</span><br><span class=\"line\">    string message = <span class=\"string\">&quot;Let&#x27;s learn and have fun!&quot;</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> year = <span class=\"number\">2023</span>;</span><br><span class=\"line\">    <span class=\"type\">double</span> version = <span class=\"number\">1.0</span>;</span><br><span class=\"line\">    <span class=\"type\">char</span> initial = <span class=\"string\">&#x27;C&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    cout &lt;&lt; greeting &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; welcome &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; message &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Current year: &quot;</span> &lt;&lt; year &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Version: &quot;</span> &lt;&lt; version &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Initial: &quot;</span> &lt;&lt; initial &lt;&lt; endl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt;= <span class=\"number\">14</span>; ++i) &#123;</span><br><span class=\"line\">        cout &lt;&lt; <span class=\"string\">&quot;This is line number &quot;</span> &lt;&lt; i + <span class=\"number\">6</span> &lt;&lt; endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong>執行程式碼</strong>：</p>\n<ul>\n<li>使用 <strong>Code Runner</strong> 插件，你可以直接運行程式碼，無需手動編譯。按下 <strong>執行按鈕</strong>（Run Code）。</li>\n<li>程式的輸出會顯示在 <strong>VSCode</strong> 的終端中。</li>\n</ul>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B3.png?alt=media&token=f0a05a16-640f-4afc-9e49-0845bb5f7328\" alt=\"執行 C++ 程式畫面\"></p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B4.png?alt=media&token=b54995aa-fb3d-43ba-9aae-96d777de5f59\" alt=\"執行結果畫面\"></p>\n</li>\n</ol>\n<hr>\n<h3 id=\"4-功能按鈕的使用說明\"><a href=\"#4-功能按鈕的使用說明\" class=\"headerlink\" title=\"4. 功能按鈕的使用說明\"></a>4. 功能按鈕的使用說明</h3><p>在你使用 <strong>Code Runner</strong> 和 <strong>C&#x2F;C++ 插件</strong> 時，可能會看到以下幾個選項：</p>\n<ol>\n<li><strong>CompileRun: Compile with default flags &amp; Run with default arguments</strong><ul>\n<li>使用預設的編譯選項來編譯並執行程式。</li>\n</ul>\n</li>\n<li><strong>Debug C&#x2F;C++ File</strong><ul>\n<li>啟動 C&#x2F;C++ 的除錯模式，允許你設置斷點、逐步執行程式並檢查變數。</li>\n</ul>\n</li>\n<li><strong>Run Code</strong><ul>\n<li>使用 <strong>Code Runner</strong> 插件直接運行程式，不需手動編譯，適合快速測試。</li>\n</ul>\n</li>\n<li><strong>CompileRun: Debug</strong><ul>\n<li>使用除錯模式進行編譯和執行，便於進行問題排查。</li>\n</ul>\n</li>\n<li><strong>Run C&#x2F;C++ File</strong><ul>\n<li>專門針對 C&#x2F;C++ 檔案進行執行，通常會先編譯再運行。</li>\n</ul>\n</li>\n</ol>\n<p>這些功能按鈕能讓你靈活選擇是否快速測試、完整編譯或進行除錯，根據需求選擇合適的功能即可。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B5.png?alt=media&token=16237bbf-7d95-4230-965b-d06e511aa7b5\" alt=\"功能按鈕選項畫面\"></p>\n<hr>\n<h3 id=\"5-執行結果\"><a href=\"#5-執行結果\" class=\"headerlink\" title=\"5. 執行結果\"></a>5. 執行結果</h3><p>當你成功編譯和執行程式後，應該會在 <strong>VSCode</strong> 終端中看到以下輸出：</p>\n<figure class=\"highlight vbnet\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vbnet</span><br><span class=\"line\">複製程式碼</span><br><span class=\"line\">Hello, World!</span><br><span class=\"line\">Welcome <span class=\"keyword\">to</span> C++ programming!</span><br><span class=\"line\"><span class=\"keyword\">Let</span><span class=\"comment\">&#x27;s learn and have fun!</span></span><br><span class=\"line\">Current year: <span class=\"number\">2023</span></span><br><span class=\"line\"><span class=\"symbol\">Version:</span> <span class=\"number\">1.0</span></span><br><span class=\"line\"><span class=\"symbol\">Initial:</span> C</span><br><span class=\"line\">This <span class=\"built_in\">is</span> line number <span class=\"number\">7</span></span><br><span class=\"line\">This <span class=\"built_in\">is</span> line number <span class=\"number\">8</span></span><br><span class=\"line\">...</span><br><span class=\"line\">This <span class=\"built_in\">is</span> line number <span class=\"number\">20</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"Debug-逐行教學\"><a href=\"#Debug-逐行教學\" class=\"headerlink\" title=\"Debug 逐行教學\"></a>Debug 逐行教學</h3><p>當你進入 <strong>Debug 模式</strong> 後，可以逐行檢查程式的運行情況。以下是一個變數在 Debug 模式下顯示的範例：</p>\n<ol>\n<li><p>可以看到變數 <code>greeting</code> 及其值已在右側顯示。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B6.png?alt=media&token=e0b4e072-a7ef-43a6-9845-65716b722a96\" alt=\"Debug 模式畫面\"></p>\n</li>\n</ol>\n","excerpt":"","more":"<p>今天在學校老師突然派一個 c++作業，結果我電腦還沒裝 C++環境，讀檔案一直出問題，我決定今天好好寫一個 Mac 在 vscode 中執行 C++ 的教學。</p>\n<hr>\n<h3 id=\"在-Mac-上使用-VSCode-的-Code-Runner-和-C-C-插件來編譯與執行-C-程式\"><a href=\"#在-Mac-上使用-VSCode-的-Code-Runner-和-C-C-插件來編譯與執行-C-程式\" class=\"headerlink\" title=\"在 Mac 上使用 VSCode 的 Code Runner 和 C&#x2F;C++ 插件來編譯與執行 C++ 程式\"></a>在 Mac 上使用 VSCode 的 Code Runner 和 C&#x2F;C++ 插件來編譯與執行 C++ 程式</h3><p>這個教學將詳細說明如何使用 <strong>VSCode</strong> 的 <strong>Code Runner</strong> 和 <strong>C&#x2F;C++ 插件</strong> 來編譯與執行 C++ 程式，並介紹幾個常見功能按鈕的說明。</p>\n<hr>\n<h3 id=\"1-確認安裝-Clang-編譯器\"><a href=\"#1-確認安裝-Clang-編譯器\" class=\"headerlink\" title=\"1. 確認安裝 Clang 編譯器\"></a>1. 確認安裝 Clang 編譯器</h3><p><strong>補充：在使用 Clang 之前，必須確保你的 Mac 上已經安裝了 Xcode 或 Xcode Command Line Tools，因為 Clang 是隨 Xcode 一起安裝的。</strong></p>\n<h3 id=\"確認是否已安裝-Xcode\"><a href=\"#確認是否已安裝-Xcode\" class=\"headerlink\" title=\"確認是否已安裝 Xcode\"></a><strong>確認是否已安裝 Xcode</strong></h3><ul>\n<li>打開 <strong>終端</strong>（Terminal）並輸入以下指令來確認 Xcode 是否已安裝：如果已經安裝，你會看到提示訊息告訴你 Xcode Command Line Tools 已經安裝。如果尚未安裝，系統將自動引導你進行安裝。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xcode-select --install</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"檢查-Clang-版本\"><a href=\"#檢查-Clang-版本\" class=\"headerlink\" title=\"檢查 Clang 版本\"></a><strong>檢查 Clang 版本</strong></h3><ol>\n<li><p>打開 <strong>終端</strong>（Terminal）。</p>\n</li>\n<li><p>輸入以下指令來檢查 Clang 的版本：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">clang --version</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>如果 Clang 已安裝，終端會顯示如下類似的版本資訊：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Apple</span> <span class=\"string\">clang</span> <span class=\"string\">version</span> <span class=\"number\">14.0</span><span class=\"number\">.3</span> <span class=\"string\">(clang-1403.0.22.14.1)</span></span><br><span class=\"line\"><span class=\"attr\">Target:</span> <span class=\"string\">x86_64-apple-darwin22.5.0</span></span><br><span class=\"line\"><span class=\"attr\">Thread model:</span> <span class=\"string\">posix</span></span><br><span class=\"line\"><span class=\"attr\">InstalledDir:</span> <span class=\"string\">/Library/Developer/CommandLineTools/usr/bin</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n<hr>\n<h3 id=\"2-使用-Code-Runner-和-C-C-插件執行-C-程式\"><a href=\"#2-使用-Code-Runner-和-C-C-插件執行-C-程式\" class=\"headerlink\" title=\"2. 使用 Code Runner 和 C&#x2F;C++ 插件執行 C++ 程式\"></a>2. 使用 Code Runner 和 C&#x2F;C++ 插件執行 C++ 程式</h3><p>在進行程式開發之前，你需要在 <strong>VSCode</strong> 中安裝 <strong>Code Runner</strong> 和 <strong>C&#x2F;C++ 插件</strong>。</p>\n<h3 id=\"安裝-Code-Runner-插件\"><a href=\"#安裝-Code-Runner-插件\" class=\"headerlink\" title=\"安裝 Code Runner 插件\"></a><strong>安裝 Code Runner 插件</strong></h3><ol>\n<li><p>在 <strong>VSCode</strong> 中打開擴展市場，搜尋 <strong>Code Runner</strong>，然後點擊 <strong>Install</strong> 安裝插件。</p>\n<ul>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=formulahendry.code-runner\">Code Runner 插件下載</a></li>\n</ul>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B2.png?alt=media&token=e98ba65b-edb2-4297-9624-958312ecacb9\" alt=\"Code Runner 插件畫面\"></p>\n</li>\n</ol>\n<h3 id=\"安裝-C-C-插件\"><a href=\"#安裝-C-C-插件\" class=\"headerlink\" title=\"安裝 C&#x2F;C++ 插件\"></a><strong>安裝 C&#x2F;C++ 插件</strong></h3><ol>\n<li><p>在 <strong>VSCode</strong> 中搜尋 **C&#x2F;C++**，然後點擊 <strong>Install</strong> 安裝插件。</p>\n<ul>\n<li><a href=\"https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools\">C&#x2F;C++ 插件下載</a></li>\n</ul>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B1.png?alt=media&token=1c42e65c-d4b0-4e61-862a-78d16a519637\" alt=\"C/C++ 插件畫面\"></p>\n</li>\n</ol>\n<hr>\n<h3 id=\"3-編寫與運行-C-程式\"><a href=\"#3-編寫與運行-C-程式\" class=\"headerlink\" title=\"3. 編寫與運行 C++ 程式\"></a>3. 編寫與運行 C++ 程式</h3><ol>\n<li><p><strong>創建 C++ 檔案</strong>：</p>\n<ul>\n<li><p>在 <strong>VSCode</strong> 中創建一個新檔案 <code>hello.cpp</code>，並寫入以下 C++ 代碼：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cpp</span><br><span class=\"line\">複製程式碼</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span>using namespace std;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    string greeting = <span class=\"string\">&quot;Hello, World!&quot;</span>;</span><br><span class=\"line\">    string welcome = <span class=\"string\">&quot;Welcome to C++ programming!&quot;</span>;</span><br><span class=\"line\">    string message = <span class=\"string\">&quot;Let&#x27;s learn and have fun!&quot;</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> year = <span class=\"number\">2023</span>;</span><br><span class=\"line\">    <span class=\"type\">double</span> version = <span class=\"number\">1.0</span>;</span><br><span class=\"line\">    <span class=\"type\">char</span> initial = <span class=\"string\">&#x27;C&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    cout &lt;&lt; greeting &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; welcome &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; message &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Current year: &quot;</span> &lt;&lt; year &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Version: &quot;</span> &lt;&lt; version &lt;&lt; endl;</span><br><span class=\"line\">    cout &lt;&lt; <span class=\"string\">&quot;Initial: &quot;</span> &lt;&lt; initial &lt;&lt; endl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt;= <span class=\"number\">14</span>; ++i) &#123;</span><br><span class=\"line\">        cout &lt;&lt; <span class=\"string\">&quot;This is line number &quot;</span> &lt;&lt; i + <span class=\"number\">6</span> &lt;&lt; endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong>執行程式碼</strong>：</p>\n<ul>\n<li>使用 <strong>Code Runner</strong> 插件，你可以直接運行程式碼，無需手動編譯。按下 <strong>執行按鈕</strong>（Run Code）。</li>\n<li>程式的輸出會顯示在 <strong>VSCode</strong> 的終端中。</li>\n</ul>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B3.png?alt=media&token=f0a05a16-640f-4afc-9e49-0845bb5f7328\" alt=\"執行 C++ 程式畫面\"></p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B4.png?alt=media&token=b54995aa-fb3d-43ba-9aae-96d777de5f59\" alt=\"執行結果畫面\"></p>\n</li>\n</ol>\n<hr>\n<h3 id=\"4-功能按鈕的使用說明\"><a href=\"#4-功能按鈕的使用說明\" class=\"headerlink\" title=\"4. 功能按鈕的使用說明\"></a>4. 功能按鈕的使用說明</h3><p>在你使用 <strong>Code Runner</strong> 和 <strong>C&#x2F;C++ 插件</strong> 時，可能會看到以下幾個選項：</p>\n<ol>\n<li><strong>CompileRun: Compile with default flags &amp; Run with default arguments</strong><ul>\n<li>使用預設的編譯選項來編譯並執行程式。</li>\n</ul>\n</li>\n<li><strong>Debug C&#x2F;C++ File</strong><ul>\n<li>啟動 C&#x2F;C++ 的除錯模式，允許你設置斷點、逐步執行程式並檢查變數。</li>\n</ul>\n</li>\n<li><strong>Run Code</strong><ul>\n<li>使用 <strong>Code Runner</strong> 插件直接運行程式，不需手動編譯，適合快速測試。</li>\n</ul>\n</li>\n<li><strong>CompileRun: Debug</strong><ul>\n<li>使用除錯模式進行編譯和執行，便於進行問題排查。</li>\n</ul>\n</li>\n<li><strong>Run C&#x2F;C++ File</strong><ul>\n<li>專門針對 C&#x2F;C++ 檔案進行執行，通常會先編譯再運行。</li>\n</ul>\n</li>\n</ol>\n<p>這些功能按鈕能讓你靈活選擇是否快速測試、完整編譯或進行除錯，根據需求選擇合適的功能即可。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B5.png?alt=media&token=16237bbf-7d95-4230-965b-d06e511aa7b5\" alt=\"功能按鈕選項畫面\"></p>\n<hr>\n<h3 id=\"5-執行結果\"><a href=\"#5-執行結果\" class=\"headerlink\" title=\"5. 執行結果\"></a>5. 執行結果</h3><p>當你成功編譯和執行程式後，應該會在 <strong>VSCode</strong> 終端中看到以下輸出：</p>\n<figure class=\"highlight vbnet\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vbnet</span><br><span class=\"line\">複製程式碼</span><br><span class=\"line\">Hello, World!</span><br><span class=\"line\">Welcome <span class=\"keyword\">to</span> C++ programming!</span><br><span class=\"line\"><span class=\"keyword\">Let</span><span class=\"comment\">&#x27;s learn and have fun!</span></span><br><span class=\"line\">Current year: <span class=\"number\">2023</span></span><br><span class=\"line\"><span class=\"symbol\">Version:</span> <span class=\"number\">1.0</span></span><br><span class=\"line\"><span class=\"symbol\">Initial:</span> C</span><br><span class=\"line\">This <span class=\"built_in\">is</span> line number <span class=\"number\">7</span></span><br><span class=\"line\">This <span class=\"built_in\">is</span> line number <span class=\"number\">8</span></span><br><span class=\"line\">...</span><br><span class=\"line\">This <span class=\"built_in\">is</span> line number <span class=\"number\">20</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"Debug-逐行教學\"><a href=\"#Debug-逐行教學\" class=\"headerlink\" title=\"Debug 逐行教學\"></a>Debug 逐行教學</h3><p>當你進入 <strong>Debug 模式</strong> 後，可以逐行檢查程式的運行情況。以下是一個變數在 Debug 模式下顯示的範例：</p>\n<ol>\n<li><p>可以看到變數 <code>greeting</code> 及其值已在右側顯示。</p>\n<p><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fmac%20%E5%9C%A8%20vscode%20%E5%9F%B7%E8%A1%8C%20c%2B%2B%2Fvscode-c%2B%2B6.png?alt=media&token=e0b4e072-a7ef-43a6-9845-65716b722a96\" alt=\"Debug 模式畫面\"></p>\n</li>\n</ol>\n"},{"layout":"post","title":"撰寫 Python 發送成績給學生確認","date":"2024-11-02T05:43:31.000Z","top_img":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2F%E6%92%B0%E5%AF%AB%20Python%20%E7%99%BC%E9%80%81%E6%88%90%E7%B8%BE%E7%B5%A6%E5%AD%B8%E7%94%9F%E7%A2%BA%E8%AA%8D%2Fpython-mailscore.webp?alt=media&token=0ed4da31-e1b5-4ea3-8f89-0ecf46d0f30c","cover":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2F%E6%92%B0%E5%AF%AB%20Python%20%E7%99%BC%E9%80%81%E6%88%90%E7%B8%BE%E7%B5%A6%E5%AD%B8%E7%94%9F%E7%A2%BA%E8%AA%8D%2Fpython-mailscore.webp?alt=media&token=0ed4da31-e1b5-4ea3-8f89-0ecf46d0f30c","_content":"\n### 程式功能概述\n\n此 Python 程式使用 `smtplib` 庫來自動發送學生成績通知郵件。從 Excel 檔案中讀取每位學生的成績，並依據其學號生成專屬郵件，郵件以純文字格式發送至指定學校郵箱地址。為了避免 Gmail 將郵件自動摺疊，程式為每封郵件添加了唯一的時間標記。\n\n---\n\n### 步驟詳解\n\n### 1. 準備所需的程式庫\n\n我們使用以下程式庫：\n\n- `pandas`：讀取 Excel 檔案，將學生的成績資料導入程式。\n- `smtplib`：用於設置 SMTP 伺服器並發送郵件。\n- `datetime`：生成唯一的時間標記，避免 Gmail 認定郵件內容相同。\n\n```python\nimport pandas as pd\nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\nfrom datetime import datetime\n```\n\n### 2. 讀取 Excel 檔案\n\n使用 `pandas` 讀取 Excel 檔案的「工作表 1」工作表。只提取所需的欄位：`班級`、`學號`、`姓名`、`隨堂1` 至 `隨堂4`。\n\n```python\nfile_path = 'ta-score-mid.xlsx'\ndata = pd.read_excel(file_path, sheet_name='工作表1')\ndata = data[['班級', '學號', '姓名', '隨堂1', '隨堂2', '隨堂3', '隨堂4']]\n```\n\n### 3. 設置 SMTP 伺服器\n\n在此程式中，我們使用 Gmail 的 SMTP 伺服器來發送郵件。設置伺服器地址、登入帳號和應用程式密碼。\n\n```python\nsmtp_server = \"smtp.gmail.com\"\nsmtp_port = 587\nsmtp_user = \"your_email@gmail.com\"  # 替換為您的 Gmail 地址\nsmtp_password = \"your_app_specific_password\"  # 替換為您的應用程式密碼\n```\n\n### 4. 開啟伺服器連接\n\n使用 `smtplib.SMTP` 建立伺服器連接，啟動 TLS 安全層後登入帳號。\n\n```python\nserver = smtplib.SMTP(smtp_server, smtp_port)\nserver.starttls()\nserver.login(smtp_user, smtp_password)\n```\n\n### 5. 構建並發送郵件\n\n對每位學生資料迴圈處理：\n\n1. 生成個性化的郵件主體，包含學生成績資訊。\n2. 將「學號」欄位轉為小寫格式，以符合學校郵箱格式。\n3. 添加當前時間作為唯一標記，避免 Gmail 摺疊郵件。\n\n```python\nfor index, row in data.iterrows():\n    student_id = row['學號'].lower()\n    student_name_full = row['姓名']\n    student_name = student_name_full[-2:]\n    email_to = f\"{student_id}@stust.edu.tw, {student_id}@office.stust.edu.tw\"\n    subject = \"基礎數學 期中作業成績確認\"\n\n    scores = (\n        f\"隨堂1: {row['隨堂1']}\\\\n\"\n        f\"隨堂2: {row['隨堂2']}\\\\n\"\n        f\"隨堂3: {row['隨堂3']}\\\\n\"\n        f\"隨堂4: {row['隨堂4']}\"\n    )\n\n    unique_marker = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n\n    body = (\n        f\"{student_name} 同學哈囉!\\\\n\\\\n\"\n        \"這是你的隨堂成績:\\\\n\\\\n\"\n        f\"{scores}\\\\n\\\\n\"\n        \"如果有任何問題或是作業需要補交都記得要跟我說一下哦。\\\\n\\\\n\"\n        \"TA 莊鈞凱\\\\n\"\n        \"祝你下週期中考試每一科都💯\\\\n\\\\n\"\n        \"Web: <https://kingkaizhuang.github.io/\\\\n\\\\n>\"\n        f\"唯一標記：{unique_marker}\"\n    )\n\n    message = MIMEMultipart()\n    message[\"From\"] = f\"基礎數學助教 <{smtp_user}>\"\n    message[\"To\"] = email_to\n    message[\"Subject\"] = subject\n    message.attach(MIMEText(body, \"plain\"))\n\n    server.sendmail(smtp_user, email_to.split(\", \"), message.as_string())\n    print(f\"已發送成績給 {student_name_full} ({email_to})\")\n```\n\n### 6. 關閉伺服器連接\n\n在所有郵件發送完畢後，關閉 SMTP 伺服器連接。\n\n```python\nserver.quit()\n```\n\n---\n\n### 完整程式碼\n\n```python\nimport pandas as pd\nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\nfrom datetime import datetime\n\nfile_path = 'ta-score-mid.xlsx'\ndata = pd.read_excel(file_path, sheet_name='工作表1')\ndata = data[['班級', '學號', '姓名', '隨堂1', '隨堂2', '隨堂3', '隨堂4']]\n\nsmtp_server = \"smtp.gmail.com\"\nsmtp_port = 587\nsmtp_user = \"your_email@gmail.com\"  # 替換為您的 Gmail 地址\nsmtp_password = \"your_app_specific_password\"  # 替換為您的應用程式密碼\n\nserver = smtplib.SMTP(smtp_server, smtp_port)\nserver.starttls()\nserver.login(smtp_user, smtp_password)\n\nfor index, row in data.iterrows():\n    student_id = row['學號'].lower()\n    student_name_full = row['姓名']\n    student_name = student_name_full[-2:]\n    email_to = f\"{student_id}@stust.edu.tw, {student_id}@office.stust.edu.tw\"\n    subject = \"基礎數學 期中作業成績確認\"\n\n    scores = (\n        f\"隨堂1: {row['隨堂1']}\\\\n\"\n        f\"隨堂2: {row['隨堂2']}\\\\n\"\n        f\"隨堂3: {row['隨堂3']}\\\\n\"\n        f\"隨堂4: {row['隨堂4']}\"\n    )\n\n    unique_marker = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n\n    body = (\n        f\"{student_name} 同學哈囉!\\\\n\\\\n\"\n        \"這是你的隨堂成績:\\\\n\\\\n\"\n        f\"{scores}\\\\n\\\\n\"\n        \"如果有任何問題或是作業需要補交都記得要跟我說一下哦。\\\\n\\\\n\"\n        \"TA 莊鈞凱\\\\n\"\n        \"祝你下週期中考試每一科都💯\\\\n\\\\n\"\n        \"Web: <https://kingkaizhuang.github.io/\\\\n\\\\n>\"\n        f\"唯一標記：{unique_marker}\"\n    )\n\n    message = MIMEMultipart()\n    message[\"From\"] = f\"基礎數學助教 <{smtp_user}>\"\n    message[\"To\"] = email_to\n    message[\"Subject\"] = subject\n    message.attach(MIMEText(body, \"plain\"))\n\n    server.sendmail(smtp_user, email_to.split(\", \"), message.as_string())\n    print(f\"已發送成績給 {student_name_full} ({email_to})\")\n\nserver.quit(\n```\n","source":"_posts/撰寫 Python 發送成績給學生確認.md","raw":"---\nlayout: post\ntitle: 撰寫 Python 發送成績給學生確認\ndate: 2024-11-02 13:43:31\ntags:\n  - \"Python Email\"\ncategories:\n  - \"Python\"\n  - \"Email\"\ntop_img: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2F%E6%92%B0%E5%AF%AB%20Python%20%E7%99%BC%E9%80%81%E6%88%90%E7%B8%BE%E7%B5%A6%E5%AD%B8%E7%94%9F%E7%A2%BA%E8%AA%8D%2Fpython-mailscore.webp?alt=media&token=0ed4da31-e1b5-4ea3-8f89-0ecf46d0f30c\"\ncover: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2F%E6%92%B0%E5%AF%AB%20Python%20%E7%99%BC%E9%80%81%E6%88%90%E7%B8%BE%E7%B5%A6%E5%AD%B8%E7%94%9F%E7%A2%BA%E8%AA%8D%2Fpython-mailscore.webp?alt=media&token=0ed4da31-e1b5-4ea3-8f89-0ecf46d0f30c\"\n---\n\n### 程式功能概述\n\n此 Python 程式使用 `smtplib` 庫來自動發送學生成績通知郵件。從 Excel 檔案中讀取每位學生的成績，並依據其學號生成專屬郵件，郵件以純文字格式發送至指定學校郵箱地址。為了避免 Gmail 將郵件自動摺疊，程式為每封郵件添加了唯一的時間標記。\n\n---\n\n### 步驟詳解\n\n### 1. 準備所需的程式庫\n\n我們使用以下程式庫：\n\n- `pandas`：讀取 Excel 檔案，將學生的成績資料導入程式。\n- `smtplib`：用於設置 SMTP 伺服器並發送郵件。\n- `datetime`：生成唯一的時間標記，避免 Gmail 認定郵件內容相同。\n\n```python\nimport pandas as pd\nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\nfrom datetime import datetime\n```\n\n### 2. 讀取 Excel 檔案\n\n使用 `pandas` 讀取 Excel 檔案的「工作表 1」工作表。只提取所需的欄位：`班級`、`學號`、`姓名`、`隨堂1` 至 `隨堂4`。\n\n```python\nfile_path = 'ta-score-mid.xlsx'\ndata = pd.read_excel(file_path, sheet_name='工作表1')\ndata = data[['班級', '學號', '姓名', '隨堂1', '隨堂2', '隨堂3', '隨堂4']]\n```\n\n### 3. 設置 SMTP 伺服器\n\n在此程式中，我們使用 Gmail 的 SMTP 伺服器來發送郵件。設置伺服器地址、登入帳號和應用程式密碼。\n\n```python\nsmtp_server = \"smtp.gmail.com\"\nsmtp_port = 587\nsmtp_user = \"your_email@gmail.com\"  # 替換為您的 Gmail 地址\nsmtp_password = \"your_app_specific_password\"  # 替換為您的應用程式密碼\n```\n\n### 4. 開啟伺服器連接\n\n使用 `smtplib.SMTP` 建立伺服器連接，啟動 TLS 安全層後登入帳號。\n\n```python\nserver = smtplib.SMTP(smtp_server, smtp_port)\nserver.starttls()\nserver.login(smtp_user, smtp_password)\n```\n\n### 5. 構建並發送郵件\n\n對每位學生資料迴圈處理：\n\n1. 生成個性化的郵件主體，包含學生成績資訊。\n2. 將「學號」欄位轉為小寫格式，以符合學校郵箱格式。\n3. 添加當前時間作為唯一標記，避免 Gmail 摺疊郵件。\n\n```python\nfor index, row in data.iterrows():\n    student_id = row['學號'].lower()\n    student_name_full = row['姓名']\n    student_name = student_name_full[-2:]\n    email_to = f\"{student_id}@stust.edu.tw, {student_id}@office.stust.edu.tw\"\n    subject = \"基礎數學 期中作業成績確認\"\n\n    scores = (\n        f\"隨堂1: {row['隨堂1']}\\\\n\"\n        f\"隨堂2: {row['隨堂2']}\\\\n\"\n        f\"隨堂3: {row['隨堂3']}\\\\n\"\n        f\"隨堂4: {row['隨堂4']}\"\n    )\n\n    unique_marker = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n\n    body = (\n        f\"{student_name} 同學哈囉!\\\\n\\\\n\"\n        \"這是你的隨堂成績:\\\\n\\\\n\"\n        f\"{scores}\\\\n\\\\n\"\n        \"如果有任何問題或是作業需要補交都記得要跟我說一下哦。\\\\n\\\\n\"\n        \"TA 莊鈞凱\\\\n\"\n        \"祝你下週期中考試每一科都💯\\\\n\\\\n\"\n        \"Web: <https://kingkaizhuang.github.io/\\\\n\\\\n>\"\n        f\"唯一標記：{unique_marker}\"\n    )\n\n    message = MIMEMultipart()\n    message[\"From\"] = f\"基礎數學助教 <{smtp_user}>\"\n    message[\"To\"] = email_to\n    message[\"Subject\"] = subject\n    message.attach(MIMEText(body, \"plain\"))\n\n    server.sendmail(smtp_user, email_to.split(\", \"), message.as_string())\n    print(f\"已發送成績給 {student_name_full} ({email_to})\")\n```\n\n### 6. 關閉伺服器連接\n\n在所有郵件發送完畢後，關閉 SMTP 伺服器連接。\n\n```python\nserver.quit()\n```\n\n---\n\n### 完整程式碼\n\n```python\nimport pandas as pd\nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\nfrom datetime import datetime\n\nfile_path = 'ta-score-mid.xlsx'\ndata = pd.read_excel(file_path, sheet_name='工作表1')\ndata = data[['班級', '學號', '姓名', '隨堂1', '隨堂2', '隨堂3', '隨堂4']]\n\nsmtp_server = \"smtp.gmail.com\"\nsmtp_port = 587\nsmtp_user = \"your_email@gmail.com\"  # 替換為您的 Gmail 地址\nsmtp_password = \"your_app_specific_password\"  # 替換為您的應用程式密碼\n\nserver = smtplib.SMTP(smtp_server, smtp_port)\nserver.starttls()\nserver.login(smtp_user, smtp_password)\n\nfor index, row in data.iterrows():\n    student_id = row['學號'].lower()\n    student_name_full = row['姓名']\n    student_name = student_name_full[-2:]\n    email_to = f\"{student_id}@stust.edu.tw, {student_id}@office.stust.edu.tw\"\n    subject = \"基礎數學 期中作業成績確認\"\n\n    scores = (\n        f\"隨堂1: {row['隨堂1']}\\\\n\"\n        f\"隨堂2: {row['隨堂2']}\\\\n\"\n        f\"隨堂3: {row['隨堂3']}\\\\n\"\n        f\"隨堂4: {row['隨堂4']}\"\n    )\n\n    unique_marker = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n\n    body = (\n        f\"{student_name} 同學哈囉!\\\\n\\\\n\"\n        \"這是你的隨堂成績:\\\\n\\\\n\"\n        f\"{scores}\\\\n\\\\n\"\n        \"如果有任何問題或是作業需要補交都記得要跟我說一下哦。\\\\n\\\\n\"\n        \"TA 莊鈞凱\\\\n\"\n        \"祝你下週期中考試每一科都💯\\\\n\\\\n\"\n        \"Web: <https://kingkaizhuang.github.io/\\\\n\\\\n>\"\n        f\"唯一標記：{unique_marker}\"\n    )\n\n    message = MIMEMultipart()\n    message[\"From\"] = f\"基礎數學助教 <{smtp_user}>\"\n    message[\"To\"] = email_to\n    message[\"Subject\"] = subject\n    message.attach(MIMEText(body, \"plain\"))\n\n    server.sendmail(smtp_user, email_to.split(\", \"), message.as_string())\n    print(f\"已發送成績給 {student_name_full} ({email_to})\")\n\nserver.quit(\n```\n","slug":"撰寫 Python 發送成績給學生確認","published":1,"updated":"2026-01-28T14:17:25.070Z","_id":"cmkxfp4y800407z8zfkw46lub","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"程式功能概述\"><a href=\"#程式功能概述\" class=\"headerlink\" title=\"程式功能概述\"></a>程式功能概述</h3><p>此 Python 程式使用 <code>smtplib</code> 庫來自動發送學生成績通知郵件。從 Excel 檔案中讀取每位學生的成績，並依據其學號生成專屬郵件，郵件以純文字格式發送至指定學校郵箱地址。為了避免 Gmail 將郵件自動摺疊，程式為每封郵件添加了唯一的時間標記。</p>\n<hr>\n<h3 id=\"步驟詳解\"><a href=\"#步驟詳解\" class=\"headerlink\" title=\"步驟詳解\"></a>步驟詳解</h3><h3 id=\"1-準備所需的程式庫\"><a href=\"#1-準備所需的程式庫\" class=\"headerlink\" title=\"1. 準備所需的程式庫\"></a>1. 準備所需的程式庫</h3><p>我們使用以下程式庫：</p>\n<ul>\n<li><code>pandas</code>：讀取 Excel 檔案，將學生的成績資料導入程式。</li>\n<li><code>smtplib</code>：用於設置 SMTP 伺服器並發送郵件。</li>\n<li><code>datetime</code>：生成唯一的時間標記，避免 Gmail 認定郵件內容相同。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">import</span> smtplib</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.text <span class=\"keyword\">import</span> MIMEText</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.multipart <span class=\"keyword\">import</span> MIMEMultipart</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-讀取-Excel-檔案\"><a href=\"#2-讀取-Excel-檔案\" class=\"headerlink\" title=\"2. 讀取 Excel 檔案\"></a>2. 讀取 Excel 檔案</h3><p>使用 <code>pandas</code> 讀取 Excel 檔案的「工作表 1」工作表。只提取所需的欄位：<code>班級</code>、<code>學號</code>、<code>姓名</code>、<code>隨堂1</code> 至 <code>隨堂4</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">file_path = <span class=\"string\">&#x27;ta-score-mid.xlsx&#x27;</span></span><br><span class=\"line\">data = pd.read_excel(file_path, sheet_name=<span class=\"string\">&#x27;工作表1&#x27;</span>)</span><br><span class=\"line\">data = data[[<span class=\"string\">&#x27;班級&#x27;</span>, <span class=\"string\">&#x27;學號&#x27;</span>, <span class=\"string\">&#x27;姓名&#x27;</span>, <span class=\"string\">&#x27;隨堂1&#x27;</span>, <span class=\"string\">&#x27;隨堂2&#x27;</span>, <span class=\"string\">&#x27;隨堂3&#x27;</span>, <span class=\"string\">&#x27;隨堂4&#x27;</span>]]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-設置-SMTP-伺服器\"><a href=\"#3-設置-SMTP-伺服器\" class=\"headerlink\" title=\"3. 設置 SMTP 伺服器\"></a>3. 設置 SMTP 伺服器</h3><p>在此程式中，我們使用 Gmail 的 SMTP 伺服器來發送郵件。設置伺服器地址、登入帳號和應用程式密碼。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">smtp_server = <span class=\"string\">&quot;smtp.gmail.com&quot;</span></span><br><span class=\"line\">smtp_port = <span class=\"number\">587</span></span><br><span class=\"line\">smtp_user = <span class=\"string\">&quot;your_email@gmail.com&quot;</span>  <span class=\"comment\"># 替換為您的 Gmail 地址</span></span><br><span class=\"line\">smtp_password = <span class=\"string\">&quot;your_app_specific_password&quot;</span>  <span class=\"comment\"># 替換為您的應用程式密碼</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-開啟伺服器連接\"><a href=\"#4-開啟伺服器連接\" class=\"headerlink\" title=\"4. 開啟伺服器連接\"></a>4. 開啟伺服器連接</h3><p>使用 <code>smtplib.SMTP</code> 建立伺服器連接，啟動 TLS 安全層後登入帳號。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server = smtplib.SMTP(smtp_server, smtp_port)</span><br><span class=\"line\">server.starttls()</span><br><span class=\"line\">server.login(smtp_user, smtp_password)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-構建並發送郵件\"><a href=\"#5-構建並發送郵件\" class=\"headerlink\" title=\"5. 構建並發送郵件\"></a>5. 構建並發送郵件</h3><p>對每位學生資料迴圈處理：</p>\n<ol>\n<li>生成個性化的郵件主體，包含學生成績資訊。</li>\n<li>將「學號」欄位轉為小寫格式，以符合學校郵箱格式。</li>\n<li>添加當前時間作為唯一標記，避免 Gmail 摺疊郵件。</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> index, row <span class=\"keyword\">in</span> data.iterrows():</span><br><span class=\"line\">    student_id = row[<span class=\"string\">&#x27;學號&#x27;</span>].lower()</span><br><span class=\"line\">    student_name_full = row[<span class=\"string\">&#x27;姓名&#x27;</span>]</span><br><span class=\"line\">    student_name = student_name_full[-<span class=\"number\">2</span>:]</span><br><span class=\"line\">    email_to = <span class=\"string\">f&quot;<span class=\"subst\">&#123;student_id&#125;</span>@stust.edu.tw, <span class=\"subst\">&#123;student_id&#125;</span>@office.stust.edu.tw&quot;</span></span><br><span class=\"line\">    subject = <span class=\"string\">&quot;基礎數學 期中作業成績確認&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    scores = (</span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂1: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂1&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂2: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂2&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂3: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂3&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂4: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂4&#x27;</span>]&#125;</span>&quot;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    unique_marker = datetime.now().strftime(<span class=\"string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    body = (</span><br><span class=\"line\">        <span class=\"string\">f&quot;<span class=\"subst\">&#123;student_name&#125;</span> 同學哈囉!\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;這是你的隨堂成績:\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;<span class=\"subst\">&#123;scores&#125;</span>\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;如果有任何問題或是作業需要補交都記得要跟我說一下哦。\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;TA 莊鈞凱\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;祝你下週期中考試每一科都💯\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;Web: &lt;https://kingkaizhuang.github.io/\\\\n\\\\n&gt;&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;唯一標記：<span class=\"subst\">&#123;unique_marker&#125;</span>&quot;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    message = MIMEMultipart()</span><br><span class=\"line\">    message[<span class=\"string\">&quot;From&quot;</span>] = <span class=\"string\">f&quot;基礎數學助教 &lt;<span class=\"subst\">&#123;smtp_user&#125;</span>&gt;&quot;</span></span><br><span class=\"line\">    message[<span class=\"string\">&quot;To&quot;</span>] = email_to</span><br><span class=\"line\">    message[<span class=\"string\">&quot;Subject&quot;</span>] = subject</span><br><span class=\"line\">    message.attach(MIMEText(body, <span class=\"string\">&quot;plain&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    server.sendmail(smtp_user, email_to.split(<span class=\"string\">&quot;, &quot;</span>), message.as_string())</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;已發送成績給 <span class=\"subst\">&#123;student_name_full&#125;</span> (<span class=\"subst\">&#123;email_to&#125;</span>)&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-關閉伺服器連接\"><a href=\"#6-關閉伺服器連接\" class=\"headerlink\" title=\"6. 關閉伺服器連接\"></a>6. 關閉伺服器連接</h3><p>在所有郵件發送完畢後，關閉 SMTP 伺服器連接。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.quit()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"完整程式碼\"><a href=\"#完整程式碼\" class=\"headerlink\" title=\"完整程式碼\"></a>完整程式碼</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">import</span> smtplib</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.text <span class=\"keyword\">import</span> MIMEText</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.multipart <span class=\"keyword\">import</span> MIMEMultipart</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\">file_path = <span class=\"string\">&#x27;ta-score-mid.xlsx&#x27;</span></span><br><span class=\"line\">data = pd.read_excel(file_path, sheet_name=<span class=\"string\">&#x27;工作表1&#x27;</span>)</span><br><span class=\"line\">data = data[[<span class=\"string\">&#x27;班級&#x27;</span>, <span class=\"string\">&#x27;學號&#x27;</span>, <span class=\"string\">&#x27;姓名&#x27;</span>, <span class=\"string\">&#x27;隨堂1&#x27;</span>, <span class=\"string\">&#x27;隨堂2&#x27;</span>, <span class=\"string\">&#x27;隨堂3&#x27;</span>, <span class=\"string\">&#x27;隨堂4&#x27;</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">smtp_server = <span class=\"string\">&quot;smtp.gmail.com&quot;</span></span><br><span class=\"line\">smtp_port = <span class=\"number\">587</span></span><br><span class=\"line\">smtp_user = <span class=\"string\">&quot;your_email@gmail.com&quot;</span>  <span class=\"comment\"># 替換為您的 Gmail 地址</span></span><br><span class=\"line\">smtp_password = <span class=\"string\">&quot;your_app_specific_password&quot;</span>  <span class=\"comment\"># 替換為您的應用程式密碼</span></span><br><span class=\"line\"></span><br><span class=\"line\">server = smtplib.SMTP(smtp_server, smtp_port)</span><br><span class=\"line\">server.starttls()</span><br><span class=\"line\">server.login(smtp_user, smtp_password)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> index, row <span class=\"keyword\">in</span> data.iterrows():</span><br><span class=\"line\">    student_id = row[<span class=\"string\">&#x27;學號&#x27;</span>].lower()</span><br><span class=\"line\">    student_name_full = row[<span class=\"string\">&#x27;姓名&#x27;</span>]</span><br><span class=\"line\">    student_name = student_name_full[-<span class=\"number\">2</span>:]</span><br><span class=\"line\">    email_to = <span class=\"string\">f&quot;<span class=\"subst\">&#123;student_id&#125;</span>@stust.edu.tw, <span class=\"subst\">&#123;student_id&#125;</span>@office.stust.edu.tw&quot;</span></span><br><span class=\"line\">    subject = <span class=\"string\">&quot;基礎數學 期中作業成績確認&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    scores = (</span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂1: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂1&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂2: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂2&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂3: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂3&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂4: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂4&#x27;</span>]&#125;</span>&quot;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    unique_marker = datetime.now().strftime(<span class=\"string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    body = (</span><br><span class=\"line\">        <span class=\"string\">f&quot;<span class=\"subst\">&#123;student_name&#125;</span> 同學哈囉!\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;這是你的隨堂成績:\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;<span class=\"subst\">&#123;scores&#125;</span>\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;如果有任何問題或是作業需要補交都記得要跟我說一下哦。\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;TA 莊鈞凱\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;祝你下週期中考試每一科都💯\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;Web: &lt;https://kingkaizhuang.github.io/\\\\n\\\\n&gt;&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;唯一標記：<span class=\"subst\">&#123;unique_marker&#125;</span>&quot;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    message = MIMEMultipart()</span><br><span class=\"line\">    message[<span class=\"string\">&quot;From&quot;</span>] = <span class=\"string\">f&quot;基礎數學助教 &lt;<span class=\"subst\">&#123;smtp_user&#125;</span>&gt;&quot;</span></span><br><span class=\"line\">    message[<span class=\"string\">&quot;To&quot;</span>] = email_to</span><br><span class=\"line\">    message[<span class=\"string\">&quot;Subject&quot;</span>] = subject</span><br><span class=\"line\">    message.attach(MIMEText(body, <span class=\"string\">&quot;plain&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    server.sendmail(smtp_user, email_to.split(<span class=\"string\">&quot;, &quot;</span>), message.as_string())</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;已發送成績給 <span class=\"subst\">&#123;student_name_full&#125;</span> (<span class=\"subst\">&#123;email_to&#125;</span>)&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">server.quit(</span><br></pre></td></tr></table></figure>\n","excerpt":"","more":"<h3 id=\"程式功能概述\"><a href=\"#程式功能概述\" class=\"headerlink\" title=\"程式功能概述\"></a>程式功能概述</h3><p>此 Python 程式使用 <code>smtplib</code> 庫來自動發送學生成績通知郵件。從 Excel 檔案中讀取每位學生的成績，並依據其學號生成專屬郵件，郵件以純文字格式發送至指定學校郵箱地址。為了避免 Gmail 將郵件自動摺疊，程式為每封郵件添加了唯一的時間標記。</p>\n<hr>\n<h3 id=\"步驟詳解\"><a href=\"#步驟詳解\" class=\"headerlink\" title=\"步驟詳解\"></a>步驟詳解</h3><h3 id=\"1-準備所需的程式庫\"><a href=\"#1-準備所需的程式庫\" class=\"headerlink\" title=\"1. 準備所需的程式庫\"></a>1. 準備所需的程式庫</h3><p>我們使用以下程式庫：</p>\n<ul>\n<li><code>pandas</code>：讀取 Excel 檔案，將學生的成績資料導入程式。</li>\n<li><code>smtplib</code>：用於設置 SMTP 伺服器並發送郵件。</li>\n<li><code>datetime</code>：生成唯一的時間標記，避免 Gmail 認定郵件內容相同。</li>\n</ul>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">import</span> smtplib</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.text <span class=\"keyword\">import</span> MIMEText</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.multipart <span class=\"keyword\">import</span> MIMEMultipart</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-讀取-Excel-檔案\"><a href=\"#2-讀取-Excel-檔案\" class=\"headerlink\" title=\"2. 讀取 Excel 檔案\"></a>2. 讀取 Excel 檔案</h3><p>使用 <code>pandas</code> 讀取 Excel 檔案的「工作表 1」工作表。只提取所需的欄位：<code>班級</code>、<code>學號</code>、<code>姓名</code>、<code>隨堂1</code> 至 <code>隨堂4</code>。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">file_path = <span class=\"string\">&#x27;ta-score-mid.xlsx&#x27;</span></span><br><span class=\"line\">data = pd.read_excel(file_path, sheet_name=<span class=\"string\">&#x27;工作表1&#x27;</span>)</span><br><span class=\"line\">data = data[[<span class=\"string\">&#x27;班級&#x27;</span>, <span class=\"string\">&#x27;學號&#x27;</span>, <span class=\"string\">&#x27;姓名&#x27;</span>, <span class=\"string\">&#x27;隨堂1&#x27;</span>, <span class=\"string\">&#x27;隨堂2&#x27;</span>, <span class=\"string\">&#x27;隨堂3&#x27;</span>, <span class=\"string\">&#x27;隨堂4&#x27;</span>]]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-設置-SMTP-伺服器\"><a href=\"#3-設置-SMTP-伺服器\" class=\"headerlink\" title=\"3. 設置 SMTP 伺服器\"></a>3. 設置 SMTP 伺服器</h3><p>在此程式中，我們使用 Gmail 的 SMTP 伺服器來發送郵件。設置伺服器地址、登入帳號和應用程式密碼。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">smtp_server = <span class=\"string\">&quot;smtp.gmail.com&quot;</span></span><br><span class=\"line\">smtp_port = <span class=\"number\">587</span></span><br><span class=\"line\">smtp_user = <span class=\"string\">&quot;your_email@gmail.com&quot;</span>  <span class=\"comment\"># 替換為您的 Gmail 地址</span></span><br><span class=\"line\">smtp_password = <span class=\"string\">&quot;your_app_specific_password&quot;</span>  <span class=\"comment\"># 替換為您的應用程式密碼</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-開啟伺服器連接\"><a href=\"#4-開啟伺服器連接\" class=\"headerlink\" title=\"4. 開啟伺服器連接\"></a>4. 開啟伺服器連接</h3><p>使用 <code>smtplib.SMTP</code> 建立伺服器連接，啟動 TLS 安全層後登入帳號。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server = smtplib.SMTP(smtp_server, smtp_port)</span><br><span class=\"line\">server.starttls()</span><br><span class=\"line\">server.login(smtp_user, smtp_password)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-構建並發送郵件\"><a href=\"#5-構建並發送郵件\" class=\"headerlink\" title=\"5. 構建並發送郵件\"></a>5. 構建並發送郵件</h3><p>對每位學生資料迴圈處理：</p>\n<ol>\n<li>生成個性化的郵件主體，包含學生成績資訊。</li>\n<li>將「學號」欄位轉為小寫格式，以符合學校郵箱格式。</li>\n<li>添加當前時間作為唯一標記，避免 Gmail 摺疊郵件。</li>\n</ol>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> index, row <span class=\"keyword\">in</span> data.iterrows():</span><br><span class=\"line\">    student_id = row[<span class=\"string\">&#x27;學號&#x27;</span>].lower()</span><br><span class=\"line\">    student_name_full = row[<span class=\"string\">&#x27;姓名&#x27;</span>]</span><br><span class=\"line\">    student_name = student_name_full[-<span class=\"number\">2</span>:]</span><br><span class=\"line\">    email_to = <span class=\"string\">f&quot;<span class=\"subst\">&#123;student_id&#125;</span>@stust.edu.tw, <span class=\"subst\">&#123;student_id&#125;</span>@office.stust.edu.tw&quot;</span></span><br><span class=\"line\">    subject = <span class=\"string\">&quot;基礎數學 期中作業成績確認&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    scores = (</span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂1: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂1&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂2: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂2&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂3: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂3&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂4: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂4&#x27;</span>]&#125;</span>&quot;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    unique_marker = datetime.now().strftime(<span class=\"string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    body = (</span><br><span class=\"line\">        <span class=\"string\">f&quot;<span class=\"subst\">&#123;student_name&#125;</span> 同學哈囉!\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;這是你的隨堂成績:\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;<span class=\"subst\">&#123;scores&#125;</span>\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;如果有任何問題或是作業需要補交都記得要跟我說一下哦。\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;TA 莊鈞凱\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;祝你下週期中考試每一科都💯\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;Web: &lt;https://kingkaizhuang.github.io/\\\\n\\\\n&gt;&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;唯一標記：<span class=\"subst\">&#123;unique_marker&#125;</span>&quot;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    message = MIMEMultipart()</span><br><span class=\"line\">    message[<span class=\"string\">&quot;From&quot;</span>] = <span class=\"string\">f&quot;基礎數學助教 &lt;<span class=\"subst\">&#123;smtp_user&#125;</span>&gt;&quot;</span></span><br><span class=\"line\">    message[<span class=\"string\">&quot;To&quot;</span>] = email_to</span><br><span class=\"line\">    message[<span class=\"string\">&quot;Subject&quot;</span>] = subject</span><br><span class=\"line\">    message.attach(MIMEText(body, <span class=\"string\">&quot;plain&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    server.sendmail(smtp_user, email_to.split(<span class=\"string\">&quot;, &quot;</span>), message.as_string())</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;已發送成績給 <span class=\"subst\">&#123;student_name_full&#125;</span> (<span class=\"subst\">&#123;email_to&#125;</span>)&quot;</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-關閉伺服器連接\"><a href=\"#6-關閉伺服器連接\" class=\"headerlink\" title=\"6. 關閉伺服器連接\"></a>6. 關閉伺服器連接</h3><p>在所有郵件發送完畢後，關閉 SMTP 伺服器連接。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.quit()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h3 id=\"完整程式碼\"><a href=\"#完整程式碼\" class=\"headerlink\" title=\"完整程式碼\"></a>完整程式碼</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">import</span> smtplib</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.text <span class=\"keyword\">import</span> MIMEText</span><br><span class=\"line\"><span class=\"keyword\">from</span> email.mime.multipart <span class=\"keyword\">import</span> MIMEMultipart</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\">file_path = <span class=\"string\">&#x27;ta-score-mid.xlsx&#x27;</span></span><br><span class=\"line\">data = pd.read_excel(file_path, sheet_name=<span class=\"string\">&#x27;工作表1&#x27;</span>)</span><br><span class=\"line\">data = data[[<span class=\"string\">&#x27;班級&#x27;</span>, <span class=\"string\">&#x27;學號&#x27;</span>, <span class=\"string\">&#x27;姓名&#x27;</span>, <span class=\"string\">&#x27;隨堂1&#x27;</span>, <span class=\"string\">&#x27;隨堂2&#x27;</span>, <span class=\"string\">&#x27;隨堂3&#x27;</span>, <span class=\"string\">&#x27;隨堂4&#x27;</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">smtp_server = <span class=\"string\">&quot;smtp.gmail.com&quot;</span></span><br><span class=\"line\">smtp_port = <span class=\"number\">587</span></span><br><span class=\"line\">smtp_user = <span class=\"string\">&quot;your_email@gmail.com&quot;</span>  <span class=\"comment\"># 替換為您的 Gmail 地址</span></span><br><span class=\"line\">smtp_password = <span class=\"string\">&quot;your_app_specific_password&quot;</span>  <span class=\"comment\"># 替換為您的應用程式密碼</span></span><br><span class=\"line\"></span><br><span class=\"line\">server = smtplib.SMTP(smtp_server, smtp_port)</span><br><span class=\"line\">server.starttls()</span><br><span class=\"line\">server.login(smtp_user, smtp_password)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> index, row <span class=\"keyword\">in</span> data.iterrows():</span><br><span class=\"line\">    student_id = row[<span class=\"string\">&#x27;學號&#x27;</span>].lower()</span><br><span class=\"line\">    student_name_full = row[<span class=\"string\">&#x27;姓名&#x27;</span>]</span><br><span class=\"line\">    student_name = student_name_full[-<span class=\"number\">2</span>:]</span><br><span class=\"line\">    email_to = <span class=\"string\">f&quot;<span class=\"subst\">&#123;student_id&#125;</span>@stust.edu.tw, <span class=\"subst\">&#123;student_id&#125;</span>@office.stust.edu.tw&quot;</span></span><br><span class=\"line\">    subject = <span class=\"string\">&quot;基礎數學 期中作業成績確認&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    scores = (</span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂1: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂1&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂2: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂2&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂3: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂3&#x27;</span>]&#125;</span>\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;隨堂4: <span class=\"subst\">&#123;row[<span class=\"string\">&#x27;隨堂4&#x27;</span>]&#125;</span>&quot;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    unique_marker = datetime.now().strftime(<span class=\"string\">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    body = (</span><br><span class=\"line\">        <span class=\"string\">f&quot;<span class=\"subst\">&#123;student_name&#125;</span> 同學哈囉!\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;這是你的隨堂成績:\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;<span class=\"subst\">&#123;scores&#125;</span>\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;如果有任何問題或是作業需要補交都記得要跟我說一下哦。\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;TA 莊鈞凱\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;祝你下週期中考試每一科都💯\\\\n\\\\n&quot;</span></span><br><span class=\"line\">        <span class=\"string\">&quot;Web: &lt;https://kingkaizhuang.github.io/\\\\n\\\\n&gt;&quot;</span></span><br><span class=\"line\">        <span class=\"string\">f&quot;唯一標記：<span class=\"subst\">&#123;unique_marker&#125;</span>&quot;</span></span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    message = MIMEMultipart()</span><br><span class=\"line\">    message[<span class=\"string\">&quot;From&quot;</span>] = <span class=\"string\">f&quot;基礎數學助教 &lt;<span class=\"subst\">&#123;smtp_user&#125;</span>&gt;&quot;</span></span><br><span class=\"line\">    message[<span class=\"string\">&quot;To&quot;</span>] = email_to</span><br><span class=\"line\">    message[<span class=\"string\">&quot;Subject&quot;</span>] = subject</span><br><span class=\"line\">    message.attach(MIMEText(body, <span class=\"string\">&quot;plain&quot;</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    server.sendmail(smtp_user, email_to.split(<span class=\"string\">&quot;, &quot;</span>), message.as_string())</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;已發送成績給 <span class=\"subst\">&#123;student_name_full&#125;</span> (<span class=\"subst\">&#123;email_to&#125;</span>)&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">server.quit(</span><br></pre></td></tr></table></figure>\n"},{"layout":"post","title":"Wordpress 動態選單","date":"2024-09-25T16:33:48.000Z","top_img":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fwordpress%20%E5%8B%95%E6%85%8B%E9%81%B8%E5%96%AE%E6%95%99%E5%AD%B8%2Fdynamic-wp-nav.webp?alt=media&token=b20209da-6039-49f2-8df4-35b3e48be9e4","cover":"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fwordpress%20%E5%8B%95%E6%85%8B%E9%81%B8%E5%96%AE%E6%95%99%E5%AD%B8%2Fdynamic-wp-nav.webp?alt=media&token=b20209da-6039-49f2-8df4-35b3e48be9e4","_content":"\n## 步驟 1：連結對應選單\n\n```php\n$menu_items = wp_get_nav_menu_items('首頁選單');\n```\n\n這段程式碼使用了 `wp_get_nav_menu_items()` 函數，傳入選單的名稱 `'首頁選單'`，該名稱對應的是你在 WordPress 後台中設定的選單名稱。\n\n👇🏻 後台長這樣 👇🏻\n![wordpress-background](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fwordpress%20%E5%8B%95%E6%85%8B%E9%81%B8%E5%96%AE%E6%95%99%E5%AD%B8%2Fwp-back-nav.png?alt=media&token=1bbfaa5c-1e34-4b9c-9683-6f64a99e62c4)\n\n### 範例：\n\n假設你在 WordPress 後台創建了一個選單，並命名為「首頁選單」，該選單中包含以下項目：\n\n1. Home\n2. Services\n   - Web Development\n   - App Development\n3. About Us\n4. Contact\n\n`wp_get_nav_menu_items()` 會返回這些選單項目作為一個物件陣列，每個項目包含：\n\n- `ID`：選單項目的唯一標識符\n- `title`：選單項目的標題（如 \"Home\", \"Services\"）\n- `url`：選單項目的連結\n- `menu_item_parent`：父選單項目的 ID（若是頂層項目則為 0）\n\n## 步驟 2：組織選單層次結構\n\n接下來，你需要將這些選單項目按父子關係組織起來，以便生成一個層次結構清晰的選單。這段程式碼的目的是將選單項目分類為父選單和子選單。\n\n```php\n$tree_menu_items = array();\n\nforeach ($menu_items as $menu_item) {\n    if ($menu_item->menu_item_parent == 0) {\n        // 父選單項目\n        $tree_menu_items[$menu_item->ID] = $menu_item;\n        $tree_menu_items[$menu_item->ID]->children = array(); // 初始化子選單陣列\n    } else {\n        // 子選單項目，添加到父選單項目的 children 陣列中\n        $tree_menu_items[$menu_item->menu_item_parent]->children[] = $menu_item;\n    }\n}\n```\n\n### 範例：\n\n- 假設 \"Services\" 是一個父選單項目，它的 `menu_item_parent` 是 `0`。\n- \"Web Development\" 和 \"App Development\" 是它的子選單項目，它們的 `menu_item_parent` 為 \"Services\" 的 ID。\n\n程式會將這些項目組織為：\n\n- `Home`：無子選單\n- `Services`：\n  - 子選單：`Web Development`, `App Development`\n- `About Us`：無子選單\n- `Contact`：無子選單\n\n## 步驟 3：生成 HTML 選單\n\n這裡的程式碼將已整理好的選單結構動態地生成 HTML。\n\n```php\n<?php if (isset($tree_menu_items)): ?>\n    <?php foreach ($tree_menu_items as $menu_item): ?>\n        <li class=\"menu-item <?php if($hasSubmenu): ?>has-children<?php endif; ?>\">\n            <a id=\"menu-item-<?php echo $menu_item->ID; ?>\" href=\"<?php echo $menu_item->url; ?>\">\n                <?php echo esc_html($menu_item->title); ?>\n                <?php if ($hasSubmenu): ?>\n                    <span class=\"angle-down-wrap\"><i class=\"fa fa-angle-down\" aria-hidden=\"true\"></i></span>\n                <?php endif; ?>\n            </a>\n\n            <?php if ($hasSubmenu): ?>\n                <ul class=\"menu-dropdown-list list-unstyled\">\n                    <?php foreach ($menu_item->children as $child_menu_item): ?>\n                        <li class=\"dropdown-list-item\">\n                            <a id=\"menu-item-<?php echo $child_menu_item->ID; ?>\" href=\"<?php echo $child_menu_item->url; ?>\">\n                                <?php echo esc_html($child_menu_item->title); ?>\n                            </a>\n                        </li>\n                    <?php endforeach; ?>\n                </ul>\n            <?php endif; ?>\n        </li>\n    <?php endforeach; ?>\n<?php endif; ?>\n```\n\n這段程式碼會生成以下的 HTML：\n\n```html\n<ul class=\"menu-box list-unstyled\">\n  <li class=\"menu-item\">\n    <a id=\"menu-item-1\" href=\"/home\">Home</a>\n  </li>\n  <li class=\"menu-item has-children\">\n    <a id=\"menu-item-2\" href=\"/services\"\n      >Services\n      <span class=\"angle-down-wrap\"\n        ><i class=\"fa fa-angle-down\" aria-hidden=\"true\"></i\n      ></span>\n    </a>\n    <ul class=\"menu-dropdown-list list-unstyled\">\n      <li class=\"dropdown-list-item\">\n        <a id=\"menu-item-3\" href=\"/services/web-development\">Web Development</a>\n      </li>\n      <li class=\"dropdown-list-item\">\n        <a id=\"menu-item-4\" href=\"/services/app-development\">App Development</a>\n      </li>\n    </ul>\n  </li>\n  <li class=\"menu-item\">\n    <a id=\"menu-item-5\" href=\"/about-us\">About Us</a>\n  </li>\n  <li class=\"menu-item\">\n    <a id=\"menu-item-6\" href=\"/contact\">Contact</a>\n  </li>\n</ul>\n```\n\n- `menu-item-2` 是 `Services`，因為它有子選單，所以會附加 `has-children` class，並顯示一個下拉圖標（`<span class=\"angle-down-wrap\">`）。\n- 其子選單（`Web Development` 和 `App Development`）被放在一個內嵌的 `<ul class=\"menu-dropdown-list\">` 中。\n\n## 步驟 4：顯示和樣式\n\n這段程式碼最終將選單顯示在 `<header>` 中，並包含基於層次結構的樣式（如子選單的下拉圖標和層次結構的縮排）。\n\n## 補充 wp_get_nav_menu_items() 得到的結構\n\n在 WordPress 中，`wp_get_nav_menu_items()` 函數返回一個包含選單項目（`$menu_items`）的陣列。每個選單項目都是一個物件，包含許多屬性，這些屬性描述了選單中的每個項目。以下是 `$menu_items` 中每個選單項目的內容：\n\n### `$menu_items` 每個項目的結構：\n\n每個選單項目會包含以下常見屬性：\n\n1. **ID** (`$menu_item->ID`)\n   - 每個選單項目的唯一識別符。這個值可以用來區分不同的選單項目。\n2. **title** (`$menu_item->title`)\n   - 選單項目的名稱，這是會顯示在前端的文字。\n3. **url** (`$menu_item->url`)\n   - 選單項目的鏈接地址（例如，指向頁面的 URL）。\n4. **menu_item_parent** (`$menu_item->menu_item_parent`)\n   - 父選單項目的 ID。如果該選單項目是頂層選單，`menu_item_parent` 會是 `0`；如果它是子選單，`menu_item_parent` 會是其父選單項目的 ID。\n5. **post_type** (`$menu_item->post_type`)\n   - 指定該選單項目的類型，一般為 `nav_menu_item`。\n6. **object** (`$menu_item->object`)\n   - 選單項目的目標對象類型，例如 `page` 或 `category`。這表示選單鏈接指向的是一個頁面還是分類目錄等。\n7. **object_id** (`$menu_item->object_id`)\n   - 目標對象的 ID，例如，如果該選單項目連接到一個頁面，這裡會顯示該頁面的 ID。\n8. **type** (`$menu_item->type`)\n   - 選單項目的類型。通常為 `post_type` 或 `taxonomy`，指的是該選單項目連結到的對象是否是一個文章類型或分類法。\n9. **classes** (`$menu_item->classes`)\n   - 選單項目所包含的 CSS class。這是一個陣列，通常可用於為選單項目添加自定義樣式。\n10. **target** (`$menu_item->target`)\n    - 指定鏈接是否在新窗口或當前窗口打開，這與 HTML 的 `target=\"_blank\"` 類似。\n11. **attr_title** (`$menu_item->attr_title`)\n    - 為選單項目提供的 `title` 屬性，用來顯示在鼠標懸停在鏈接上時的提示文字。\n12. **description** (`$menu_item->description`)\n    - 選單項目的描述，通常不會顯示在前端，但在一些主題中可能會用於輔助說明。\n13. **xfn** (`$menu_item->xfn`)\n    - 用於指定鏈接關係（XFN，\"XHTML Friends Network\"），例如指定鏈接到該頁面的使用者關係（朋友、合作夥伴等）。\n14. **db_id** (`$menu_item->db_id`)\n    - 選單項目的資料庫 ID，與 `ID` 相同，用來唯一識別該選單項目。\n15. **menu_order** (`$menu_item->menu_order`)\n    - 選單項目的順序，用來指定該項目在選單中的顯示順序。\n\n### 範例：`$menu_items` 的內容範例\n\n假設有一個選單名為「首頁選單」，其中包含以下項目：\n\n1. Home（頂層選單）\n2. Services（頂層選單）\n   - Web Development（子選單）\n   - App Development（子選單）\n3. About Us（頂層選單）\n\n那麼，`$menu_items` 中的內容可能類似以下結構：\n\n```php\nArray (\n    [0] => stdClass Object (\n        [ID] => 1\n        [title] => Home\n        [url] => http://example.com/home\n        [menu_item_parent] => 0\n        [post_type] => nav_menu_item\n        [object] => page\n        [object_id] => 5\n        [type] => post_type\n        [classes] => Array ( )\n        [target] =>\n        [attr_title] =>\n        [description] =>\n        [xfn] =>\n        [db_id] => 1\n        [menu_order] => 1\n    )\n    [1] => stdClass Object (\n        [ID] => 2\n        [title] => Services\n        [url] => http://example.com/services\n        [menu_item_parent] => 0\n        [post_type] => nav_menu_item\n        [object] => page\n        [object_id] => 6\n        [type] => post_type\n        [classes] => Array ( )\n        [target] =>\n        [attr_title] =>\n        [description] =>\n        [xfn] =>\n        [db_id] => 2\n        [menu_order] => 2\n    )\n    [2] => stdClass Object (\n        [ID] => 3\n        [title] => Web Development\n        [url] => http://example.com/web-development\n        [menu_item_parent] => 2\n        [post_type] => nav_menu_item\n        [object] => page\n        [object_id] => 7\n        [type] => post_type\n        [classes] => Array ( )\n        [target] =>\n        [attr_title] =>\n        [description] =>\n        [xfn] =>\n        [db_id] => 3\n        [menu_order] => 3\n    )\n    [3] => stdClass Object (\n        [ID] => 4\n        [title] => App Development\n        [url] => http://example.com/app-development\n        [menu_item_parent] => 2\n        [post_type] => nav_menu_item\n        [object] => page\n        [object_id] => 8\n        [type] => post_type\n        [classes] => Array ( )\n        [target] =>\n        [attr_title] =>\n        [description] =>\n        [xfn] =>\n        [db_id] => 4\n        [menu_order] => 4\n    )\n    [4] => stdClass Object (\n        [ID] => 5\n        [title] => About Us\n        [url] => http://example.com/about-us\n        [menu_item_parent] => 0\n        [post_type] => nav_menu_item\n        [object] => page\n        [object_id] => 9\n        [type] => post_type\n        [classes] => Array ( )\n        [target] =>\n        [attr_title] =>\n        [description] =>\n        [xfn] =>\n        [db_id] => 5\n        [menu_order] => 5\n    )\n)\n\n```\n\n### 說明：\n\n1. `Home`：是一個頂層選單項目，`menu_item_parent` 為 `0`。\n2. `Services`：也是一個頂層選單項目，`menu_item_parent` 為 `0`，並且有子項目。\n3. `Web Development`：是 `Services` 的子選單，`menu_item_parent` 是 `Services` 的 `ID`（即 `2`）。\n4. `App Development`：也是 `Services` 的子選單，`menu_item_parent` 是 `Services` 的 `ID`（即 `2`）。\n5. `About Us`：是一個頂層選單項目，`menu_item_parent` 為 `0`。\n","source":"_posts/Wordpress-動態選單.md","raw":"---\nlayout: post\ntitle: Wordpress 動態選單\ndate: 2024-09-26 00:33:48\ntags:\n  - \"Wordpress\"\ncategories:\n  - \"Wordpress\"\n  - \"動態選單\"\ntop_img: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fwordpress%20%E5%8B%95%E6%85%8B%E9%81%B8%E5%96%AE%E6%95%99%E5%AD%B8%2Fdynamic-wp-nav.webp?alt=media&token=b20209da-6039-49f2-8df4-35b3e48be9e4\"\ncover: \"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fwordpress%20%E5%8B%95%E6%85%8B%E9%81%B8%E5%96%AE%E6%95%99%E5%AD%B8%2Fdynamic-wp-nav.webp?alt=media&token=b20209da-6039-49f2-8df4-35b3e48be9e4\"\n---\n\n## 步驟 1：連結對應選單\n\n```php\n$menu_items = wp_get_nav_menu_items('首頁選單');\n```\n\n這段程式碼使用了 `wp_get_nav_menu_items()` 函數，傳入選單的名稱 `'首頁選單'`，該名稱對應的是你在 WordPress 後台中設定的選單名稱。\n\n👇🏻 後台長這樣 👇🏻\n![wordpress-background](https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fwordpress%20%E5%8B%95%E6%85%8B%E9%81%B8%E5%96%AE%E6%95%99%E5%AD%B8%2Fwp-back-nav.png?alt=media&token=1bbfaa5c-1e34-4b9c-9683-6f64a99e62c4)\n\n### 範例：\n\n假設你在 WordPress 後台創建了一個選單，並命名為「首頁選單」，該選單中包含以下項目：\n\n1. Home\n2. Services\n   - Web Development\n   - App Development\n3. About Us\n4. Contact\n\n`wp_get_nav_menu_items()` 會返回這些選單項目作為一個物件陣列，每個項目包含：\n\n- `ID`：選單項目的唯一標識符\n- `title`：選單項目的標題（如 \"Home\", \"Services\"）\n- `url`：選單項目的連結\n- `menu_item_parent`：父選單項目的 ID（若是頂層項目則為 0）\n\n## 步驟 2：組織選單層次結構\n\n接下來，你需要將這些選單項目按父子關係組織起來，以便生成一個層次結構清晰的選單。這段程式碼的目的是將選單項目分類為父選單和子選單。\n\n```php\n$tree_menu_items = array();\n\nforeach ($menu_items as $menu_item) {\n    if ($menu_item->menu_item_parent == 0) {\n        // 父選單項目\n        $tree_menu_items[$menu_item->ID] = $menu_item;\n        $tree_menu_items[$menu_item->ID]->children = array(); // 初始化子選單陣列\n    } else {\n        // 子選單項目，添加到父選單項目的 children 陣列中\n        $tree_menu_items[$menu_item->menu_item_parent]->children[] = $menu_item;\n    }\n}\n```\n\n### 範例：\n\n- 假設 \"Services\" 是一個父選單項目，它的 `menu_item_parent` 是 `0`。\n- \"Web Development\" 和 \"App Development\" 是它的子選單項目，它們的 `menu_item_parent` 為 \"Services\" 的 ID。\n\n程式會將這些項目組織為：\n\n- `Home`：無子選單\n- `Services`：\n  - 子選單：`Web Development`, `App Development`\n- `About Us`：無子選單\n- `Contact`：無子選單\n\n## 步驟 3：生成 HTML 選單\n\n這裡的程式碼將已整理好的選單結構動態地生成 HTML。\n\n```php\n<?php if (isset($tree_menu_items)): ?>\n    <?php foreach ($tree_menu_items as $menu_item): ?>\n        <li class=\"menu-item <?php if($hasSubmenu): ?>has-children<?php endif; ?>\">\n            <a id=\"menu-item-<?php echo $menu_item->ID; ?>\" href=\"<?php echo $menu_item->url; ?>\">\n                <?php echo esc_html($menu_item->title); ?>\n                <?php if ($hasSubmenu): ?>\n                    <span class=\"angle-down-wrap\"><i class=\"fa fa-angle-down\" aria-hidden=\"true\"></i></span>\n                <?php endif; ?>\n            </a>\n\n            <?php if ($hasSubmenu): ?>\n                <ul class=\"menu-dropdown-list list-unstyled\">\n                    <?php foreach ($menu_item->children as $child_menu_item): ?>\n                        <li class=\"dropdown-list-item\">\n                            <a id=\"menu-item-<?php echo $child_menu_item->ID; ?>\" href=\"<?php echo $child_menu_item->url; ?>\">\n                                <?php echo esc_html($child_menu_item->title); ?>\n                            </a>\n                        </li>\n                    <?php endforeach; ?>\n                </ul>\n            <?php endif; ?>\n        </li>\n    <?php endforeach; ?>\n<?php endif; ?>\n```\n\n這段程式碼會生成以下的 HTML：\n\n```html\n<ul class=\"menu-box list-unstyled\">\n  <li class=\"menu-item\">\n    <a id=\"menu-item-1\" href=\"/home\">Home</a>\n  </li>\n  <li class=\"menu-item has-children\">\n    <a id=\"menu-item-2\" href=\"/services\"\n      >Services\n      <span class=\"angle-down-wrap\"\n        ><i class=\"fa fa-angle-down\" aria-hidden=\"true\"></i\n      ></span>\n    </a>\n    <ul class=\"menu-dropdown-list list-unstyled\">\n      <li class=\"dropdown-list-item\">\n        <a id=\"menu-item-3\" href=\"/services/web-development\">Web Development</a>\n      </li>\n      <li class=\"dropdown-list-item\">\n        <a id=\"menu-item-4\" href=\"/services/app-development\">App Development</a>\n      </li>\n    </ul>\n  </li>\n  <li class=\"menu-item\">\n    <a id=\"menu-item-5\" href=\"/about-us\">About Us</a>\n  </li>\n  <li class=\"menu-item\">\n    <a id=\"menu-item-6\" href=\"/contact\">Contact</a>\n  </li>\n</ul>\n```\n\n- `menu-item-2` 是 `Services`，因為它有子選單，所以會附加 `has-children` class，並顯示一個下拉圖標（`<span class=\"angle-down-wrap\">`）。\n- 其子選單（`Web Development` 和 `App Development`）被放在一個內嵌的 `<ul class=\"menu-dropdown-list\">` 中。\n\n## 步驟 4：顯示和樣式\n\n這段程式碼最終將選單顯示在 `<header>` 中，並包含基於層次結構的樣式（如子選單的下拉圖標和層次結構的縮排）。\n\n## 補充 wp_get_nav_menu_items() 得到的結構\n\n在 WordPress 中，`wp_get_nav_menu_items()` 函數返回一個包含選單項目（`$menu_items`）的陣列。每個選單項目都是一個物件，包含許多屬性，這些屬性描述了選單中的每個項目。以下是 `$menu_items` 中每個選單項目的內容：\n\n### `$menu_items` 每個項目的結構：\n\n每個選單項目會包含以下常見屬性：\n\n1. **ID** (`$menu_item->ID`)\n   - 每個選單項目的唯一識別符。這個值可以用來區分不同的選單項目。\n2. **title** (`$menu_item->title`)\n   - 選單項目的名稱，這是會顯示在前端的文字。\n3. **url** (`$menu_item->url`)\n   - 選單項目的鏈接地址（例如，指向頁面的 URL）。\n4. **menu_item_parent** (`$menu_item->menu_item_parent`)\n   - 父選單項目的 ID。如果該選單項目是頂層選單，`menu_item_parent` 會是 `0`；如果它是子選單，`menu_item_parent` 會是其父選單項目的 ID。\n5. **post_type** (`$menu_item->post_type`)\n   - 指定該選單項目的類型，一般為 `nav_menu_item`。\n6. **object** (`$menu_item->object`)\n   - 選單項目的目標對象類型，例如 `page` 或 `category`。這表示選單鏈接指向的是一個頁面還是分類目錄等。\n7. **object_id** (`$menu_item->object_id`)\n   - 目標對象的 ID，例如，如果該選單項目連接到一個頁面，這裡會顯示該頁面的 ID。\n8. **type** (`$menu_item->type`)\n   - 選單項目的類型。通常為 `post_type` 或 `taxonomy`，指的是該選單項目連結到的對象是否是一個文章類型或分類法。\n9. **classes** (`$menu_item->classes`)\n   - 選單項目所包含的 CSS class。這是一個陣列，通常可用於為選單項目添加自定義樣式。\n10. **target** (`$menu_item->target`)\n    - 指定鏈接是否在新窗口或當前窗口打開，這與 HTML 的 `target=\"_blank\"` 類似。\n11. **attr_title** (`$menu_item->attr_title`)\n    - 為選單項目提供的 `title` 屬性，用來顯示在鼠標懸停在鏈接上時的提示文字。\n12. **description** (`$menu_item->description`)\n    - 選單項目的描述，通常不會顯示在前端，但在一些主題中可能會用於輔助說明。\n13. **xfn** (`$menu_item->xfn`)\n    - 用於指定鏈接關係（XFN，\"XHTML Friends Network\"），例如指定鏈接到該頁面的使用者關係（朋友、合作夥伴等）。\n14. **db_id** (`$menu_item->db_id`)\n    - 選單項目的資料庫 ID，與 `ID` 相同，用來唯一識別該選單項目。\n15. **menu_order** (`$menu_item->menu_order`)\n    - 選單項目的順序，用來指定該項目在選單中的顯示順序。\n\n### 範例：`$menu_items` 的內容範例\n\n假設有一個選單名為「首頁選單」，其中包含以下項目：\n\n1. Home（頂層選單）\n2. Services（頂層選單）\n   - Web Development（子選單）\n   - App Development（子選單）\n3. About Us（頂層選單）\n\n那麼，`$menu_items` 中的內容可能類似以下結構：\n\n```php\nArray (\n    [0] => stdClass Object (\n        [ID] => 1\n        [title] => Home\n        [url] => http://example.com/home\n        [menu_item_parent] => 0\n        [post_type] => nav_menu_item\n        [object] => page\n        [object_id] => 5\n        [type] => post_type\n        [classes] => Array ( )\n        [target] =>\n        [attr_title] =>\n        [description] =>\n        [xfn] =>\n        [db_id] => 1\n        [menu_order] => 1\n    )\n    [1] => stdClass Object (\n        [ID] => 2\n        [title] => Services\n        [url] => http://example.com/services\n        [menu_item_parent] => 0\n        [post_type] => nav_menu_item\n        [object] => page\n        [object_id] => 6\n        [type] => post_type\n        [classes] => Array ( )\n        [target] =>\n        [attr_title] =>\n        [description] =>\n        [xfn] =>\n        [db_id] => 2\n        [menu_order] => 2\n    )\n    [2] => stdClass Object (\n        [ID] => 3\n        [title] => Web Development\n        [url] => http://example.com/web-development\n        [menu_item_parent] => 2\n        [post_type] => nav_menu_item\n        [object] => page\n        [object_id] => 7\n        [type] => post_type\n        [classes] => Array ( )\n        [target] =>\n        [attr_title] =>\n        [description] =>\n        [xfn] =>\n        [db_id] => 3\n        [menu_order] => 3\n    )\n    [3] => stdClass Object (\n        [ID] => 4\n        [title] => App Development\n        [url] => http://example.com/app-development\n        [menu_item_parent] => 2\n        [post_type] => nav_menu_item\n        [object] => page\n        [object_id] => 8\n        [type] => post_type\n        [classes] => Array ( )\n        [target] =>\n        [attr_title] =>\n        [description] =>\n        [xfn] =>\n        [db_id] => 4\n        [menu_order] => 4\n    )\n    [4] => stdClass Object (\n        [ID] => 5\n        [title] => About Us\n        [url] => http://example.com/about-us\n        [menu_item_parent] => 0\n        [post_type] => nav_menu_item\n        [object] => page\n        [object_id] => 9\n        [type] => post_type\n        [classes] => Array ( )\n        [target] =>\n        [attr_title] =>\n        [description] =>\n        [xfn] =>\n        [db_id] => 5\n        [menu_order] => 5\n    )\n)\n\n```\n\n### 說明：\n\n1. `Home`：是一個頂層選單項目，`menu_item_parent` 為 `0`。\n2. `Services`：也是一個頂層選單項目，`menu_item_parent` 為 `0`，並且有子項目。\n3. `Web Development`：是 `Services` 的子選單，`menu_item_parent` 是 `Services` 的 `ID`（即 `2`）。\n4. `App Development`：也是 `Services` 的子選單，`menu_item_parent` 是 `Services` 的 `ID`（即 `2`）。\n5. `About Us`：是一個頂層選單項目，`menu_item_parent` 為 `0`。\n","slug":"Wordpress-動態選單","published":1,"updated":"2026-01-28T14:17:25.062Z","_id":"cmkxfp4y800417z8z7gej5qq6","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"步驟-1：連結對應選單\"><a href=\"#步驟-1：連結對應選單\" class=\"headerlink\" title=\"步驟 1：連結對應選單\"></a>步驟 1：連結對應選單</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$menu_items</span> = <span class=\"title function_ invoke__\">wp_get_nav_menu_items</span>(<span class=\"string\">&#x27;首頁選單&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>這段程式碼使用了 <code>wp_get_nav_menu_items()</code> 函數，傳入選單的名稱 <code>&#39;首頁選單&#39;</code>，該名稱對應的是你在 WordPress 後台中設定的選單名稱。</p>\n<p>👇🏻 後台長這樣 👇🏻<br><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fwordpress%20%E5%8B%95%E6%85%8B%E9%81%B8%E5%96%AE%E6%95%99%E5%AD%B8%2Fwp-back-nav.png?alt=media&token=1bbfaa5c-1e34-4b9c-9683-6f64a99e62c4\" alt=\"wordpress-background\"></p>\n<h3 id=\"範例：\"><a href=\"#範例：\" class=\"headerlink\" title=\"範例：\"></a>範例：</h3><p>假設你在 WordPress 後台創建了一個選單，並命名為「首頁選單」，該選單中包含以下項目：</p>\n<ol>\n<li>Home</li>\n<li>Services<ul>\n<li>Web Development</li>\n<li>App Development</li>\n</ul>\n</li>\n<li>About Us</li>\n<li>Contact</li>\n</ol>\n<p><code>wp_get_nav_menu_items()</code> 會返回這些選單項目作為一個物件陣列，每個項目包含：</p>\n<ul>\n<li><code>ID</code>：選單項目的唯一標識符</li>\n<li><code>title</code>：選單項目的標題（如 “Home”, “Services”）</li>\n<li><code>url</code>：選單項目的連結</li>\n<li><code>menu_item_parent</code>：父選單項目的 ID（若是頂層項目則為 0）</li>\n</ul>\n<h2 id=\"步驟-2：組織選單層次結構\"><a href=\"#步驟-2：組織選單層次結構\" class=\"headerlink\" title=\"步驟 2：組織選單層次結構\"></a>步驟 2：組織選單層次結構</h2><p>接下來，你需要將這些選單項目按父子關係組織起來，以便生成一個層次結構清晰的選單。這段程式碼的目的是將選單項目分類為父選單和子選單。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$tree_menu_items</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> (<span class=\"variable\">$menu_items</span> <span class=\"keyword\">as</span> <span class=\"variable\">$menu_item</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$menu_item</span>-&gt;menu_item_parent == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 父選單項目</span></span><br><span class=\"line\">        <span class=\"variable\">$tree_menu_items</span>[<span class=\"variable\">$menu_item</span>-&gt;ID] = <span class=\"variable\">$menu_item</span>;</span><br><span class=\"line\">        <span class=\"variable\">$tree_menu_items</span>[<span class=\"variable\">$menu_item</span>-&gt;ID]-&gt;children = <span class=\"keyword\">array</span>(); <span class=\"comment\">// 初始化子選單陣列</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 子選單項目，添加到父選單項目的 children 陣列中</span></span><br><span class=\"line\">        <span class=\"variable\">$tree_menu_items</span>[<span class=\"variable\">$menu_item</span>-&gt;menu_item_parent]-&gt;children[] = <span class=\"variable\">$menu_item</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"範例：-1\"><a href=\"#範例：-1\" class=\"headerlink\" title=\"範例：\"></a>範例：</h3><ul>\n<li>假設 “Services” 是一個父選單項目，它的 <code>menu_item_parent</code> 是 <code>0</code>。</li>\n<li>“Web Development” 和 “App Development” 是它的子選單項目，它們的 <code>menu_item_parent</code> 為 “Services” 的 ID。</li>\n</ul>\n<p>程式會將這些項目組織為：</p>\n<ul>\n<li><code>Home</code>：無子選單</li>\n<li><code>Services</code>：<ul>\n<li>子選單：<code>Web Development</code>, <code>App Development</code></li>\n</ul>\n</li>\n<li><code>About Us</code>：無子選單</li>\n<li><code>Contact</code>：無子選單</li>\n</ul>\n<h2 id=\"步驟-3：生成-HTML-選單\"><a href=\"#步驟-3：生成-HTML-選單\" class=\"headerlink\" title=\"步驟 3：生成 HTML 選單\"></a>步驟 3：生成 HTML 選單</h2><p>這裡的程式碼將已整理好的選單結構動態地生成 HTML。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$tree_menu_items</span>)): <span class=\"meta\">?&gt;</span></span><br><span class=\"line\">    <span class=\"meta\">&lt;?php</span> <span class=\"keyword\">foreach</span> (<span class=\"variable\">$tree_menu_items</span> <span class=\"keyword\">as</span> <span class=\"variable\">$menu_item</span>): <span class=\"meta\">?&gt;</span></span><br><span class=\"line\">        &lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">menu</span>-<span class=\"title\">item</span> &lt;?<span class=\"title\">php</span> <span class=\"title\">if</span>($<span class=\"title\">hasSubmenu</span>): ?&gt;<span class=\"title\">has</span>-<span class=\"title\">children</span>&lt;?<span class=\"title\">php</span> <span class=\"title\">endif</span>; ?&gt;&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">a</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">menu</span>-<span class=\"title\">item</span>-&lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> $<span class=\"title\">menu_item</span>-&gt;<span class=\"title\">ID</span>; ?&gt;&quot; <span class=\"title\">href</span>=&quot;&lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> $<span class=\"title\">menu_item</span>-&gt;<span class=\"title\">url</span>; ?&gt;&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">                &lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> <span class=\"title\">esc_html</span>($<span class=\"title\">menu_item</span>-&gt;<span class=\"title\">title</span>); ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                &lt;?<span class=\"title\">php</span> <span class=\"title\">if</span> ($<span class=\"title\">hasSubmenu</span>): ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                    &lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">angle</span>-<span class=\"title\">down</span>-<span class=\"title\">wrap</span>&quot;&gt;&lt;<span class=\"title\">i</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">fa</span> <span class=\"title\">fa</span>-<span class=\"title\">angle</span>-<span class=\"title\">down</span>&quot; <span class=\"title\">aria</span>-<span class=\"title\">hidden</span>=&quot;<span class=\"title\">true</span>&quot;&gt;&lt;/<span class=\"title\">i</span>&gt;&lt;/<span class=\"title\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">                &lt;?<span class=\"title\">php</span> <span class=\"title\">endif</span>; ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;/<span class=\"title\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">            &lt;?<span class=\"title\">php</span> <span class=\"title\">if</span> ($<span class=\"title\">hasSubmenu</span>): ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                &lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">menu</span>-<span class=\"title\">dropdown</span>-<span class=\"title\">list</span> <span class=\"title\">list</span>-<span class=\"title\">unstyled</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">                    &lt;?<span class=\"title\">php</span> <span class=\"title\">foreach</span> ($<span class=\"title\">menu_item</span>-&gt;<span class=\"title\">children</span> <span class=\"title\">as</span> $<span class=\"title\">child_menu_item</span>): ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">dropdown</span>-<span class=\"title\">list</span>-<span class=\"title\">item</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">                            &lt;<span class=\"title\">a</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">menu</span>-<span class=\"title\">item</span>-&lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> $<span class=\"title\">child_menu_item</span>-&gt;<span class=\"title\">ID</span>; ?&gt;&quot; <span class=\"title\">href</span>=&quot;&lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> $<span class=\"title\">child_menu_item</span>-&gt;<span class=\"title\">url</span>; ?&gt;&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">                                &lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> <span class=\"title\">esc_html</span>($<span class=\"title\">child_menu_item</span>-&gt;<span class=\"title\">title</span>); ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                            &lt;/<span class=\"title\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">                        &lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">                    &lt;?<span class=\"title\">php</span> <span class=\"title\">endforeach</span>; ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;?<span class=\"title\">php</span> <span class=\"title\">endif</span>; ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;?<span class=\"title\">php</span> <span class=\"title\">endforeach</span>; ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;?<span class=\"title\">php</span> <span class=\"title\">endif</span>; ?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>這段程式碼會生成以下的 HTML：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-box list-unstyled&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-1&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/home&quot;</span>&gt;</span>Home<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-item has-children&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-2&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/services&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">      &gt;</span>Services</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;angle-down-wrap&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        &gt;</span><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fa fa-angle-down&quot;</span> <span class=\"attr\">aria-hidden</span>=<span class=\"string\">&quot;true&quot;</span>&gt;</span>&lt;/i</span><br><span class=\"line\">      &gt;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-dropdown-list list-unstyled&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;dropdown-list-item&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-3&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/services/web-development&quot;</span>&gt;</span>Web Development<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;dropdown-list-item&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-4&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/services/app-development&quot;</span>&gt;</span>App Development<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-5&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/about-us&quot;</span>&gt;</span>About Us<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-6&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/contact&quot;</span>&gt;</span>Contact<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>menu-item-2</code> 是 <code>Services</code>，因為它有子選單，所以會附加 <code>has-children</code> class，並顯示一個下拉圖標（<code>&lt;span class=&quot;angle-down-wrap&quot;&gt;</code>）。</li>\n<li>其子選單（<code>Web Development</code> 和 <code>App Development</code>）被放在一個內嵌的 <code>&lt;ul class=&quot;menu-dropdown-list&quot;&gt;</code> 中。</li>\n</ul>\n<h2 id=\"步驟-4：顯示和樣式\"><a href=\"#步驟-4：顯示和樣式\" class=\"headerlink\" title=\"步驟 4：顯示和樣式\"></a>步驟 4：顯示和樣式</h2><p>這段程式碼最終將選單顯示在 <code>&lt;header&gt;</code> 中，並包含基於層次結構的樣式（如子選單的下拉圖標和層次結構的縮排）。</p>\n<h2 id=\"補充-wp-get-nav-menu-items-得到的結構\"><a href=\"#補充-wp-get-nav-menu-items-得到的結構\" class=\"headerlink\" title=\"補充 wp_get_nav_menu_items() 得到的結構\"></a>補充 wp_get_nav_menu_items() 得到的結構</h2><p>在 WordPress 中，<code>wp_get_nav_menu_items()</code> 函數返回一個包含選單項目（<code>$menu_items</code>）的陣列。每個選單項目都是一個物件，包含許多屬性，這些屬性描述了選單中的每個項目。以下是 <code>$menu_items</code> 中每個選單項目的內容：</p>\n<h3 id=\"menu-items-每個項目的結構：\"><a href=\"#menu-items-每個項目的結構：\" class=\"headerlink\" title=\"$menu_items 每個項目的結構：\"></a><code>$menu_items</code> 每個項目的結構：</h3><p>每個選單項目會包含以下常見屬性：</p>\n<ol>\n<li><strong>ID</strong> (<code>$menu_item-&gt;ID</code>)<ul>\n<li>每個選單項目的唯一識別符。這個值可以用來區分不同的選單項目。</li>\n</ul>\n</li>\n<li><strong>title</strong> (<code>$menu_item-&gt;title</code>)<ul>\n<li>選單項目的名稱，這是會顯示在前端的文字。</li>\n</ul>\n</li>\n<li><strong>url</strong> (<code>$menu_item-&gt;url</code>)<ul>\n<li>選單項目的鏈接地址（例如，指向頁面的 URL）。</li>\n</ul>\n</li>\n<li><strong>menu_item_parent</strong> (<code>$menu_item-&gt;menu_item_parent</code>)<ul>\n<li>父選單項目的 ID。如果該選單項目是頂層選單，<code>menu_item_parent</code> 會是 <code>0</code>；如果它是子選單，<code>menu_item_parent</code> 會是其父選單項目的 ID。</li>\n</ul>\n</li>\n<li><strong>post_type</strong> (<code>$menu_item-&gt;post_type</code>)<ul>\n<li>指定該選單項目的類型，一般為 <code>nav_menu_item</code>。</li>\n</ul>\n</li>\n<li><strong>object</strong> (<code>$menu_item-&gt;object</code>)<ul>\n<li>選單項目的目標對象類型，例如 <code>page</code> 或 <code>category</code>。這表示選單鏈接指向的是一個頁面還是分類目錄等。</li>\n</ul>\n</li>\n<li><strong>object_id</strong> (<code>$menu_item-&gt;object_id</code>)<ul>\n<li>目標對象的 ID，例如，如果該選單項目連接到一個頁面，這裡會顯示該頁面的 ID。</li>\n</ul>\n</li>\n<li><strong>type</strong> (<code>$menu_item-&gt;type</code>)<ul>\n<li>選單項目的類型。通常為 <code>post_type</code> 或 <code>taxonomy</code>，指的是該選單項目連結到的對象是否是一個文章類型或分類法。</li>\n</ul>\n</li>\n<li><strong>classes</strong> (<code>$menu_item-&gt;classes</code>)<ul>\n<li>選單項目所包含的 CSS class。這是一個陣列，通常可用於為選單項目添加自定義樣式。</li>\n</ul>\n</li>\n<li><strong>target</strong> (<code>$menu_item-&gt;target</code>)<ul>\n<li>指定鏈接是否在新窗口或當前窗口打開，這與 HTML 的 <code>target=&quot;_blank&quot;</code> 類似。</li>\n</ul>\n</li>\n<li><strong>attr_title</strong> (<code>$menu_item-&gt;attr_title</code>)<ul>\n<li>為選單項目提供的 <code>title</code> 屬性，用來顯示在鼠標懸停在鏈接上時的提示文字。</li>\n</ul>\n</li>\n<li><strong>description</strong> (<code>$menu_item-&gt;description</code>)<ul>\n<li>選單項目的描述，通常不會顯示在前端，但在一些主題中可能會用於輔助說明。</li>\n</ul>\n</li>\n<li><strong>xfn</strong> (<code>$menu_item-&gt;xfn</code>)<ul>\n<li>用於指定鏈接關係（XFN，”XHTML Friends Network”），例如指定鏈接到該頁面的使用者關係（朋友、合作夥伴等）。</li>\n</ul>\n</li>\n<li><strong>db_id</strong> (<code>$menu_item-&gt;db_id</code>)<ul>\n<li>選單項目的資料庫 ID，與 <code>ID</code> 相同，用來唯一識別該選單項目。</li>\n</ul>\n</li>\n<li><strong>menu_order</strong> (<code>$menu_item-&gt;menu_order</code>)<ul>\n<li>選單項目的順序，用來指定該項目在選單中的顯示順序。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"範例：-menu-items-的內容範例\"><a href=\"#範例：-menu-items-的內容範例\" class=\"headerlink\" title=\"範例：$menu_items 的內容範例\"></a>範例：<code>$menu_items</code> 的內容範例</h3><p>假設有一個選單名為「首頁選單」，其中包含以下項目：</p>\n<ol>\n<li>Home（頂層選單）</li>\n<li>Services（頂層選單）<ul>\n<li>Web Development（子選單）</li>\n<li>App Development（子選單）</li>\n</ul>\n</li>\n<li>About Us（頂層選單）</li>\n</ol>\n<p>那麼，<code>$menu_items</code> 中的內容可能類似以下結構：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_ invoke__\">Array</span> (</span><br><span class=\"line\">    [<span class=\"number\">0</span>] =&gt; <span class=\"built_in\">stdClass</span> <span class=\"title function_ invoke__\">Object</span> (</span><br><span class=\"line\">        [ID] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">        [title] =&gt; Home</span><br><span class=\"line\">        [url] =&gt; <span class=\"attr\">http</span>://example.com/home</span><br><span class=\"line\">        [menu_item_parent] =&gt; <span class=\"number\">0</span></span><br><span class=\"line\">        [post_type] =&gt; nav_menu_item</span><br><span class=\"line\">        [<span class=\"keyword\">object</span>] =&gt; page</span><br><span class=\"line\">        [object_id] =&gt; <span class=\"number\">5</span></span><br><span class=\"line\">        [type] =&gt; post_type</span><br><span class=\"line\">        [classes] =&gt; <span class=\"title function_ invoke__\">Array</span> ( )</span><br><span class=\"line\">        [target] =&gt;</span><br><span class=\"line\">        [attr_title] =&gt;</span><br><span class=\"line\">        [description] =&gt;</span><br><span class=\"line\">        [xfn] =&gt;</span><br><span class=\"line\">        [db_id] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">        [menu_order] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">    [<span class=\"number\">1</span>] =&gt; <span class=\"built_in\">stdClass</span> <span class=\"title function_ invoke__\">Object</span> (</span><br><span class=\"line\">        [ID] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">        [title] =&gt; Services</span><br><span class=\"line\">        [url] =&gt; <span class=\"attr\">http</span>://example.com/services</span><br><span class=\"line\">        [menu_item_parent] =&gt; <span class=\"number\">0</span></span><br><span class=\"line\">        [post_type] =&gt; nav_menu_item</span><br><span class=\"line\">        [<span class=\"keyword\">object</span>] =&gt; page</span><br><span class=\"line\">        [object_id] =&gt; <span class=\"number\">6</span></span><br><span class=\"line\">        [type] =&gt; post_type</span><br><span class=\"line\">        [classes] =&gt; <span class=\"title function_ invoke__\">Array</span> ( )</span><br><span class=\"line\">        [target] =&gt;</span><br><span class=\"line\">        [attr_title] =&gt;</span><br><span class=\"line\">        [description] =&gt;</span><br><span class=\"line\">        [xfn] =&gt;</span><br><span class=\"line\">        [db_id] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">        [menu_order] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">    [<span class=\"number\">2</span>] =&gt; <span class=\"built_in\">stdClass</span> <span class=\"title function_ invoke__\">Object</span> (</span><br><span class=\"line\">        [ID] =&gt; <span class=\"number\">3</span></span><br><span class=\"line\">        [title] =&gt; Web Development</span><br><span class=\"line\">        [url] =&gt; <span class=\"attr\">http</span>://example.com/web-development</span><br><span class=\"line\">        [menu_item_parent] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">        [post_type] =&gt; nav_menu_item</span><br><span class=\"line\">        [<span class=\"keyword\">object</span>] =&gt; page</span><br><span class=\"line\">        [object_id] =&gt; <span class=\"number\">7</span></span><br><span class=\"line\">        [type] =&gt; post_type</span><br><span class=\"line\">        [classes] =&gt; <span class=\"title function_ invoke__\">Array</span> ( )</span><br><span class=\"line\">        [target] =&gt;</span><br><span class=\"line\">        [attr_title] =&gt;</span><br><span class=\"line\">        [description] =&gt;</span><br><span class=\"line\">        [xfn] =&gt;</span><br><span class=\"line\">        [db_id] =&gt; <span class=\"number\">3</span></span><br><span class=\"line\">        [menu_order] =&gt; <span class=\"number\">3</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">    [<span class=\"number\">3</span>] =&gt; <span class=\"built_in\">stdClass</span> <span class=\"title function_ invoke__\">Object</span> (</span><br><span class=\"line\">        [ID] =&gt; <span class=\"number\">4</span></span><br><span class=\"line\">        [title] =&gt; App Development</span><br><span class=\"line\">        [url] =&gt; <span class=\"attr\">http</span>://example.com/app-development</span><br><span class=\"line\">        [menu_item_parent] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">        [post_type] =&gt; nav_menu_item</span><br><span class=\"line\">        [<span class=\"keyword\">object</span>] =&gt; page</span><br><span class=\"line\">        [object_id] =&gt; <span class=\"number\">8</span></span><br><span class=\"line\">        [type] =&gt; post_type</span><br><span class=\"line\">        [classes] =&gt; <span class=\"title function_ invoke__\">Array</span> ( )</span><br><span class=\"line\">        [target] =&gt;</span><br><span class=\"line\">        [attr_title] =&gt;</span><br><span class=\"line\">        [description] =&gt;</span><br><span class=\"line\">        [xfn] =&gt;</span><br><span class=\"line\">        [db_id] =&gt; <span class=\"number\">4</span></span><br><span class=\"line\">        [menu_order] =&gt; <span class=\"number\">4</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">    [<span class=\"number\">4</span>] =&gt; <span class=\"built_in\">stdClass</span> <span class=\"title function_ invoke__\">Object</span> (</span><br><span class=\"line\">        [ID] =&gt; <span class=\"number\">5</span></span><br><span class=\"line\">        [title] =&gt; About Us</span><br><span class=\"line\">        [url] =&gt; <span class=\"attr\">http</span>://example.com/about-us</span><br><span class=\"line\">        [menu_item_parent] =&gt; <span class=\"number\">0</span></span><br><span class=\"line\">        [post_type] =&gt; nav_menu_item</span><br><span class=\"line\">        [<span class=\"keyword\">object</span>] =&gt; page</span><br><span class=\"line\">        [object_id] =&gt; <span class=\"number\">9</span></span><br><span class=\"line\">        [type] =&gt; post_type</span><br><span class=\"line\">        [classes] =&gt; <span class=\"title function_ invoke__\">Array</span> ( )</span><br><span class=\"line\">        [target] =&gt;</span><br><span class=\"line\">        [attr_title] =&gt;</span><br><span class=\"line\">        [description] =&gt;</span><br><span class=\"line\">        [xfn] =&gt;</span><br><span class=\"line\">        [db_id] =&gt; <span class=\"number\">5</span></span><br><span class=\"line\">        [menu_order] =&gt; <span class=\"number\">5</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"說明：\"><a href=\"#說明：\" class=\"headerlink\" title=\"說明：\"></a>說明：</h3><ol>\n<li><code>Home</code>：是一個頂層選單項目，<code>menu_item_parent</code> 為 <code>0</code>。</li>\n<li><code>Services</code>：也是一個頂層選單項目，<code>menu_item_parent</code> 為 <code>0</code>，並且有子項目。</li>\n<li><code>Web Development</code>：是 <code>Services</code> 的子選單，<code>menu_item_parent</code> 是 <code>Services</code> 的 <code>ID</code>（即 <code>2</code>）。</li>\n<li><code>App Development</code>：也是 <code>Services</code> 的子選單，<code>menu_item_parent</code> 是 <code>Services</code> 的 <code>ID</code>（即 <code>2</code>）。</li>\n<li><code>About Us</code>：是一個頂層選單項目，<code>menu_item_parent</code> 為 <code>0</code>。</li>\n</ol>\n","excerpt":"","more":"<h2 id=\"步驟-1：連結對應選單\"><a href=\"#步驟-1：連結對應選單\" class=\"headerlink\" title=\"步驟 1：連結對應選單\"></a>步驟 1：連結對應選單</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$menu_items</span> = <span class=\"title function_ invoke__\">wp_get_nav_menu_items</span>(<span class=\"string\">&#x27;首頁選單&#x27;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>這段程式碼使用了 <code>wp_get_nav_menu_items()</code> 函數，傳入選單的名稱 <code>&#39;首頁選單&#39;</code>，該名稱對應的是你在 WordPress 後台中設定的選單名稱。</p>\n<p>👇🏻 後台長這樣 👇🏻<br><img src=\"https://firebasestorage.googleapis.com/v0/b/zhuang-afef4.appspot.com/o/KingKaiZhuang.github.io%2Fwordpress%20%E5%8B%95%E6%85%8B%E9%81%B8%E5%96%AE%E6%95%99%E5%AD%B8%2Fwp-back-nav.png?alt=media&token=1bbfaa5c-1e34-4b9c-9683-6f64a99e62c4\" alt=\"wordpress-background\"></p>\n<h3 id=\"範例：\"><a href=\"#範例：\" class=\"headerlink\" title=\"範例：\"></a>範例：</h3><p>假設你在 WordPress 後台創建了一個選單，並命名為「首頁選單」，該選單中包含以下項目：</p>\n<ol>\n<li>Home</li>\n<li>Services<ul>\n<li>Web Development</li>\n<li>App Development</li>\n</ul>\n</li>\n<li>About Us</li>\n<li>Contact</li>\n</ol>\n<p><code>wp_get_nav_menu_items()</code> 會返回這些選單項目作為一個物件陣列，每個項目包含：</p>\n<ul>\n<li><code>ID</code>：選單項目的唯一標識符</li>\n<li><code>title</code>：選單項目的標題（如 “Home”, “Services”）</li>\n<li><code>url</code>：選單項目的連結</li>\n<li><code>menu_item_parent</code>：父選單項目的 ID（若是頂層項目則為 0）</li>\n</ul>\n<h2 id=\"步驟-2：組織選單層次結構\"><a href=\"#步驟-2：組織選單層次結構\" class=\"headerlink\" title=\"步驟 2：組織選單層次結構\"></a>步驟 2：組織選單層次結構</h2><p>接下來，你需要將這些選單項目按父子關係組織起來，以便生成一個層次結構清晰的選單。這段程式碼的目的是將選單項目分類為父選單和子選單。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$tree_menu_items</span> = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> (<span class=\"variable\">$menu_items</span> <span class=\"keyword\">as</span> <span class=\"variable\">$menu_item</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$menu_item</span>-&gt;menu_item_parent == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 父選單項目</span></span><br><span class=\"line\">        <span class=\"variable\">$tree_menu_items</span>[<span class=\"variable\">$menu_item</span>-&gt;ID] = <span class=\"variable\">$menu_item</span>;</span><br><span class=\"line\">        <span class=\"variable\">$tree_menu_items</span>[<span class=\"variable\">$menu_item</span>-&gt;ID]-&gt;children = <span class=\"keyword\">array</span>(); <span class=\"comment\">// 初始化子選單陣列</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 子選單項目，添加到父選單項目的 children 陣列中</span></span><br><span class=\"line\">        <span class=\"variable\">$tree_menu_items</span>[<span class=\"variable\">$menu_item</span>-&gt;menu_item_parent]-&gt;children[] = <span class=\"variable\">$menu_item</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"範例：-1\"><a href=\"#範例：-1\" class=\"headerlink\" title=\"範例：\"></a>範例：</h3><ul>\n<li>假設 “Services” 是一個父選單項目，它的 <code>menu_item_parent</code> 是 <code>0</code>。</li>\n<li>“Web Development” 和 “App Development” 是它的子選單項目，它們的 <code>menu_item_parent</code> 為 “Services” 的 ID。</li>\n</ul>\n<p>程式會將這些項目組織為：</p>\n<ul>\n<li><code>Home</code>：無子選單</li>\n<li><code>Services</code>：<ul>\n<li>子選單：<code>Web Development</code>, <code>App Development</code></li>\n</ul>\n</li>\n<li><code>About Us</code>：無子選單</li>\n<li><code>Contact</code>：無子選單</li>\n</ul>\n<h2 id=\"步驟-3：生成-HTML-選單\"><a href=\"#步驟-3：生成-HTML-選單\" class=\"headerlink\" title=\"步驟 3：生成 HTML 選單\"></a>步驟 3：生成 HTML 選單</h2><p>這裡的程式碼將已整理好的選單結構動態地生成 HTML。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$tree_menu_items</span>)): <span class=\"meta\">?&gt;</span></span><br><span class=\"line\">    <span class=\"meta\">&lt;?php</span> <span class=\"keyword\">foreach</span> (<span class=\"variable\">$tree_menu_items</span> <span class=\"keyword\">as</span> <span class=\"variable\">$menu_item</span>): <span class=\"meta\">?&gt;</span></span><br><span class=\"line\">        &lt;li <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">menu</span>-<span class=\"title\">item</span> &lt;?<span class=\"title\">php</span> <span class=\"title\">if</span>($<span class=\"title\">hasSubmenu</span>): ?&gt;<span class=\"title\">has</span>-<span class=\"title\">children</span>&lt;?<span class=\"title\">php</span> <span class=\"title\">endif</span>; ?&gt;&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;<span class=\"title\">a</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">menu</span>-<span class=\"title\">item</span>-&lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> $<span class=\"title\">menu_item</span>-&gt;<span class=\"title\">ID</span>; ?&gt;&quot; <span class=\"title\">href</span>=&quot;&lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> $<span class=\"title\">menu_item</span>-&gt;<span class=\"title\">url</span>; ?&gt;&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">                &lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> <span class=\"title\">esc_html</span>($<span class=\"title\">menu_item</span>-&gt;<span class=\"title\">title</span>); ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                &lt;?<span class=\"title\">php</span> <span class=\"title\">if</span> ($<span class=\"title\">hasSubmenu</span>): ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                    &lt;<span class=\"title\">span</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">angle</span>-<span class=\"title\">down</span>-<span class=\"title\">wrap</span>&quot;&gt;&lt;<span class=\"title\">i</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">fa</span> <span class=\"title\">fa</span>-<span class=\"title\">angle</span>-<span class=\"title\">down</span>&quot; <span class=\"title\">aria</span>-<span class=\"title\">hidden</span>=&quot;<span class=\"title\">true</span>&quot;&gt;&lt;/<span class=\"title\">i</span>&gt;&lt;/<span class=\"title\">span</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">                &lt;?<span class=\"title\">php</span> <span class=\"title\">endif</span>; ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;/<span class=\"title\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">            &lt;?<span class=\"title\">php</span> <span class=\"title\">if</span> ($<span class=\"title\">hasSubmenu</span>): ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                &lt;<span class=\"title\">ul</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">menu</span>-<span class=\"title\">dropdown</span>-<span class=\"title\">list</span> <span class=\"title\">list</span>-<span class=\"title\">unstyled</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">                    &lt;?<span class=\"title\">php</span> <span class=\"title\">foreach</span> ($<span class=\"title\">menu_item</span>-&gt;<span class=\"title\">children</span> <span class=\"title\">as</span> $<span class=\"title\">child_menu_item</span>): ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                        &lt;<span class=\"title\">li</span> <span class=\"title\">class</span>=&quot;<span class=\"title\">dropdown</span>-<span class=\"title\">list</span>-<span class=\"title\">item</span>&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">                            &lt;<span class=\"title\">a</span> <span class=\"title\">id</span>=&quot;<span class=\"title\">menu</span>-<span class=\"title\">item</span>-&lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> $<span class=\"title\">child_menu_item</span>-&gt;<span class=\"title\">ID</span>; ?&gt;&quot; <span class=\"title\">href</span>=&quot;&lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> $<span class=\"title\">child_menu_item</span>-&gt;<span class=\"title\">url</span>; ?&gt;&quot;&gt;</span></span><br><span class=\"line\"><span class=\"class\">                                &lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> <span class=\"title\">esc_html</span>($<span class=\"title\">child_menu_item</span>-&gt;<span class=\"title\">title</span>); ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                            &lt;/<span class=\"title\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">                        &lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">                    &lt;?<span class=\"title\">php</span> <span class=\"title\">endforeach</span>; ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">                &lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">            &lt;?<span class=\"title\">php</span> <span class=\"title\">endif</span>; ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;?<span class=\"title\">php</span> <span class=\"title\">endforeach</span>; ?&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;?<span class=\"title\">php</span> <span class=\"title\">endif</span>; ?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>這段程式碼會生成以下的 HTML：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-box list-unstyled&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-1&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/home&quot;</span>&gt;</span>Home<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-item has-children&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-2&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/services&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">      &gt;</span>Services</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;angle-down-wrap&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">        &gt;</span><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;fa fa-angle-down&quot;</span> <span class=\"attr\">aria-hidden</span>=<span class=\"string\">&quot;true&quot;</span>&gt;</span>&lt;/i</span><br><span class=\"line\">      &gt;<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ul</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-dropdown-list list-unstyled&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;dropdown-list-item&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-3&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/services/web-development&quot;</span>&gt;</span>Web Development<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;dropdown-list-item&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-4&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/services/app-development&quot;</span>&gt;</span>App Development<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-5&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/about-us&quot;</span>&gt;</span>About Us<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;menu-item&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;menu-item-6&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;/contact&quot;</span>&gt;</span>Contact<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>menu-item-2</code> 是 <code>Services</code>，因為它有子選單，所以會附加 <code>has-children</code> class，並顯示一個下拉圖標（<code>&lt;span class=&quot;angle-down-wrap&quot;&gt;</code>）。</li>\n<li>其子選單（<code>Web Development</code> 和 <code>App Development</code>）被放在一個內嵌的 <code>&lt;ul class=&quot;menu-dropdown-list&quot;&gt;</code> 中。</li>\n</ul>\n<h2 id=\"步驟-4：顯示和樣式\"><a href=\"#步驟-4：顯示和樣式\" class=\"headerlink\" title=\"步驟 4：顯示和樣式\"></a>步驟 4：顯示和樣式</h2><p>這段程式碼最終將選單顯示在 <code>&lt;header&gt;</code> 中，並包含基於層次結構的樣式（如子選單的下拉圖標和層次結構的縮排）。</p>\n<h2 id=\"補充-wp-get-nav-menu-items-得到的結構\"><a href=\"#補充-wp-get-nav-menu-items-得到的結構\" class=\"headerlink\" title=\"補充 wp_get_nav_menu_items() 得到的結構\"></a>補充 wp_get_nav_menu_items() 得到的結構</h2><p>在 WordPress 中，<code>wp_get_nav_menu_items()</code> 函數返回一個包含選單項目（<code>$menu_items</code>）的陣列。每個選單項目都是一個物件，包含許多屬性，這些屬性描述了選單中的每個項目。以下是 <code>$menu_items</code> 中每個選單項目的內容：</p>\n<h3 id=\"menu-items-每個項目的結構：\"><a href=\"#menu-items-每個項目的結構：\" class=\"headerlink\" title=\"$menu_items 每個項目的結構：\"></a><code>$menu_items</code> 每個項目的結構：</h3><p>每個選單項目會包含以下常見屬性：</p>\n<ol>\n<li><strong>ID</strong> (<code>$menu_item-&gt;ID</code>)<ul>\n<li>每個選單項目的唯一識別符。這個值可以用來區分不同的選單項目。</li>\n</ul>\n</li>\n<li><strong>title</strong> (<code>$menu_item-&gt;title</code>)<ul>\n<li>選單項目的名稱，這是會顯示在前端的文字。</li>\n</ul>\n</li>\n<li><strong>url</strong> (<code>$menu_item-&gt;url</code>)<ul>\n<li>選單項目的鏈接地址（例如，指向頁面的 URL）。</li>\n</ul>\n</li>\n<li><strong>menu_item_parent</strong> (<code>$menu_item-&gt;menu_item_parent</code>)<ul>\n<li>父選單項目的 ID。如果該選單項目是頂層選單，<code>menu_item_parent</code> 會是 <code>0</code>；如果它是子選單，<code>menu_item_parent</code> 會是其父選單項目的 ID。</li>\n</ul>\n</li>\n<li><strong>post_type</strong> (<code>$menu_item-&gt;post_type</code>)<ul>\n<li>指定該選單項目的類型，一般為 <code>nav_menu_item</code>。</li>\n</ul>\n</li>\n<li><strong>object</strong> (<code>$menu_item-&gt;object</code>)<ul>\n<li>選單項目的目標對象類型，例如 <code>page</code> 或 <code>category</code>。這表示選單鏈接指向的是一個頁面還是分類目錄等。</li>\n</ul>\n</li>\n<li><strong>object_id</strong> (<code>$menu_item-&gt;object_id</code>)<ul>\n<li>目標對象的 ID，例如，如果該選單項目連接到一個頁面，這裡會顯示該頁面的 ID。</li>\n</ul>\n</li>\n<li><strong>type</strong> (<code>$menu_item-&gt;type</code>)<ul>\n<li>選單項目的類型。通常為 <code>post_type</code> 或 <code>taxonomy</code>，指的是該選單項目連結到的對象是否是一個文章類型或分類法。</li>\n</ul>\n</li>\n<li><strong>classes</strong> (<code>$menu_item-&gt;classes</code>)<ul>\n<li>選單項目所包含的 CSS class。這是一個陣列，通常可用於為選單項目添加自定義樣式。</li>\n</ul>\n</li>\n<li><strong>target</strong> (<code>$menu_item-&gt;target</code>)<ul>\n<li>指定鏈接是否在新窗口或當前窗口打開，這與 HTML 的 <code>target=&quot;_blank&quot;</code> 類似。</li>\n</ul>\n</li>\n<li><strong>attr_title</strong> (<code>$menu_item-&gt;attr_title</code>)<ul>\n<li>為選單項目提供的 <code>title</code> 屬性，用來顯示在鼠標懸停在鏈接上時的提示文字。</li>\n</ul>\n</li>\n<li><strong>description</strong> (<code>$menu_item-&gt;description</code>)<ul>\n<li>選單項目的描述，通常不會顯示在前端，但在一些主題中可能會用於輔助說明。</li>\n</ul>\n</li>\n<li><strong>xfn</strong> (<code>$menu_item-&gt;xfn</code>)<ul>\n<li>用於指定鏈接關係（XFN，”XHTML Friends Network”），例如指定鏈接到該頁面的使用者關係（朋友、合作夥伴等）。</li>\n</ul>\n</li>\n<li><strong>db_id</strong> (<code>$menu_item-&gt;db_id</code>)<ul>\n<li>選單項目的資料庫 ID，與 <code>ID</code> 相同，用來唯一識別該選單項目。</li>\n</ul>\n</li>\n<li><strong>menu_order</strong> (<code>$menu_item-&gt;menu_order</code>)<ul>\n<li>選單項目的順序，用來指定該項目在選單中的顯示順序。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"範例：-menu-items-的內容範例\"><a href=\"#範例：-menu-items-的內容範例\" class=\"headerlink\" title=\"範例：$menu_items 的內容範例\"></a>範例：<code>$menu_items</code> 的內容範例</h3><p>假設有一個選單名為「首頁選單」，其中包含以下項目：</p>\n<ol>\n<li>Home（頂層選單）</li>\n<li>Services（頂層選單）<ul>\n<li>Web Development（子選單）</li>\n<li>App Development（子選單）</li>\n</ul>\n</li>\n<li>About Us（頂層選單）</li>\n</ol>\n<p>那麼，<code>$menu_items</code> 中的內容可能類似以下結構：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_ invoke__\">Array</span> (</span><br><span class=\"line\">    [<span class=\"number\">0</span>] =&gt; <span class=\"built_in\">stdClass</span> <span class=\"title function_ invoke__\">Object</span> (</span><br><span class=\"line\">        [ID] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">        [title] =&gt; Home</span><br><span class=\"line\">        [url] =&gt; <span class=\"attr\">http</span>://example.com/home</span><br><span class=\"line\">        [menu_item_parent] =&gt; <span class=\"number\">0</span></span><br><span class=\"line\">        [post_type] =&gt; nav_menu_item</span><br><span class=\"line\">        [<span class=\"keyword\">object</span>] =&gt; page</span><br><span class=\"line\">        [object_id] =&gt; <span class=\"number\">5</span></span><br><span class=\"line\">        [type] =&gt; post_type</span><br><span class=\"line\">        [classes] =&gt; <span class=\"title function_ invoke__\">Array</span> ( )</span><br><span class=\"line\">        [target] =&gt;</span><br><span class=\"line\">        [attr_title] =&gt;</span><br><span class=\"line\">        [description] =&gt;</span><br><span class=\"line\">        [xfn] =&gt;</span><br><span class=\"line\">        [db_id] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">        [menu_order] =&gt; <span class=\"number\">1</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">    [<span class=\"number\">1</span>] =&gt; <span class=\"built_in\">stdClass</span> <span class=\"title function_ invoke__\">Object</span> (</span><br><span class=\"line\">        [ID] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">        [title] =&gt; Services</span><br><span class=\"line\">        [url] =&gt; <span class=\"attr\">http</span>://example.com/services</span><br><span class=\"line\">        [menu_item_parent] =&gt; <span class=\"number\">0</span></span><br><span class=\"line\">        [post_type] =&gt; nav_menu_item</span><br><span class=\"line\">        [<span class=\"keyword\">object</span>] =&gt; page</span><br><span class=\"line\">        [object_id] =&gt; <span class=\"number\">6</span></span><br><span class=\"line\">        [type] =&gt; post_type</span><br><span class=\"line\">        [classes] =&gt; <span class=\"title function_ invoke__\">Array</span> ( )</span><br><span class=\"line\">        [target] =&gt;</span><br><span class=\"line\">        [attr_title] =&gt;</span><br><span class=\"line\">        [description] =&gt;</span><br><span class=\"line\">        [xfn] =&gt;</span><br><span class=\"line\">        [db_id] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">        [menu_order] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">    [<span class=\"number\">2</span>] =&gt; <span class=\"built_in\">stdClass</span> <span class=\"title function_ invoke__\">Object</span> (</span><br><span class=\"line\">        [ID] =&gt; <span class=\"number\">3</span></span><br><span class=\"line\">        [title] =&gt; Web Development</span><br><span class=\"line\">        [url] =&gt; <span class=\"attr\">http</span>://example.com/web-development</span><br><span class=\"line\">        [menu_item_parent] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">        [post_type] =&gt; nav_menu_item</span><br><span class=\"line\">        [<span class=\"keyword\">object</span>] =&gt; page</span><br><span class=\"line\">        [object_id] =&gt; <span class=\"number\">7</span></span><br><span class=\"line\">        [type] =&gt; post_type</span><br><span class=\"line\">        [classes] =&gt; <span class=\"title function_ invoke__\">Array</span> ( )</span><br><span class=\"line\">        [target] =&gt;</span><br><span class=\"line\">        [attr_title] =&gt;</span><br><span class=\"line\">        [description] =&gt;</span><br><span class=\"line\">        [xfn] =&gt;</span><br><span class=\"line\">        [db_id] =&gt; <span class=\"number\">3</span></span><br><span class=\"line\">        [menu_order] =&gt; <span class=\"number\">3</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">    [<span class=\"number\">3</span>] =&gt; <span class=\"built_in\">stdClass</span> <span class=\"title function_ invoke__\">Object</span> (</span><br><span class=\"line\">        [ID] =&gt; <span class=\"number\">4</span></span><br><span class=\"line\">        [title] =&gt; App Development</span><br><span class=\"line\">        [url] =&gt; <span class=\"attr\">http</span>://example.com/app-development</span><br><span class=\"line\">        [menu_item_parent] =&gt; <span class=\"number\">2</span></span><br><span class=\"line\">        [post_type] =&gt; nav_menu_item</span><br><span class=\"line\">        [<span class=\"keyword\">object</span>] =&gt; page</span><br><span class=\"line\">        [object_id] =&gt; <span class=\"number\">8</span></span><br><span class=\"line\">        [type] =&gt; post_type</span><br><span class=\"line\">        [classes] =&gt; <span class=\"title function_ invoke__\">Array</span> ( )</span><br><span class=\"line\">        [target] =&gt;</span><br><span class=\"line\">        [attr_title] =&gt;</span><br><span class=\"line\">        [description] =&gt;</span><br><span class=\"line\">        [xfn] =&gt;</span><br><span class=\"line\">        [db_id] =&gt; <span class=\"number\">4</span></span><br><span class=\"line\">        [menu_order] =&gt; <span class=\"number\">4</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">    [<span class=\"number\">4</span>] =&gt; <span class=\"built_in\">stdClass</span> <span class=\"title function_ invoke__\">Object</span> (</span><br><span class=\"line\">        [ID] =&gt; <span class=\"number\">5</span></span><br><span class=\"line\">        [title] =&gt; About Us</span><br><span class=\"line\">        [url] =&gt; <span class=\"attr\">http</span>://example.com/about-us</span><br><span class=\"line\">        [menu_item_parent] =&gt; <span class=\"number\">0</span></span><br><span class=\"line\">        [post_type] =&gt; nav_menu_item</span><br><span class=\"line\">        [<span class=\"keyword\">object</span>] =&gt; page</span><br><span class=\"line\">        [object_id] =&gt; <span class=\"number\">9</span></span><br><span class=\"line\">        [type] =&gt; post_type</span><br><span class=\"line\">        [classes] =&gt; <span class=\"title function_ invoke__\">Array</span> ( )</span><br><span class=\"line\">        [target] =&gt;</span><br><span class=\"line\">        [attr_title] =&gt;</span><br><span class=\"line\">        [description] =&gt;</span><br><span class=\"line\">        [xfn] =&gt;</span><br><span class=\"line\">        [db_id] =&gt; <span class=\"number\">5</span></span><br><span class=\"line\">        [menu_order] =&gt; <span class=\"number\">5</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"說明：\"><a href=\"#說明：\" class=\"headerlink\" title=\"說明：\"></a>說明：</h3><ol>\n<li><code>Home</code>：是一個頂層選單項目，<code>menu_item_parent</code> 為 <code>0</code>。</li>\n<li><code>Services</code>：也是一個頂層選單項目，<code>menu_item_parent</code> 為 <code>0</code>，並且有子項目。</li>\n<li><code>Web Development</code>：是 <code>Services</code> 的子選單，<code>menu_item_parent</code> 是 <code>Services</code> 的 <code>ID</code>（即 <code>2</code>）。</li>\n<li><code>App Development</code>：也是 <code>Services</code> 的子選單，<code>menu_item_parent</code> 是 <code>Services</code> 的 <code>ID</code>（即 <code>2</code>）。</li>\n<li><code>About Us</code>：是一個頂層選單項目，<code>menu_item_parent</code> 為 <code>0</code>。</li>\n</ol>\n"},{"layout":"post","title":"本地專案推送至Bitbucket遠端存放庫","date":"2024-09-22T04:47:29.000Z","top_img":"https://www.interviewbit.com/blog/wp-content/uploads/2021/10/What-is-Bitbucket-550x413.jpeg","cover":"https://www.interviewbit.com/blog/wp-content/uploads/2021/10/What-is-Bitbucket-550x413.jpeg","_content":"\n我的工作常常會使用到 bitbucket 遠端存放庫，前幾次使用不是很熟悉，因此我將步驟記錄下來讓我對 git 語法更熟悉：\n\n````markdown\n# 將本地專案推送到 Bitbucket 的教學文案\n\n本文介紹了如何將本地的 Git 專案推送到 Bitbucket，包括每個步驟執行指令後的顯示內容。\n\n---\n\n## 步驟 1: 初始化本地 Git 儲存庫\n\n如果尚未初始化 Git 儲存庫，首先進入專案目錄並執行以下命令：\n\n```bash\ngit init\n```\n````\n\n### 顯示內容\n\n```bash\nInitialized empty Git repository in /Users/zhuang/iavogue/.git/\n```\n\n---\n\n## 步驟 2: 新增 Bitbucket 遠端倉庫\n\n將 Bitbucket 的儲存庫 URL 新增到本地專案的 Git 遠端倉庫列表中：\n\n```bash\ngit remote add origin git@bitbucket.org:iambigd/wp-iavogue.git\n```\n\n檢查遠端倉庫是否正確添加：\n\n```bash\nbash\ngit remote -v\n```\n\n### 顯示內容\n\n```bash\norigin  git@bitbucket.org:iambigd/wp-iavogue.git (fetch)\norigin  git@bitbucket.org:iambigd/wp-iavogue.git (push)\n```\n\n---\n\n## 步驟 3: 添加專案檔案到暫存區\n\n將本地專案中的檔案添加到 Git 暫存區中，準備提交變更：\n\n```bash\ngit add .\n```\n\n檢查添加的檔案：\n\n```bash\ngit status\n```\n\n### 顯示內容\n\n```bash\nOn branch main\nYour branch is up-to-date with 'origin/main'.\nChanges to be committed:\n  (use \"git reset HEAD <file>...\" to unstage)\n\n\tnew file:   index.html\n\tnew file:   styles.css\n```\n\n---\n\n## 步驟 4: 提交變更\n\n提交這些檔案並附上提交訊息：\n\n```bash\ngit commit -m \"第一次提交\"\n```\n\n### 顯示內容\n\n```bash\n[main (root-commit) fd4c3c0] 第一次提交\n 2 files changed, 190 insertions(+)\n create mode 100644 index.html\n create mode 100644 styles.css\n```\n\n---\n\n## 步驟 5: 推送到遠端 Bitbucket 儲存庫\n\n嘗試將本地專案推送到遠端儲存庫：\n\n```bash\ngit push -u origin main\n```\n\n### 顯示內容（成功時）\n\n```bash\n枚舉物件: 72, 完成.\n物件計數中: 100% (72/72), 完成.\n使用 8 個執行緒進行壓縮\n壓縮物件中: 100% (66/66), 完成.\n寫入物件中: 100% (71/71), 1.70 MiB | 27.14 MiB/s, 完成.\n總共 71 (差異 0)，復用 0 (差異 0)，重用包 0 (總共 0)\nTo bitbucket.org:iambigd/wp-iavogue.git\n   145a286..9a1623a  main -> main\nBranch 'main' set up to track remote branch 'main' from 'origin'.\n```\n\n---\n\n## 常見問題：推送被拒絕 (non-fast-forward)\n\n### 顯示內容\n\n```bash\n! [rejected]        main -> main (non-fast-forward)\n錯誤: 推送一些引用到 'bitbucket.org:iambigd/wp-iavogue.git' 失敗\n提示： 更新被拒絕，因為您目前分支的最新提交落後於其對應的遠端分支。\n```\n\n### 解決方案\n\n拉取遠端的變更並重新推送：\n\n```bash\ngit pull origin main --rebase\ngit push origin main\n```\n\n### 顯示內容\n\n```bash\n來自 bitbucket.org:iambigd/wp-iavogue\n * branch            main       -> FETCH_HEAD\n成功重定基底並更新 refs/heads/main。\n\n枚舉物件: 72, 完成.\n物件計數中: 100% (72/72), 完成.\n使用 8 個執行緒進行壓縮\n壓縮物件中: 100% (66/66), 完成.\n寫入物件中: 100% (71/71), 1.70 MiB | 27.14 MiB/s, 完成.\n總共 71 (差異 0)，復用 0 (差異 0)，重用包 0 (總共 0)\nTo bitbucket.org:iambigd/wp-iavogue.git\n   145a286..9a1623a  main -> main\n```\n\n---\n\n## 強制推送（如需要）\n\n如果你不在意遠端歷史，或者希望覆蓋遠端的變更，你可以使用 `--force` 強制推送：\n\n```bash\ngit push -f origin main\n```\n\n---\n","source":"_posts/本地專案推送至Bitbucket遠端存放庫.md","raw":"---\nlayout: post\ntitle: 本地專案推送至Bitbucket遠端存放庫\ndate: 2024-09-22 12:47:29\ntags:\n  - \"Bitbucket\"\ncategories:\n  - \"遠端存放庫\"\n  - \"Bitbucket\"\ntop_img: \"https://www.interviewbit.com/blog/wp-content/uploads/2021/10/What-is-Bitbucket-550x413.jpeg\"\ncover: \"https://www.interviewbit.com/blog/wp-content/uploads/2021/10/What-is-Bitbucket-550x413.jpeg\"\n---\n\n我的工作常常會使用到 bitbucket 遠端存放庫，前幾次使用不是很熟悉，因此我將步驟記錄下來讓我對 git 語法更熟悉：\n\n````markdown\n# 將本地專案推送到 Bitbucket 的教學文案\n\n本文介紹了如何將本地的 Git 專案推送到 Bitbucket，包括每個步驟執行指令後的顯示內容。\n\n---\n\n## 步驟 1: 初始化本地 Git 儲存庫\n\n如果尚未初始化 Git 儲存庫，首先進入專案目錄並執行以下命令：\n\n```bash\ngit init\n```\n````\n\n### 顯示內容\n\n```bash\nInitialized empty Git repository in /Users/zhuang/iavogue/.git/\n```\n\n---\n\n## 步驟 2: 新增 Bitbucket 遠端倉庫\n\n將 Bitbucket 的儲存庫 URL 新增到本地專案的 Git 遠端倉庫列表中：\n\n```bash\ngit remote add origin git@bitbucket.org:iambigd/wp-iavogue.git\n```\n\n檢查遠端倉庫是否正確添加：\n\n```bash\nbash\ngit remote -v\n```\n\n### 顯示內容\n\n```bash\norigin  git@bitbucket.org:iambigd/wp-iavogue.git (fetch)\norigin  git@bitbucket.org:iambigd/wp-iavogue.git (push)\n```\n\n---\n\n## 步驟 3: 添加專案檔案到暫存區\n\n將本地專案中的檔案添加到 Git 暫存區中，準備提交變更：\n\n```bash\ngit add .\n```\n\n檢查添加的檔案：\n\n```bash\ngit status\n```\n\n### 顯示內容\n\n```bash\nOn branch main\nYour branch is up-to-date with 'origin/main'.\nChanges to be committed:\n  (use \"git reset HEAD <file>...\" to unstage)\n\n\tnew file:   index.html\n\tnew file:   styles.css\n```\n\n---\n\n## 步驟 4: 提交變更\n\n提交這些檔案並附上提交訊息：\n\n```bash\ngit commit -m \"第一次提交\"\n```\n\n### 顯示內容\n\n```bash\n[main (root-commit) fd4c3c0] 第一次提交\n 2 files changed, 190 insertions(+)\n create mode 100644 index.html\n create mode 100644 styles.css\n```\n\n---\n\n## 步驟 5: 推送到遠端 Bitbucket 儲存庫\n\n嘗試將本地專案推送到遠端儲存庫：\n\n```bash\ngit push -u origin main\n```\n\n### 顯示內容（成功時）\n\n```bash\n枚舉物件: 72, 完成.\n物件計數中: 100% (72/72), 完成.\n使用 8 個執行緒進行壓縮\n壓縮物件中: 100% (66/66), 完成.\n寫入物件中: 100% (71/71), 1.70 MiB | 27.14 MiB/s, 完成.\n總共 71 (差異 0)，復用 0 (差異 0)，重用包 0 (總共 0)\nTo bitbucket.org:iambigd/wp-iavogue.git\n   145a286..9a1623a  main -> main\nBranch 'main' set up to track remote branch 'main' from 'origin'.\n```\n\n---\n\n## 常見問題：推送被拒絕 (non-fast-forward)\n\n### 顯示內容\n\n```bash\n! [rejected]        main -> main (non-fast-forward)\n錯誤: 推送一些引用到 'bitbucket.org:iambigd/wp-iavogue.git' 失敗\n提示： 更新被拒絕，因為您目前分支的最新提交落後於其對應的遠端分支。\n```\n\n### 解決方案\n\n拉取遠端的變更並重新推送：\n\n```bash\ngit pull origin main --rebase\ngit push origin main\n```\n\n### 顯示內容\n\n```bash\n來自 bitbucket.org:iambigd/wp-iavogue\n * branch            main       -> FETCH_HEAD\n成功重定基底並更新 refs/heads/main。\n\n枚舉物件: 72, 完成.\n物件計數中: 100% (72/72), 完成.\n使用 8 個執行緒進行壓縮\n壓縮物件中: 100% (66/66), 完成.\n寫入物件中: 100% (71/71), 1.70 MiB | 27.14 MiB/s, 完成.\n總共 71 (差異 0)，復用 0 (差異 0)，重用包 0 (總共 0)\nTo bitbucket.org:iambigd/wp-iavogue.git\n   145a286..9a1623a  main -> main\n```\n\n---\n\n## 強制推送（如需要）\n\n如果你不在意遠端歷史，或者希望覆蓋遠端的變更，你可以使用 `--force` 強制推送：\n\n```bash\ngit push -f origin main\n```\n\n---\n","slug":"本地專案推送至Bitbucket遠端存放庫","published":1,"updated":"2026-01-28T14:17:25.070Z","_id":"cmkxfp4y800427z8z0vf2czx8","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>我的工作常常會使用到 bitbucket 遠端存放庫，前幾次使用不是很熟悉，因此我將步驟記錄下來讓我對 git 語法更熟悉：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 將本地專案推送到 Bitbucket 的教學文案</span></span><br><span class=\"line\"></span><br><span class=\"line\">本文介紹了如何將本地的 Git 專案推送到 Bitbucket，包括每個步驟執行指令後的顯示內容。</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 步驟 1: 初始化本地 Git 儲存庫</span></span><br><span class=\"line\"></span><br><span class=\"line\">如果尚未初始化 Git 儲存庫，首先進入專案目錄並執行以下命令：</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"code\">```bash</span></span><br><span class=\"line\"><span class=\"code\">git init</span></span><br><span class=\"line\"><span class=\"code\">```</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容\"><a href=\"#顯示內容\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Initialized empty Git repository <span class=\"keyword\">in</span> /Users/zhuang/iavogue/.git/</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"步驟-2-新增-Bitbucket-遠端倉庫\"><a href=\"#步驟-2-新增-Bitbucket-遠端倉庫\" class=\"headerlink\" title=\"步驟 2: 新增 Bitbucket 遠端倉庫\"></a>步驟 2: 新增 Bitbucket 遠端倉庫</h2><p>將 Bitbucket 的儲存庫 URL 新增到本地專案的 Git 遠端倉庫列表中：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote add origin git@bitbucket.org:iambigd/wp-iavogue.git</span><br></pre></td></tr></table></figure>\n\n<p>檢查遠端倉庫是否正確添加：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bash</span><br><span class=\"line\">git remote -v</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容-1\"><a href=\"#顯示內容-1\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">origin  git@bitbucket.org:iambigd/wp-iavogue.git (fetch)</span><br><span class=\"line\">origin  git@bitbucket.org:iambigd/wp-iavogue.git (push)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"步驟-3-添加專案檔案到暫存區\"><a href=\"#步驟-3-添加專案檔案到暫存區\" class=\"headerlink\" title=\"步驟 3: 添加專案檔案到暫存區\"></a>步驟 3: 添加專案檔案到暫存區</h2><p>將本地專案中的檔案添加到 Git 暫存區中，準備提交變更：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br></pre></td></tr></table></figure>\n\n<p>檢查添加的檔案：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git status</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容-2\"><a href=\"#顯示內容-2\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">On branch main</span><br><span class=\"line\">Your branch is up-to-date with <span class=\"string\">&#x27;origin/main&#x27;</span>.</span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use <span class=\"string\">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">\tnew file:   index.html</span><br><span class=\"line\">\tnew file:   styles.css</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"步驟-4-提交變更\"><a href=\"#步驟-4-提交變更\" class=\"headerlink\" title=\"步驟 4: 提交變更\"></a>步驟 4: 提交變更</h2><p>提交這些檔案並附上提交訊息：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -m <span class=\"string\">&quot;第一次提交&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容-3\"><a href=\"#顯示內容-3\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[main (root-commit) fd4c3c0] 第一次提交</span><br><span class=\"line\"> 2 files changed, 190 insertions(+)</span><br><span class=\"line\"> create mode 100644 index.html</span><br><span class=\"line\"> create mode 100644 styles.css</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"步驟-5-推送到遠端-Bitbucket-儲存庫\"><a href=\"#步驟-5-推送到遠端-Bitbucket-儲存庫\" class=\"headerlink\" title=\"步驟 5: 推送到遠端 Bitbucket 儲存庫\"></a>步驟 5: 推送到遠端 Bitbucket 儲存庫</h2><p>嘗試將本地專案推送到遠端儲存庫：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push -u origin main</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容（成功時）\"><a href=\"#顯示內容（成功時）\" class=\"headerlink\" title=\"顯示內容（成功時）\"></a>顯示內容（成功時）</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">枚舉物件: 72, 完成.</span><br><span class=\"line\">物件計數中: 100% (72/72), 完成.</span><br><span class=\"line\">使用 8 個執行緒進行壓縮</span><br><span class=\"line\">壓縮物件中: 100% (66/66), 完成.</span><br><span class=\"line\">寫入物件中: 100% (71/71), 1.70 MiB | 27.14 MiB/s, 完成.</span><br><span class=\"line\">總共 71 (差異 0)，復用 0 (差異 0)，重用包 0 (總共 0)</span><br><span class=\"line\">To bitbucket.org:iambigd/wp-iavogue.git</span><br><span class=\"line\">   145a286..9a1623a  main -&gt; main</span><br><span class=\"line\">Branch <span class=\"string\">&#x27;main&#x27;</span> <span class=\"built_in\">set</span> up to track remote branch <span class=\"string\">&#x27;main&#x27;</span> from <span class=\"string\">&#x27;origin&#x27;</span>.</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"常見問題：推送被拒絕-non-fast-forward\"><a href=\"#常見問題：推送被拒絕-non-fast-forward\" class=\"headerlink\" title=\"常見問題：推送被拒絕 (non-fast-forward)\"></a>常見問題：推送被拒絕 (non-fast-forward)</h2><h3 id=\"顯示內容-4\"><a href=\"#顯示內容-4\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">! [rejected]        main -&gt; main (non-fast-forward)</span><br><span class=\"line\">錯誤: 推送一些引用到 <span class=\"string\">&#x27;bitbucket.org:iambigd/wp-iavogue.git&#x27;</span> 失敗</span><br><span class=\"line\">提示： 更新被拒絕，因為您目前分支的最新提交落後於其對應的遠端分支。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"解決方案\"><a href=\"#解決方案\" class=\"headerlink\" title=\"解決方案\"></a>解決方案</h3><p>拉取遠端的變更並重新推送：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull origin main --rebase</span><br><span class=\"line\">git push origin main</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容-5\"><a href=\"#顯示內容-5\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">來自 bitbucket.org:iambigd/wp-iavogue</span><br><span class=\"line\"> * branch            main       -&gt; FETCH_HEAD</span><br><span class=\"line\">成功重定基底並更新 refs/heads/main。</span><br><span class=\"line\"></span><br><span class=\"line\">枚舉物件: 72, 完成.</span><br><span class=\"line\">物件計數中: 100% (72/72), 完成.</span><br><span class=\"line\">使用 8 個執行緒進行壓縮</span><br><span class=\"line\">壓縮物件中: 100% (66/66), 完成.</span><br><span class=\"line\">寫入物件中: 100% (71/71), 1.70 MiB | 27.14 MiB/s, 完成.</span><br><span class=\"line\">總共 71 (差異 0)，復用 0 (差異 0)，重用包 0 (總共 0)</span><br><span class=\"line\">To bitbucket.org:iambigd/wp-iavogue.git</span><br><span class=\"line\">   145a286..9a1623a  main -&gt; main</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"強制推送（如需要）\"><a href=\"#強制推送（如需要）\" class=\"headerlink\" title=\"強制推送（如需要）\"></a>強制推送（如需要）</h2><p>如果你不在意遠端歷史，或者希望覆蓋遠端的變更，你可以使用 <code>--force</code> 強制推送：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push -f origin main</span><br></pre></td></tr></table></figure>\n\n<hr>\n","excerpt":"","more":"<p>我的工作常常會使用到 bitbucket 遠端存放庫，前幾次使用不是很熟悉，因此我將步驟記錄下來讓我對 git 語法更熟悉：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># 將本地專案推送到 Bitbucket 的教學文案</span></span><br><span class=\"line\"></span><br><span class=\"line\">本文介紹了如何將本地的 Git 專案推送到 Bitbucket，包括每個步驟執行指令後的顯示內容。</span><br><span class=\"line\"></span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## 步驟 1: 初始化本地 Git 儲存庫</span></span><br><span class=\"line\"></span><br><span class=\"line\">如果尚未初始化 Git 儲存庫，首先進入專案目錄並執行以下命令：</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"code\">```bash</span></span><br><span class=\"line\"><span class=\"code\">git init</span></span><br><span class=\"line\"><span class=\"code\">```</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容\"><a href=\"#顯示內容\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Initialized empty Git repository <span class=\"keyword\">in</span> /Users/zhuang/iavogue/.git/</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"步驟-2-新增-Bitbucket-遠端倉庫\"><a href=\"#步驟-2-新增-Bitbucket-遠端倉庫\" class=\"headerlink\" title=\"步驟 2: 新增 Bitbucket 遠端倉庫\"></a>步驟 2: 新增 Bitbucket 遠端倉庫</h2><p>將 Bitbucket 的儲存庫 URL 新增到本地專案的 Git 遠端倉庫列表中：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote add origin git@bitbucket.org:iambigd/wp-iavogue.git</span><br></pre></td></tr></table></figure>\n\n<p>檢查遠端倉庫是否正確添加：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bash</span><br><span class=\"line\">git remote -v</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容-1\"><a href=\"#顯示內容-1\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">origin  git@bitbucket.org:iambigd/wp-iavogue.git (fetch)</span><br><span class=\"line\">origin  git@bitbucket.org:iambigd/wp-iavogue.git (push)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"步驟-3-添加專案檔案到暫存區\"><a href=\"#步驟-3-添加專案檔案到暫存區\" class=\"headerlink\" title=\"步驟 3: 添加專案檔案到暫存區\"></a>步驟 3: 添加專案檔案到暫存區</h2><p>將本地專案中的檔案添加到 Git 暫存區中，準備提交變更：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br></pre></td></tr></table></figure>\n\n<p>檢查添加的檔案：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git status</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容-2\"><a href=\"#顯示內容-2\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">On branch main</span><br><span class=\"line\">Your branch is up-to-date with <span class=\"string\">&#x27;origin/main&#x27;</span>.</span><br><span class=\"line\">Changes to be committed:</span><br><span class=\"line\">  (use <span class=\"string\">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage)</span><br><span class=\"line\"></span><br><span class=\"line\">\tnew file:   index.html</span><br><span class=\"line\">\tnew file:   styles.css</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"步驟-4-提交變更\"><a href=\"#步驟-4-提交變更\" class=\"headerlink\" title=\"步驟 4: 提交變更\"></a>步驟 4: 提交變更</h2><p>提交這些檔案並附上提交訊息：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git commit -m <span class=\"string\">&quot;第一次提交&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容-3\"><a href=\"#顯示內容-3\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[main (root-commit) fd4c3c0] 第一次提交</span><br><span class=\"line\"> 2 files changed, 190 insertions(+)</span><br><span class=\"line\"> create mode 100644 index.html</span><br><span class=\"line\"> create mode 100644 styles.css</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"步驟-5-推送到遠端-Bitbucket-儲存庫\"><a href=\"#步驟-5-推送到遠端-Bitbucket-儲存庫\" class=\"headerlink\" title=\"步驟 5: 推送到遠端 Bitbucket 儲存庫\"></a>步驟 5: 推送到遠端 Bitbucket 儲存庫</h2><p>嘗試將本地專案推送到遠端儲存庫：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push -u origin main</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容（成功時）\"><a href=\"#顯示內容（成功時）\" class=\"headerlink\" title=\"顯示內容（成功時）\"></a>顯示內容（成功時）</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">枚舉物件: 72, 完成.</span><br><span class=\"line\">物件計數中: 100% (72/72), 完成.</span><br><span class=\"line\">使用 8 個執行緒進行壓縮</span><br><span class=\"line\">壓縮物件中: 100% (66/66), 完成.</span><br><span class=\"line\">寫入物件中: 100% (71/71), 1.70 MiB | 27.14 MiB/s, 完成.</span><br><span class=\"line\">總共 71 (差異 0)，復用 0 (差異 0)，重用包 0 (總共 0)</span><br><span class=\"line\">To bitbucket.org:iambigd/wp-iavogue.git</span><br><span class=\"line\">   145a286..9a1623a  main -&gt; main</span><br><span class=\"line\">Branch <span class=\"string\">&#x27;main&#x27;</span> <span class=\"built_in\">set</span> up to track remote branch <span class=\"string\">&#x27;main&#x27;</span> from <span class=\"string\">&#x27;origin&#x27;</span>.</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"常見問題：推送被拒絕-non-fast-forward\"><a href=\"#常見問題：推送被拒絕-non-fast-forward\" class=\"headerlink\" title=\"常見問題：推送被拒絕 (non-fast-forward)\"></a>常見問題：推送被拒絕 (non-fast-forward)</h2><h3 id=\"顯示內容-4\"><a href=\"#顯示內容-4\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">! [rejected]        main -&gt; main (non-fast-forward)</span><br><span class=\"line\">錯誤: 推送一些引用到 <span class=\"string\">&#x27;bitbucket.org:iambigd/wp-iavogue.git&#x27;</span> 失敗</span><br><span class=\"line\">提示： 更新被拒絕，因為您目前分支的最新提交落後於其對應的遠端分支。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"解決方案\"><a href=\"#解決方案\" class=\"headerlink\" title=\"解決方案\"></a>解決方案</h3><p>拉取遠端的變更並重新推送：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git pull origin main --rebase</span><br><span class=\"line\">git push origin main</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"顯示內容-5\"><a href=\"#顯示內容-5\" class=\"headerlink\" title=\"顯示內容\"></a>顯示內容</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">來自 bitbucket.org:iambigd/wp-iavogue</span><br><span class=\"line\"> * branch            main       -&gt; FETCH_HEAD</span><br><span class=\"line\">成功重定基底並更新 refs/heads/main。</span><br><span class=\"line\"></span><br><span class=\"line\">枚舉物件: 72, 完成.</span><br><span class=\"line\">物件計數中: 100% (72/72), 完成.</span><br><span class=\"line\">使用 8 個執行緒進行壓縮</span><br><span class=\"line\">壓縮物件中: 100% (66/66), 完成.</span><br><span class=\"line\">寫入物件中: 100% (71/71), 1.70 MiB | 27.14 MiB/s, 完成.</span><br><span class=\"line\">總共 71 (差異 0)，復用 0 (差異 0)，重用包 0 (總共 0)</span><br><span class=\"line\">To bitbucket.org:iambigd/wp-iavogue.git</span><br><span class=\"line\">   145a286..9a1623a  main -&gt; main</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"強制推送（如需要）\"><a href=\"#強制推送（如需要）\" class=\"headerlink\" title=\"強制推送（如需要）\"></a>強制推送（如需要）</h2><p>如果你不在意遠端歷史，或者希望覆蓋遠端的變更，你可以使用 <code>--force</code> 強制推送：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push -f origin main</span><br></pre></td></tr></table></figure>\n\n<hr>\n"},{"layout":"post","title":"Pytorch Quickstart","date":"2025-10-19T16:00:00.000Z","top_img":"/images/Pytorch.png","cover":"/images/Pytorch.png","_content":"\n程式碼來源：[https://docs.pytorch.org/tutorials/beginner/basics/quickstart\\_tutorial.html](https://docs.pytorch.org/tutorials/beginner/basics/quickstart_tutorial.html)\n\n```\nimport torch\n# 匯入 nn（neural network）子模組\nfrom torch import nn\nfrom torch.utils.data import DataLoader\nfrom torchvision import datasets\nfrom torchvision.transforms import ToTensor\n```\n\n```\nimport torch\n# 匯入 nn（neural network）子模組\nfrom torch import nn\nfrom torch.utils.data import DataLoader\nfrom torchvision import datasets\nfrom torchvision.transforms import ToTensor\n```\n\n`nn` 是用來「定義網路結構」的模組。\n\nDataLoader 幫你自動把 dataset 切成一批一批（batch）。在每個 epoch 打亂（shuffle）資料。\n\ntorchvision.datasets 這是 PyTorch 針對「影像資料集」的工具庫。  \n常見的像 `MNIST`, `CIFAR10`, `ImageNet` 都可以直接用這個模組下載與載入。\n\nToTensor() 用來把影像（通常是 PIL Image 或 NumPy 陣列）轉成 PyTorch 的 Tensor 格式。  \n同時會自動把像素值從 `[0, 255]` 轉成 `[0.0, 1.0]`。\n\n```\n# Download training data from open datasets.\ntraining_data = datasets.FashionMNIST(\n    root=\"data\",\n    train=True,\n    download=True,\n    transform=ToTensor(),\n)\n<div></div>\n# Download test data from open datasets.\ntest_data = datasets.FashionMNIST(\n    root=\"data\",\n    train=False,\n    download=True,\n    transform=ToTensor(),\n)\n```\n\n```\n# Download training data from open datasets.\ntraining_data = datasets.FashionMNIST(\n    root=\"data\",\n    train=True,\n    download=True,\n    transform=ToTensor(),\n)\n\n# Download test data from open datasets.\ntest_data = datasets.FashionMNIST(\n    root=\"data\",\n    train=False,\n    download=True,\n    transform=ToTensor(),\n)\n```\n\n## training\\_data 訓練資料\n\n`datasets.FashionMNIST`：  \n這是 PyTorch 內建的 **Fashion-MNIST 資料集**，  \n它是一組 **灰階 28×28 的衣物影像**（共有 10 類，像是 T-shirt、鞋子、包包等）。  \n可以視為「MNIST（手寫數字）」的進階版。\n\n`root=\"data\"`：  \n指定資料儲存的資料夾名稱（PyTorch 會自動在這個資料夾裡建立結構）。  \n若資料不存在，會在 `\"data/\"` 底下建立子資料夾並下載。\n\n`train=True`：  \n表示這是**訓練集**（training set），  \nFashionMNIST 總共有：\n\n- 訓練資料：60,000 張圖片\n\n- 測試資料：10,000 張圖片\n\n`download=True`：  \n若本地端還沒有資料集，就自動幫你從官方網站下載。\n\n`transform=ToTensor()`：  \n將每張影像轉換成 PyTorch 的 **Tensor** 格式，  \n並且把像素值從 `[0, 255]` 正規化到 `[0.0, 1.0]`。\n\n轉換後的每張圖大小是 `(1, 28, 28)`，代表：`1` 個通道（灰階），`28×28` 像素。\n\n## test\\_data 測試資料\n\n`train=False` → 表示這是**測試集**（test set）。用來在訓練完模型後驗證準確率。\n\n* * *\n\n```\nbatch_size = 64\n<div></div>\n# Create data loaders.\ntrain_dataloader = DataLoader(training_data, batch_size=batch_size)\ntest_dataloader = DataLoader(test_data, batch_size=batch_size)\n<div></div>\nfor X, y in test_dataloader:\n    print(f\"Shape of X [N, C, H, W]: {X.shape}\")\n    print(f\"Shape of y: {y.shape} {y.dtype}\")\n    break\n```\n\n```\nbatch_size = 64\n\n# Create data loaders.\ntrain_dataloader = DataLoader(training_data, batch_size=batch_size)\ntest_dataloader = DataLoader(test_data, batch_size=batch_size)\n\nfor X, y in test_dataloader:\n    print(f\"Shape of X [N, C, H, W]: {X.shape}\")\n    print(f\"Shape of y: {y.shape} {y.dtype}\")\n    break\n```\n\n> 輸出結果 : Shape of X \\[N, C, H, W\\]: torch.Size(\\[64, 1, 28, 28\\]) Shape of y: torch.Size(\\[64\\]) torch.int64\n\n`DataLoader` 的功能：\n\n自動把 dataset 拆成一批批（依照 batch\\_size）。\n\n每次用 `for` 迴圈取資料時，會自動回傳一組 `(X, y)`：\n\n- `X`: 一批圖片\n\n- `y`: 一批標籤\n\nbatch\\_size = 64 模型訓練或測試時，每次會從資料集中取出 64 筆樣本。\n\nN: 筆數 C: RGB H: 高度 W: 寬度\n\n| 符號 | 意義 | 實際數值 | 說明 |\n| --- | --- | --- | --- |\n| `N` | batch size | 64 | 每次讀 64 張圖片 |\n| `C` | channels | 1 | 灰階圖像（只有 1 個通道） |\n| `H` | height | 28 | 高度 28 pixels |\n| `W` | width | 28 | 寬度 28 pixels |\n\n## Creating Models 建立模型\n\n```\n＃ AMD or MAC M1... or NVIDIA\ndevice = torch.accelerator.current_accelerator().type if torch.accelerator.is_available() else \"cpu\"\nprint(f\"Using {device} device\")\n<div></div>\n# Define model\nclass NeuralNetwork(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.flatten = nn.Flatten()\n        self.linear_relu_stack = nn.Sequential(\n            nn.Linear(28*28, 512), ＃ 輸入,輸出神經元個數\n            nn.ReLU(),\n            nn.Linear(512, 512),\n            nn.ReLU(),\n            nn.Linear(512, 10)\n        )\n    \n    ＃ x 就是 28 * 28的資料\n    def forward(self, x):\n        x = self.flatten(x)\n        logits = self.linear_relu_stack(x)\n        return logits\n<div></div>\nmodel = NeuralNetwork().to(device)\nprint(model)\n```\n\n```\n＃ AMD or MAC M1... or NVIDIA\ndevice = torch.accelerator.current_accelerator().type if torch.accelerator.is_available() else \"cpu\"\nprint(f\"Using {device} device\")\n\n# Define model\nclass NeuralNetwork(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.flatten = nn.Flatten()\n        self.linear_relu_stack = nn.Sequential(\n            nn.Linear(28*28, 512), ＃ 輸入,輸出神經元個數\n            nn.ReLU(),\n            nn.Linear(512, 512),\n            nn.ReLU(),\n            nn.Linear(512, 10)\n        )\n    \n    ＃ x 就是 28 * 28的資料\n    def forward(self, x):\n        x = self.flatten(x)\n        logits = self.linear_relu_stack(x)\n        return logits\n\nmodel = NeuralNetwork().to(device)\nprint(model)\n```\n\n輸出結果：\n\n```\nUsing cuda device\nNeuralNetwork(\n  (flatten): Flatten(start_dim=1, end_dim=-1)\n  (linear_relu_stack): Sequential(\n    (0): Linear(in_features=784, out_features=512, bias=True)\n    (1): ReLU()\n    (2): Linear(in_features=512, out_features=512, bias=True)\n    (3): ReLU()\n    (4): Linear(in_features=512, out_features=10, bias=True)\n  )\n)\n```\n\n```\nUsing cuda device\nNeuralNetwork(\n  (flatten): Flatten(start_dim=1, end_dim=-1)\n  (linear_relu_stack): Sequential(\n    (0): Linear(in_features=784, out_features=512, bias=True)\n    (1): ReLU()\n    (2): Linear(in_features=512, out_features=512, bias=True)\n    (3): ReLU()\n    (4): Linear(in_features=512, out_features=10, bias=True)\n  )\n)\n```\n\n### 初始化神經層結構\n\n- 先定義每一層的結構（例如 Flatten、Linear、ReLU 等）。\n\n- 透過 `forward()` 函式，把各神經層串接起來，形成資料的運算流程。\n\n* * *\n\n### `nn.Flatten()`\n\n- 功能：將影像從二維 (H×W) 攤平成一維 (向量)。\n\n- 原因：神經元無法直接讀取二維資料，必須轉成一維輸入。\n\n- 從 `(1, 28, 28)` 攤平成一維 `(784,)`。\n\n* * *\n\n### `nn.Sequential()`\n\n- 功能：將多個神經層打包成一個順序結構，使程式更簡潔。\n\n- 常見組合：`Linear`（線性層）搭配 `ReLU`（激活函數）。\n\n- 範例：`nn.Sequential(nn.Linear(784, 512), nn.ReLU())`。\n\n* * *\n\n### `.to(device)`\n\n- 功能：指定模型運行的裝置。\n\n- 若系統有 GPU，會將整個神經網路搬移到 GPU 執行，以加快訓練速度。\n\n- 範例：`model.to(\"cuda\")`。\n\n## Optimizing the Model Parameters 優化模型參數\n\n```\nloss_fn = nn.CrossEntropyLoss() #分類\noptimizer = torch.optim.SGD(model.parameters(), lr=1e-3) #最佳化 lr = 0.001\n```\n\n```\nloss_fn = nn.CrossEntropyLoss() #分類\noptimizer = torch.optim.SGD(model.parameters(), lr=1e-3) #最佳化 lr = 0.001\n```\n\nCrossEntropyLoss 有兩個功能 :\n\n- **Softmax**（把模型輸出的 logits 轉為機率分佈）\n\n- **Negative Log-Likelihood (NLLLoss)**（衡量預測與真實答案的差距）\n\nSGD、Adam 都是適應性的演算法，動態調整 learning rate。\n\nmodel.parameters() : 權重的更新\n\nlr=1e-3 ：學習率（learning rate）= 0.001，控制每次更新的步伐大小。\n\n```\ndef train(dataloader, model, loss_fn, optimizer):\n    size = len(dataloader.dataset)\n    model.train() #切換到訓練模式\n    for batch, (X, y) in enumerate(dataloader):\n        X, y = X.to(device), y.to(device) #放倒GPU\n<div></div>\n        # Compute prediction error\n        pred = model(X)\n        loss = loss_fn(pred, y)\n<div></div>\n        # Backpropagation\n        loss.backward() #反向傳播 計算梯度\n        optimizer.step() #學東西\n        optimizer.zero_grad() #將上一次的參數歸零\n<div></div>\n        if batch % 100 == 0:\n            loss, current = loss.item(), (batch + 1) * len(X\n            print(f\"loss: {loss:>7f}  [{current:>5d}/{size:>5d}]\")\n```\n\n```\ndef train(dataloader, model, loss_fn, optimizer):\n    size = len(dataloader.dataset)\n    model.train() #切換到訓練模式\n    for batch, (X, y) in enumerate(dataloader):\n        X, y = X.to(device), y.to(device) #放倒GPU\n\n        # Compute prediction error\n        pred = model(X)\n        loss = loss_fn(pred, y)\n\n        # Backpropagation\n        loss.backward() #反向傳播 計算梯度\n        optimizer.step() #學東西\n        optimizer.zero_grad() #將上一次的參數歸零\n\n        if batch % 100 == 0:\n            loss, current = loss.item(), (batch + 1) * len(X\n            print(f\"loss: {loss:>7f}  [{current:>5d}/{size:>5d}]\")\n```\n\n`len(dataloader.dataset)`：取得整個訓練資料集的總筆數。\n\n`model.train()`：設定為訓練模式（啟用 dropout、batchnorm 等訓練專用層的行為）。\n\n使用 `enumerate(dataloader)`：一批一批地從 DataLoader 拿資料。`(X, y)`：`X` 是輸入影像，`y` 是真實標籤。\n\n`.to(device)`：把資料放到相同的裝置上（如 GPU），確保和模型一致。\n\n```\npred = model(X)\n```\n\n```\npred = model(X)\n```\n\n把圖片送進模型，取得預測結果（logits）。此時 `pred` 的形狀會是 `[64, 10]`（64 張圖、10 類別）。\n\n```\nloss = loss_fn(pred, y)\n```\n\n```\nloss = loss_fn(pred, y)\n```\n\n用損失函數得到目前這一批的「平均誤差」。\n\nloss.backward() : 計算梯度（反向傳遞 Backpropagation）\n\noptimizer.step() : 根據梯度更新模型權重\n\noptimizer.zero\\_grad() : 清空舊梯度（避免累積）\n\n最後每 100 個 batch 顯示一次進度與目前損失值。\n\n```\ndef test(dataloader, model, loss_fn):\n    size = len(dataloader.dataset)\n    num_batches = len(dataloader)\n    model.eval()\n    test_loss, correct = 0, 0\n    with torch.no_grad():\n        for X, y in dataloader:\n            X, y = X.to(device), y.to(device)\n            pred = model(X)\n            test_loss += loss_fn(pred, y).item() #比對64筆資料\n            correct += (pred.argmax(1) == y).type(torch.float).sum().item()\n    test_loss /= num_batches\n    correct /= size\n    print(f\"Test Error: \\n Accuracy: {(100*correct):>0.1f}%, Avg loss: {test_loss:>8f} \\n\")\n```\n\n```\ndef test(dataloader, model, loss_fn):\n    size = len(dataloader.dataset)\n    num_batches = len(dataloader)\n    model.eval()\n    test_loss, correct = 0, 0\n    with torch.no_grad():\n        for X, y in dataloader:\n            X, y = X.to(device), y.to(device)\n            pred = model(X)\n            test_loss += loss_fn(pred, y).item() #比對64筆資料\n            correct += (pred.argmax(1) == y).type(torch.float).sum().item()\n    test_loss /= num_batches\n    correct /= size\n    print(f\"Test Error: \\n Accuracy: {(100*correct):>0.1f}%, Avg loss: {test_loss:>8f} \\n\")\n```\n\n`size`：測試資料總筆數（例如 10,000 張 FashionMNIST 圖）\n\n`num_batches`：DataLoader 的批次數量（例如 10,000 ÷ 64 ≈ 157 批）\n\nmodel.eval() : 把模型切換為 evaluation mode (評估模式)。\n\nargmax(list) : 選出數字最大的，然後取出索引值。\n\ntest\\_loss越小表示學習效果越好\n\n- `size`：整個測試資料集的樣本總數。\n\n- `num_batches`：總共有幾個批次（batch）。\n\n- `model.eval()`：切換成「**評估模式**」，停用訓練時的行為（例如 dropout、batchnorm 更新）。\n\n- `test_loss`、`correct`：用來累積測試的結果。\n\n### 關閉梯度計算\n\n```\nwith torch.no_grad():\n```\n\n- 測試階段不需要訓練，也不需要反向傳播梯度。\n\n- `torch.no_grad()` 可以節省記憶體與加快運算速度。\n\n### 主要測試迴圈\n\n```\nfor X, y in dataloader:\n    X, y = X.to(device), y.to(device)\n    pred = model(X)\n    test_loss += loss_fn(pred, y).item()  # 累積每個 batch 的 loss\n    correct += (pred.argmax(1) == y).type(torch.float).sum().item()\n```\n\n```\nfor X, y in dataloader:\n    X, y = X.to(device), y.to(device)\n    pred = model(X)\n    test_loss += loss_fn(pred, y).item()  # 累積每個 batch 的 loss\n    correct += (pred.argmax(1) == y).type(torch.float).sum().item()\n```\n\n### 詳細解釋：\n\n| 步驟 | 說明 |\n| --- | --- |\n| `X, y = X.to(device), y.to(device)` | 將資料移到 GPU / CPU |\n| `pred = model(X)` | 對測試資料做預測 |\n| `loss_fn(pred, y)` | 計算這一批資料的損失值 |\n| `.item()` | 取出純數值（從 tensor 轉成 float） |\n| `pred.argmax(1)` | 取出每筆資料預測機率最高的類別 |\n| `(pred.argmax(1) == y)` | 比對預測結果與真實標籤是否相同 |\n| `.type(torch.float).sum().item()` | 計算這一批中預測正確的樣本數並加總 |\n\n* * *\n\n### 平均化結果與輸出\n\n```\ntest_loss /= num_batches\ncorrect /= size\nprint(f\"Test Error: \\n Accuracy: {(100*correct):>0.1f}%, Avg loss: {test_loss:>8f} \\n\")\n```\n\n```\ntest_loss /= num_batches\ncorrect /= size\nprint(f\"Test Error: \\n Accuracy: {(100*correct):>0.1f}%, Avg loss: {test_loss:>8f} \\n\")\n```\n\n- `test_loss /= num_batches`：計算整體平均損失。\n\n- `correct /= size`：計算整體準確率。\n\n- `print()`：輸出測試結果。\n\n```\nepochs = 5\nfor t in range(epochs):\n    print(f\"Epoch {t+1}\\n-------------------------------\")\n    train(train_dataloader, model, loss_fn, optimizer)\n    test(test_dataloader, model, loss_fn)\nprint(\"Done!\")\n```\n\n```\nepochs = 5\nfor t in range(epochs):\n    print(f\"Epoch {t+1}\\n-------------------------------\")\n    train(train_dataloader, model, loss_fn, optimizer)\n    test(test_dataloader, model, loss_fn)\nprint(\"Done!\")\n```\n\n以這個程式碼來說epochs是5，也就是訓練5次的意思。\n\n## Saving Models\n\n```\ntorch.save(model.state_dict(), \"model.pth\")\nprint(\"Saved PyTorch Model State to model.pth\")\n```\n\n```\ntorch.save(model.state_dict(), \"model.pth\")\nprint(\"Saved PyTorch Model State to model.pth\")\n```\n\n將模型的參數儲存到一個檔案 `\"model.pth\"` 中。\n\n之後可以再繼續訓練或是使用。\n\n## Loading Models\n\n```\nmodel = NeuralNetwork().to(device)\nmodel.load_state_dict(torch.load(\"model.pth\", weights_only=True))\n```\n\n```\nmodel = NeuralNetwork().to(device)\nmodel.load_state_dict(torch.load(\"model.pth\", weights_only=True))\n```\n\n```\nclasses = [\n    \"T-shirt/top\",\n    \"Trouser\",\n    \"Pullover\",\n    \"Dress\",\n    \"Coat\",\n    \"Sandal\",\n    \"Shirt\",\n    \"Sneaker\",\n    \"Bag\",\n    \"Ankle boot\",\n]\n<div></div>\nmodel.eval()\nx, y = test_data[0][0], test_data[0][1]\nwith torch.no_grad():\n    x = x.to(device)\n    pred = model(x)\n    predicted, actual = classes[pred[0].argmax(0)], classes[y]\n    print(f'Predicted: \"{predicted}\", Actual: \"{actual}\"')\n```\n\n```\nclasses = [\n    \"T-shirt/top\",\n    \"Trouser\",\n    \"Pullover\",\n    \"Dress\",\n    \"Coat\",\n    \"Sandal\",\n    \"Shirt\",\n    \"Sneaker\",\n    \"Bag\",\n    \"Ankle boot\",\n]\n\nmodel.eval()\nx, y = test_data[0][0], test_data[0][1]\nwith torch.no_grad():\n    x = x.to(device)\n    pred = model(x)\n    predicted, actual = classes[pred[0].argmax(0)], classes[y]\n    print(f'Predicted: \"{predicted}\", Actual: \"{actual}\"')\n```\n\n輸出結果 : Predicted: \"Ankle boot\", Actual: \"Ankle boot\"\n","source":"_posts/pytorch-base.md","raw":"---\nlayout: post\ntitle: Pytorch Quickstart\ndate: 2025-10-20\ntags:\ncategories:\n  - \"ai\"\n  - \"pytorch\"\ntop_img: /images/Pytorch.png\ncover: /images/Pytorch.png\n---\n\n程式碼來源：[https://docs.pytorch.org/tutorials/beginner/basics/quickstart\\_tutorial.html](https://docs.pytorch.org/tutorials/beginner/basics/quickstart_tutorial.html)\n\n```\nimport torch\n# 匯入 nn（neural network）子模組\nfrom torch import nn\nfrom torch.utils.data import DataLoader\nfrom torchvision import datasets\nfrom torchvision.transforms import ToTensor\n```\n\n```\nimport torch\n# 匯入 nn（neural network）子模組\nfrom torch import nn\nfrom torch.utils.data import DataLoader\nfrom torchvision import datasets\nfrom torchvision.transforms import ToTensor\n```\n\n`nn` 是用來「定義網路結構」的模組。\n\nDataLoader 幫你自動把 dataset 切成一批一批（batch）。在每個 epoch 打亂（shuffle）資料。\n\ntorchvision.datasets 這是 PyTorch 針對「影像資料集」的工具庫。  \n常見的像 `MNIST`, `CIFAR10`, `ImageNet` 都可以直接用這個模組下載與載入。\n\nToTensor() 用來把影像（通常是 PIL Image 或 NumPy 陣列）轉成 PyTorch 的 Tensor 格式。  \n同時會自動把像素值從 `[0, 255]` 轉成 `[0.0, 1.0]`。\n\n```\n# Download training data from open datasets.\ntraining_data = datasets.FashionMNIST(\n    root=\"data\",\n    train=True,\n    download=True,\n    transform=ToTensor(),\n)\n<div></div>\n# Download test data from open datasets.\ntest_data = datasets.FashionMNIST(\n    root=\"data\",\n    train=False,\n    download=True,\n    transform=ToTensor(),\n)\n```\n\n```\n# Download training data from open datasets.\ntraining_data = datasets.FashionMNIST(\n    root=\"data\",\n    train=True,\n    download=True,\n    transform=ToTensor(),\n)\n\n# Download test data from open datasets.\ntest_data = datasets.FashionMNIST(\n    root=\"data\",\n    train=False,\n    download=True,\n    transform=ToTensor(),\n)\n```\n\n## training\\_data 訓練資料\n\n`datasets.FashionMNIST`：  \n這是 PyTorch 內建的 **Fashion-MNIST 資料集**，  \n它是一組 **灰階 28×28 的衣物影像**（共有 10 類，像是 T-shirt、鞋子、包包等）。  \n可以視為「MNIST（手寫數字）」的進階版。\n\n`root=\"data\"`：  \n指定資料儲存的資料夾名稱（PyTorch 會自動在這個資料夾裡建立結構）。  \n若資料不存在，會在 `\"data/\"` 底下建立子資料夾並下載。\n\n`train=True`：  \n表示這是**訓練集**（training set），  \nFashionMNIST 總共有：\n\n- 訓練資料：60,000 張圖片\n\n- 測試資料：10,000 張圖片\n\n`download=True`：  \n若本地端還沒有資料集，就自動幫你從官方網站下載。\n\n`transform=ToTensor()`：  \n將每張影像轉換成 PyTorch 的 **Tensor** 格式，  \n並且把像素值從 `[0, 255]` 正規化到 `[0.0, 1.0]`。\n\n轉換後的每張圖大小是 `(1, 28, 28)`，代表：`1` 個通道（灰階），`28×28` 像素。\n\n## test\\_data 測試資料\n\n`train=False` → 表示這是**測試集**（test set）。用來在訓練完模型後驗證準確率。\n\n* * *\n\n```\nbatch_size = 64\n<div></div>\n# Create data loaders.\ntrain_dataloader = DataLoader(training_data, batch_size=batch_size)\ntest_dataloader = DataLoader(test_data, batch_size=batch_size)\n<div></div>\nfor X, y in test_dataloader:\n    print(f\"Shape of X [N, C, H, W]: {X.shape}\")\n    print(f\"Shape of y: {y.shape} {y.dtype}\")\n    break\n```\n\n```\nbatch_size = 64\n\n# Create data loaders.\ntrain_dataloader = DataLoader(training_data, batch_size=batch_size)\ntest_dataloader = DataLoader(test_data, batch_size=batch_size)\n\nfor X, y in test_dataloader:\n    print(f\"Shape of X [N, C, H, W]: {X.shape}\")\n    print(f\"Shape of y: {y.shape} {y.dtype}\")\n    break\n```\n\n> 輸出結果 : Shape of X \\[N, C, H, W\\]: torch.Size(\\[64, 1, 28, 28\\]) Shape of y: torch.Size(\\[64\\]) torch.int64\n\n`DataLoader` 的功能：\n\n自動把 dataset 拆成一批批（依照 batch\\_size）。\n\n每次用 `for` 迴圈取資料時，會自動回傳一組 `(X, y)`：\n\n- `X`: 一批圖片\n\n- `y`: 一批標籤\n\nbatch\\_size = 64 模型訓練或測試時，每次會從資料集中取出 64 筆樣本。\n\nN: 筆數 C: RGB H: 高度 W: 寬度\n\n| 符號 | 意義 | 實際數值 | 說明 |\n| --- | --- | --- | --- |\n| `N` | batch size | 64 | 每次讀 64 張圖片 |\n| `C` | channels | 1 | 灰階圖像（只有 1 個通道） |\n| `H` | height | 28 | 高度 28 pixels |\n| `W` | width | 28 | 寬度 28 pixels |\n\n## Creating Models 建立模型\n\n```\n＃ AMD or MAC M1... or NVIDIA\ndevice = torch.accelerator.current_accelerator().type if torch.accelerator.is_available() else \"cpu\"\nprint(f\"Using {device} device\")\n<div></div>\n# Define model\nclass NeuralNetwork(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.flatten = nn.Flatten()\n        self.linear_relu_stack = nn.Sequential(\n            nn.Linear(28*28, 512), ＃ 輸入,輸出神經元個數\n            nn.ReLU(),\n            nn.Linear(512, 512),\n            nn.ReLU(),\n            nn.Linear(512, 10)\n        )\n    \n    ＃ x 就是 28 * 28的資料\n    def forward(self, x):\n        x = self.flatten(x)\n        logits = self.linear_relu_stack(x)\n        return logits\n<div></div>\nmodel = NeuralNetwork().to(device)\nprint(model)\n```\n\n```\n＃ AMD or MAC M1... or NVIDIA\ndevice = torch.accelerator.current_accelerator().type if torch.accelerator.is_available() else \"cpu\"\nprint(f\"Using {device} device\")\n\n# Define model\nclass NeuralNetwork(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.flatten = nn.Flatten()\n        self.linear_relu_stack = nn.Sequential(\n            nn.Linear(28*28, 512), ＃ 輸入,輸出神經元個數\n            nn.ReLU(),\n            nn.Linear(512, 512),\n            nn.ReLU(),\n            nn.Linear(512, 10)\n        )\n    \n    ＃ x 就是 28 * 28的資料\n    def forward(self, x):\n        x = self.flatten(x)\n        logits = self.linear_relu_stack(x)\n        return logits\n\nmodel = NeuralNetwork().to(device)\nprint(model)\n```\n\n輸出結果：\n\n```\nUsing cuda device\nNeuralNetwork(\n  (flatten): Flatten(start_dim=1, end_dim=-1)\n  (linear_relu_stack): Sequential(\n    (0): Linear(in_features=784, out_features=512, bias=True)\n    (1): ReLU()\n    (2): Linear(in_features=512, out_features=512, bias=True)\n    (3): ReLU()\n    (4): Linear(in_features=512, out_features=10, bias=True)\n  )\n)\n```\n\n```\nUsing cuda device\nNeuralNetwork(\n  (flatten): Flatten(start_dim=1, end_dim=-1)\n  (linear_relu_stack): Sequential(\n    (0): Linear(in_features=784, out_features=512, bias=True)\n    (1): ReLU()\n    (2): Linear(in_features=512, out_features=512, bias=True)\n    (3): ReLU()\n    (4): Linear(in_features=512, out_features=10, bias=True)\n  )\n)\n```\n\n### 初始化神經層結構\n\n- 先定義每一層的結構（例如 Flatten、Linear、ReLU 等）。\n\n- 透過 `forward()` 函式，把各神經層串接起來，形成資料的運算流程。\n\n* * *\n\n### `nn.Flatten()`\n\n- 功能：將影像從二維 (H×W) 攤平成一維 (向量)。\n\n- 原因：神經元無法直接讀取二維資料，必須轉成一維輸入。\n\n- 從 `(1, 28, 28)` 攤平成一維 `(784,)`。\n\n* * *\n\n### `nn.Sequential()`\n\n- 功能：將多個神經層打包成一個順序結構，使程式更簡潔。\n\n- 常見組合：`Linear`（線性層）搭配 `ReLU`（激活函數）。\n\n- 範例：`nn.Sequential(nn.Linear(784, 512), nn.ReLU())`。\n\n* * *\n\n### `.to(device)`\n\n- 功能：指定模型運行的裝置。\n\n- 若系統有 GPU，會將整個神經網路搬移到 GPU 執行，以加快訓練速度。\n\n- 範例：`model.to(\"cuda\")`。\n\n## Optimizing the Model Parameters 優化模型參數\n\n```\nloss_fn = nn.CrossEntropyLoss() #分類\noptimizer = torch.optim.SGD(model.parameters(), lr=1e-3) #最佳化 lr = 0.001\n```\n\n```\nloss_fn = nn.CrossEntropyLoss() #分類\noptimizer = torch.optim.SGD(model.parameters(), lr=1e-3) #最佳化 lr = 0.001\n```\n\nCrossEntropyLoss 有兩個功能 :\n\n- **Softmax**（把模型輸出的 logits 轉為機率分佈）\n\n- **Negative Log-Likelihood (NLLLoss)**（衡量預測與真實答案的差距）\n\nSGD、Adam 都是適應性的演算法，動態調整 learning rate。\n\nmodel.parameters() : 權重的更新\n\nlr=1e-3 ：學習率（learning rate）= 0.001，控制每次更新的步伐大小。\n\n```\ndef train(dataloader, model, loss_fn, optimizer):\n    size = len(dataloader.dataset)\n    model.train() #切換到訓練模式\n    for batch, (X, y) in enumerate(dataloader):\n        X, y = X.to(device), y.to(device) #放倒GPU\n<div></div>\n        # Compute prediction error\n        pred = model(X)\n        loss = loss_fn(pred, y)\n<div></div>\n        # Backpropagation\n        loss.backward() #反向傳播 計算梯度\n        optimizer.step() #學東西\n        optimizer.zero_grad() #將上一次的參數歸零\n<div></div>\n        if batch % 100 == 0:\n            loss, current = loss.item(), (batch + 1) * len(X\n            print(f\"loss: {loss:>7f}  [{current:>5d}/{size:>5d}]\")\n```\n\n```\ndef train(dataloader, model, loss_fn, optimizer):\n    size = len(dataloader.dataset)\n    model.train() #切換到訓練模式\n    for batch, (X, y) in enumerate(dataloader):\n        X, y = X.to(device), y.to(device) #放倒GPU\n\n        # Compute prediction error\n        pred = model(X)\n        loss = loss_fn(pred, y)\n\n        # Backpropagation\n        loss.backward() #反向傳播 計算梯度\n        optimizer.step() #學東西\n        optimizer.zero_grad() #將上一次的參數歸零\n\n        if batch % 100 == 0:\n            loss, current = loss.item(), (batch + 1) * len(X\n            print(f\"loss: {loss:>7f}  [{current:>5d}/{size:>5d}]\")\n```\n\n`len(dataloader.dataset)`：取得整個訓練資料集的總筆數。\n\n`model.train()`：設定為訓練模式（啟用 dropout、batchnorm 等訓練專用層的行為）。\n\n使用 `enumerate(dataloader)`：一批一批地從 DataLoader 拿資料。`(X, y)`：`X` 是輸入影像，`y` 是真實標籤。\n\n`.to(device)`：把資料放到相同的裝置上（如 GPU），確保和模型一致。\n\n```\npred = model(X)\n```\n\n```\npred = model(X)\n```\n\n把圖片送進模型，取得預測結果（logits）。此時 `pred` 的形狀會是 `[64, 10]`（64 張圖、10 類別）。\n\n```\nloss = loss_fn(pred, y)\n```\n\n```\nloss = loss_fn(pred, y)\n```\n\n用損失函數得到目前這一批的「平均誤差」。\n\nloss.backward() : 計算梯度（反向傳遞 Backpropagation）\n\noptimizer.step() : 根據梯度更新模型權重\n\noptimizer.zero\\_grad() : 清空舊梯度（避免累積）\n\n最後每 100 個 batch 顯示一次進度與目前損失值。\n\n```\ndef test(dataloader, model, loss_fn):\n    size = len(dataloader.dataset)\n    num_batches = len(dataloader)\n    model.eval()\n    test_loss, correct = 0, 0\n    with torch.no_grad():\n        for X, y in dataloader:\n            X, y = X.to(device), y.to(device)\n            pred = model(X)\n            test_loss += loss_fn(pred, y).item() #比對64筆資料\n            correct += (pred.argmax(1) == y).type(torch.float).sum().item()\n    test_loss /= num_batches\n    correct /= size\n    print(f\"Test Error: \\n Accuracy: {(100*correct):>0.1f}%, Avg loss: {test_loss:>8f} \\n\")\n```\n\n```\ndef test(dataloader, model, loss_fn):\n    size = len(dataloader.dataset)\n    num_batches = len(dataloader)\n    model.eval()\n    test_loss, correct = 0, 0\n    with torch.no_grad():\n        for X, y in dataloader:\n            X, y = X.to(device), y.to(device)\n            pred = model(X)\n            test_loss += loss_fn(pred, y).item() #比對64筆資料\n            correct += (pred.argmax(1) == y).type(torch.float).sum().item()\n    test_loss /= num_batches\n    correct /= size\n    print(f\"Test Error: \\n Accuracy: {(100*correct):>0.1f}%, Avg loss: {test_loss:>8f} \\n\")\n```\n\n`size`：測試資料總筆數（例如 10,000 張 FashionMNIST 圖）\n\n`num_batches`：DataLoader 的批次數量（例如 10,000 ÷ 64 ≈ 157 批）\n\nmodel.eval() : 把模型切換為 evaluation mode (評估模式)。\n\nargmax(list) : 選出數字最大的，然後取出索引值。\n\ntest\\_loss越小表示學習效果越好\n\n- `size`：整個測試資料集的樣本總數。\n\n- `num_batches`：總共有幾個批次（batch）。\n\n- `model.eval()`：切換成「**評估模式**」，停用訓練時的行為（例如 dropout、batchnorm 更新）。\n\n- `test_loss`、`correct`：用來累積測試的結果。\n\n### 關閉梯度計算\n\n```\nwith torch.no_grad():\n```\n\n- 測試階段不需要訓練，也不需要反向傳播梯度。\n\n- `torch.no_grad()` 可以節省記憶體與加快運算速度。\n\n### 主要測試迴圈\n\n```\nfor X, y in dataloader:\n    X, y = X.to(device), y.to(device)\n    pred = model(X)\n    test_loss += loss_fn(pred, y).item()  # 累積每個 batch 的 loss\n    correct += (pred.argmax(1) == y).type(torch.float).sum().item()\n```\n\n```\nfor X, y in dataloader:\n    X, y = X.to(device), y.to(device)\n    pred = model(X)\n    test_loss += loss_fn(pred, y).item()  # 累積每個 batch 的 loss\n    correct += (pred.argmax(1) == y).type(torch.float).sum().item()\n```\n\n### 詳細解釋：\n\n| 步驟 | 說明 |\n| --- | --- |\n| `X, y = X.to(device), y.to(device)` | 將資料移到 GPU / CPU |\n| `pred = model(X)` | 對測試資料做預測 |\n| `loss_fn(pred, y)` | 計算這一批資料的損失值 |\n| `.item()` | 取出純數值（從 tensor 轉成 float） |\n| `pred.argmax(1)` | 取出每筆資料預測機率最高的類別 |\n| `(pred.argmax(1) == y)` | 比對預測結果與真實標籤是否相同 |\n| `.type(torch.float).sum().item()` | 計算這一批中預測正確的樣本數並加總 |\n\n* * *\n\n### 平均化結果與輸出\n\n```\ntest_loss /= num_batches\ncorrect /= size\nprint(f\"Test Error: \\n Accuracy: {(100*correct):>0.1f}%, Avg loss: {test_loss:>8f} \\n\")\n```\n\n```\ntest_loss /= num_batches\ncorrect /= size\nprint(f\"Test Error: \\n Accuracy: {(100*correct):>0.1f}%, Avg loss: {test_loss:>8f} \\n\")\n```\n\n- `test_loss /= num_batches`：計算整體平均損失。\n\n- `correct /= size`：計算整體準確率。\n\n- `print()`：輸出測試結果。\n\n```\nepochs = 5\nfor t in range(epochs):\n    print(f\"Epoch {t+1}\\n-------------------------------\")\n    train(train_dataloader, model, loss_fn, optimizer)\n    test(test_dataloader, model, loss_fn)\nprint(\"Done!\")\n```\n\n```\nepochs = 5\nfor t in range(epochs):\n    print(f\"Epoch {t+1}\\n-------------------------------\")\n    train(train_dataloader, model, loss_fn, optimizer)\n    test(test_dataloader, model, loss_fn)\nprint(\"Done!\")\n```\n\n以這個程式碼來說epochs是5，也就是訓練5次的意思。\n\n## Saving Models\n\n```\ntorch.save(model.state_dict(), \"model.pth\")\nprint(\"Saved PyTorch Model State to model.pth\")\n```\n\n```\ntorch.save(model.state_dict(), \"model.pth\")\nprint(\"Saved PyTorch Model State to model.pth\")\n```\n\n將模型的參數儲存到一個檔案 `\"model.pth\"` 中。\n\n之後可以再繼續訓練或是使用。\n\n## Loading Models\n\n```\nmodel = NeuralNetwork().to(device)\nmodel.load_state_dict(torch.load(\"model.pth\", weights_only=True))\n```\n\n```\nmodel = NeuralNetwork().to(device)\nmodel.load_state_dict(torch.load(\"model.pth\", weights_only=True))\n```\n\n```\nclasses = [\n    \"T-shirt/top\",\n    \"Trouser\",\n    \"Pullover\",\n    \"Dress\",\n    \"Coat\",\n    \"Sandal\",\n    \"Shirt\",\n    \"Sneaker\",\n    \"Bag\",\n    \"Ankle boot\",\n]\n<div></div>\nmodel.eval()\nx, y = test_data[0][0], test_data[0][1]\nwith torch.no_grad():\n    x = x.to(device)\n    pred = model(x)\n    predicted, actual = classes[pred[0].argmax(0)], classes[y]\n    print(f'Predicted: \"{predicted}\", Actual: \"{actual}\"')\n```\n\n```\nclasses = [\n    \"T-shirt/top\",\n    \"Trouser\",\n    \"Pullover\",\n    \"Dress\",\n    \"Coat\",\n    \"Sandal\",\n    \"Shirt\",\n    \"Sneaker\",\n    \"Bag\",\n    \"Ankle boot\",\n]\n\nmodel.eval()\nx, y = test_data[0][0], test_data[0][1]\nwith torch.no_grad():\n    x = x.to(device)\n    pred = model(x)\n    predicted, actual = classes[pred[0].argmax(0)], classes[y]\n    print(f'Predicted: \"{predicted}\", Actual: \"{actual}\"')\n```\n\n輸出結果 : Predicted: \"Ankle boot\", Actual: \"Ankle boot\"\n","slug":"pytorch-base","published":1,"updated":"2026-01-28T14:17:25.066Z","_id":"cmkxg0krp0000rb8zhhykesuq","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>程式碼來源：<a href=\"https://docs.pytorch.org/tutorials/beginner/basics/quickstart_tutorial.html\">https://docs.pytorch.org/tutorials/beginner/basics/quickstart_tutorial.html</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch</span><br><span class=\"line\"># 匯入 nn（neural network）子模組</span><br><span class=\"line\">from torch import nn</span><br><span class=\"line\">from torch.utils.data import DataLoader</span><br><span class=\"line\">from torchvision import datasets</span><br><span class=\"line\">from torchvision.transforms import ToTensor</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch</span><br><span class=\"line\"># 匯入 nn（neural network）子模組</span><br><span class=\"line\">from torch import nn</span><br><span class=\"line\">from torch.utils.data import DataLoader</span><br><span class=\"line\">from torchvision import datasets</span><br><span class=\"line\">from torchvision.transforms import ToTensor</span><br></pre></td></tr></table></figure>\n\n<p><code>nn</code> 是用來「定義網路結構」的模組。</p>\n<p>DataLoader 幫你自動把 dataset 切成一批一批（batch）。在每個 epoch 打亂（shuffle）資料。</p>\n<p>torchvision.datasets 這是 PyTorch 針對「影像資料集」的工具庫。<br>常見的像 <code>MNIST</code>, <code>CIFAR10</code>, <code>ImageNet</code> 都可以直接用這個模組下載與載入。</p>\n<p>ToTensor() 用來把影像（通常是 PIL Image 或 NumPy 陣列）轉成 PyTorch 的 Tensor 格式。<br>同時會自動把像素值從 <code>[0, 255]</code> 轉成 <code>[0.0, 1.0]</code>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Download training data from open datasets.</span><br><span class=\"line\">training_data = datasets.FashionMNIST(</span><br><span class=\"line\">    root=&quot;data&quot;,</span><br><span class=\"line\">    train=True,</span><br><span class=\"line\">    download=True,</span><br><span class=\"line\">    transform=ToTensor(),</span><br><span class=\"line\">)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># Download test data from open datasets.</span><br><span class=\"line\">test_data = datasets.FashionMNIST(</span><br><span class=\"line\">    root=&quot;data&quot;,</span><br><span class=\"line\">    train=False,</span><br><span class=\"line\">    download=True,</span><br><span class=\"line\">    transform=ToTensor(),</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Download training data from open datasets.</span><br><span class=\"line\">training_data = datasets.FashionMNIST(</span><br><span class=\"line\">    root=&quot;data&quot;,</span><br><span class=\"line\">    train=True,</span><br><span class=\"line\">    download=True,</span><br><span class=\"line\">    transform=ToTensor(),</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"># Download test data from open datasets.</span><br><span class=\"line\">test_data = datasets.FashionMNIST(</span><br><span class=\"line\">    root=&quot;data&quot;,</span><br><span class=\"line\">    train=False,</span><br><span class=\"line\">    download=True,</span><br><span class=\"line\">    transform=ToTensor(),</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"training-data-訓練資料\"><a href=\"#training-data-訓練資料\" class=\"headerlink\" title=\"training_data 訓練資料\"></a>training_data 訓練資料</h2><p><code>datasets.FashionMNIST</code>：<br>這是 PyTorch 內建的 <strong>Fashion-MNIST 資料集</strong>，<br>它是一組 <strong>灰階 28×28 的衣物影像</strong>（共有 10 類，像是 T-shirt、鞋子、包包等）。<br>可以視為「MNIST（手寫數字）」的進階版。</p>\n<p><code>root=&quot;data&quot;</code>：<br>指定資料儲存的資料夾名稱（PyTorch 會自動在這個資料夾裡建立結構）。<br>若資料不存在，會在 <code>&quot;data/&quot;</code> 底下建立子資料夾並下載。</p>\n<p><code>train=True</code>：<br>表示這是<strong>訓練集</strong>（training set），<br>FashionMNIST 總共有：</p>\n<ul>\n<li><p>訓練資料：60,000 張圖片</p>\n</li>\n<li><p>測試資料：10,000 張圖片</p>\n</li>\n</ul>\n<p><code>download=True</code>：<br>若本地端還沒有資料集，就自動幫你從官方網站下載。</p>\n<p><code>transform=ToTensor()</code>：<br>將每張影像轉換成 PyTorch 的 <strong>Tensor</strong> 格式，<br>並且把像素值從 <code>[0, 255]</code> 正規化到 <code>[0.0, 1.0]</code>。</p>\n<p>轉換後的每張圖大小是 <code>(1, 28, 28)</code>，代表：<code>1</code> 個通道（灰階），<code>28×28</code> 像素。</p>\n<h2 id=\"test-data-測試資料\"><a href=\"#test-data-測試資料\" class=\"headerlink\" title=\"test_data 測試資料\"></a>test_data 測試資料</h2><p><code>train=False</code> → 表示這是<strong>測試集</strong>（test set）。用來在訓練完模型後驗證準確率。</p>\n<hr>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">batch_size = 64</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># Create data loaders.</span><br><span class=\"line\">train_dataloader = DataLoader(training_data, batch_size=batch_size)</span><br><span class=\"line\">test_dataloader = DataLoader(test_data, batch_size=batch_size)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">for X, y in test_dataloader:</span><br><span class=\"line\">    print(f&quot;Shape of X [N, C, H, W]: &#123;X.shape&#125;&quot;)</span><br><span class=\"line\">    print(f&quot;Shape of y: &#123;y.shape&#125; &#123;y.dtype&#125;&quot;)</span><br><span class=\"line\">    break</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">batch_size = 64</span><br><span class=\"line\"></span><br><span class=\"line\"># Create data loaders.</span><br><span class=\"line\">train_dataloader = DataLoader(training_data, batch_size=batch_size)</span><br><span class=\"line\">test_dataloader = DataLoader(test_data, batch_size=batch_size)</span><br><span class=\"line\"></span><br><span class=\"line\">for X, y in test_dataloader:</span><br><span class=\"line\">    print(f&quot;Shape of X [N, C, H, W]: &#123;X.shape&#125;&quot;)</span><br><span class=\"line\">    print(f&quot;Shape of y: &#123;y.shape&#125; &#123;y.dtype&#125;&quot;)</span><br><span class=\"line\">    break</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>輸出結果 : Shape of X [N, C, H, W]: torch.Size([64, 1, 28, 28]) Shape of y: torch.Size([64]) torch.int64</p>\n</blockquote>\n<p><code>DataLoader</code> 的功能：</p>\n<p>自動把 dataset 拆成一批批（依照 batch_size）。</p>\n<p>每次用 <code>for</code> 迴圈取資料時，會自動回傳一組 <code>(X, y)</code>：</p>\n<ul>\n<li><p><code>X</code>: 一批圖片</p>\n</li>\n<li><p><code>y</code>: 一批標籤</p>\n</li>\n</ul>\n<p>batch_size &#x3D; 64 模型訓練或測試時，每次會從資料集中取出 64 筆樣本。</p>\n<p>N: 筆數 C: RGB H: 高度 W: 寬度</p>\n<table>\n<thead>\n<tr>\n<th>符號</th>\n<th>意義</th>\n<th>實際數值</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>N</code></td>\n<td>batch size</td>\n<td>64</td>\n<td>每次讀 64 張圖片</td>\n</tr>\n<tr>\n<td><code>C</code></td>\n<td>channels</td>\n<td>1</td>\n<td>灰階圖像（只有 1 個通道）</td>\n</tr>\n<tr>\n<td><code>H</code></td>\n<td>height</td>\n<td>28</td>\n<td>高度 28 pixels</td>\n</tr>\n<tr>\n<td><code>W</code></td>\n<td>width</td>\n<td>28</td>\n<td>寬度 28 pixels</td>\n</tr>\n</tbody></table>\n<h2 id=\"Creating-Models-建立模型\"><a href=\"#Creating-Models-建立模型\" class=\"headerlink\" title=\"Creating Models 建立模型\"></a>Creating Models 建立模型</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">＃ AMD or MAC M1... or NVIDIA</span><br><span class=\"line\">device = torch.accelerator.current_accelerator().type if torch.accelerator.is_available() else &quot;cpu&quot;</span><br><span class=\"line\">print(f&quot;Using &#123;device&#125; device&quot;)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># Define model</span><br><span class=\"line\">class NeuralNetwork(nn.Module):</span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        super().__init__()</span><br><span class=\"line\">        self.flatten = nn.Flatten()</span><br><span class=\"line\">        self.linear_relu_stack = nn.Sequential(</span><br><span class=\"line\">            nn.Linear(28*28, 512), ＃ 輸入,輸出神經元個數</span><br><span class=\"line\">            nn.ReLU(),</span><br><span class=\"line\">            nn.Linear(512, 512),</span><br><span class=\"line\">            nn.ReLU(),</span><br><span class=\"line\">            nn.Linear(512, 10)</span><br><span class=\"line\">        )</span><br><span class=\"line\">    </span><br><span class=\"line\">    ＃ x 就是 28 * 28的資料</span><br><span class=\"line\">    def forward(self, x):</span><br><span class=\"line\">        x = self.flatten(x)</span><br><span class=\"line\">        logits = self.linear_relu_stack(x)</span><br><span class=\"line\">        return logits</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">model = NeuralNetwork().to(device)</span><br><span class=\"line\">print(model)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">＃ AMD or MAC M1... or NVIDIA</span><br><span class=\"line\">device = torch.accelerator.current_accelerator().type if torch.accelerator.is_available() else &quot;cpu&quot;</span><br><span class=\"line\">print(f&quot;Using &#123;device&#125; device&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># Define model</span><br><span class=\"line\">class NeuralNetwork(nn.Module):</span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        super().__init__()</span><br><span class=\"line\">        self.flatten = nn.Flatten()</span><br><span class=\"line\">        self.linear_relu_stack = nn.Sequential(</span><br><span class=\"line\">            nn.Linear(28*28, 512), ＃ 輸入,輸出神經元個數</span><br><span class=\"line\">            nn.ReLU(),</span><br><span class=\"line\">            nn.Linear(512, 512),</span><br><span class=\"line\">            nn.ReLU(),</span><br><span class=\"line\">            nn.Linear(512, 10)</span><br><span class=\"line\">        )</span><br><span class=\"line\">    </span><br><span class=\"line\">    ＃ x 就是 28 * 28的資料</span><br><span class=\"line\">    def forward(self, x):</span><br><span class=\"line\">        x = self.flatten(x)</span><br><span class=\"line\">        logits = self.linear_relu_stack(x)</span><br><span class=\"line\">        return logits</span><br><span class=\"line\"></span><br><span class=\"line\">model = NeuralNetwork().to(device)</span><br><span class=\"line\">print(model)</span><br></pre></td></tr></table></figure>\n\n<p>輸出結果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Using cuda device</span><br><span class=\"line\">NeuralNetwork(</span><br><span class=\"line\">  (flatten): Flatten(start_dim=1, end_dim=-1)</span><br><span class=\"line\">  (linear_relu_stack): Sequential(</span><br><span class=\"line\">    (0): Linear(in_features=784, out_features=512, bias=True)</span><br><span class=\"line\">    (1): ReLU()</span><br><span class=\"line\">    (2): Linear(in_features=512, out_features=512, bias=True)</span><br><span class=\"line\">    (3): ReLU()</span><br><span class=\"line\">    (4): Linear(in_features=512, out_features=10, bias=True)</span><br><span class=\"line\">  )</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Using cuda device</span><br><span class=\"line\">NeuralNetwork(</span><br><span class=\"line\">  (flatten): Flatten(start_dim=1, end_dim=-1)</span><br><span class=\"line\">  (linear_relu_stack): Sequential(</span><br><span class=\"line\">    (0): Linear(in_features=784, out_features=512, bias=True)</span><br><span class=\"line\">    (1): ReLU()</span><br><span class=\"line\">    (2): Linear(in_features=512, out_features=512, bias=True)</span><br><span class=\"line\">    (3): ReLU()</span><br><span class=\"line\">    (4): Linear(in_features=512, out_features=10, bias=True)</span><br><span class=\"line\">  )</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"初始化神經層結構\"><a href=\"#初始化神經層結構\" class=\"headerlink\" title=\"初始化神經層結構\"></a>初始化神經層結構</h3><ul>\n<li><p>先定義每一層的結構（例如 Flatten、Linear、ReLU 等）。</p>\n</li>\n<li><p>透過 <code>forward()</code> 函式，把各神經層串接起來，形成資料的運算流程。</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"nn-Flatten\"><a href=\"#nn-Flatten\" class=\"headerlink\" title=\"nn.Flatten()\"></a><code>nn.Flatten()</code></h3><ul>\n<li><p>功能：將影像從二維 (H×W) 攤平成一維 (向量)。</p>\n</li>\n<li><p>原因：神經元無法直接讀取二維資料，必須轉成一維輸入。</p>\n</li>\n<li><p>從 <code>(1, 28, 28)</code> 攤平成一維 <code>(784,)</code>。</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"nn-Sequential\"><a href=\"#nn-Sequential\" class=\"headerlink\" title=\"nn.Sequential()\"></a><code>nn.Sequential()</code></h3><ul>\n<li><p>功能：將多個神經層打包成一個順序結構，使程式更簡潔。</p>\n</li>\n<li><p>常見組合：<code>Linear</code>（線性層）搭配 <code>ReLU</code>（激活函數）。</p>\n</li>\n<li><p>範例：<code>nn.Sequential(nn.Linear(784, 512), nn.ReLU())</code>。</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"to-device\"><a href=\"#to-device\" class=\"headerlink\" title=\".to(device)\"></a><code>.to(device)</code></h3><ul>\n<li><p>功能：指定模型運行的裝置。</p>\n</li>\n<li><p>若系統有 GPU，會將整個神經網路搬移到 GPU 執行，以加快訓練速度。</p>\n</li>\n<li><p>範例：<code>model.to(&quot;cuda&quot;)</code>。</p>\n</li>\n</ul>\n<h2 id=\"Optimizing-the-Model-Parameters-優化模型參數\"><a href=\"#Optimizing-the-Model-Parameters-優化模型參數\" class=\"headerlink\" title=\"Optimizing the Model Parameters 優化模型參數\"></a>Optimizing the Model Parameters 優化模型參數</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss_fn = nn.CrossEntropyLoss() #分類</span><br><span class=\"line\">optimizer = torch.optim.SGD(model.parameters(), lr=1e-3) #最佳化 lr = 0.001</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss_fn = nn.CrossEntropyLoss() #分類</span><br><span class=\"line\">optimizer = torch.optim.SGD(model.parameters(), lr=1e-3) #最佳化 lr = 0.001</span><br></pre></td></tr></table></figure>\n\n<p>CrossEntropyLoss 有兩個功能 :</p>\n<ul>\n<li><p><strong>Softmax</strong>（把模型輸出的 logits 轉為機率分佈）</p>\n</li>\n<li><p>**Negative Log-Likelihood (NLLLoss)**（衡量預測與真實答案的差距）</p>\n</li>\n</ul>\n<p>SGD、Adam 都是適應性的演算法，動態調整 learning rate。</p>\n<p>model.parameters() : 權重的更新</p>\n<p>lr&#x3D;1e-3 ：學習率（learning rate）&#x3D; 0.001，控制每次更新的步伐大小。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def train(dataloader, model, loss_fn, optimizer):</span><br><span class=\"line\">    size = len(dataloader.dataset)</span><br><span class=\"line\">    model.train() #切換到訓練模式</span><br><span class=\"line\">    for batch, (X, y) in enumerate(dataloader):</span><br><span class=\"line\">        X, y = X.to(device), y.to(device) #放倒GPU</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        # Compute prediction error</span><br><span class=\"line\">        pred = model(X)</span><br><span class=\"line\">        loss = loss_fn(pred, y)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        # Backpropagation</span><br><span class=\"line\">        loss.backward() #反向傳播 計算梯度</span><br><span class=\"line\">        optimizer.step() #學東西</span><br><span class=\"line\">        optimizer.zero_grad() #將上一次的參數歸零</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        if batch % 100 == 0:</span><br><span class=\"line\">            loss, current = loss.item(), (batch + 1) * len(X</span><br><span class=\"line\">            print(f&quot;loss: &#123;loss:&gt;7f&#125;  [&#123;current:&gt;5d&#125;/&#123;size:&gt;5d&#125;]&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def train(dataloader, model, loss_fn, optimizer):</span><br><span class=\"line\">    size = len(dataloader.dataset)</span><br><span class=\"line\">    model.train() #切換到訓練模式</span><br><span class=\"line\">    for batch, (X, y) in enumerate(dataloader):</span><br><span class=\"line\">        X, y = X.to(device), y.to(device) #放倒GPU</span><br><span class=\"line\"></span><br><span class=\"line\">        # Compute prediction error</span><br><span class=\"line\">        pred = model(X)</span><br><span class=\"line\">        loss = loss_fn(pred, y)</span><br><span class=\"line\"></span><br><span class=\"line\">        # Backpropagation</span><br><span class=\"line\">        loss.backward() #反向傳播 計算梯度</span><br><span class=\"line\">        optimizer.step() #學東西</span><br><span class=\"line\">        optimizer.zero_grad() #將上一次的參數歸零</span><br><span class=\"line\"></span><br><span class=\"line\">        if batch % 100 == 0:</span><br><span class=\"line\">            loss, current = loss.item(), (batch + 1) * len(X</span><br><span class=\"line\">            print(f&quot;loss: &#123;loss:&gt;7f&#125;  [&#123;current:&gt;5d&#125;/&#123;size:&gt;5d&#125;]&quot;)</span><br></pre></td></tr></table></figure>\n\n<p><code>len(dataloader.dataset)</code>：取得整個訓練資料集的總筆數。</p>\n<p><code>model.train()</code>：設定為訓練模式（啟用 dropout、batchnorm 等訓練專用層的行為）。</p>\n<p>使用 <code>enumerate(dataloader)</code>：一批一批地從 DataLoader 拿資料。<code>(X, y)</code>：<code>X</code> 是輸入影像，<code>y</code> 是真實標籤。</p>\n<p><code>.to(device)</code>：把資料放到相同的裝置上（如 GPU），確保和模型一致。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pred = model(X)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pred = model(X)</span><br></pre></td></tr></table></figure>\n\n<p>把圖片送進模型，取得預測結果（logits）。此時 <code>pred</code> 的形狀會是 <code>[64, 10]</code>（64 張圖、10 類別）。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss = loss_fn(pred, y)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss = loss_fn(pred, y)</span><br></pre></td></tr></table></figure>\n\n<p>用損失函數得到目前這一批的「平均誤差」。</p>\n<p>loss.backward() : 計算梯度（反向傳遞 Backpropagation）</p>\n<p>optimizer.step() : 根據梯度更新模型權重</p>\n<p>optimizer.zero_grad() : 清空舊梯度（避免累積）</p>\n<p>最後每 100 個 batch 顯示一次進度與目前損失值。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def test(dataloader, model, loss_fn):</span><br><span class=\"line\">    size = len(dataloader.dataset)</span><br><span class=\"line\">    num_batches = len(dataloader)</span><br><span class=\"line\">    model.eval()</span><br><span class=\"line\">    test_loss, correct = 0, 0</span><br><span class=\"line\">    with torch.no_grad():</span><br><span class=\"line\">        for X, y in dataloader:</span><br><span class=\"line\">            X, y = X.to(device), y.to(device)</span><br><span class=\"line\">            pred = model(X)</span><br><span class=\"line\">            test_loss += loss_fn(pred, y).item() #比對64筆資料</span><br><span class=\"line\">            correct += (pred.argmax(1) == y).type(torch.float).sum().item()</span><br><span class=\"line\">    test_loss /= num_batches</span><br><span class=\"line\">    correct /= size</span><br><span class=\"line\">    print(f&quot;Test Error: \\n Accuracy: &#123;(100*correct):&gt;0.1f&#125;%, Avg loss: &#123;test_loss:&gt;8f&#125; \\n&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def test(dataloader, model, loss_fn):</span><br><span class=\"line\">    size = len(dataloader.dataset)</span><br><span class=\"line\">    num_batches = len(dataloader)</span><br><span class=\"line\">    model.eval()</span><br><span class=\"line\">    test_loss, correct = 0, 0</span><br><span class=\"line\">    with torch.no_grad():</span><br><span class=\"line\">        for X, y in dataloader:</span><br><span class=\"line\">            X, y = X.to(device), y.to(device)</span><br><span class=\"line\">            pred = model(X)</span><br><span class=\"line\">            test_loss += loss_fn(pred, y).item() #比對64筆資料</span><br><span class=\"line\">            correct += (pred.argmax(1) == y).type(torch.float).sum().item()</span><br><span class=\"line\">    test_loss /= num_batches</span><br><span class=\"line\">    correct /= size</span><br><span class=\"line\">    print(f&quot;Test Error: \\n Accuracy: &#123;(100*correct):&gt;0.1f&#125;%, Avg loss: &#123;test_loss:&gt;8f&#125; \\n&quot;)</span><br></pre></td></tr></table></figure>\n\n<p><code>size</code>：測試資料總筆數（例如 10,000 張 FashionMNIST 圖）</p>\n<p><code>num_batches</code>：DataLoader 的批次數量（例如 10,000 ÷ 64 ≈ 157 批）</p>\n<p>model.eval() : 把模型切換為 evaluation mode (評估模式)。</p>\n<p>argmax(list) : 選出數字最大的，然後取出索引值。</p>\n<p>test_loss越小表示學習效果越好</p>\n<ul>\n<li><p><code>size</code>：整個測試資料集的樣本總數。</p>\n</li>\n<li><p><code>num_batches</code>：總共有幾個批次（batch）。</p>\n</li>\n<li><p><code>model.eval()</code>：切換成「<strong>評估模式</strong>」，停用訓練時的行為（例如 dropout、batchnorm 更新）。</p>\n</li>\n<li><p><code>test_loss</code>、<code>correct</code>：用來累積測試的結果。</p>\n</li>\n</ul>\n<h3 id=\"關閉梯度計算\"><a href=\"#關閉梯度計算\" class=\"headerlink\" title=\"關閉梯度計算\"></a>關閉梯度計算</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">with torch.no_grad():</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>測試階段不需要訓練，也不需要反向傳播梯度。</p>\n</li>\n<li><p><code>torch.no_grad()</code> 可以節省記憶體與加快運算速度。</p>\n</li>\n</ul>\n<h3 id=\"主要測試迴圈\"><a href=\"#主要測試迴圈\" class=\"headerlink\" title=\"主要測試迴圈\"></a>主要測試迴圈</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for X, y in dataloader:</span><br><span class=\"line\">    X, y = X.to(device), y.to(device)</span><br><span class=\"line\">    pred = model(X)</span><br><span class=\"line\">    test_loss += loss_fn(pred, y).item()  # 累積每個 batch 的 loss</span><br><span class=\"line\">    correct += (pred.argmax(1) == y).type(torch.float).sum().item()</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for X, y in dataloader:</span><br><span class=\"line\">    X, y = X.to(device), y.to(device)</span><br><span class=\"line\">    pred = model(X)</span><br><span class=\"line\">    test_loss += loss_fn(pred, y).item()  # 累積每個 batch 的 loss</span><br><span class=\"line\">    correct += (pred.argmax(1) == y).type(torch.float).sum().item()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"詳細解釋：\"><a href=\"#詳細解釋：\" class=\"headerlink\" title=\"詳細解釋：\"></a>詳細解釋：</h3><table>\n<thead>\n<tr>\n<th>步驟</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>X, y = X.to(device), y.to(device)</code></td>\n<td>將資料移到 GPU &#x2F; CPU</td>\n</tr>\n<tr>\n<td><code>pred = model(X)</code></td>\n<td>對測試資料做預測</td>\n</tr>\n<tr>\n<td><code>loss_fn(pred, y)</code></td>\n<td>計算這一批資料的損失值</td>\n</tr>\n<tr>\n<td><code>.item()</code></td>\n<td>取出純數值（從 tensor 轉成 float）</td>\n</tr>\n<tr>\n<td><code>pred.argmax(1)</code></td>\n<td>取出每筆資料預測機率最高的類別</td>\n</tr>\n<tr>\n<td><code>(pred.argmax(1) == y)</code></td>\n<td>比對預測結果與真實標籤是否相同</td>\n</tr>\n<tr>\n<td><code>.type(torch.float).sum().item()</code></td>\n<td>計算這一批中預測正確的樣本數並加總</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"平均化結果與輸出\"><a href=\"#平均化結果與輸出\" class=\"headerlink\" title=\"平均化結果與輸出\"></a>平均化結果與輸出</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test_loss /= num_batches</span><br><span class=\"line\">correct /= size</span><br><span class=\"line\">print(f&quot;Test Error: \\n Accuracy: &#123;(100*correct):&gt;0.1f&#125;%, Avg loss: &#123;test_loss:&gt;8f&#125; \\n&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test_loss /= num_batches</span><br><span class=\"line\">correct /= size</span><br><span class=\"line\">print(f&quot;Test Error: \\n Accuracy: &#123;(100*correct):&gt;0.1f&#125;%, Avg loss: &#123;test_loss:&gt;8f&#125; \\n&quot;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><code>test_loss /= num_batches</code>：計算整體平均損失。</p>\n</li>\n<li><p><code>correct /= size</code>：計算整體準確率。</p>\n</li>\n<li><p><code>print()</code>：輸出測試結果。</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">epochs = 5</span><br><span class=\"line\">for t in range(epochs):</span><br><span class=\"line\">    print(f&quot;Epoch &#123;t+1&#125;\\n-------------------------------&quot;)</span><br><span class=\"line\">    train(train_dataloader, model, loss_fn, optimizer)</span><br><span class=\"line\">    test(test_dataloader, model, loss_fn)</span><br><span class=\"line\">print(&quot;Done!&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">epochs = 5</span><br><span class=\"line\">for t in range(epochs):</span><br><span class=\"line\">    print(f&quot;Epoch &#123;t+1&#125;\\n-------------------------------&quot;)</span><br><span class=\"line\">    train(train_dataloader, model, loss_fn, optimizer)</span><br><span class=\"line\">    test(test_dataloader, model, loss_fn)</span><br><span class=\"line\">print(&quot;Done!&quot;)</span><br></pre></td></tr></table></figure>\n\n<p>以這個程式碼來說epochs是5，也就是訓練5次的意思。</p>\n<h2 id=\"Saving-Models\"><a href=\"#Saving-Models\" class=\"headerlink\" title=\"Saving Models\"></a>Saving Models</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">torch.save(model.state_dict(), &quot;model.pth&quot;)</span><br><span class=\"line\">print(&quot;Saved PyTorch Model State to model.pth&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">torch.save(model.state_dict(), &quot;model.pth&quot;)</span><br><span class=\"line\">print(&quot;Saved PyTorch Model State to model.pth&quot;)</span><br></pre></td></tr></table></figure>\n\n<p>將模型的參數儲存到一個檔案 <code>&quot;model.pth&quot;</code> 中。</p>\n<p>之後可以再繼續訓練或是使用。</p>\n<h2 id=\"Loading-Models\"><a href=\"#Loading-Models\" class=\"headerlink\" title=\"Loading Models\"></a>Loading Models</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model = NeuralNetwork().to(device)</span><br><span class=\"line\">model.load_state_dict(torch.load(&quot;model.pth&quot;, weights_only=True))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model = NeuralNetwork().to(device)</span><br><span class=\"line\">model.load_state_dict(torch.load(&quot;model.pth&quot;, weights_only=True))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">classes = [</span><br><span class=\"line\">    &quot;T-shirt/top&quot;,</span><br><span class=\"line\">    &quot;Trouser&quot;,</span><br><span class=\"line\">    &quot;Pullover&quot;,</span><br><span class=\"line\">    &quot;Dress&quot;,</span><br><span class=\"line\">    &quot;Coat&quot;,</span><br><span class=\"line\">    &quot;Sandal&quot;,</span><br><span class=\"line\">    &quot;Shirt&quot;,</span><br><span class=\"line\">    &quot;Sneaker&quot;,</span><br><span class=\"line\">    &quot;Bag&quot;,</span><br><span class=\"line\">    &quot;Ankle boot&quot;,</span><br><span class=\"line\">]</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">model.eval()</span><br><span class=\"line\">x, y = test_data[0][0], test_data[0][1]</span><br><span class=\"line\">with torch.no_grad():</span><br><span class=\"line\">    x = x.to(device)</span><br><span class=\"line\">    pred = model(x)</span><br><span class=\"line\">    predicted, actual = classes[pred[0].argmax(0)], classes[y]</span><br><span class=\"line\">    print(f&#x27;Predicted: &quot;&#123;predicted&#125;&quot;, Actual: &quot;&#123;actual&#125;&quot;&#x27;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">classes = [</span><br><span class=\"line\">    &quot;T-shirt/top&quot;,</span><br><span class=\"line\">    &quot;Trouser&quot;,</span><br><span class=\"line\">    &quot;Pullover&quot;,</span><br><span class=\"line\">    &quot;Dress&quot;,</span><br><span class=\"line\">    &quot;Coat&quot;,</span><br><span class=\"line\">    &quot;Sandal&quot;,</span><br><span class=\"line\">    &quot;Shirt&quot;,</span><br><span class=\"line\">    &quot;Sneaker&quot;,</span><br><span class=\"line\">    &quot;Bag&quot;,</span><br><span class=\"line\">    &quot;Ankle boot&quot;,</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">model.eval()</span><br><span class=\"line\">x, y = test_data[0][0], test_data[0][1]</span><br><span class=\"line\">with torch.no_grad():</span><br><span class=\"line\">    x = x.to(device)</span><br><span class=\"line\">    pred = model(x)</span><br><span class=\"line\">    predicted, actual = classes[pred[0].argmax(0)], classes[y]</span><br><span class=\"line\">    print(f&#x27;Predicted: &quot;&#123;predicted&#125;&quot;, Actual: &quot;&#123;actual&#125;&quot;&#x27;)</span><br></pre></td></tr></table></figure>\n\n<p>輸出結果 : Predicted: “Ankle boot”, Actual: “Ankle boot”</p>\n","excerpt":"","more":"<p>程式碼來源：<a href=\"https://docs.pytorch.org/tutorials/beginner/basics/quickstart_tutorial.html\">https://docs.pytorch.org/tutorials/beginner/basics/quickstart_tutorial.html</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch</span><br><span class=\"line\"># 匯入 nn（neural network）子模組</span><br><span class=\"line\">from torch import nn</span><br><span class=\"line\">from torch.utils.data import DataLoader</span><br><span class=\"line\">from torchvision import datasets</span><br><span class=\"line\">from torchvision.transforms import ToTensor</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch</span><br><span class=\"line\"># 匯入 nn（neural network）子模組</span><br><span class=\"line\">from torch import nn</span><br><span class=\"line\">from torch.utils.data import DataLoader</span><br><span class=\"line\">from torchvision import datasets</span><br><span class=\"line\">from torchvision.transforms import ToTensor</span><br></pre></td></tr></table></figure>\n\n<p><code>nn</code> 是用來「定義網路結構」的模組。</p>\n<p>DataLoader 幫你自動把 dataset 切成一批一批（batch）。在每個 epoch 打亂（shuffle）資料。</p>\n<p>torchvision.datasets 這是 PyTorch 針對「影像資料集」的工具庫。<br>常見的像 <code>MNIST</code>, <code>CIFAR10</code>, <code>ImageNet</code> 都可以直接用這個模組下載與載入。</p>\n<p>ToTensor() 用來把影像（通常是 PIL Image 或 NumPy 陣列）轉成 PyTorch 的 Tensor 格式。<br>同時會自動把像素值從 <code>[0, 255]</code> 轉成 <code>[0.0, 1.0]</code>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Download training data from open datasets.</span><br><span class=\"line\">training_data = datasets.FashionMNIST(</span><br><span class=\"line\">    root=&quot;data&quot;,</span><br><span class=\"line\">    train=True,</span><br><span class=\"line\">    download=True,</span><br><span class=\"line\">    transform=ToTensor(),</span><br><span class=\"line\">)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># Download test data from open datasets.</span><br><span class=\"line\">test_data = datasets.FashionMNIST(</span><br><span class=\"line\">    root=&quot;data&quot;,</span><br><span class=\"line\">    train=False,</span><br><span class=\"line\">    download=True,</span><br><span class=\"line\">    transform=ToTensor(),</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Download training data from open datasets.</span><br><span class=\"line\">training_data = datasets.FashionMNIST(</span><br><span class=\"line\">    root=&quot;data&quot;,</span><br><span class=\"line\">    train=True,</span><br><span class=\"line\">    download=True,</span><br><span class=\"line\">    transform=ToTensor(),</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"># Download test data from open datasets.</span><br><span class=\"line\">test_data = datasets.FashionMNIST(</span><br><span class=\"line\">    root=&quot;data&quot;,</span><br><span class=\"line\">    train=False,</span><br><span class=\"line\">    download=True,</span><br><span class=\"line\">    transform=ToTensor(),</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"training-data-訓練資料\"><a href=\"#training-data-訓練資料\" class=\"headerlink\" title=\"training_data 訓練資料\"></a>training_data 訓練資料</h2><p><code>datasets.FashionMNIST</code>：<br>這是 PyTorch 內建的 <strong>Fashion-MNIST 資料集</strong>，<br>它是一組 <strong>灰階 28×28 的衣物影像</strong>（共有 10 類，像是 T-shirt、鞋子、包包等）。<br>可以視為「MNIST（手寫數字）」的進階版。</p>\n<p><code>root=&quot;data&quot;</code>：<br>指定資料儲存的資料夾名稱（PyTorch 會自動在這個資料夾裡建立結構）。<br>若資料不存在，會在 <code>&quot;data/&quot;</code> 底下建立子資料夾並下載。</p>\n<p><code>train=True</code>：<br>表示這是<strong>訓練集</strong>（training set），<br>FashionMNIST 總共有：</p>\n<ul>\n<li><p>訓練資料：60,000 張圖片</p>\n</li>\n<li><p>測試資料：10,000 張圖片</p>\n</li>\n</ul>\n<p><code>download=True</code>：<br>若本地端還沒有資料集，就自動幫你從官方網站下載。</p>\n<p><code>transform=ToTensor()</code>：<br>將每張影像轉換成 PyTorch 的 <strong>Tensor</strong> 格式，<br>並且把像素值從 <code>[0, 255]</code> 正規化到 <code>[0.0, 1.0]</code>。</p>\n<p>轉換後的每張圖大小是 <code>(1, 28, 28)</code>，代表：<code>1</code> 個通道（灰階），<code>28×28</code> 像素。</p>\n<h2 id=\"test-data-測試資料\"><a href=\"#test-data-測試資料\" class=\"headerlink\" title=\"test_data 測試資料\"></a>test_data 測試資料</h2><p><code>train=False</code> → 表示這是<strong>測試集</strong>（test set）。用來在訓練完模型後驗證準確率。</p>\n<hr>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">batch_size = 64</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># Create data loaders.</span><br><span class=\"line\">train_dataloader = DataLoader(training_data, batch_size=batch_size)</span><br><span class=\"line\">test_dataloader = DataLoader(test_data, batch_size=batch_size)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">for X, y in test_dataloader:</span><br><span class=\"line\">    print(f&quot;Shape of X [N, C, H, W]: &#123;X.shape&#125;&quot;)</span><br><span class=\"line\">    print(f&quot;Shape of y: &#123;y.shape&#125; &#123;y.dtype&#125;&quot;)</span><br><span class=\"line\">    break</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">batch_size = 64</span><br><span class=\"line\"></span><br><span class=\"line\"># Create data loaders.</span><br><span class=\"line\">train_dataloader = DataLoader(training_data, batch_size=batch_size)</span><br><span class=\"line\">test_dataloader = DataLoader(test_data, batch_size=batch_size)</span><br><span class=\"line\"></span><br><span class=\"line\">for X, y in test_dataloader:</span><br><span class=\"line\">    print(f&quot;Shape of X [N, C, H, W]: &#123;X.shape&#125;&quot;)</span><br><span class=\"line\">    print(f&quot;Shape of y: &#123;y.shape&#125; &#123;y.dtype&#125;&quot;)</span><br><span class=\"line\">    break</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>輸出結果 : Shape of X [N, C, H, W]: torch.Size([64, 1, 28, 28]) Shape of y: torch.Size([64]) torch.int64</p>\n</blockquote>\n<p><code>DataLoader</code> 的功能：</p>\n<p>自動把 dataset 拆成一批批（依照 batch_size）。</p>\n<p>每次用 <code>for</code> 迴圈取資料時，會自動回傳一組 <code>(X, y)</code>：</p>\n<ul>\n<li><p><code>X</code>: 一批圖片</p>\n</li>\n<li><p><code>y</code>: 一批標籤</p>\n</li>\n</ul>\n<p>batch_size &#x3D; 64 模型訓練或測試時，每次會從資料集中取出 64 筆樣本。</p>\n<p>N: 筆數 C: RGB H: 高度 W: 寬度</p>\n<table>\n<thead>\n<tr>\n<th>符號</th>\n<th>意義</th>\n<th>實際數值</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>N</code></td>\n<td>batch size</td>\n<td>64</td>\n<td>每次讀 64 張圖片</td>\n</tr>\n<tr>\n<td><code>C</code></td>\n<td>channels</td>\n<td>1</td>\n<td>灰階圖像（只有 1 個通道）</td>\n</tr>\n<tr>\n<td><code>H</code></td>\n<td>height</td>\n<td>28</td>\n<td>高度 28 pixels</td>\n</tr>\n<tr>\n<td><code>W</code></td>\n<td>width</td>\n<td>28</td>\n<td>寬度 28 pixels</td>\n</tr>\n</tbody></table>\n<h2 id=\"Creating-Models-建立模型\"><a href=\"#Creating-Models-建立模型\" class=\"headerlink\" title=\"Creating Models 建立模型\"></a>Creating Models 建立模型</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">＃ AMD or MAC M1... or NVIDIA</span><br><span class=\"line\">device = torch.accelerator.current_accelerator().type if torch.accelerator.is_available() else &quot;cpu&quot;</span><br><span class=\"line\">print(f&quot;Using &#123;device&#125; device&quot;)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># Define model</span><br><span class=\"line\">class NeuralNetwork(nn.Module):</span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        super().__init__()</span><br><span class=\"line\">        self.flatten = nn.Flatten()</span><br><span class=\"line\">        self.linear_relu_stack = nn.Sequential(</span><br><span class=\"line\">            nn.Linear(28*28, 512), ＃ 輸入,輸出神經元個數</span><br><span class=\"line\">            nn.ReLU(),</span><br><span class=\"line\">            nn.Linear(512, 512),</span><br><span class=\"line\">            nn.ReLU(),</span><br><span class=\"line\">            nn.Linear(512, 10)</span><br><span class=\"line\">        )</span><br><span class=\"line\">    </span><br><span class=\"line\">    ＃ x 就是 28 * 28的資料</span><br><span class=\"line\">    def forward(self, x):</span><br><span class=\"line\">        x = self.flatten(x)</span><br><span class=\"line\">        logits = self.linear_relu_stack(x)</span><br><span class=\"line\">        return logits</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">model = NeuralNetwork().to(device)</span><br><span class=\"line\">print(model)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">＃ AMD or MAC M1... or NVIDIA</span><br><span class=\"line\">device = torch.accelerator.current_accelerator().type if torch.accelerator.is_available() else &quot;cpu&quot;</span><br><span class=\"line\">print(f&quot;Using &#123;device&#125; device&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\"># Define model</span><br><span class=\"line\">class NeuralNetwork(nn.Module):</span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        super().__init__()</span><br><span class=\"line\">        self.flatten = nn.Flatten()</span><br><span class=\"line\">        self.linear_relu_stack = nn.Sequential(</span><br><span class=\"line\">            nn.Linear(28*28, 512), ＃ 輸入,輸出神經元個數</span><br><span class=\"line\">            nn.ReLU(),</span><br><span class=\"line\">            nn.Linear(512, 512),</span><br><span class=\"line\">            nn.ReLU(),</span><br><span class=\"line\">            nn.Linear(512, 10)</span><br><span class=\"line\">        )</span><br><span class=\"line\">    </span><br><span class=\"line\">    ＃ x 就是 28 * 28的資料</span><br><span class=\"line\">    def forward(self, x):</span><br><span class=\"line\">        x = self.flatten(x)</span><br><span class=\"line\">        logits = self.linear_relu_stack(x)</span><br><span class=\"line\">        return logits</span><br><span class=\"line\"></span><br><span class=\"line\">model = NeuralNetwork().to(device)</span><br><span class=\"line\">print(model)</span><br></pre></td></tr></table></figure>\n\n<p>輸出結果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Using cuda device</span><br><span class=\"line\">NeuralNetwork(</span><br><span class=\"line\">  (flatten): Flatten(start_dim=1, end_dim=-1)</span><br><span class=\"line\">  (linear_relu_stack): Sequential(</span><br><span class=\"line\">    (0): Linear(in_features=784, out_features=512, bias=True)</span><br><span class=\"line\">    (1): ReLU()</span><br><span class=\"line\">    (2): Linear(in_features=512, out_features=512, bias=True)</span><br><span class=\"line\">    (3): ReLU()</span><br><span class=\"line\">    (4): Linear(in_features=512, out_features=10, bias=True)</span><br><span class=\"line\">  )</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Using cuda device</span><br><span class=\"line\">NeuralNetwork(</span><br><span class=\"line\">  (flatten): Flatten(start_dim=1, end_dim=-1)</span><br><span class=\"line\">  (linear_relu_stack): Sequential(</span><br><span class=\"line\">    (0): Linear(in_features=784, out_features=512, bias=True)</span><br><span class=\"line\">    (1): ReLU()</span><br><span class=\"line\">    (2): Linear(in_features=512, out_features=512, bias=True)</span><br><span class=\"line\">    (3): ReLU()</span><br><span class=\"line\">    (4): Linear(in_features=512, out_features=10, bias=True)</span><br><span class=\"line\">  )</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"初始化神經層結構\"><a href=\"#初始化神經層結構\" class=\"headerlink\" title=\"初始化神經層結構\"></a>初始化神經層結構</h3><ul>\n<li><p>先定義每一層的結構（例如 Flatten、Linear、ReLU 等）。</p>\n</li>\n<li><p>透過 <code>forward()</code> 函式，把各神經層串接起來，形成資料的運算流程。</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"nn-Flatten\"><a href=\"#nn-Flatten\" class=\"headerlink\" title=\"nn.Flatten()\"></a><code>nn.Flatten()</code></h3><ul>\n<li><p>功能：將影像從二維 (H×W) 攤平成一維 (向量)。</p>\n</li>\n<li><p>原因：神經元無法直接讀取二維資料，必須轉成一維輸入。</p>\n</li>\n<li><p>從 <code>(1, 28, 28)</code> 攤平成一維 <code>(784,)</code>。</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"nn-Sequential\"><a href=\"#nn-Sequential\" class=\"headerlink\" title=\"nn.Sequential()\"></a><code>nn.Sequential()</code></h3><ul>\n<li><p>功能：將多個神經層打包成一個順序結構，使程式更簡潔。</p>\n</li>\n<li><p>常見組合：<code>Linear</code>（線性層）搭配 <code>ReLU</code>（激活函數）。</p>\n</li>\n<li><p>範例：<code>nn.Sequential(nn.Linear(784, 512), nn.ReLU())</code>。</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"to-device\"><a href=\"#to-device\" class=\"headerlink\" title=\".to(device)\"></a><code>.to(device)</code></h3><ul>\n<li><p>功能：指定模型運行的裝置。</p>\n</li>\n<li><p>若系統有 GPU，會將整個神經網路搬移到 GPU 執行，以加快訓練速度。</p>\n</li>\n<li><p>範例：<code>model.to(&quot;cuda&quot;)</code>。</p>\n</li>\n</ul>\n<h2 id=\"Optimizing-the-Model-Parameters-優化模型參數\"><a href=\"#Optimizing-the-Model-Parameters-優化模型參數\" class=\"headerlink\" title=\"Optimizing the Model Parameters 優化模型參數\"></a>Optimizing the Model Parameters 優化模型參數</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss_fn = nn.CrossEntropyLoss() #分類</span><br><span class=\"line\">optimizer = torch.optim.SGD(model.parameters(), lr=1e-3) #最佳化 lr = 0.001</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss_fn = nn.CrossEntropyLoss() #分類</span><br><span class=\"line\">optimizer = torch.optim.SGD(model.parameters(), lr=1e-3) #最佳化 lr = 0.001</span><br></pre></td></tr></table></figure>\n\n<p>CrossEntropyLoss 有兩個功能 :</p>\n<ul>\n<li><p><strong>Softmax</strong>（把模型輸出的 logits 轉為機率分佈）</p>\n</li>\n<li><p>**Negative Log-Likelihood (NLLLoss)**（衡量預測與真實答案的差距）</p>\n</li>\n</ul>\n<p>SGD、Adam 都是適應性的演算法，動態調整 learning rate。</p>\n<p>model.parameters() : 權重的更新</p>\n<p>lr&#x3D;1e-3 ：學習率（learning rate）&#x3D; 0.001，控制每次更新的步伐大小。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def train(dataloader, model, loss_fn, optimizer):</span><br><span class=\"line\">    size = len(dataloader.dataset)</span><br><span class=\"line\">    model.train() #切換到訓練模式</span><br><span class=\"line\">    for batch, (X, y) in enumerate(dataloader):</span><br><span class=\"line\">        X, y = X.to(device), y.to(device) #放倒GPU</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        # Compute prediction error</span><br><span class=\"line\">        pred = model(X)</span><br><span class=\"line\">        loss = loss_fn(pred, y)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        # Backpropagation</span><br><span class=\"line\">        loss.backward() #反向傳播 計算梯度</span><br><span class=\"line\">        optimizer.step() #學東西</span><br><span class=\"line\">        optimizer.zero_grad() #將上一次的參數歸零</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        if batch % 100 == 0:</span><br><span class=\"line\">            loss, current = loss.item(), (batch + 1) * len(X</span><br><span class=\"line\">            print(f&quot;loss: &#123;loss:&gt;7f&#125;  [&#123;current:&gt;5d&#125;/&#123;size:&gt;5d&#125;]&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def train(dataloader, model, loss_fn, optimizer):</span><br><span class=\"line\">    size = len(dataloader.dataset)</span><br><span class=\"line\">    model.train() #切換到訓練模式</span><br><span class=\"line\">    for batch, (X, y) in enumerate(dataloader):</span><br><span class=\"line\">        X, y = X.to(device), y.to(device) #放倒GPU</span><br><span class=\"line\"></span><br><span class=\"line\">        # Compute prediction error</span><br><span class=\"line\">        pred = model(X)</span><br><span class=\"line\">        loss = loss_fn(pred, y)</span><br><span class=\"line\"></span><br><span class=\"line\">        # Backpropagation</span><br><span class=\"line\">        loss.backward() #反向傳播 計算梯度</span><br><span class=\"line\">        optimizer.step() #學東西</span><br><span class=\"line\">        optimizer.zero_grad() #將上一次的參數歸零</span><br><span class=\"line\"></span><br><span class=\"line\">        if batch % 100 == 0:</span><br><span class=\"line\">            loss, current = loss.item(), (batch + 1) * len(X</span><br><span class=\"line\">            print(f&quot;loss: &#123;loss:&gt;7f&#125;  [&#123;current:&gt;5d&#125;/&#123;size:&gt;5d&#125;]&quot;)</span><br></pre></td></tr></table></figure>\n\n<p><code>len(dataloader.dataset)</code>：取得整個訓練資料集的總筆數。</p>\n<p><code>model.train()</code>：設定為訓練模式（啟用 dropout、batchnorm 等訓練專用層的行為）。</p>\n<p>使用 <code>enumerate(dataloader)</code>：一批一批地從 DataLoader 拿資料。<code>(X, y)</code>：<code>X</code> 是輸入影像，<code>y</code> 是真實標籤。</p>\n<p><code>.to(device)</code>：把資料放到相同的裝置上（如 GPU），確保和模型一致。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pred = model(X)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pred = model(X)</span><br></pre></td></tr></table></figure>\n\n<p>把圖片送進模型，取得預測結果（logits）。此時 <code>pred</code> 的形狀會是 <code>[64, 10]</code>（64 張圖、10 類別）。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss = loss_fn(pred, y)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">loss = loss_fn(pred, y)</span><br></pre></td></tr></table></figure>\n\n<p>用損失函數得到目前這一批的「平均誤差」。</p>\n<p>loss.backward() : 計算梯度（反向傳遞 Backpropagation）</p>\n<p>optimizer.step() : 根據梯度更新模型權重</p>\n<p>optimizer.zero_grad() : 清空舊梯度（避免累積）</p>\n<p>最後每 100 個 batch 顯示一次進度與目前損失值。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def test(dataloader, model, loss_fn):</span><br><span class=\"line\">    size = len(dataloader.dataset)</span><br><span class=\"line\">    num_batches = len(dataloader)</span><br><span class=\"line\">    model.eval()</span><br><span class=\"line\">    test_loss, correct = 0, 0</span><br><span class=\"line\">    with torch.no_grad():</span><br><span class=\"line\">        for X, y in dataloader:</span><br><span class=\"line\">            X, y = X.to(device), y.to(device)</span><br><span class=\"line\">            pred = model(X)</span><br><span class=\"line\">            test_loss += loss_fn(pred, y).item() #比對64筆資料</span><br><span class=\"line\">            correct += (pred.argmax(1) == y).type(torch.float).sum().item()</span><br><span class=\"line\">    test_loss /= num_batches</span><br><span class=\"line\">    correct /= size</span><br><span class=\"line\">    print(f&quot;Test Error: \\n Accuracy: &#123;(100*correct):&gt;0.1f&#125;%, Avg loss: &#123;test_loss:&gt;8f&#125; \\n&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">def test(dataloader, model, loss_fn):</span><br><span class=\"line\">    size = len(dataloader.dataset)</span><br><span class=\"line\">    num_batches = len(dataloader)</span><br><span class=\"line\">    model.eval()</span><br><span class=\"line\">    test_loss, correct = 0, 0</span><br><span class=\"line\">    with torch.no_grad():</span><br><span class=\"line\">        for X, y in dataloader:</span><br><span class=\"line\">            X, y = X.to(device), y.to(device)</span><br><span class=\"line\">            pred = model(X)</span><br><span class=\"line\">            test_loss += loss_fn(pred, y).item() #比對64筆資料</span><br><span class=\"line\">            correct += (pred.argmax(1) == y).type(torch.float).sum().item()</span><br><span class=\"line\">    test_loss /= num_batches</span><br><span class=\"line\">    correct /= size</span><br><span class=\"line\">    print(f&quot;Test Error: \\n Accuracy: &#123;(100*correct):&gt;0.1f&#125;%, Avg loss: &#123;test_loss:&gt;8f&#125; \\n&quot;)</span><br></pre></td></tr></table></figure>\n\n<p><code>size</code>：測試資料總筆數（例如 10,000 張 FashionMNIST 圖）</p>\n<p><code>num_batches</code>：DataLoader 的批次數量（例如 10,000 ÷ 64 ≈ 157 批）</p>\n<p>model.eval() : 把模型切換為 evaluation mode (評估模式)。</p>\n<p>argmax(list) : 選出數字最大的，然後取出索引值。</p>\n<p>test_loss越小表示學習效果越好</p>\n<ul>\n<li><p><code>size</code>：整個測試資料集的樣本總數。</p>\n</li>\n<li><p><code>num_batches</code>：總共有幾個批次（batch）。</p>\n</li>\n<li><p><code>model.eval()</code>：切換成「<strong>評估模式</strong>」，停用訓練時的行為（例如 dropout、batchnorm 更新）。</p>\n</li>\n<li><p><code>test_loss</code>、<code>correct</code>：用來累積測試的結果。</p>\n</li>\n</ul>\n<h3 id=\"關閉梯度計算\"><a href=\"#關閉梯度計算\" class=\"headerlink\" title=\"關閉梯度計算\"></a>關閉梯度計算</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">with torch.no_grad():</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>測試階段不需要訓練，也不需要反向傳播梯度。</p>\n</li>\n<li><p><code>torch.no_grad()</code> 可以節省記憶體與加快運算速度。</p>\n</li>\n</ul>\n<h3 id=\"主要測試迴圈\"><a href=\"#主要測試迴圈\" class=\"headerlink\" title=\"主要測試迴圈\"></a>主要測試迴圈</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for X, y in dataloader:</span><br><span class=\"line\">    X, y = X.to(device), y.to(device)</span><br><span class=\"line\">    pred = model(X)</span><br><span class=\"line\">    test_loss += loss_fn(pred, y).item()  # 累積每個 batch 的 loss</span><br><span class=\"line\">    correct += (pred.argmax(1) == y).type(torch.float).sum().item()</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for X, y in dataloader:</span><br><span class=\"line\">    X, y = X.to(device), y.to(device)</span><br><span class=\"line\">    pred = model(X)</span><br><span class=\"line\">    test_loss += loss_fn(pred, y).item()  # 累積每個 batch 的 loss</span><br><span class=\"line\">    correct += (pred.argmax(1) == y).type(torch.float).sum().item()</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"詳細解釋：\"><a href=\"#詳細解釋：\" class=\"headerlink\" title=\"詳細解釋：\"></a>詳細解釋：</h3><table>\n<thead>\n<tr>\n<th>步驟</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>X, y = X.to(device), y.to(device)</code></td>\n<td>將資料移到 GPU &#x2F; CPU</td>\n</tr>\n<tr>\n<td><code>pred = model(X)</code></td>\n<td>對測試資料做預測</td>\n</tr>\n<tr>\n<td><code>loss_fn(pred, y)</code></td>\n<td>計算這一批資料的損失值</td>\n</tr>\n<tr>\n<td><code>.item()</code></td>\n<td>取出純數值（從 tensor 轉成 float）</td>\n</tr>\n<tr>\n<td><code>pred.argmax(1)</code></td>\n<td>取出每筆資料預測機率最高的類別</td>\n</tr>\n<tr>\n<td><code>(pred.argmax(1) == y)</code></td>\n<td>比對預測結果與真實標籤是否相同</td>\n</tr>\n<tr>\n<td><code>.type(torch.float).sum().item()</code></td>\n<td>計算這一批中預測正確的樣本數並加總</td>\n</tr>\n</tbody></table>\n<hr>\n<h3 id=\"平均化結果與輸出\"><a href=\"#平均化結果與輸出\" class=\"headerlink\" title=\"平均化結果與輸出\"></a>平均化結果與輸出</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test_loss /= num_batches</span><br><span class=\"line\">correct /= size</span><br><span class=\"line\">print(f&quot;Test Error: \\n Accuracy: &#123;(100*correct):&gt;0.1f&#125;%, Avg loss: &#123;test_loss:&gt;8f&#125; \\n&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test_loss /= num_batches</span><br><span class=\"line\">correct /= size</span><br><span class=\"line\">print(f&quot;Test Error: \\n Accuracy: &#123;(100*correct):&gt;0.1f&#125;%, Avg loss: &#123;test_loss:&gt;8f&#125; \\n&quot;)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><code>test_loss /= num_batches</code>：計算整體平均損失。</p>\n</li>\n<li><p><code>correct /= size</code>：計算整體準確率。</p>\n</li>\n<li><p><code>print()</code>：輸出測試結果。</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">epochs = 5</span><br><span class=\"line\">for t in range(epochs):</span><br><span class=\"line\">    print(f&quot;Epoch &#123;t+1&#125;\\n-------------------------------&quot;)</span><br><span class=\"line\">    train(train_dataloader, model, loss_fn, optimizer)</span><br><span class=\"line\">    test(test_dataloader, model, loss_fn)</span><br><span class=\"line\">print(&quot;Done!&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">epochs = 5</span><br><span class=\"line\">for t in range(epochs):</span><br><span class=\"line\">    print(f&quot;Epoch &#123;t+1&#125;\\n-------------------------------&quot;)</span><br><span class=\"line\">    train(train_dataloader, model, loss_fn, optimizer)</span><br><span class=\"line\">    test(test_dataloader, model, loss_fn)</span><br><span class=\"line\">print(&quot;Done!&quot;)</span><br></pre></td></tr></table></figure>\n\n<p>以這個程式碼來說epochs是5，也就是訓練5次的意思。</p>\n<h2 id=\"Saving-Models\"><a href=\"#Saving-Models\" class=\"headerlink\" title=\"Saving Models\"></a>Saving Models</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">torch.save(model.state_dict(), &quot;model.pth&quot;)</span><br><span class=\"line\">print(&quot;Saved PyTorch Model State to model.pth&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">torch.save(model.state_dict(), &quot;model.pth&quot;)</span><br><span class=\"line\">print(&quot;Saved PyTorch Model State to model.pth&quot;)</span><br></pre></td></tr></table></figure>\n\n<p>將模型的參數儲存到一個檔案 <code>&quot;model.pth&quot;</code> 中。</p>\n<p>之後可以再繼續訓練或是使用。</p>\n<h2 id=\"Loading-Models\"><a href=\"#Loading-Models\" class=\"headerlink\" title=\"Loading Models\"></a>Loading Models</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model = NeuralNetwork().to(device)</span><br><span class=\"line\">model.load_state_dict(torch.load(&quot;model.pth&quot;, weights_only=True))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">model = NeuralNetwork().to(device)</span><br><span class=\"line\">model.load_state_dict(torch.load(&quot;model.pth&quot;, weights_only=True))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">classes = [</span><br><span class=\"line\">    &quot;T-shirt/top&quot;,</span><br><span class=\"line\">    &quot;Trouser&quot;,</span><br><span class=\"line\">    &quot;Pullover&quot;,</span><br><span class=\"line\">    &quot;Dress&quot;,</span><br><span class=\"line\">    &quot;Coat&quot;,</span><br><span class=\"line\">    &quot;Sandal&quot;,</span><br><span class=\"line\">    &quot;Shirt&quot;,</span><br><span class=\"line\">    &quot;Sneaker&quot;,</span><br><span class=\"line\">    &quot;Bag&quot;,</span><br><span class=\"line\">    &quot;Ankle boot&quot;,</span><br><span class=\"line\">]</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">model.eval()</span><br><span class=\"line\">x, y = test_data[0][0], test_data[0][1]</span><br><span class=\"line\">with torch.no_grad():</span><br><span class=\"line\">    x = x.to(device)</span><br><span class=\"line\">    pred = model(x)</span><br><span class=\"line\">    predicted, actual = classes[pred[0].argmax(0)], classes[y]</span><br><span class=\"line\">    print(f&#x27;Predicted: &quot;&#123;predicted&#125;&quot;, Actual: &quot;&#123;actual&#125;&quot;&#x27;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">classes = [</span><br><span class=\"line\">    &quot;T-shirt/top&quot;,</span><br><span class=\"line\">    &quot;Trouser&quot;,</span><br><span class=\"line\">    &quot;Pullover&quot;,</span><br><span class=\"line\">    &quot;Dress&quot;,</span><br><span class=\"line\">    &quot;Coat&quot;,</span><br><span class=\"line\">    &quot;Sandal&quot;,</span><br><span class=\"line\">    &quot;Shirt&quot;,</span><br><span class=\"line\">    &quot;Sneaker&quot;,</span><br><span class=\"line\">    &quot;Bag&quot;,</span><br><span class=\"line\">    &quot;Ankle boot&quot;,</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">model.eval()</span><br><span class=\"line\">x, y = test_data[0][0], test_data[0][1]</span><br><span class=\"line\">with torch.no_grad():</span><br><span class=\"line\">    x = x.to(device)</span><br><span class=\"line\">    pred = model(x)</span><br><span class=\"line\">    predicted, actual = classes[pred[0].argmax(0)], classes[y]</span><br><span class=\"line\">    print(f&#x27;Predicted: &quot;&#123;predicted&#125;&quot;, Actual: &quot;&#123;actual&#125;&quot;&#x27;)</span><br></pre></td></tr></table></figure>\n\n<p>輸出結果 : Predicted: “Ankle boot”, Actual: “Ankle boot”</p>\n"},{"layout":"post","title":"Nginx + Certbot 為 WordPress 網站設定 HTTPS","date":"2025-03-29T16:00:00.000Z","top_img":"/images/09d01d97-6054-4172-930a-5cf01b8bf9a8.webp","cover":"/images/09d01d97-6054-4172-930a-5cf01b8bf9a8.webp","_content":"\n本教學將說明如何透過 Certbot 申請 Let's Encrypt 免費 SSL 憑證，並整合至 Nginx，成功為你的 WordPress 網站啟用 HTTPS。\n\n## 📌 前置準備\n\n1. 網站程式碼已部署於 `/var/www/你的網站資料夾`\n\n3. 網域名稱（例如 `yourdomain.com`）已正確指向你的伺服器 IP\n\n5. 已安裝 Nginx、PHP-FPM、Certbot\n\n* * *\n\n## 步驟一：建立 Nginx 設定檔\n\n使用 `nano` 編輯對應網域的 Nginx 設定檔：\n\n```\nsudo nano /etc/nginx/sites-available/yourdomain.com\n```\n\nBash\n\n設定內容範例如下（HTTPS 區塊會由 Certbot 自動補上）：\n\n```\nserver {\n    server_name yourdomain.com www.yourdomain.com;\n\n    root /var/www/你的網站資料夾;\n    index index.php index.html;\n\n    access_log /var/log/nginx/yourdomain.access.log;\n    error_log  /var/log/nginx/yourdomain.error.log;\n\n    location / {\n        try_files $uri $uri/ /index.php?$args;\n    }\n\n    location ~ \\.php$ {\n        include snippets/fastcgi-php.conf;\n        fastcgi_pass unix:/run/php/php8.3-fpm.sock;\n    }\n\n    location ~ /\\.ht {\n        deny all;\n    }\n\n    listen 443 ssl; # managed by Certbot\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n}\n\nserver {\n    if ($host = www.yourdomain.com) {\n        return 301 https://$host$request_uri;\n    } # managed by Certbot\n\n    if ($host = yourdomain.com) {\n        return 301 https://$host$request_uri;\n    } # managed by Certbot\n\n    listen 80;\n    server_name yourdomain.com www.yourdomain.com;\n    return 404; # managed by Certbot\n}\n```\n\nBash\n\n啟用站點：\n\n```\nsudo ln -s /etc/nginx/sites-available/yourdomain.com /etc/nginx/sites-enabled/\n\nps: 注意你的fastcgi_pass php 版本要對應 例如我是php8.3-fpm.sock\n```\n\n* * *\n\n## 步驟二：使用 Certbot 啟用 HTTPS\n\n使用以下指令安裝 SSL 憑證並自動設定 Nginx：\n\n```\nsudo certbot --nginx -d yourdomain.com -d www.yourdomain.com\n```\n\n```\nsudo certbot --nginx -d yourdomain.com -d www.yourdomain.com\n```\n\nBash\n\n若成功，會出現類似以下訊息：\n\n```\nSuccessfully deployed certificate for yourdomain.com to /etc/nginx/sites-enabled/yourdomain.com\n...\nCongratulations! You have successfully enabled HTTPS on https://yourdomain.com\n```\n\n```\nSuccessfully deployed certificate for yourdomain.com to /etc/nginx/sites-enabled/yourdomain.com\n...\nCongratulations! You have successfully enabled HTTPS on https://yourdomain.com\n```\n\nBash\n\n* * *\n\n## 步驟三：檢查 Nginx 設定\n\n確認設定檔是否正確：\n\n```\nsudo nginx -t\n```\n\n```\nsudo nginx -t\n```\n\nBash\n\n重新載入 Nginx：\n\n```\nsudo systemctl reload nginx\n```\n\n```\nsudo systemctl reload nginx\n```\n\nBash\n\n* * *\n\n## 步驟四：確認 HTTPS 連接埠（443）已開啟\n\n檢查 443 port 是否啟用中：\n\n```\nsudo ss -tulpn | grep ':443'\n```\n\n```\nsudo ss -tulpn | grep ':443'\n```\n\nBash\n\n若防火牆未開啟 443，請加入防火牆規則：\n\n```\nsudo ufw allow 443\nsudo ufw reload\n```\n\n```\nsudo ufw allow 443\nsudo ufw reload\n```\n\nBash\n\n可再次確認 UFW 狀態：\n\n```\nsudo ufw status\n```\n\n```\nsudo ufw status\n```\n\nBash\n\n* * *\n\n## 步驟五：確認網站正常運作\n\n瀏覽器開啟：\n\n1. [**https://yourdomain.com**](https://yourdomain.com/)\n\n3. [https://www.yourdomain.com](https://www.yourdomain.com/)\n\n應顯示 WordPress 首頁，且網址列應顯示鎖頭圖示（HTTPS 已啟用）。\n\n* * *\n\n## ✅ 補充資訊\n\n- Certbot 預設會自動排程憑證續期，無需手動干預\n\n- 憑證有效期限為 90 天，自動續期機制會確保不中斷\n\n- 可手動測試續期機制： `sudo certbot renew --dry-run`\n","source":"_posts/nginx-cerbot.md","raw":"---\nlayout: post\ntitle: Nginx + Certbot 為 WordPress 網站設定 HTTPS\ndate: 2025-03-30\ntags:\ncategories:\n  - \"vm-setting\"\ntop_img: /images/09d01d97-6054-4172-930a-5cf01b8bf9a8.webp\ncover: /images/09d01d97-6054-4172-930a-5cf01b8bf9a8.webp\n---\n\n本教學將說明如何透過 Certbot 申請 Let's Encrypt 免費 SSL 憑證，並整合至 Nginx，成功為你的 WordPress 網站啟用 HTTPS。\n\n## 📌 前置準備\n\n1. 網站程式碼已部署於 `/var/www/你的網站資料夾`\n\n3. 網域名稱（例如 `yourdomain.com`）已正確指向你的伺服器 IP\n\n5. 已安裝 Nginx、PHP-FPM、Certbot\n\n* * *\n\n## 步驟一：建立 Nginx 設定檔\n\n使用 `nano` 編輯對應網域的 Nginx 設定檔：\n\n```\nsudo nano /etc/nginx/sites-available/yourdomain.com\n```\n\nBash\n\n設定內容範例如下（HTTPS 區塊會由 Certbot 自動補上）：\n\n```\nserver {\n    server_name yourdomain.com www.yourdomain.com;\n\n    root /var/www/你的網站資料夾;\n    index index.php index.html;\n\n    access_log /var/log/nginx/yourdomain.access.log;\n    error_log  /var/log/nginx/yourdomain.error.log;\n\n    location / {\n        try_files $uri $uri/ /index.php?$args;\n    }\n\n    location ~ \\.php$ {\n        include snippets/fastcgi-php.conf;\n        fastcgi_pass unix:/run/php/php8.3-fpm.sock;\n    }\n\n    location ~ /\\.ht {\n        deny all;\n    }\n\n    listen 443 ssl; # managed by Certbot\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n}\n\nserver {\n    if ($host = www.yourdomain.com) {\n        return 301 https://$host$request_uri;\n    } # managed by Certbot\n\n    if ($host = yourdomain.com) {\n        return 301 https://$host$request_uri;\n    } # managed by Certbot\n\n    listen 80;\n    server_name yourdomain.com www.yourdomain.com;\n    return 404; # managed by Certbot\n}\n```\n\nBash\n\n啟用站點：\n\n```\nsudo ln -s /etc/nginx/sites-available/yourdomain.com /etc/nginx/sites-enabled/\n\nps: 注意你的fastcgi_pass php 版本要對應 例如我是php8.3-fpm.sock\n```\n\n* * *\n\n## 步驟二：使用 Certbot 啟用 HTTPS\n\n使用以下指令安裝 SSL 憑證並自動設定 Nginx：\n\n```\nsudo certbot --nginx -d yourdomain.com -d www.yourdomain.com\n```\n\n```\nsudo certbot --nginx -d yourdomain.com -d www.yourdomain.com\n```\n\nBash\n\n若成功，會出現類似以下訊息：\n\n```\nSuccessfully deployed certificate for yourdomain.com to /etc/nginx/sites-enabled/yourdomain.com\n...\nCongratulations! You have successfully enabled HTTPS on https://yourdomain.com\n```\n\n```\nSuccessfully deployed certificate for yourdomain.com to /etc/nginx/sites-enabled/yourdomain.com\n...\nCongratulations! You have successfully enabled HTTPS on https://yourdomain.com\n```\n\nBash\n\n* * *\n\n## 步驟三：檢查 Nginx 設定\n\n確認設定檔是否正確：\n\n```\nsudo nginx -t\n```\n\n```\nsudo nginx -t\n```\n\nBash\n\n重新載入 Nginx：\n\n```\nsudo systemctl reload nginx\n```\n\n```\nsudo systemctl reload nginx\n```\n\nBash\n\n* * *\n\n## 步驟四：確認 HTTPS 連接埠（443）已開啟\n\n檢查 443 port 是否啟用中：\n\n```\nsudo ss -tulpn | grep ':443'\n```\n\n```\nsudo ss -tulpn | grep ':443'\n```\n\nBash\n\n若防火牆未開啟 443，請加入防火牆規則：\n\n```\nsudo ufw allow 443\nsudo ufw reload\n```\n\n```\nsudo ufw allow 443\nsudo ufw reload\n```\n\nBash\n\n可再次確認 UFW 狀態：\n\n```\nsudo ufw status\n```\n\n```\nsudo ufw status\n```\n\nBash\n\n* * *\n\n## 步驟五：確認網站正常運作\n\n瀏覽器開啟：\n\n1. [**https://yourdomain.com**](https://yourdomain.com/)\n\n3. [https://www.yourdomain.com](https://www.yourdomain.com/)\n\n應顯示 WordPress 首頁，且網址列應顯示鎖頭圖示（HTTPS 已啟用）。\n\n* * *\n\n## ✅ 補充資訊\n\n- Certbot 預設會自動排程憑證續期，無需手動干預\n\n- 憑證有效期限為 90 天，自動續期機制會確保不中斷\n\n- 可手動測試續期機制： `sudo certbot renew --dry-run`\n","slug":"nginx-cerbot","published":1,"updated":"2026-01-28T14:17:25.065Z","_id":"cmkxg0krr0001rb8z57h7cz7o","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>本教學將說明如何透過 Certbot 申請 Let’s Encrypt 免費 SSL 憑證，並整合至 Nginx，成功為你的 WordPress 網站啟用 HTTPS。</p>\n<h2 id=\"📌-前置準備\"><a href=\"#📌-前置準備\" class=\"headerlink\" title=\"📌 前置準備\"></a>📌 前置準備</h2><ol>\n<li><p>網站程式碼已部署於 <code>/var/www/你的網站資料夾</code></p>\n</li>\n<li><p>網域名稱（例如 <code>yourdomain.com</code>）已正確指向你的伺服器 IP</p>\n</li>\n<li><p>已安裝 Nginx、PHP-FPM、Certbot</p>\n</li>\n</ol>\n<hr>\n<h2 id=\"步驟一：建立-Nginx-設定檔\"><a href=\"#步驟一：建立-Nginx-設定檔\" class=\"headerlink\" title=\"步驟一：建立 Nginx 設定檔\"></a>步驟一：建立 Nginx 設定檔</h2><p>使用 <code>nano</code> 編輯對應網域的 Nginx 設定檔：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nano /etc/nginx/sites-available/yourdomain.com</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>設定內容範例如下（HTTPS 區塊會由 Certbot 自動補上）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    server_name yourdomain.com www.yourdomain.com;</span><br><span class=\"line\"></span><br><span class=\"line\">    root /var/www/你的網站資料夾;</span><br><span class=\"line\">    index index.php index.html;</span><br><span class=\"line\"></span><br><span class=\"line\">    access_log /var/log/nginx/yourdomain.access.log;</span><br><span class=\"line\">    error_log  /var/log/nginx/yourdomain.error.log;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        try_files $uri $uri/ /index.php?$args;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location ~ \\.php$ &#123;</span><br><span class=\"line\">        include snippets/fastcgi-php.conf;</span><br><span class=\"line\">        fastcgi_pass unix:/run/php/php8.3-fpm.sock;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location ~ /\\.ht &#123;</span><br><span class=\"line\">        deny all;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    listen 443 ssl; # managed by Certbot</span><br><span class=\"line\">    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem; # managed by Certbot</span><br><span class=\"line\">    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem; # managed by Certbot</span><br><span class=\"line\">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class=\"line\">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    if ($host = www.yourdomain.com) &#123;</span><br><span class=\"line\">        return 301 https://$host$request_uri;</span><br><span class=\"line\">    &#125; # managed by Certbot</span><br><span class=\"line\"></span><br><span class=\"line\">    if ($host = yourdomain.com) &#123;</span><br><span class=\"line\">        return 301 https://$host$request_uri;</span><br><span class=\"line\">    &#125; # managed by Certbot</span><br><span class=\"line\"></span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name yourdomain.com www.yourdomain.com;</span><br><span class=\"line\">    return 404; # managed by Certbot</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>啟用站點：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ln -s /etc/nginx/sites-available/yourdomain.com /etc/nginx/sites-enabled/</span><br><span class=\"line\"></span><br><span class=\"line\">ps: 注意你的fastcgi_pass php 版本要對應 例如我是php8.3-fpm.sock</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"步驟二：使用-Certbot-啟用-HTTPS\"><a href=\"#步驟二：使用-Certbot-啟用-HTTPS\" class=\"headerlink\" title=\"步驟二：使用 Certbot 啟用 HTTPS\"></a>步驟二：使用 Certbot 啟用 HTTPS</h2><p>使用以下指令安裝 SSL 憑證並自動設定 Nginx：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>若成功，會出現類似以下訊息：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Successfully deployed certificate for yourdomain.com to /etc/nginx/sites-enabled/yourdomain.com</span><br><span class=\"line\">...</span><br><span class=\"line\">Congratulations! You have successfully enabled HTTPS on https://yourdomain.com</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Successfully deployed certificate for yourdomain.com to /etc/nginx/sites-enabled/yourdomain.com</span><br><span class=\"line\">...</span><br><span class=\"line\">Congratulations! You have successfully enabled HTTPS on https://yourdomain.com</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<hr>\n<h2 id=\"步驟三：檢查-Nginx-設定\"><a href=\"#步驟三：檢查-Nginx-設定\" class=\"headerlink\" title=\"步驟三：檢查 Nginx 設定\"></a>步驟三：檢查 Nginx 設定</h2><p>確認設定檔是否正確：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nginx -t</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nginx -t</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>重新載入 Nginx：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<hr>\n<h2 id=\"步驟四：確認-HTTPS-連接埠（443）已開啟\"><a href=\"#步驟四：確認-HTTPS-連接埠（443）已開啟\" class=\"headerlink\" title=\"步驟四：確認 HTTPS 連接埠（443）已開啟\"></a>步驟四：確認 HTTPS 連接埠（443）已開啟</h2><p>檢查 443 port 是否啟用中：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ss -tulpn | grep &#x27;:443&#x27;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ss -tulpn | grep &#x27;:443&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>若防火牆未開啟 443，請加入防火牆規則：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ufw allow 443</span><br><span class=\"line\">sudo ufw reload</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ufw allow 443</span><br><span class=\"line\">sudo ufw reload</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>可再次確認 UFW 狀態：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ufw status</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ufw status</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<hr>\n<h2 id=\"步驟五：確認網站正常運作\"><a href=\"#步驟五：確認網站正常運作\" class=\"headerlink\" title=\"步驟五：確認網站正常運作\"></a>步驟五：確認網站正常運作</h2><p>瀏覽器開啟：</p>\n<ol>\n<li><p><a href=\"https://yourdomain.com/\"><strong>https://yourdomain.com</strong></a></p>\n</li>\n<li><p><a href=\"https://www.yourdomain.com/\">https://www.yourdomain.com</a></p>\n</li>\n</ol>\n<p>應顯示 WordPress 首頁，且網址列應顯示鎖頭圖示（HTTPS 已啟用）。</p>\n<hr>\n<h2 id=\"✅-補充資訊\"><a href=\"#✅-補充資訊\" class=\"headerlink\" title=\"✅ 補充資訊\"></a>✅ 補充資訊</h2><ul>\n<li><p>Certbot 預設會自動排程憑證續期，無需手動干預</p>\n</li>\n<li><p>憑證有效期限為 90 天，自動續期機制會確保不中斷</p>\n</li>\n<li><p>可手動測試續期機制： <code>sudo certbot renew --dry-run</code></p>\n</li>\n</ul>\n","excerpt":"","more":"<p>本教學將說明如何透過 Certbot 申請 Let’s Encrypt 免費 SSL 憑證，並整合至 Nginx，成功為你的 WordPress 網站啟用 HTTPS。</p>\n<h2 id=\"📌-前置準備\"><a href=\"#📌-前置準備\" class=\"headerlink\" title=\"📌 前置準備\"></a>📌 前置準備</h2><ol>\n<li><p>網站程式碼已部署於 <code>/var/www/你的網站資料夾</code></p>\n</li>\n<li><p>網域名稱（例如 <code>yourdomain.com</code>）已正確指向你的伺服器 IP</p>\n</li>\n<li><p>已安裝 Nginx、PHP-FPM、Certbot</p>\n</li>\n</ol>\n<hr>\n<h2 id=\"步驟一：建立-Nginx-設定檔\"><a href=\"#步驟一：建立-Nginx-設定檔\" class=\"headerlink\" title=\"步驟一：建立 Nginx 設定檔\"></a>步驟一：建立 Nginx 設定檔</h2><p>使用 <code>nano</code> 編輯對應網域的 Nginx 設定檔：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nano /etc/nginx/sites-available/yourdomain.com</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>設定內容範例如下（HTTPS 區塊會由 Certbot 自動補上）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    server_name yourdomain.com www.yourdomain.com;</span><br><span class=\"line\"></span><br><span class=\"line\">    root /var/www/你的網站資料夾;</span><br><span class=\"line\">    index index.php index.html;</span><br><span class=\"line\"></span><br><span class=\"line\">    access_log /var/log/nginx/yourdomain.access.log;</span><br><span class=\"line\">    error_log  /var/log/nginx/yourdomain.error.log;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        try_files $uri $uri/ /index.php?$args;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location ~ \\.php$ &#123;</span><br><span class=\"line\">        include snippets/fastcgi-php.conf;</span><br><span class=\"line\">        fastcgi_pass unix:/run/php/php8.3-fpm.sock;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location ~ /\\.ht &#123;</span><br><span class=\"line\">        deny all;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    listen 443 ssl; # managed by Certbot</span><br><span class=\"line\">    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem; # managed by Certbot</span><br><span class=\"line\">    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem; # managed by Certbot</span><br><span class=\"line\">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class=\"line\">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    if ($host = www.yourdomain.com) &#123;</span><br><span class=\"line\">        return 301 https://$host$request_uri;</span><br><span class=\"line\">    &#125; # managed by Certbot</span><br><span class=\"line\"></span><br><span class=\"line\">    if ($host = yourdomain.com) &#123;</span><br><span class=\"line\">        return 301 https://$host$request_uri;</span><br><span class=\"line\">    &#125; # managed by Certbot</span><br><span class=\"line\"></span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name yourdomain.com www.yourdomain.com;</span><br><span class=\"line\">    return 404; # managed by Certbot</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>啟用站點：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ln -s /etc/nginx/sites-available/yourdomain.com /etc/nginx/sites-enabled/</span><br><span class=\"line\"></span><br><span class=\"line\">ps: 注意你的fastcgi_pass php 版本要對應 例如我是php8.3-fpm.sock</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"步驟二：使用-Certbot-啟用-HTTPS\"><a href=\"#步驟二：使用-Certbot-啟用-HTTPS\" class=\"headerlink\" title=\"步驟二：使用 Certbot 啟用 HTTPS\"></a>步驟二：使用 Certbot 啟用 HTTPS</h2><p>使用以下指令安裝 SSL 憑證並自動設定 Nginx：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>若成功，會出現類似以下訊息：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Successfully deployed certificate for yourdomain.com to /etc/nginx/sites-enabled/yourdomain.com</span><br><span class=\"line\">...</span><br><span class=\"line\">Congratulations! You have successfully enabled HTTPS on https://yourdomain.com</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Successfully deployed certificate for yourdomain.com to /etc/nginx/sites-enabled/yourdomain.com</span><br><span class=\"line\">...</span><br><span class=\"line\">Congratulations! You have successfully enabled HTTPS on https://yourdomain.com</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<hr>\n<h2 id=\"步驟三：檢查-Nginx-設定\"><a href=\"#步驟三：檢查-Nginx-設定\" class=\"headerlink\" title=\"步驟三：檢查 Nginx 設定\"></a>步驟三：檢查 Nginx 設定</h2><p>確認設定檔是否正確：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nginx -t</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nginx -t</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>重新載入 Nginx：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<hr>\n<h2 id=\"步驟四：確認-HTTPS-連接埠（443）已開啟\"><a href=\"#步驟四：確認-HTTPS-連接埠（443）已開啟\" class=\"headerlink\" title=\"步驟四：確認 HTTPS 連接埠（443）已開啟\"></a>步驟四：確認 HTTPS 連接埠（443）已開啟</h2><p>檢查 443 port 是否啟用中：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ss -tulpn | grep &#x27;:443&#x27;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ss -tulpn | grep &#x27;:443&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>若防火牆未開啟 443，請加入防火牆規則：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ufw allow 443</span><br><span class=\"line\">sudo ufw reload</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ufw allow 443</span><br><span class=\"line\">sudo ufw reload</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>可再次確認 UFW 狀態：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ufw status</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ufw status</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<hr>\n<h2 id=\"步驟五：確認網站正常運作\"><a href=\"#步驟五：確認網站正常運作\" class=\"headerlink\" title=\"步驟五：確認網站正常運作\"></a>步驟五：確認網站正常運作</h2><p>瀏覽器開啟：</p>\n<ol>\n<li><p><a href=\"https://yourdomain.com/\"><strong>https://yourdomain.com</strong></a></p>\n</li>\n<li><p><a href=\"https://www.yourdomain.com/\">https://www.yourdomain.com</a></p>\n</li>\n</ol>\n<p>應顯示 WordPress 首頁，且網址列應顯示鎖頭圖示（HTTPS 已啟用）。</p>\n<hr>\n<h2 id=\"✅-補充資訊\"><a href=\"#✅-補充資訊\" class=\"headerlink\" title=\"✅ 補充資訊\"></a>✅ 補充資訊</h2><ul>\n<li><p>Certbot 預設會自動排程憑證續期，無需手動干預</p>\n</li>\n<li><p>憑證有效期限為 90 天，自動續期機制會確保不中斷</p>\n</li>\n<li><p>可手動測試續期機制： <code>sudo certbot renew --dry-run</code></p>\n</li>\n</ul>\n"},{"layout":"post","title":"Next.js v16 基本常識","date":"2025-11-25T16:00:00.000Z","top_img":"/images/Gemini_Generated_Image_8zuhop8zuhop8zuh-1.png","cover":"/images/Gemini_Generated_Image_8zuhop8zuhop8zuh-1.png","_content":"\n## Console.log 的使用方式\n\n在Next.js 16版，有一個新的開發技巧。\n\n我們在Home裡面加上一個console.log，以往的經驗來說這是一個伺服器端的事件，所以在瀏覽器的Console中並不會出現這段輸出內容。\n\n```\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <div className=\"text-5xl\">Welcome to Next.js!</div>\n    )\n}\n<div></div>\nexport default Home\n```\n\n```\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <div className=\"text-5xl\">Welcome to Next.js!</div>\n    )\n}\n\nexport default Home\n```\n\n正常來說只會在伺服器端看到。\n\n![](/images/CleanShot-2025-11-26-at-21.17.46-1024x664.png)\n\n可以看到在瀏覽器一樣出現了標示Server的Console內容。\n\n不過不用擔心，這只是在開發的時候方便觀察而已。\n\n![](/images/CleanShot-2025-11-26-at-21.16.14-1024x662.png)\n\n這個時候有趣的來了，我要來測試在Client端寫console.log會發生什麼事情，我在app底下建立components資料夾並建立一個hello.tsx檔案。\n\n```\n// components/hello.tsx\n\"use client\"\n<div></div>\nconst Hello = () => {\n    console.log(\"Hello 組件在客戶端執行\");\n    return (\n        <div>Hello</div>\n    )\n}\n<div></div>\nexport default Hello\n```\n\n```\n// components/hello.tsx\n\"use client\"\n\nconst Hello = () => {\n    console.log(\"Hello 組件在客戶端執行\");\n    return (\n        <div>Hello</div>\n    )\n}\n\nexport default Hello\n```\n\n將hello的components引入到app/page.tsx。\n\n```\n// app/page.tsx\nimport Hello from \"@/components/hello\"\n<div></div>\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <main>\n            <div className=\"text-5xl\">Welcome to Next.js!</div>\n            <Hello />\n        </main>\n    )\n}\n<div></div>\nexport default Home\n```\n\n```\n// app/page.tsx\nimport Hello from \"@/components/hello\"\n\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <main>\n            <div className=\"text-5xl\">Welcome to Next.js!</div>\n            <Hello />\n        </main>\n    )\n}\n\nexport default Home\n```\n\n這時候到瀏覽器觀察。會發現有兩個一樣的log。\n\n![](/images/CleanShot-2025-11-26-at-21.35.15-1024x667.png)\n\n你可能會問為什麼？我用一張圖給你看看。\n\n在Server端會先建立好static shell，之後在Client端渲染。\n\n![](/images/image-13.png)\n\nReact\n\n```\nnpm install babel-plugin-react-compiler@latest\n```\n\n```\nnpm install babel-plugin-react-compiler@latest\n```\n\n在next.config.ts加上reactCompiler: true,\n\n```\nimport type { NextConfig } from \"next\";\n<div></div>\nconst nextConfig: NextConfig = {\n  reactCompiler: true,\n  experimental: {\n      turbopackFileSystemCacheForDev: true\n  }\n<div></div>\n};\n<div></div>\nexport default nextConfig;\n```\n\n```\nimport type { NextConfig } from \"next\";\n\nconst nextConfig: NextConfig = {\n  reactCompiler: true,\n  experimental: {\n      turbopackFileSystemCacheForDev: true\n  }\n\n};\n\nexport default nextConfig;\n```\n\n因為我對React沒有很熟悉，所以我問了一下ChatGpt。\n\nbabel-plugin-react-compiler 能做的事\n\n1. 自動最佳化 React 重新渲染\n\n3. 自動 memo 化 computation\n\n5. 減少 performance bug\n\n7. 用更少的 hooks 寫法就能達到最佳性能\n\n9. 讓 React 程式碼更簡潔、效果更穩定\n\n11. 未來會成為 React 的標準性能工具（官方推薦）\n\n## Router\n\n![](/images/image-10.png)\n\n你會看到一個layout.tsk，可以想成是一個網站的佈局，像是header跟footer可以先放好位置，這樣每一個頁面就不必再重複渲染，然後{children}是每一個頁面的進入點，這邊舉個例子像這樣：\n\n![](/images/未命名-2-1021x1024.png)\n\nPage是你的網站首頁的內容，一進去會先吃到app/page.tsx然後傳到layout.tsx裡面的{children}這裡。\n\n以剛剛的例子：\n\n```\n// app/page.tsx\nimport Hello from \"@/components/hello\"\n<div></div>\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <main>\n            <div className=\"text-5xl\">Welcome to Next.js!</div>\n            <Hello />\n        </main>\n    )\n}\n<div></div>\nexport default Home\n```\n\n```\n// app/page.tsx\nimport Hello from \"@/components/hello\"\n\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <main>\n            <div className=\"text-5xl\">Welcome to Next.js!</div>\n            <Hello />\n        </main>\n    )\n}\n\nexport default Home\n```\n\n觀察一下瀏覽器的 Elements，已經把app/page.tsx的內容傳到{children}並顯示。\n\n![](/images/CleanShot-2025-11-26-at-22.18.53-1024x667.png)\n\n> 補充：Components不能放在app/資料夾內，app是放Page的地方。\n\n### 新增一個 Route\n\n直接在app/建立一個資料夾，這邊建立一個about資料夾，跟一個page.tsx。\n\n```\napp/about/page.tsx\nconst Page = () => {\n    return (\n        <div>Page</div>\n    )\n}\n<div></div>\nexport default Page\n```\n\n```\napp/about/page.tsx\nconst Page = () => {\n    return (\n        <div>Page</div>\n    )\n}\n\nexport default Page\n```\n\n只要在你的網頁打/about路由就會看到Page了。這個在Next.js叫做Filebased routing system。\n\n以下是官方文件的Route示意圖：\n\n![](/images/image-14-1024x336.png)\n\n### Nested Routes 巢狀路由\n\n我建立了一個dashboard，並在dashboard在建立兩個資料夾分別是analytics跟users。\n\n![](/images/image-15.png)\n\n```\n// analytics/page.tsx\nconst Analytics = () => {\n    return (\n        <div>Analytics</div>\n    )\n}\n<div></div>\nexport default Analytics\n```\n\n```\n// analytics/page.tsx\nconst Analytics = () => {\n    return (\n        <div>Analytics</div>\n    )\n}\n\nexport default Analytics\n```\n\n```\n// users/page.tsx\nconst Users = () => {\n    return (\n        <div>Users</div>\n    )\n}\n<div></div>\nexport default Users\n```\n\n```\n// users/page.tsx\nconst Users = () => {\n    return (\n        <div>Users</div>\n    )\n}\n\nexport default Users\n```\n\n進到 http://localhost:3000/dashboard/analytics 就可以看到 Analytics\n\n![](/images/CleanShot-2025-11-27-at-10.34.45-1024x657.png)\n\n進到 http://localhost:3000/dashboard/users 就可以看到 Users\n\n![](/images/CleanShot-2025-11-27-at-10.33.25-1024x657.png)\n\n那我們可能會有很多User，每個User都要有自己的Dashboard介面。\n\n因此先在users底下建立一個\\[id\\]資料夾，他可以根據你傳進來的params，對應到不同Users的頁面資料。\n\n![](/images/image-17.png)\n\n將每個User外面包一個Link，對應到不同的使用者。將參數傳送到users/\\[id\\]。\n\n```\n// users/page.tsx\nimport Link from \"next/link\"\n<div></div>\nconst Users = () => {\n    return (\n        <div>\n            <h1>Dashboard Users</h1>\n<div></div>\n            <ul className=\"mt-10\">\n                <li><Link href=\"/dashboard/users/1\">User 1</Link></li>\n                <li><Link href=\"/dashboard/users/2\">User 2</Link></li>\n                <li><Link href=\"/dashboard/users/3\">User 3</Link></li>\n                <li><Link href=\"/dashboard/users/4\">User 4</Link></li>\n            </ul>\n        </div>\n    )\n}\n<div></div>\nexport default Users\n```\n\n```\n// users/page.tsx\nimport Link from \"next/link\"\n\nconst Users = () => {\n    return (\n        <div>\n            <h1>Dashboard Users</h1>\n\n            <ul className=\"mt-10\">\n                <li><Link href=\"/dashboard/users/1\">User 1</Link></li>\n                <li><Link href=\"/dashboard/users/2\">User 2</Link></li>\n                <li><Link href=\"/dashboard/users/3\">User 3</Link></li>\n                <li><Link href=\"/dashboard/users/4\">User 4</Link></li>\n            </ul>\n        </div>\n    )\n}\n\nexport default Users\n```\n\n收到了點擊Link之後傳過來的參數，並顯示使用者id。\n\n```\n// users/[id]/page.tsx\nconst UserDetails = async ({ params } : { params: Promise<{ id: string }> }) => {\n    const { id } = await params;\n    return (\n        <div>\n            <h1>User Details for User {id}</h1>\n        </div>\n    )\n}\n<div></div>\nexport default UserDetails\n```\n\n```\n// users/[id]/page.tsx\nconst UserDetails = async ({ params } : { params: Promise<{ id: string }> }) => {\n    const { id } = await params;\n    return (\n        <div>\n            <h1>User Details for User {id}</h1>\n        </div>\n    )\n}\n\nexport default UserDetails\n```\n\n這邊我在學的時候第一次看到{params}這種語法，其實是簡化了以下的程式碼：\n\n```\nconst UserDetails = async (props) => {\n    const params = props.params;\n}\n```\n\n```\nconst UserDetails = async (props) => {\n    const params = props.params;\n}\n```\n\n> 補充：在 JavaScript 中，所有非同步行為（例如 fetch、資料庫、計時器）最後得到的都是 Promise 才會使用到async、await。這裡的 id其實還不需要用到 await 因為傳來的資料是同步的如下：\n\n```\n{ id: \"1\" }\nor\n{ id: \"2\" }\nor\n{ id: \"3\" }\nor\n{ id: \"4\" }\n```\n\n```\n{ id: \"1\" }\nor\n{ id: \"2\" }\nor\n{ id: \"3\" }\nor\n{ id: \"4\" }\n```\n\n![](/images/CleanShot-2025-11-27-at-12.47.38-1024x664.png)\n\n## Layout 版面設定\n\n> 請注意！必須使用 layout.tsx 這個檔案名稱，否則 next.js會認不出來。\n\n我在app/dashboard底下新增layout.tsx\n\n```\nconst Layout = ({ children } : { children: React.ReactNode}) => {\n    return (\n        <div>\n            <div>Dashboard Navbar</div>\n            {children}\n        </div>\n    )\n}\n<div></div>\nexport default Layout;\n```\n\n```\nconst Layout = ({ children } : { children: React.ReactNode}) => {\n    return (\n        <div>\n            <div>Dashboard Navbar</div>\n            {children}\n        </div>\n    )\n}\n\nexport default Layout;\n```\n\n{ children } : { children: React.ReactNode} 的意思是：\n\n這個 component 的 props 有一個 children，而它的型別是 React.ReactNode\n\nReact.ReactNode = 可以被 React 放在畫面上的東西\n\n完整的說就是從 props 拿出 children，並且保證它是 React 可渲染的內容。\n\n## Route Groups\n\nRoute Groups 讓你能夠建立資料夾而且不會影響到 URL。\n\n如果你想要建立一個Layout.tsx，但是不想要當成一個路由，可以使用(admin)，這種括號的方式包起來。\n\n![An example folder structure using route groups](/images/image)\n\n以我的資料夾來看：\n\n首頁 http://localhost:3000 會吃到 (root) 底下的page.tsx。\n\nabout的話也是會忽略(root)資料夾，指向 http://localhost:3000/about\n\ndashboard也是相同的道理，外層(dashboard)不會吃，會吃內層的dashboard資料夾。\n\n![](/images/CleanShot-2025-11-27-at-22.47.08-1024x588.png)\n\n我們可以分別在(dashboard)跟(root)設定不同的layout。並且把最外部原來的page.tsx移動到(root)。\n\n但是要注意，使用括號()的資料夾底下，只能在其中一個保留page.tsx，否則會出現以下錯誤。\n\n![](/images/CleanShot-2025-11-27-at-22.43.19-1024x670.png)\n\n## Error Handling 錯誤處理\n\n當 Server Component 或 route segment 渲染失敗時，Next.js 會顯示你寫在 error.tsx 的 UI。\n\n而不是預設簡陋的錯誤頁。像是我在about的page寫一個Error，並在about底下建立一個error.tsx。\n\n並進入到about頁面觀察。\n\n```\n// about/error.tsx\n'use client' // Error boundaries must be Client Components\n \nimport { useEffect } from 'react'\n \nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error & { digest?: string }\n  reset: () => void\n}) {\n  useEffect(() => {\n    // Log the error to an error reporting service\n    console.error(error)\n  }, [error])\n \n  return (\n    <div>\n      <h2>Something went wrong!</h2>\n      <button\n        onClick={\n          // Attempt to recover by trying to re-render the segment\n          () => reset()\n        }\n      >\n        Try again\n      </button>\n    </div>\n  )\n}\n```\n\n```\n// about/error.tsx\n'use client' // Error boundaries must be Client Components\n \nimport { useEffect } from 'react'\n \nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error & { digest?: string }\n  reset: () => void\n}) {\n  useEffect(() => {\n    // Log the error to an error reporting service\n    console.error(error)\n  }, [error])\n \n  return (\n    <div>\n      <h2>Something went wrong!</h2>\n      <button\n        onClick={\n          // Attempt to recover by trying to re-render the segment\n          () => reset()\n        }\n      >\n        Try again\n      </button>\n    </div>\n  )\n}\n```\n\n![](/images/CleanShot-2025-11-28-at-10.25.54-1024x578.png)\n\n可以看到在畫面有顯示文字，同時也可以在console中看到錯誤。\n\n> Console只在「開發模式（npm run dev）」才會出現\n> \n> 所以return的部分顯示在前端，useEffect的部分是顯示在後端。\n\n![](/images/CleanShot-2025-11-28-at-10.28.43-1024x670.png)\n\n預設的狀態只能看到簡陋的一些文字，無法讓使用者了解目前的狀態。\n\n有了error.tsx，可以呈現一些相關的錯誤訊息給使用者，讓使用者知道目前網站的狀態。\n\n不用擔心重要的資訊外露，因為在client端不會顯示重要訊息，我是把它想成美化error頁面。\n\n![](/images/CleanShot-2025-11-28-at-10.33.17-1024x670.png)\n\n## Loading UI 載入畫面\n\n在Next.js改如何使用Loading的效果呢？\n\n以下是一個抓取api等待時間的loading效果展示。\n\n```\nconst Page = async () => {\n    const res = await fetch(\"https://jsonplaceholder.typicode.com/users/1\");\n    const user = await res.json();\n    return (\n        <div>        \n             <div>{user.name}</div>;\n        </div>\n    )\n}\n<div></div>\nexport default Page\n```\n\n```\nconst Page = async () => {\n    const res = await fetch(\"https://jsonplaceholder.typicode.com/users/1\");\n    const user = await res.json();\n    return (\n        <div>        \n             <div>{user.name}</div>;\n        </div>\n    )\n}\n\nexport default Page\n```\n\n![](/images/CleanShot-2025-11-28-at-12.17.25.gif)\n\n只要在app/底下建立一個loading.tsx，就會有Loading的效果，它的作用範圍是**全站**（global loading UI）。\n\n> 只要任何 page.tsx 或 layout.tsx 在 await 資料，  \n> Next.js 就會顯示 /app/loading.tsx 作為「Loading 過渡畫面」。  \n> 子路由可以用自己的 loading.tsx 覆蓋上層的。\n\n## Data Fetching 資料截取\n\n第一種方式是透過前端渲染畫面。\n\n但是不推薦，會有延遲，而且原始碼很空SEO效果不好。\n\n```\n\"use client\";\n<div></div>\nimport { useState,useEffect } from 'react';\n<div></div>\nfunction album1() {\n    const [albums, setAlbums] = useState([]);\n<div></div>\n    useEffect(() => {\n        const fetchAlbums = async () => {\n            try {\n                const response = await fetch(\"https://jsonplaceholder.typicode.com/albums\")\n                const data = await response.json();\n                setAlbums(data);\n            } catch (error) {\n                console.error(\"Error fetching albums:\", error);\n            }\n        };\n        fetchAlbums();\n    }, []);\n<div></div>\n    return (\n        <div className=''>\n            {albums.map((album: {id: number; title: string}) => (\n                <div key={album.id} className=''>\n                    <h3>{album.title}</h3>\n                    <p>Album ID: {album.id}</p>\n                </div>\n            ))}\n        </div>\n    )\n}\n<div></div>\nexport default album1;\n```\n\n```\n\"use client\";\n\nimport { useState,useEffect } from 'react';\n\nfunction album1() {\n    const [albums, setAlbums] = useState([]);\n\n    useEffect(() => {\n        const fetchAlbums = async () => {\n            try {\n                const response = await fetch(\"https://jsonplaceholder.typicode.com/albums\")\n                const data = await response.json();\n                setAlbums(data);\n            } catch (error) {\n                console.error(\"Error fetching albums:\", error);\n            }\n        };\n        fetchAlbums();\n    }, []);\n\n    return (\n        <div className=''>\n            {albums.map((album: {id: number; title: string}) => (\n                <div key={album.id} className=''>\n                    <h3>{album.title}</h3>\n                    <p>Album ID: {album.id}</p>\n                </div>\n            ))}\n        </div>\n    )\n}\n\nexport default album1;\n```\n\n另一種方式是伺服器先跑完才放到前端，這種方式速度會更快，用更少的程式碼。\n\n> 本地開發npm run dev的時候會有Server Components HMR快取，代表會有更快的回應速度，減少呼叫api的次數。\n\n```\nasync function AlbumsPage() {\n    const response = await fetch(\"https://jsonplaceholder.typicode.com/albums\");\n    if (!response.ok) throw new Error(\"Failed to fetch data\");\n<div></div>\n    const albums = await response.json();\n<div></div>\n    return (\n        <main className=\"min-h-screen bg-slate-50 py-8\">\n            <div className=\"max-w-4xl mx-auto px-4\">\n                <h1 className=\"text-2xl font-semibold text-slate-900 mb-6\">\n                    Albums\n                </h1>\n<div></div>\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4\">\n                    {albums.map((album: { id: number; title: string }) => (\n                        <div\n                            key={album.id}\n                            className=\"bg-white rounded-lg border border-slate-200 p-4 shadow-sm \n                                       hover:shadow-md hover:-translate-y-0.5 \n                                       transition-transform transition-shadow duration-150\"\n                        >\n                            <h3 className=\"text-base font-semibold text-slate-900 mb-1\">\n                                {album.title}\n                            </h3>\n                            <p className=\"text-xs text-slate-500\">\n                                ID: {album.id}\n                            </p>\n                        </div>\n                    ))}\n                </div>\n            </div>\n        </main>\n    );\n}\n<div></div>\nexport default AlbumsPage;\n```\n\n```\nasync function AlbumsPage() {\n    const response = await fetch(\"https://jsonplaceholder.typicode.com/albums\");\n    if (!response.ok) throw new Error(\"Failed to fetch data\");\n\n    const albums = await response.json();\n\n    return (\n        <main className=\"min-h-screen bg-slate-50 py-8\">\n            <div className=\"max-w-4xl mx-auto px-4\">\n                <h1 className=\"text-2xl font-semibold text-slate-900 mb-6\">\n                    Albums\n                </h1>\n\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4\">\n                    {albums.map((album: { id: number; title: string }) => (\n                        <div\n                            key={album.id}\n                            className=\"bg-white rounded-lg border border-slate-200 p-4 shadow-sm \n                                       hover:shadow-md hover:-translate-y-0.5 \n                                       transition-transform transition-shadow duration-150\"\n                        >\n                            <h3 className=\"text-base font-semibold text-slate-900 mb-1\">\n                                {album.title}\n                            </h3>\n                            <p className=\"text-xs text-slate-500\">\n                                ID: {album.id}\n                            </p>\n                        </div>\n                    ))}\n                </div>\n            </div>\n        </main>\n    );\n}\n\nexport default AlbumsPage;\n```\n\n回到伺服器端跟客戶端之間的差別，伺服器端的方式有更多好處，像是載入的時間比較快，FCP表現更好。\n\n![良好的 FCP 值為 1.8 秒或更短，不良的值為 3.0 秒以上，介於兩者之間的值則需要改善](/images/good-fcp-values-18.svg)\n\n也因為在server就先載入好，所以在瀏覽器可以查看到所有原始碼SEO相對也會比較好。\n\n![](/images/image-18.png)\n\n> 參考 [JavaScript Mastery](https://www.youtube.com/@javascriptmastery) 的教學影片 [https://www.youtube.com/watch?v=I1V9YWqRIeI&t=1540s](https://www.youtube.com/watch?v=I1V9YWqRIeI&t=1540s)\n","source":"_posts/next-js-v16-base.md","raw":"---\nlayout: post\ntitle: Next.js v16 基本常識\ndate: 2025-11-26\ntags:\ncategories:\n  - \"next-js\"\ntop_img: /images/Gemini_Generated_Image_8zuhop8zuhop8zuh-1.png\ncover: /images/Gemini_Generated_Image_8zuhop8zuhop8zuh-1.png\n---\n\n## Console.log 的使用方式\n\n在Next.js 16版，有一個新的開發技巧。\n\n我們在Home裡面加上一個console.log，以往的經驗來說這是一個伺服器端的事件，所以在瀏覽器的Console中並不會出現這段輸出內容。\n\n```\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <div className=\"text-5xl\">Welcome to Next.js!</div>\n    )\n}\n<div></div>\nexport default Home\n```\n\n```\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <div className=\"text-5xl\">Welcome to Next.js!</div>\n    )\n}\n\nexport default Home\n```\n\n正常來說只會在伺服器端看到。\n\n![](/images/CleanShot-2025-11-26-at-21.17.46-1024x664.png)\n\n可以看到在瀏覽器一樣出現了標示Server的Console內容。\n\n不過不用擔心，這只是在開發的時候方便觀察而已。\n\n![](/images/CleanShot-2025-11-26-at-21.16.14-1024x662.png)\n\n這個時候有趣的來了，我要來測試在Client端寫console.log會發生什麼事情，我在app底下建立components資料夾並建立一個hello.tsx檔案。\n\n```\n// components/hello.tsx\n\"use client\"\n<div></div>\nconst Hello = () => {\n    console.log(\"Hello 組件在客戶端執行\");\n    return (\n        <div>Hello</div>\n    )\n}\n<div></div>\nexport default Hello\n```\n\n```\n// components/hello.tsx\n\"use client\"\n\nconst Hello = () => {\n    console.log(\"Hello 組件在客戶端執行\");\n    return (\n        <div>Hello</div>\n    )\n}\n\nexport default Hello\n```\n\n將hello的components引入到app/page.tsx。\n\n```\n// app/page.tsx\nimport Hello from \"@/components/hello\"\n<div></div>\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <main>\n            <div className=\"text-5xl\">Welcome to Next.js!</div>\n            <Hello />\n        </main>\n    )\n}\n<div></div>\nexport default Home\n```\n\n```\n// app/page.tsx\nimport Hello from \"@/components/hello\"\n\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <main>\n            <div className=\"text-5xl\">Welcome to Next.js!</div>\n            <Hello />\n        </main>\n    )\n}\n\nexport default Home\n```\n\n這時候到瀏覽器觀察。會發現有兩個一樣的log。\n\n![](/images/CleanShot-2025-11-26-at-21.35.15-1024x667.png)\n\n你可能會問為什麼？我用一張圖給你看看。\n\n在Server端會先建立好static shell，之後在Client端渲染。\n\n![](/images/image-13.png)\n\nReact\n\n```\nnpm install babel-plugin-react-compiler@latest\n```\n\n```\nnpm install babel-plugin-react-compiler@latest\n```\n\n在next.config.ts加上reactCompiler: true,\n\n```\nimport type { NextConfig } from \"next\";\n<div></div>\nconst nextConfig: NextConfig = {\n  reactCompiler: true,\n  experimental: {\n      turbopackFileSystemCacheForDev: true\n  }\n<div></div>\n};\n<div></div>\nexport default nextConfig;\n```\n\n```\nimport type { NextConfig } from \"next\";\n\nconst nextConfig: NextConfig = {\n  reactCompiler: true,\n  experimental: {\n      turbopackFileSystemCacheForDev: true\n  }\n\n};\n\nexport default nextConfig;\n```\n\n因為我對React沒有很熟悉，所以我問了一下ChatGpt。\n\nbabel-plugin-react-compiler 能做的事\n\n1. 自動最佳化 React 重新渲染\n\n3. 自動 memo 化 computation\n\n5. 減少 performance bug\n\n7. 用更少的 hooks 寫法就能達到最佳性能\n\n9. 讓 React 程式碼更簡潔、效果更穩定\n\n11. 未來會成為 React 的標準性能工具（官方推薦）\n\n## Router\n\n![](/images/image-10.png)\n\n你會看到一個layout.tsk，可以想成是一個網站的佈局，像是header跟footer可以先放好位置，這樣每一個頁面就不必再重複渲染，然後{children}是每一個頁面的進入點，這邊舉個例子像這樣：\n\n![](/images/未命名-2-1021x1024.png)\n\nPage是你的網站首頁的內容，一進去會先吃到app/page.tsx然後傳到layout.tsx裡面的{children}這裡。\n\n以剛剛的例子：\n\n```\n// app/page.tsx\nimport Hello from \"@/components/hello\"\n<div></div>\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <main>\n            <div className=\"text-5xl\">Welcome to Next.js!</div>\n            <Hello />\n        </main>\n    )\n}\n<div></div>\nexport default Home\n```\n\n```\n// app/page.tsx\nimport Hello from \"@/components/hello\"\n\nconst Home = () => {\n    console.log(\"我會在伺服器端執行還是客戶端執行？\");\n    return (\n        <main>\n            <div className=\"text-5xl\">Welcome to Next.js!</div>\n            <Hello />\n        </main>\n    )\n}\n\nexport default Home\n```\n\n觀察一下瀏覽器的 Elements，已經把app/page.tsx的內容傳到{children}並顯示。\n\n![](/images/CleanShot-2025-11-26-at-22.18.53-1024x667.png)\n\n> 補充：Components不能放在app/資料夾內，app是放Page的地方。\n\n### 新增一個 Route\n\n直接在app/建立一個資料夾，這邊建立一個about資料夾，跟一個page.tsx。\n\n```\napp/about/page.tsx\nconst Page = () => {\n    return (\n        <div>Page</div>\n    )\n}\n<div></div>\nexport default Page\n```\n\n```\napp/about/page.tsx\nconst Page = () => {\n    return (\n        <div>Page</div>\n    )\n}\n\nexport default Page\n```\n\n只要在你的網頁打/about路由就會看到Page了。這個在Next.js叫做Filebased routing system。\n\n以下是官方文件的Route示意圖：\n\n![](/images/image-14-1024x336.png)\n\n### Nested Routes 巢狀路由\n\n我建立了一個dashboard，並在dashboard在建立兩個資料夾分別是analytics跟users。\n\n![](/images/image-15.png)\n\n```\n// analytics/page.tsx\nconst Analytics = () => {\n    return (\n        <div>Analytics</div>\n    )\n}\n<div></div>\nexport default Analytics\n```\n\n```\n// analytics/page.tsx\nconst Analytics = () => {\n    return (\n        <div>Analytics</div>\n    )\n}\n\nexport default Analytics\n```\n\n```\n// users/page.tsx\nconst Users = () => {\n    return (\n        <div>Users</div>\n    )\n}\n<div></div>\nexport default Users\n```\n\n```\n// users/page.tsx\nconst Users = () => {\n    return (\n        <div>Users</div>\n    )\n}\n\nexport default Users\n```\n\n進到 http://localhost:3000/dashboard/analytics 就可以看到 Analytics\n\n![](/images/CleanShot-2025-11-27-at-10.34.45-1024x657.png)\n\n進到 http://localhost:3000/dashboard/users 就可以看到 Users\n\n![](/images/CleanShot-2025-11-27-at-10.33.25-1024x657.png)\n\n那我們可能會有很多User，每個User都要有自己的Dashboard介面。\n\n因此先在users底下建立一個\\[id\\]資料夾，他可以根據你傳進來的params，對應到不同Users的頁面資料。\n\n![](/images/image-17.png)\n\n將每個User外面包一個Link，對應到不同的使用者。將參數傳送到users/\\[id\\]。\n\n```\n// users/page.tsx\nimport Link from \"next/link\"\n<div></div>\nconst Users = () => {\n    return (\n        <div>\n            <h1>Dashboard Users</h1>\n<div></div>\n            <ul className=\"mt-10\">\n                <li><Link href=\"/dashboard/users/1\">User 1</Link></li>\n                <li><Link href=\"/dashboard/users/2\">User 2</Link></li>\n                <li><Link href=\"/dashboard/users/3\">User 3</Link></li>\n                <li><Link href=\"/dashboard/users/4\">User 4</Link></li>\n            </ul>\n        </div>\n    )\n}\n<div></div>\nexport default Users\n```\n\n```\n// users/page.tsx\nimport Link from \"next/link\"\n\nconst Users = () => {\n    return (\n        <div>\n            <h1>Dashboard Users</h1>\n\n            <ul className=\"mt-10\">\n                <li><Link href=\"/dashboard/users/1\">User 1</Link></li>\n                <li><Link href=\"/dashboard/users/2\">User 2</Link></li>\n                <li><Link href=\"/dashboard/users/3\">User 3</Link></li>\n                <li><Link href=\"/dashboard/users/4\">User 4</Link></li>\n            </ul>\n        </div>\n    )\n}\n\nexport default Users\n```\n\n收到了點擊Link之後傳過來的參數，並顯示使用者id。\n\n```\n// users/[id]/page.tsx\nconst UserDetails = async ({ params } : { params: Promise<{ id: string }> }) => {\n    const { id } = await params;\n    return (\n        <div>\n            <h1>User Details for User {id}</h1>\n        </div>\n    )\n}\n<div></div>\nexport default UserDetails\n```\n\n```\n// users/[id]/page.tsx\nconst UserDetails = async ({ params } : { params: Promise<{ id: string }> }) => {\n    const { id } = await params;\n    return (\n        <div>\n            <h1>User Details for User {id}</h1>\n        </div>\n    )\n}\n\nexport default UserDetails\n```\n\n這邊我在學的時候第一次看到{params}這種語法，其實是簡化了以下的程式碼：\n\n```\nconst UserDetails = async (props) => {\n    const params = props.params;\n}\n```\n\n```\nconst UserDetails = async (props) => {\n    const params = props.params;\n}\n```\n\n> 補充：在 JavaScript 中，所有非同步行為（例如 fetch、資料庫、計時器）最後得到的都是 Promise 才會使用到async、await。這裡的 id其實還不需要用到 await 因為傳來的資料是同步的如下：\n\n```\n{ id: \"1\" }\nor\n{ id: \"2\" }\nor\n{ id: \"3\" }\nor\n{ id: \"4\" }\n```\n\n```\n{ id: \"1\" }\nor\n{ id: \"2\" }\nor\n{ id: \"3\" }\nor\n{ id: \"4\" }\n```\n\n![](/images/CleanShot-2025-11-27-at-12.47.38-1024x664.png)\n\n## Layout 版面設定\n\n> 請注意！必須使用 layout.tsx 這個檔案名稱，否則 next.js會認不出來。\n\n我在app/dashboard底下新增layout.tsx\n\n```\nconst Layout = ({ children } : { children: React.ReactNode}) => {\n    return (\n        <div>\n            <div>Dashboard Navbar</div>\n            {children}\n        </div>\n    )\n}\n<div></div>\nexport default Layout;\n```\n\n```\nconst Layout = ({ children } : { children: React.ReactNode}) => {\n    return (\n        <div>\n            <div>Dashboard Navbar</div>\n            {children}\n        </div>\n    )\n}\n\nexport default Layout;\n```\n\n{ children } : { children: React.ReactNode} 的意思是：\n\n這個 component 的 props 有一個 children，而它的型別是 React.ReactNode\n\nReact.ReactNode = 可以被 React 放在畫面上的東西\n\n完整的說就是從 props 拿出 children，並且保證它是 React 可渲染的內容。\n\n## Route Groups\n\nRoute Groups 讓你能夠建立資料夾而且不會影響到 URL。\n\n如果你想要建立一個Layout.tsx，但是不想要當成一個路由，可以使用(admin)，這種括號的方式包起來。\n\n![An example folder structure using route groups](/images/image)\n\n以我的資料夾來看：\n\n首頁 http://localhost:3000 會吃到 (root) 底下的page.tsx。\n\nabout的話也是會忽略(root)資料夾，指向 http://localhost:3000/about\n\ndashboard也是相同的道理，外層(dashboard)不會吃，會吃內層的dashboard資料夾。\n\n![](/images/CleanShot-2025-11-27-at-22.47.08-1024x588.png)\n\n我們可以分別在(dashboard)跟(root)設定不同的layout。並且把最外部原來的page.tsx移動到(root)。\n\n但是要注意，使用括號()的資料夾底下，只能在其中一個保留page.tsx，否則會出現以下錯誤。\n\n![](/images/CleanShot-2025-11-27-at-22.43.19-1024x670.png)\n\n## Error Handling 錯誤處理\n\n當 Server Component 或 route segment 渲染失敗時，Next.js 會顯示你寫在 error.tsx 的 UI。\n\n而不是預設簡陋的錯誤頁。像是我在about的page寫一個Error，並在about底下建立一個error.tsx。\n\n並進入到about頁面觀察。\n\n```\n// about/error.tsx\n'use client' // Error boundaries must be Client Components\n \nimport { useEffect } from 'react'\n \nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error & { digest?: string }\n  reset: () => void\n}) {\n  useEffect(() => {\n    // Log the error to an error reporting service\n    console.error(error)\n  }, [error])\n \n  return (\n    <div>\n      <h2>Something went wrong!</h2>\n      <button\n        onClick={\n          // Attempt to recover by trying to re-render the segment\n          () => reset()\n        }\n      >\n        Try again\n      </button>\n    </div>\n  )\n}\n```\n\n```\n// about/error.tsx\n'use client' // Error boundaries must be Client Components\n \nimport { useEffect } from 'react'\n \nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error & { digest?: string }\n  reset: () => void\n}) {\n  useEffect(() => {\n    // Log the error to an error reporting service\n    console.error(error)\n  }, [error])\n \n  return (\n    <div>\n      <h2>Something went wrong!</h2>\n      <button\n        onClick={\n          // Attempt to recover by trying to re-render the segment\n          () => reset()\n        }\n      >\n        Try again\n      </button>\n    </div>\n  )\n}\n```\n\n![](/images/CleanShot-2025-11-28-at-10.25.54-1024x578.png)\n\n可以看到在畫面有顯示文字，同時也可以在console中看到錯誤。\n\n> Console只在「開發模式（npm run dev）」才會出現\n> \n> 所以return的部分顯示在前端，useEffect的部分是顯示在後端。\n\n![](/images/CleanShot-2025-11-28-at-10.28.43-1024x670.png)\n\n預設的狀態只能看到簡陋的一些文字，無法讓使用者了解目前的狀態。\n\n有了error.tsx，可以呈現一些相關的錯誤訊息給使用者，讓使用者知道目前網站的狀態。\n\n不用擔心重要的資訊外露，因為在client端不會顯示重要訊息，我是把它想成美化error頁面。\n\n![](/images/CleanShot-2025-11-28-at-10.33.17-1024x670.png)\n\n## Loading UI 載入畫面\n\n在Next.js改如何使用Loading的效果呢？\n\n以下是一個抓取api等待時間的loading效果展示。\n\n```\nconst Page = async () => {\n    const res = await fetch(\"https://jsonplaceholder.typicode.com/users/1\");\n    const user = await res.json();\n    return (\n        <div>        \n             <div>{user.name}</div>;\n        </div>\n    )\n}\n<div></div>\nexport default Page\n```\n\n```\nconst Page = async () => {\n    const res = await fetch(\"https://jsonplaceholder.typicode.com/users/1\");\n    const user = await res.json();\n    return (\n        <div>        \n             <div>{user.name}</div>;\n        </div>\n    )\n}\n\nexport default Page\n```\n\n![](/images/CleanShot-2025-11-28-at-12.17.25.gif)\n\n只要在app/底下建立一個loading.tsx，就會有Loading的效果，它的作用範圍是**全站**（global loading UI）。\n\n> 只要任何 page.tsx 或 layout.tsx 在 await 資料，  \n> Next.js 就會顯示 /app/loading.tsx 作為「Loading 過渡畫面」。  \n> 子路由可以用自己的 loading.tsx 覆蓋上層的。\n\n## Data Fetching 資料截取\n\n第一種方式是透過前端渲染畫面。\n\n但是不推薦，會有延遲，而且原始碼很空SEO效果不好。\n\n```\n\"use client\";\n<div></div>\nimport { useState,useEffect } from 'react';\n<div></div>\nfunction album1() {\n    const [albums, setAlbums] = useState([]);\n<div></div>\n    useEffect(() => {\n        const fetchAlbums = async () => {\n            try {\n                const response = await fetch(\"https://jsonplaceholder.typicode.com/albums\")\n                const data = await response.json();\n                setAlbums(data);\n            } catch (error) {\n                console.error(\"Error fetching albums:\", error);\n            }\n        };\n        fetchAlbums();\n    }, []);\n<div></div>\n    return (\n        <div className=''>\n            {albums.map((album: {id: number; title: string}) => (\n                <div key={album.id} className=''>\n                    <h3>{album.title}</h3>\n                    <p>Album ID: {album.id}</p>\n                </div>\n            ))}\n        </div>\n    )\n}\n<div></div>\nexport default album1;\n```\n\n```\n\"use client\";\n\nimport { useState,useEffect } from 'react';\n\nfunction album1() {\n    const [albums, setAlbums] = useState([]);\n\n    useEffect(() => {\n        const fetchAlbums = async () => {\n            try {\n                const response = await fetch(\"https://jsonplaceholder.typicode.com/albums\")\n                const data = await response.json();\n                setAlbums(data);\n            } catch (error) {\n                console.error(\"Error fetching albums:\", error);\n            }\n        };\n        fetchAlbums();\n    }, []);\n\n    return (\n        <div className=''>\n            {albums.map((album: {id: number; title: string}) => (\n                <div key={album.id} className=''>\n                    <h3>{album.title}</h3>\n                    <p>Album ID: {album.id}</p>\n                </div>\n            ))}\n        </div>\n    )\n}\n\nexport default album1;\n```\n\n另一種方式是伺服器先跑完才放到前端，這種方式速度會更快，用更少的程式碼。\n\n> 本地開發npm run dev的時候會有Server Components HMR快取，代表會有更快的回應速度，減少呼叫api的次數。\n\n```\nasync function AlbumsPage() {\n    const response = await fetch(\"https://jsonplaceholder.typicode.com/albums\");\n    if (!response.ok) throw new Error(\"Failed to fetch data\");\n<div></div>\n    const albums = await response.json();\n<div></div>\n    return (\n        <main className=\"min-h-screen bg-slate-50 py-8\">\n            <div className=\"max-w-4xl mx-auto px-4\">\n                <h1 className=\"text-2xl font-semibold text-slate-900 mb-6\">\n                    Albums\n                </h1>\n<div></div>\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4\">\n                    {albums.map((album: { id: number; title: string }) => (\n                        <div\n                            key={album.id}\n                            className=\"bg-white rounded-lg border border-slate-200 p-4 shadow-sm \n                                       hover:shadow-md hover:-translate-y-0.5 \n                                       transition-transform transition-shadow duration-150\"\n                        >\n                            <h3 className=\"text-base font-semibold text-slate-900 mb-1\">\n                                {album.title}\n                            </h3>\n                            <p className=\"text-xs text-slate-500\">\n                                ID: {album.id}\n                            </p>\n                        </div>\n                    ))}\n                </div>\n            </div>\n        </main>\n    );\n}\n<div></div>\nexport default AlbumsPage;\n```\n\n```\nasync function AlbumsPage() {\n    const response = await fetch(\"https://jsonplaceholder.typicode.com/albums\");\n    if (!response.ok) throw new Error(\"Failed to fetch data\");\n\n    const albums = await response.json();\n\n    return (\n        <main className=\"min-h-screen bg-slate-50 py-8\">\n            <div className=\"max-w-4xl mx-auto px-4\">\n                <h1 className=\"text-2xl font-semibold text-slate-900 mb-6\">\n                    Albums\n                </h1>\n\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4\">\n                    {albums.map((album: { id: number; title: string }) => (\n                        <div\n                            key={album.id}\n                            className=\"bg-white rounded-lg border border-slate-200 p-4 shadow-sm \n                                       hover:shadow-md hover:-translate-y-0.5 \n                                       transition-transform transition-shadow duration-150\"\n                        >\n                            <h3 className=\"text-base font-semibold text-slate-900 mb-1\">\n                                {album.title}\n                            </h3>\n                            <p className=\"text-xs text-slate-500\">\n                                ID: {album.id}\n                            </p>\n                        </div>\n                    ))}\n                </div>\n            </div>\n        </main>\n    );\n}\n\nexport default AlbumsPage;\n```\n\n回到伺服器端跟客戶端之間的差別，伺服器端的方式有更多好處，像是載入的時間比較快，FCP表現更好。\n\n![良好的 FCP 值為 1.8 秒或更短，不良的值為 3.0 秒以上，介於兩者之間的值則需要改善](/images/good-fcp-values-18.svg)\n\n也因為在server就先載入好，所以在瀏覽器可以查看到所有原始碼SEO相對也會比較好。\n\n![](/images/image-18.png)\n\n> 參考 [JavaScript Mastery](https://www.youtube.com/@javascriptmastery) 的教學影片 [https://www.youtube.com/watch?v=I1V9YWqRIeI&t=1540s](https://www.youtube.com/watch?v=I1V9YWqRIeI&t=1540s)\n","slug":"next-js-v16-base","published":1,"updated":"2026-01-28T14:17:25.065Z","_id":"cmkxg0krr0002rb8z81849mbt","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"Console-log-的使用方式\"><a href=\"#Console-log-的使用方式\" class=\"headerlink\" title=\"Console.log 的使用方式\"></a>Console.log 的使用方式</h2><p>在Next.js 16版，有一個新的開發技巧。</p>\n<p>我們在Home裡面加上一個console.log，以往的經驗來說這是一個伺服器端的事件，所以在瀏覽器的Console中並不會出現這段輸出內容。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<p>正常來說只會在伺服器端看到。</p>\n<p><img src=\"/images/CleanShot-2025-11-26-at-21.17.46-1024x664.png\"></p>\n<p>可以看到在瀏覽器一樣出現了標示Server的Console內容。</p>\n<p>不過不用擔心，這只是在開發的時候方便觀察而已。</p>\n<p><img src=\"/images/CleanShot-2025-11-26-at-21.16.14-1024x662.png\"></p>\n<p>這個時候有趣的來了，我要來測試在Client端寫console.log會發生什麼事情，我在app底下建立components資料夾並建立一個hello.tsx檔案。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// components/hello.tsx</span><br><span class=\"line\">&quot;use client&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">const Hello = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;Hello 組件在客戶端執行&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Hello&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Hello</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// components/hello.tsx</span><br><span class=\"line\">&quot;use client&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">const Hello = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;Hello 組件在客戶端執行&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Hello&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Hello</span><br></pre></td></tr></table></figure>\n\n<p>將hello的components引入到app&#x2F;page.tsx。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// app/page.tsx</span><br><span class=\"line\">import Hello from &quot;@/components/hello&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main&gt;</span><br><span class=\"line\">            &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">            &lt;Hello /&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// app/page.tsx</span><br><span class=\"line\">import Hello from &quot;@/components/hello&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main&gt;</span><br><span class=\"line\">            &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">            &lt;Hello /&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<p>這時候到瀏覽器觀察。會發現有兩個一樣的log。</p>\n<p><img src=\"/images/CleanShot-2025-11-26-at-21.35.15-1024x667.png\"></p>\n<p>你可能會問為什麼？我用一張圖給你看看。</p>\n<p>在Server端會先建立好static shell，之後在Client端渲染。</p>\n<p><img src=\"/images/image-13.png\"></p>\n<p>React</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install babel-plugin-react-compiler@latest</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install babel-plugin-react-compiler@latest</span><br></pre></td></tr></table></figure>\n\n<p>在next.config.ts加上reactCompiler: true,</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import type &#123; NextConfig &#125; from &quot;next&quot;;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">const nextConfig: NextConfig = &#123;</span><br><span class=\"line\">  reactCompiler: true,</span><br><span class=\"line\">  experimental: &#123;</span><br><span class=\"line\">      turbopackFileSystemCacheForDev: true</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default nextConfig;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import type &#123; NextConfig &#125; from &quot;next&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">const nextConfig: NextConfig = &#123;</span><br><span class=\"line\">  reactCompiler: true,</span><br><span class=\"line\">  experimental: &#123;</span><br><span class=\"line\">      turbopackFileSystemCacheForDev: true</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">export default nextConfig;</span><br></pre></td></tr></table></figure>\n\n<p>因為我對React沒有很熟悉，所以我問了一下ChatGpt。</p>\n<p>babel-plugin-react-compiler 能做的事</p>\n<ol>\n<li><p>自動最佳化 React 重新渲染</p>\n</li>\n<li><p>自動 memo 化 computation</p>\n</li>\n<li><p>減少 performance bug</p>\n</li>\n<li><p>用更少的 hooks 寫法就能達到最佳性能</p>\n</li>\n<li><p>讓 React 程式碼更簡潔、效果更穩定</p>\n</li>\n<li><p>未來會成為 React 的標準性能工具（官方推薦）</p>\n</li>\n</ol>\n<h2 id=\"Router\"><a href=\"#Router\" class=\"headerlink\" title=\"Router\"></a>Router</h2><p><img src=\"/images/image-10.png\"></p>\n<p>你會看到一個layout.tsk，可以想成是一個網站的佈局，像是header跟footer可以先放好位置，這樣每一個頁面就不必再重複渲染，然後{children}是每一個頁面的進入點，這邊舉個例子像這樣：</p>\n<p><img src=\"/images/%E6%9C%AA%E5%91%BD%E5%90%8D-2-1021x1024.png\"></p>\n<p>Page是你的網站首頁的內容，一進去會先吃到app&#x2F;page.tsx然後傳到layout.tsx裡面的{children}這裡。</p>\n<p>以剛剛的例子：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// app/page.tsx</span><br><span class=\"line\">import Hello from &quot;@/components/hello&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main&gt;</span><br><span class=\"line\">            &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">            &lt;Hello /&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// app/page.tsx</span><br><span class=\"line\">import Hello from &quot;@/components/hello&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main&gt;</span><br><span class=\"line\">            &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">            &lt;Hello /&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<p>觀察一下瀏覽器的 Elements，已經把app&#x2F;page.tsx的內容傳到{children}並顯示。</p>\n<p><img src=\"/images/CleanShot-2025-11-26-at-22.18.53-1024x667.png\"></p>\n<blockquote>\n<p>補充：Components不能放在app&#x2F;資料夾內，app是放Page的地方。</p>\n</blockquote>\n<h3 id=\"新增一個-Route\"><a href=\"#新增一個-Route\" class=\"headerlink\" title=\"新增一個 Route\"></a>新增一個 Route</h3><p>直接在app&#x2F;建立一個資料夾，這邊建立一個about資料夾，跟一個page.tsx。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app/about/page.tsx</span><br><span class=\"line\">const Page = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Page&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Page</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app/about/page.tsx</span><br><span class=\"line\">const Page = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Page&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Page</span><br></pre></td></tr></table></figure>\n\n<p>只要在你的網頁打&#x2F;about路由就會看到Page了。這個在Next.js叫做Filebased routing system。</p>\n<p>以下是官方文件的Route示意圖：</p>\n<p><img src=\"/images/image-14-1024x336.png\"></p>\n<h3 id=\"Nested-Routes-巢狀路由\"><a href=\"#Nested-Routes-巢狀路由\" class=\"headerlink\" title=\"Nested Routes 巢狀路由\"></a>Nested Routes 巢狀路由</h3><p>我建立了一個dashboard，並在dashboard在建立兩個資料夾分別是analytics跟users。</p>\n<p><img src=\"/images/image-15.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// analytics/page.tsx</span><br><span class=\"line\">const Analytics = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Analytics&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Analytics</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// analytics/page.tsx</span><br><span class=\"line\">const Analytics = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Analytics&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Analytics</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/page.tsx</span><br><span class=\"line\">const Users = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Users&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Users</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/page.tsx</span><br><span class=\"line\">const Users = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Users&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Users</span><br></pre></td></tr></table></figure>\n\n<p>進到 <a href=\"http://localhost:3000/dashboard/analytics\">http://localhost:3000/dashboard/analytics</a> 就可以看到 Analytics</p>\n<p><img src=\"/images/CleanShot-2025-11-27-at-10.34.45-1024x657.png\"></p>\n<p>進到 <a href=\"http://localhost:3000/dashboard/users\">http://localhost:3000/dashboard/users</a> 就可以看到 Users</p>\n<p><img src=\"/images/CleanShot-2025-11-27-at-10.33.25-1024x657.png\"></p>\n<p>那我們可能會有很多User，每個User都要有自己的Dashboard介面。</p>\n<p>因此先在users底下建立一個[id]資料夾，他可以根據你傳進來的params，對應到不同Users的頁面資料。</p>\n<p><img src=\"/images/image-17.png\"></p>\n<p>將每個User外面包一個Link，對應到不同的使用者。將參數傳送到users&#x2F;[id]。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/page.tsx</span><br><span class=\"line\">import Link from &quot;next/link&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">const Users = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;h1&gt;Dashboard Users&lt;/h1&gt;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">            &lt;ul className=&quot;mt-10&quot;&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/1&quot;&gt;User 1&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/2&quot;&gt;User 2&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/3&quot;&gt;User 3&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/4&quot;&gt;User 4&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">            &lt;/ul&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Users</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/page.tsx</span><br><span class=\"line\">import Link from &quot;next/link&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">const Users = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;h1&gt;Dashboard Users&lt;/h1&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;ul className=&quot;mt-10&quot;&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/1&quot;&gt;User 1&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/2&quot;&gt;User 2&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/3&quot;&gt;User 3&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/4&quot;&gt;User 4&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">            &lt;/ul&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Users</span><br></pre></td></tr></table></figure>\n\n<p>收到了點擊Link之後傳過來的參數，並顯示使用者id。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/[id]/page.tsx</span><br><span class=\"line\">const UserDetails = async (&#123; params &#125; : &#123; params: Promise&lt;&#123; id: string &#125;&gt; &#125;) =&gt; &#123;</span><br><span class=\"line\">    const &#123; id &#125; = await params;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;h1&gt;User Details for User &#123;id&#125;&lt;/h1&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default UserDetails</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/[id]/page.tsx</span><br><span class=\"line\">const UserDetails = async (&#123; params &#125; : &#123; params: Promise&lt;&#123; id: string &#125;&gt; &#125;) =&gt; &#123;</span><br><span class=\"line\">    const &#123; id &#125; = await params;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;h1&gt;User Details for User &#123;id&#125;&lt;/h1&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default UserDetails</span><br></pre></td></tr></table></figure>\n\n<p>這邊我在學的時候第一次看到{params}這種語法，其實是簡化了以下的程式碼：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const UserDetails = async (props) =&gt; &#123;</span><br><span class=\"line\">    const params = props.params;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const UserDetails = async (props) =&gt; &#123;</span><br><span class=\"line\">    const params = props.params;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>補充：在 JavaScript 中，所有非同步行為（例如 fetch、資料庫、計時器）最後得到的都是 Promise 才會使用到async、await。這裡的 id其實還不需要用到 await 因為傳來的資料是同步的如下：</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; id: &quot;1&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;2&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;3&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;4&quot; &#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; id: &quot;1&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;2&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;3&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;4&quot; &#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/CleanShot-2025-11-27-at-12.47.38-1024x664.png\"></p>\n<h2 id=\"Layout-版面設定\"><a href=\"#Layout-版面設定\" class=\"headerlink\" title=\"Layout 版面設定\"></a>Layout 版面設定</h2><blockquote>\n<p>請注意！必須使用 layout.tsx 這個檔案名稱，否則 next.js會認不出來。</p>\n</blockquote>\n<p>我在app&#x2F;dashboard底下新增layout.tsx</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Layout = (&#123; children &#125; : &#123; children: React.ReactNode&#125;) =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;div&gt;Dashboard Navbar&lt;/div&gt;</span><br><span class=\"line\">            &#123;children&#125;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Layout;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Layout = (&#123; children &#125; : &#123; children: React.ReactNode&#125;) =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;div&gt;Dashboard Navbar&lt;/div&gt;</span><br><span class=\"line\">            &#123;children&#125;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Layout;</span><br></pre></td></tr></table></figure>\n\n<p>{ children } : { children: React.ReactNode} 的意思是：</p>\n<p>這個 component 的 props 有一個 children，而它的型別是 React.ReactNode</p>\n<p>React.ReactNode &#x3D; 可以被 React 放在畫面上的東西</p>\n<p>完整的說就是從 props 拿出 children，並且保證它是 React 可渲染的內容。</p>\n<h2 id=\"Route-Groups\"><a href=\"#Route-Groups\" class=\"headerlink\" title=\"Route Groups\"></a>Route Groups</h2><p>Route Groups 讓你能夠建立資料夾而且不會影響到 URL。</p>\n<p>如果你想要建立一個Layout.tsx，但是不想要當成一個路由，可以使用(admin)，這種括號的方式包起來。</p>\n<p><img src=\"/images/image\" alt=\"An example folder structure using route groups\"></p>\n<p>以我的資料夾來看：</p>\n<p>首頁 <a href=\"http://localhost:3000/\">http://localhost:3000</a> 會吃到 (root) 底下的page.tsx。</p>\n<p>about的話也是會忽略(root)資料夾，指向 <a href=\"http://localhost:3000/about\">http://localhost:3000/about</a></p>\n<p>dashboard也是相同的道理，外層(dashboard)不會吃，會吃內層的dashboard資料夾。</p>\n<p><img src=\"/images/CleanShot-2025-11-27-at-22.47.08-1024x588.png\"></p>\n<p>我們可以分別在(dashboard)跟(root)設定不同的layout。並且把最外部原來的page.tsx移動到(root)。</p>\n<p>但是要注意，使用括號()的資料夾底下，只能在其中一個保留page.tsx，否則會出現以下錯誤。</p>\n<p><img src=\"/images/CleanShot-2025-11-27-at-22.43.19-1024x670.png\"></p>\n<h2 id=\"Error-Handling-錯誤處理\"><a href=\"#Error-Handling-錯誤處理\" class=\"headerlink\" title=\"Error Handling 錯誤處理\"></a>Error Handling 錯誤處理</h2><p>當 Server Component 或 route segment 渲染失敗時，Next.js 會顯示你寫在 error.tsx 的 UI。</p>\n<p>而不是預設簡陋的錯誤頁。像是我在about的page寫一個Error，並在about底下建立一個error.tsx。</p>\n<p>並進入到about頁面觀察。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// about/error.tsx</span><br><span class=\"line\">&#x27;use client&#x27; // Error boundaries must be Client Components</span><br><span class=\"line\"> </span><br><span class=\"line\">import &#123; useEffect &#125; from &#x27;react&#x27;</span><br><span class=\"line\"> </span><br><span class=\"line\">export default function Error(&#123;</span><br><span class=\"line\">  error,</span><br><span class=\"line\">  reset,</span><br><span class=\"line\">&#125;: &#123;</span><br><span class=\"line\">  error: Error &amp; &#123; digest?: string &#125;</span><br><span class=\"line\">  reset: () =&gt; void</span><br><span class=\"line\">&#125;) &#123;</span><br><span class=\"line\">  useEffect(() =&gt; &#123;</span><br><span class=\"line\">    // Log the error to an error reporting service</span><br><span class=\"line\">    console.error(error)</span><br><span class=\"line\">  &#125;, [error])</span><br><span class=\"line\"> </span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;h2&gt;Something went wrong!&lt;/h2&gt;</span><br><span class=\"line\">      &lt;button</span><br><span class=\"line\">        onClick=&#123;</span><br><span class=\"line\">          // Attempt to recover by trying to re-render the segment</span><br><span class=\"line\">          () =&gt; reset()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">        Try again</span><br><span class=\"line\">      &lt;/button&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// about/error.tsx</span><br><span class=\"line\">&#x27;use client&#x27; // Error boundaries must be Client Components</span><br><span class=\"line\"> </span><br><span class=\"line\">import &#123; useEffect &#125; from &#x27;react&#x27;</span><br><span class=\"line\"> </span><br><span class=\"line\">export default function Error(&#123;</span><br><span class=\"line\">  error,</span><br><span class=\"line\">  reset,</span><br><span class=\"line\">&#125;: &#123;</span><br><span class=\"line\">  error: Error &amp; &#123; digest?: string &#125;</span><br><span class=\"line\">  reset: () =&gt; void</span><br><span class=\"line\">&#125;) &#123;</span><br><span class=\"line\">  useEffect(() =&gt; &#123;</span><br><span class=\"line\">    // Log the error to an error reporting service</span><br><span class=\"line\">    console.error(error)</span><br><span class=\"line\">  &#125;, [error])</span><br><span class=\"line\"> </span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;h2&gt;Something went wrong!&lt;/h2&gt;</span><br><span class=\"line\">      &lt;button</span><br><span class=\"line\">        onClick=&#123;</span><br><span class=\"line\">          // Attempt to recover by trying to re-render the segment</span><br><span class=\"line\">          () =&gt; reset()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">        Try again</span><br><span class=\"line\">      &lt;/button&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/CleanShot-2025-11-28-at-10.25.54-1024x578.png\"></p>\n<p>可以看到在畫面有顯示文字，同時也可以在console中看到錯誤。</p>\n<blockquote>\n<p>Console只在「開發模式（npm run dev）」才會出現</p>\n<p>所以return的部分顯示在前端，useEffect的部分是顯示在後端。</p>\n</blockquote>\n<p><img src=\"/images/CleanShot-2025-11-28-at-10.28.43-1024x670.png\"></p>\n<p>預設的狀態只能看到簡陋的一些文字，無法讓使用者了解目前的狀態。</p>\n<p>有了error.tsx，可以呈現一些相關的錯誤訊息給使用者，讓使用者知道目前網站的狀態。</p>\n<p>不用擔心重要的資訊外露，因為在client端不會顯示重要訊息，我是把它想成美化error頁面。</p>\n<p><img src=\"/images/CleanShot-2025-11-28-at-10.33.17-1024x670.png\"></p>\n<h2 id=\"Loading-UI-載入畫面\"><a href=\"#Loading-UI-載入畫面\" class=\"headerlink\" title=\"Loading UI 載入畫面\"></a>Loading UI 載入畫面</h2><p>在Next.js改如何使用Loading的效果呢？</p>\n<p>以下是一個抓取api等待時間的loading效果展示。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Page = async () =&gt; &#123;</span><br><span class=\"line\">    const res = await fetch(&quot;https://jsonplaceholder.typicode.com/users/1&quot;);</span><br><span class=\"line\">    const user = await res.json();</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;        </span><br><span class=\"line\">             &lt;div&gt;&#123;user.name&#125;&lt;/div&gt;;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Page</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Page = async () =&gt; &#123;</span><br><span class=\"line\">    const res = await fetch(&quot;https://jsonplaceholder.typicode.com/users/1&quot;);</span><br><span class=\"line\">    const user = await res.json();</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;        </span><br><span class=\"line\">             &lt;div&gt;&#123;user.name&#125;&lt;/div&gt;;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Page</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/CleanShot-2025-11-28-at-12.17.25.gif\"></p>\n<p>只要在app&#x2F;底下建立一個loading.tsx，就會有Loading的效果，它的作用範圍是<strong>全站</strong>（global loading UI）。</p>\n<blockquote>\n<p>只要任何 page.tsx 或 layout.tsx 在 await 資料，<br>Next.js 就會顯示 &#x2F;app&#x2F;loading.tsx 作為「Loading 過渡畫面」。<br>子路由可以用自己的 loading.tsx 覆蓋上層的。</p>\n</blockquote>\n<h2 id=\"Data-Fetching-資料截取\"><a href=\"#Data-Fetching-資料截取\" class=\"headerlink\" title=\"Data Fetching 資料截取\"></a>Data Fetching 資料截取</h2><p>第一種方式是透過前端渲染畫面。</p>\n<p>但是不推薦，會有延遲，而且原始碼很空SEO效果不好。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;use client&quot;;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">import &#123; useState,useEffect &#125; from &#x27;react&#x27;;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">function album1() &#123;</span><br><span class=\"line\">    const [albums, setAlbums] = useState([]);</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    useEffect(() =&gt; &#123;</span><br><span class=\"line\">        const fetchAlbums = async () =&gt; &#123;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                const response = await fetch(&quot;https://jsonplaceholder.typicode.com/albums&quot;)</span><br><span class=\"line\">                const data = await response.json();</span><br><span class=\"line\">                setAlbums(data);</span><br><span class=\"line\">            &#125; catch (error) &#123;</span><br><span class=\"line\">                console.error(&quot;Error fetching albums:&quot;, error);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        fetchAlbums();</span><br><span class=\"line\">    &#125;, []);</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div className=&#x27;&#x27;&gt;</span><br><span class=\"line\">            &#123;albums.map((album: &#123;id: number; title: string&#125;) =&gt; (</span><br><span class=\"line\">                &lt;div key=&#123;album.id&#125; className=&#x27;&#x27;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;&#123;album.title&#125;&lt;/h3&gt;</span><br><span class=\"line\">                    &lt;p&gt;Album ID: &#123;album.id&#125;&lt;/p&gt;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            ))&#125;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default album1;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;use client&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">import &#123; useState,useEffect &#125; from &#x27;react&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">function album1() &#123;</span><br><span class=\"line\">    const [albums, setAlbums] = useState([]);</span><br><span class=\"line\"></span><br><span class=\"line\">    useEffect(() =&gt; &#123;</span><br><span class=\"line\">        const fetchAlbums = async () =&gt; &#123;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                const response = await fetch(&quot;https://jsonplaceholder.typicode.com/albums&quot;)</span><br><span class=\"line\">                const data = await response.json();</span><br><span class=\"line\">                setAlbums(data);</span><br><span class=\"line\">            &#125; catch (error) &#123;</span><br><span class=\"line\">                console.error(&quot;Error fetching albums:&quot;, error);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        fetchAlbums();</span><br><span class=\"line\">    &#125;, []);</span><br><span class=\"line\"></span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div className=&#x27;&#x27;&gt;</span><br><span class=\"line\">            &#123;albums.map((album: &#123;id: number; title: string&#125;) =&gt; (</span><br><span class=\"line\">                &lt;div key=&#123;album.id&#125; className=&#x27;&#x27;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;&#123;album.title&#125;&lt;/h3&gt;</span><br><span class=\"line\">                    &lt;p&gt;Album ID: &#123;album.id&#125;&lt;/p&gt;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            ))&#125;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default album1;</span><br></pre></td></tr></table></figure>\n\n<p>另一種方式是伺服器先跑完才放到前端，這種方式速度會更快，用更少的程式碼。</p>\n<blockquote>\n<p>本地開發npm run dev的時候會有Server Components HMR快取，代表會有更快的回應速度，減少呼叫api的次數。</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">async function AlbumsPage() &#123;</span><br><span class=\"line\">    const response = await fetch(&quot;https://jsonplaceholder.typicode.com/albums&quot;);</span><br><span class=\"line\">    if (!response.ok) throw new Error(&quot;Failed to fetch data&quot;);</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    const albums = await response.json();</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main className=&quot;min-h-screen bg-slate-50 py-8&quot;&gt;</span><br><span class=\"line\">            &lt;div className=&quot;max-w-4xl mx-auto px-4&quot;&gt;</span><br><span class=\"line\">                &lt;h1 className=&quot;text-2xl font-semibold text-slate-900 mb-6&quot;&gt;</span><br><span class=\"line\">                    Albums</span><br><span class=\"line\">                &lt;/h1&gt;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">                &lt;div className=&quot;grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4&quot;&gt;</span><br><span class=\"line\">                    &#123;albums.map((album: &#123; id: number; title: string &#125;) =&gt; (</span><br><span class=\"line\">                        &lt;div</span><br><span class=\"line\">                            key=&#123;album.id&#125;</span><br><span class=\"line\">                            className=&quot;bg-white rounded-lg border border-slate-200 p-4 shadow-sm </span><br><span class=\"line\">                                       hover:shadow-md hover:-translate-y-0.5 </span><br><span class=\"line\">                                       transition-transform transition-shadow duration-150&quot;</span><br><span class=\"line\">                        &gt;</span><br><span class=\"line\">                            &lt;h3 className=&quot;text-base font-semibold text-slate-900 mb-1&quot;&gt;</span><br><span class=\"line\">                                &#123;album.title&#125;</span><br><span class=\"line\">                            &lt;/h3&gt;</span><br><span class=\"line\">                            &lt;p className=&quot;text-xs text-slate-500&quot;&gt;</span><br><span class=\"line\">                                ID: &#123;album.id&#125;</span><br><span class=\"line\">                            &lt;/p&gt;</span><br><span class=\"line\">                        &lt;/div&gt;</span><br><span class=\"line\">                    ))&#125;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            &lt;/div&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default AlbumsPage;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">async function AlbumsPage() &#123;</span><br><span class=\"line\">    const response = await fetch(&quot;https://jsonplaceholder.typicode.com/albums&quot;);</span><br><span class=\"line\">    if (!response.ok) throw new Error(&quot;Failed to fetch data&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    const albums = await response.json();</span><br><span class=\"line\"></span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main className=&quot;min-h-screen bg-slate-50 py-8&quot;&gt;</span><br><span class=\"line\">            &lt;div className=&quot;max-w-4xl mx-auto px-4&quot;&gt;</span><br><span class=\"line\">                &lt;h1 className=&quot;text-2xl font-semibold text-slate-900 mb-6&quot;&gt;</span><br><span class=\"line\">                    Albums</span><br><span class=\"line\">                &lt;/h1&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                &lt;div className=&quot;grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4&quot;&gt;</span><br><span class=\"line\">                    &#123;albums.map((album: &#123; id: number; title: string &#125;) =&gt; (</span><br><span class=\"line\">                        &lt;div</span><br><span class=\"line\">                            key=&#123;album.id&#125;</span><br><span class=\"line\">                            className=&quot;bg-white rounded-lg border border-slate-200 p-4 shadow-sm </span><br><span class=\"line\">                                       hover:shadow-md hover:-translate-y-0.5 </span><br><span class=\"line\">                                       transition-transform transition-shadow duration-150&quot;</span><br><span class=\"line\">                        &gt;</span><br><span class=\"line\">                            &lt;h3 className=&quot;text-base font-semibold text-slate-900 mb-1&quot;&gt;</span><br><span class=\"line\">                                &#123;album.title&#125;</span><br><span class=\"line\">                            &lt;/h3&gt;</span><br><span class=\"line\">                            &lt;p className=&quot;text-xs text-slate-500&quot;&gt;</span><br><span class=\"line\">                                ID: &#123;album.id&#125;</span><br><span class=\"line\">                            &lt;/p&gt;</span><br><span class=\"line\">                        &lt;/div&gt;</span><br><span class=\"line\">                    ))&#125;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            &lt;/div&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default AlbumsPage;</span><br></pre></td></tr></table></figure>\n\n<p>回到伺服器端跟客戶端之間的差別，伺服器端的方式有更多好處，像是載入的時間比較快，FCP表現更好。</p>\n<p><img src=\"/images/good-fcp-values-18.svg\" alt=\"良好的 FCP 值為 1.8 秒或更短，不良的值為 3.0 秒以上，介於兩者之間的值則需要改善\"></p>\n<p>也因為在server就先載入好，所以在瀏覽器可以查看到所有原始碼SEO相對也會比較好。</p>\n<p><img src=\"/images/image-18.png\"></p>\n<blockquote>\n<p>參考 <a href=\"https://www.youtube.com/@javascriptmastery\">JavaScript Mastery</a> 的教學影片 <a href=\"https://www.youtube.com/watch?v=I1V9YWqRIeI&t=1540s\">https://www.youtube.com/watch?v=I1V9YWqRIeI&t=1540s</a></p>\n</blockquote>\n","excerpt":"","more":"<h2 id=\"Console-log-的使用方式\"><a href=\"#Console-log-的使用方式\" class=\"headerlink\" title=\"Console.log 的使用方式\"></a>Console.log 的使用方式</h2><p>在Next.js 16版，有一個新的開發技巧。</p>\n<p>我們在Home裡面加上一個console.log，以往的經驗來說這是一個伺服器端的事件，所以在瀏覽器的Console中並不會出現這段輸出內容。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<p>正常來說只會在伺服器端看到。</p>\n<p><img src=\"/images/CleanShot-2025-11-26-at-21.17.46-1024x664.png\"></p>\n<p>可以看到在瀏覽器一樣出現了標示Server的Console內容。</p>\n<p>不過不用擔心，這只是在開發的時候方便觀察而已。</p>\n<p><img src=\"/images/CleanShot-2025-11-26-at-21.16.14-1024x662.png\"></p>\n<p>這個時候有趣的來了，我要來測試在Client端寫console.log會發生什麼事情，我在app底下建立components資料夾並建立一個hello.tsx檔案。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// components/hello.tsx</span><br><span class=\"line\">&quot;use client&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">const Hello = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;Hello 組件在客戶端執行&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Hello&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Hello</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// components/hello.tsx</span><br><span class=\"line\">&quot;use client&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">const Hello = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;Hello 組件在客戶端執行&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Hello&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Hello</span><br></pre></td></tr></table></figure>\n\n<p>將hello的components引入到app&#x2F;page.tsx。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// app/page.tsx</span><br><span class=\"line\">import Hello from &quot;@/components/hello&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main&gt;</span><br><span class=\"line\">            &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">            &lt;Hello /&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// app/page.tsx</span><br><span class=\"line\">import Hello from &quot;@/components/hello&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main&gt;</span><br><span class=\"line\">            &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">            &lt;Hello /&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<p>這時候到瀏覽器觀察。會發現有兩個一樣的log。</p>\n<p><img src=\"/images/CleanShot-2025-11-26-at-21.35.15-1024x667.png\"></p>\n<p>你可能會問為什麼？我用一張圖給你看看。</p>\n<p>在Server端會先建立好static shell，之後在Client端渲染。</p>\n<p><img src=\"/images/image-13.png\"></p>\n<p>React</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install babel-plugin-react-compiler@latest</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install babel-plugin-react-compiler@latest</span><br></pre></td></tr></table></figure>\n\n<p>在next.config.ts加上reactCompiler: true,</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import type &#123; NextConfig &#125; from &quot;next&quot;;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">const nextConfig: NextConfig = &#123;</span><br><span class=\"line\">  reactCompiler: true,</span><br><span class=\"line\">  experimental: &#123;</span><br><span class=\"line\">      turbopackFileSystemCacheForDev: true</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default nextConfig;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import type &#123; NextConfig &#125; from &quot;next&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">const nextConfig: NextConfig = &#123;</span><br><span class=\"line\">  reactCompiler: true,</span><br><span class=\"line\">  experimental: &#123;</span><br><span class=\"line\">      turbopackFileSystemCacheForDev: true</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">export default nextConfig;</span><br></pre></td></tr></table></figure>\n\n<p>因為我對React沒有很熟悉，所以我問了一下ChatGpt。</p>\n<p>babel-plugin-react-compiler 能做的事</p>\n<ol>\n<li><p>自動最佳化 React 重新渲染</p>\n</li>\n<li><p>自動 memo 化 computation</p>\n</li>\n<li><p>減少 performance bug</p>\n</li>\n<li><p>用更少的 hooks 寫法就能達到最佳性能</p>\n</li>\n<li><p>讓 React 程式碼更簡潔、效果更穩定</p>\n</li>\n<li><p>未來會成為 React 的標準性能工具（官方推薦）</p>\n</li>\n</ol>\n<h2 id=\"Router\"><a href=\"#Router\" class=\"headerlink\" title=\"Router\"></a>Router</h2><p><img src=\"/images/image-10.png\"></p>\n<p>你會看到一個layout.tsk，可以想成是一個網站的佈局，像是header跟footer可以先放好位置，這樣每一個頁面就不必再重複渲染，然後{children}是每一個頁面的進入點，這邊舉個例子像這樣：</p>\n<p><img src=\"/images/%E6%9C%AA%E5%91%BD%E5%90%8D-2-1021x1024.png\"></p>\n<p>Page是你的網站首頁的內容，一進去會先吃到app&#x2F;page.tsx然後傳到layout.tsx裡面的{children}這裡。</p>\n<p>以剛剛的例子：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// app/page.tsx</span><br><span class=\"line\">import Hello from &quot;@/components/hello&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main&gt;</span><br><span class=\"line\">            &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">            &lt;Hello /&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// app/page.tsx</span><br><span class=\"line\">import Hello from &quot;@/components/hello&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">const Home = () =&gt; &#123;</span><br><span class=\"line\">    console.log(&quot;我會在伺服器端執行還是客戶端執行？&quot;);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main&gt;</span><br><span class=\"line\">            &lt;div className=&quot;text-5xl&quot;&gt;Welcome to Next.js!&lt;/div&gt;</span><br><span class=\"line\">            &lt;Hello /&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Home</span><br></pre></td></tr></table></figure>\n\n<p>觀察一下瀏覽器的 Elements，已經把app&#x2F;page.tsx的內容傳到{children}並顯示。</p>\n<p><img src=\"/images/CleanShot-2025-11-26-at-22.18.53-1024x667.png\"></p>\n<blockquote>\n<p>補充：Components不能放在app&#x2F;資料夾內，app是放Page的地方。</p>\n</blockquote>\n<h3 id=\"新增一個-Route\"><a href=\"#新增一個-Route\" class=\"headerlink\" title=\"新增一個 Route\"></a>新增一個 Route</h3><p>直接在app&#x2F;建立一個資料夾，這邊建立一個about資料夾，跟一個page.tsx。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app/about/page.tsx</span><br><span class=\"line\">const Page = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Page&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Page</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app/about/page.tsx</span><br><span class=\"line\">const Page = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Page&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Page</span><br></pre></td></tr></table></figure>\n\n<p>只要在你的網頁打&#x2F;about路由就會看到Page了。這個在Next.js叫做Filebased routing system。</p>\n<p>以下是官方文件的Route示意圖：</p>\n<p><img src=\"/images/image-14-1024x336.png\"></p>\n<h3 id=\"Nested-Routes-巢狀路由\"><a href=\"#Nested-Routes-巢狀路由\" class=\"headerlink\" title=\"Nested Routes 巢狀路由\"></a>Nested Routes 巢狀路由</h3><p>我建立了一個dashboard，並在dashboard在建立兩個資料夾分別是analytics跟users。</p>\n<p><img src=\"/images/image-15.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// analytics/page.tsx</span><br><span class=\"line\">const Analytics = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Analytics&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Analytics</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// analytics/page.tsx</span><br><span class=\"line\">const Analytics = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Analytics&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Analytics</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/page.tsx</span><br><span class=\"line\">const Users = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Users&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Users</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/page.tsx</span><br><span class=\"line\">const Users = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;Users&lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Users</span><br></pre></td></tr></table></figure>\n\n<p>進到 <a href=\"http://localhost:3000/dashboard/analytics\">http://localhost:3000/dashboard/analytics</a> 就可以看到 Analytics</p>\n<p><img src=\"/images/CleanShot-2025-11-27-at-10.34.45-1024x657.png\"></p>\n<p>進到 <a href=\"http://localhost:3000/dashboard/users\">http://localhost:3000/dashboard/users</a> 就可以看到 Users</p>\n<p><img src=\"/images/CleanShot-2025-11-27-at-10.33.25-1024x657.png\"></p>\n<p>那我們可能會有很多User，每個User都要有自己的Dashboard介面。</p>\n<p>因此先在users底下建立一個[id]資料夾，他可以根據你傳進來的params，對應到不同Users的頁面資料。</p>\n<p><img src=\"/images/image-17.png\"></p>\n<p>將每個User外面包一個Link，對應到不同的使用者。將參數傳送到users&#x2F;[id]。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/page.tsx</span><br><span class=\"line\">import Link from &quot;next/link&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">const Users = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;h1&gt;Dashboard Users&lt;/h1&gt;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">            &lt;ul className=&quot;mt-10&quot;&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/1&quot;&gt;User 1&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/2&quot;&gt;User 2&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/3&quot;&gt;User 3&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/4&quot;&gt;User 4&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">            &lt;/ul&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Users</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/page.tsx</span><br><span class=\"line\">import Link from &quot;next/link&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">const Users = () =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;h1&gt;Dashboard Users&lt;/h1&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;ul className=&quot;mt-10&quot;&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/1&quot;&gt;User 1&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/2&quot;&gt;User 2&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/3&quot;&gt;User 3&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">                &lt;li&gt;&lt;Link href=&quot;/dashboard/users/4&quot;&gt;User 4&lt;/Link&gt;&lt;/li&gt;</span><br><span class=\"line\">            &lt;/ul&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Users</span><br></pre></td></tr></table></figure>\n\n<p>收到了點擊Link之後傳過來的參數，並顯示使用者id。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/[id]/page.tsx</span><br><span class=\"line\">const UserDetails = async (&#123; params &#125; : &#123; params: Promise&lt;&#123; id: string &#125;&gt; &#125;) =&gt; &#123;</span><br><span class=\"line\">    const &#123; id &#125; = await params;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;h1&gt;User Details for User &#123;id&#125;&lt;/h1&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default UserDetails</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// users/[id]/page.tsx</span><br><span class=\"line\">const UserDetails = async (&#123; params &#125; : &#123; params: Promise&lt;&#123; id: string &#125;&gt; &#125;) =&gt; &#123;</span><br><span class=\"line\">    const &#123; id &#125; = await params;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;h1&gt;User Details for User &#123;id&#125;&lt;/h1&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default UserDetails</span><br></pre></td></tr></table></figure>\n\n<p>這邊我在學的時候第一次看到{params}這種語法，其實是簡化了以下的程式碼：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const UserDetails = async (props) =&gt; &#123;</span><br><span class=\"line\">    const params = props.params;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const UserDetails = async (props) =&gt; &#123;</span><br><span class=\"line\">    const params = props.params;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>補充：在 JavaScript 中，所有非同步行為（例如 fetch、資料庫、計時器）最後得到的都是 Promise 才會使用到async、await。這裡的 id其實還不需要用到 await 因為傳來的資料是同步的如下：</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; id: &quot;1&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;2&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;3&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;4&quot; &#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; id: &quot;1&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;2&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;3&quot; &#125;</span><br><span class=\"line\">or</span><br><span class=\"line\">&#123; id: &quot;4&quot; &#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/CleanShot-2025-11-27-at-12.47.38-1024x664.png\"></p>\n<h2 id=\"Layout-版面設定\"><a href=\"#Layout-版面設定\" class=\"headerlink\" title=\"Layout 版面設定\"></a>Layout 版面設定</h2><blockquote>\n<p>請注意！必須使用 layout.tsx 這個檔案名稱，否則 next.js會認不出來。</p>\n</blockquote>\n<p>我在app&#x2F;dashboard底下新增layout.tsx</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Layout = (&#123; children &#125; : &#123; children: React.ReactNode&#125;) =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;div&gt;Dashboard Navbar&lt;/div&gt;</span><br><span class=\"line\">            &#123;children&#125;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Layout;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Layout = (&#123; children &#125; : &#123; children: React.ReactNode&#125;) =&gt; &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;</span><br><span class=\"line\">            &lt;div&gt;Dashboard Navbar&lt;/div&gt;</span><br><span class=\"line\">            &#123;children&#125;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Layout;</span><br></pre></td></tr></table></figure>\n\n<p>{ children } : { children: React.ReactNode} 的意思是：</p>\n<p>這個 component 的 props 有一個 children，而它的型別是 React.ReactNode</p>\n<p>React.ReactNode &#x3D; 可以被 React 放在畫面上的東西</p>\n<p>完整的說就是從 props 拿出 children，並且保證它是 React 可渲染的內容。</p>\n<h2 id=\"Route-Groups\"><a href=\"#Route-Groups\" class=\"headerlink\" title=\"Route Groups\"></a>Route Groups</h2><p>Route Groups 讓你能夠建立資料夾而且不會影響到 URL。</p>\n<p>如果你想要建立一個Layout.tsx，但是不想要當成一個路由，可以使用(admin)，這種括號的方式包起來。</p>\n<p><img src=\"/images/image\" alt=\"An example folder structure using route groups\"></p>\n<p>以我的資料夾來看：</p>\n<p>首頁 <a href=\"http://localhost:3000/\">http://localhost:3000</a> 會吃到 (root) 底下的page.tsx。</p>\n<p>about的話也是會忽略(root)資料夾，指向 <a href=\"http://localhost:3000/about\">http://localhost:3000/about</a></p>\n<p>dashboard也是相同的道理，外層(dashboard)不會吃，會吃內層的dashboard資料夾。</p>\n<p><img src=\"/images/CleanShot-2025-11-27-at-22.47.08-1024x588.png\"></p>\n<p>我們可以分別在(dashboard)跟(root)設定不同的layout。並且把最外部原來的page.tsx移動到(root)。</p>\n<p>但是要注意，使用括號()的資料夾底下，只能在其中一個保留page.tsx，否則會出現以下錯誤。</p>\n<p><img src=\"/images/CleanShot-2025-11-27-at-22.43.19-1024x670.png\"></p>\n<h2 id=\"Error-Handling-錯誤處理\"><a href=\"#Error-Handling-錯誤處理\" class=\"headerlink\" title=\"Error Handling 錯誤處理\"></a>Error Handling 錯誤處理</h2><p>當 Server Component 或 route segment 渲染失敗時，Next.js 會顯示你寫在 error.tsx 的 UI。</p>\n<p>而不是預設簡陋的錯誤頁。像是我在about的page寫一個Error，並在about底下建立一個error.tsx。</p>\n<p>並進入到about頁面觀察。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// about/error.tsx</span><br><span class=\"line\">&#x27;use client&#x27; // Error boundaries must be Client Components</span><br><span class=\"line\"> </span><br><span class=\"line\">import &#123; useEffect &#125; from &#x27;react&#x27;</span><br><span class=\"line\"> </span><br><span class=\"line\">export default function Error(&#123;</span><br><span class=\"line\">  error,</span><br><span class=\"line\">  reset,</span><br><span class=\"line\">&#125;: &#123;</span><br><span class=\"line\">  error: Error &amp; &#123; digest?: string &#125;</span><br><span class=\"line\">  reset: () =&gt; void</span><br><span class=\"line\">&#125;) &#123;</span><br><span class=\"line\">  useEffect(() =&gt; &#123;</span><br><span class=\"line\">    // Log the error to an error reporting service</span><br><span class=\"line\">    console.error(error)</span><br><span class=\"line\">  &#125;, [error])</span><br><span class=\"line\"> </span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;h2&gt;Something went wrong!&lt;/h2&gt;</span><br><span class=\"line\">      &lt;button</span><br><span class=\"line\">        onClick=&#123;</span><br><span class=\"line\">          // Attempt to recover by trying to re-render the segment</span><br><span class=\"line\">          () =&gt; reset()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">        Try again</span><br><span class=\"line\">      &lt;/button&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// about/error.tsx</span><br><span class=\"line\">&#x27;use client&#x27; // Error boundaries must be Client Components</span><br><span class=\"line\"> </span><br><span class=\"line\">import &#123; useEffect &#125; from &#x27;react&#x27;</span><br><span class=\"line\"> </span><br><span class=\"line\">export default function Error(&#123;</span><br><span class=\"line\">  error,</span><br><span class=\"line\">  reset,</span><br><span class=\"line\">&#125;: &#123;</span><br><span class=\"line\">  error: Error &amp; &#123; digest?: string &#125;</span><br><span class=\"line\">  reset: () =&gt; void</span><br><span class=\"line\">&#125;) &#123;</span><br><span class=\"line\">  useEffect(() =&gt; &#123;</span><br><span class=\"line\">    // Log the error to an error reporting service</span><br><span class=\"line\">    console.error(error)</span><br><span class=\"line\">  &#125;, [error])</span><br><span class=\"line\"> </span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;h2&gt;Something went wrong!&lt;/h2&gt;</span><br><span class=\"line\">      &lt;button</span><br><span class=\"line\">        onClick=&#123;</span><br><span class=\"line\">          // Attempt to recover by trying to re-render the segment</span><br><span class=\"line\">          () =&gt; reset()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">        Try again</span><br><span class=\"line\">      &lt;/button&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/CleanShot-2025-11-28-at-10.25.54-1024x578.png\"></p>\n<p>可以看到在畫面有顯示文字，同時也可以在console中看到錯誤。</p>\n<blockquote>\n<p>Console只在「開發模式（npm run dev）」才會出現</p>\n<p>所以return的部分顯示在前端，useEffect的部分是顯示在後端。</p>\n</blockquote>\n<p><img src=\"/images/CleanShot-2025-11-28-at-10.28.43-1024x670.png\"></p>\n<p>預設的狀態只能看到簡陋的一些文字，無法讓使用者了解目前的狀態。</p>\n<p>有了error.tsx，可以呈現一些相關的錯誤訊息給使用者，讓使用者知道目前網站的狀態。</p>\n<p>不用擔心重要的資訊外露，因為在client端不會顯示重要訊息，我是把它想成美化error頁面。</p>\n<p><img src=\"/images/CleanShot-2025-11-28-at-10.33.17-1024x670.png\"></p>\n<h2 id=\"Loading-UI-載入畫面\"><a href=\"#Loading-UI-載入畫面\" class=\"headerlink\" title=\"Loading UI 載入畫面\"></a>Loading UI 載入畫面</h2><p>在Next.js改如何使用Loading的效果呢？</p>\n<p>以下是一個抓取api等待時間的loading效果展示。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Page = async () =&gt; &#123;</span><br><span class=\"line\">    const res = await fetch(&quot;https://jsonplaceholder.typicode.com/users/1&quot;);</span><br><span class=\"line\">    const user = await res.json();</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;        </span><br><span class=\"line\">             &lt;div&gt;&#123;user.name&#125;&lt;/div&gt;;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default Page</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const Page = async () =&gt; &#123;</span><br><span class=\"line\">    const res = await fetch(&quot;https://jsonplaceholder.typicode.com/users/1&quot;);</span><br><span class=\"line\">    const user = await res.json();</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div&gt;        </span><br><span class=\"line\">             &lt;div&gt;&#123;user.name&#125;&lt;/div&gt;;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Page</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/CleanShot-2025-11-28-at-12.17.25.gif\"></p>\n<p>只要在app&#x2F;底下建立一個loading.tsx，就會有Loading的效果，它的作用範圍是<strong>全站</strong>（global loading UI）。</p>\n<blockquote>\n<p>只要任何 page.tsx 或 layout.tsx 在 await 資料，<br>Next.js 就會顯示 &#x2F;app&#x2F;loading.tsx 作為「Loading 過渡畫面」。<br>子路由可以用自己的 loading.tsx 覆蓋上層的。</p>\n</blockquote>\n<h2 id=\"Data-Fetching-資料截取\"><a href=\"#Data-Fetching-資料截取\" class=\"headerlink\" title=\"Data Fetching 資料截取\"></a>Data Fetching 資料截取</h2><p>第一種方式是透過前端渲染畫面。</p>\n<p>但是不推薦，會有延遲，而且原始碼很空SEO效果不好。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;use client&quot;;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">import &#123; useState,useEffect &#125; from &#x27;react&#x27;;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">function album1() &#123;</span><br><span class=\"line\">    const [albums, setAlbums] = useState([]);</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    useEffect(() =&gt; &#123;</span><br><span class=\"line\">        const fetchAlbums = async () =&gt; &#123;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                const response = await fetch(&quot;https://jsonplaceholder.typicode.com/albums&quot;)</span><br><span class=\"line\">                const data = await response.json();</span><br><span class=\"line\">                setAlbums(data);</span><br><span class=\"line\">            &#125; catch (error) &#123;</span><br><span class=\"line\">                console.error(&quot;Error fetching albums:&quot;, error);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        fetchAlbums();</span><br><span class=\"line\">    &#125;, []);</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div className=&#x27;&#x27;&gt;</span><br><span class=\"line\">            &#123;albums.map((album: &#123;id: number; title: string&#125;) =&gt; (</span><br><span class=\"line\">                &lt;div key=&#123;album.id&#125; className=&#x27;&#x27;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;&#123;album.title&#125;&lt;/h3&gt;</span><br><span class=\"line\">                    &lt;p&gt;Album ID: &#123;album.id&#125;&lt;/p&gt;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            ))&#125;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default album1;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;use client&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">import &#123; useState,useEffect &#125; from &#x27;react&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">function album1() &#123;</span><br><span class=\"line\">    const [albums, setAlbums] = useState([]);</span><br><span class=\"line\"></span><br><span class=\"line\">    useEffect(() =&gt; &#123;</span><br><span class=\"line\">        const fetchAlbums = async () =&gt; &#123;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                const response = await fetch(&quot;https://jsonplaceholder.typicode.com/albums&quot;)</span><br><span class=\"line\">                const data = await response.json();</span><br><span class=\"line\">                setAlbums(data);</span><br><span class=\"line\">            &#125; catch (error) &#123;</span><br><span class=\"line\">                console.error(&quot;Error fetching albums:&quot;, error);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        fetchAlbums();</span><br><span class=\"line\">    &#125;, []);</span><br><span class=\"line\"></span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;div className=&#x27;&#x27;&gt;</span><br><span class=\"line\">            &#123;albums.map((album: &#123;id: number; title: string&#125;) =&gt; (</span><br><span class=\"line\">                &lt;div key=&#123;album.id&#125; className=&#x27;&#x27;&gt;</span><br><span class=\"line\">                    &lt;h3&gt;&#123;album.title&#125;&lt;/h3&gt;</span><br><span class=\"line\">                    &lt;p&gt;Album ID: &#123;album.id&#125;&lt;/p&gt;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            ))&#125;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default album1;</span><br></pre></td></tr></table></figure>\n\n<p>另一種方式是伺服器先跑完才放到前端，這種方式速度會更快，用更少的程式碼。</p>\n<blockquote>\n<p>本地開發npm run dev的時候會有Server Components HMR快取，代表會有更快的回應速度，減少呼叫api的次數。</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">async function AlbumsPage() &#123;</span><br><span class=\"line\">    const response = await fetch(&quot;https://jsonplaceholder.typicode.com/albums&quot;);</span><br><span class=\"line\">    if (!response.ok) throw new Error(&quot;Failed to fetch data&quot;);</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    const albums = await response.json();</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main className=&quot;min-h-screen bg-slate-50 py-8&quot;&gt;</span><br><span class=\"line\">            &lt;div className=&quot;max-w-4xl mx-auto px-4&quot;&gt;</span><br><span class=\"line\">                &lt;h1 className=&quot;text-2xl font-semibold text-slate-900 mb-6&quot;&gt;</span><br><span class=\"line\">                    Albums</span><br><span class=\"line\">                &lt;/h1&gt;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">                &lt;div className=&quot;grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4&quot;&gt;</span><br><span class=\"line\">                    &#123;albums.map((album: &#123; id: number; title: string &#125;) =&gt; (</span><br><span class=\"line\">                        &lt;div</span><br><span class=\"line\">                            key=&#123;album.id&#125;</span><br><span class=\"line\">                            className=&quot;bg-white rounded-lg border border-slate-200 p-4 shadow-sm </span><br><span class=\"line\">                                       hover:shadow-md hover:-translate-y-0.5 </span><br><span class=\"line\">                                       transition-transform transition-shadow duration-150&quot;</span><br><span class=\"line\">                        &gt;</span><br><span class=\"line\">                            &lt;h3 className=&quot;text-base font-semibold text-slate-900 mb-1&quot;&gt;</span><br><span class=\"line\">                                &#123;album.title&#125;</span><br><span class=\"line\">                            &lt;/h3&gt;</span><br><span class=\"line\">                            &lt;p className=&quot;text-xs text-slate-500&quot;&gt;</span><br><span class=\"line\">                                ID: &#123;album.id&#125;</span><br><span class=\"line\">                            &lt;/p&gt;</span><br><span class=\"line\">                        &lt;/div&gt;</span><br><span class=\"line\">                    ))&#125;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            &lt;/div&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">export default AlbumsPage;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">async function AlbumsPage() &#123;</span><br><span class=\"line\">    const response = await fetch(&quot;https://jsonplaceholder.typicode.com/albums&quot;);</span><br><span class=\"line\">    if (!response.ok) throw new Error(&quot;Failed to fetch data&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    const albums = await response.json();</span><br><span class=\"line\"></span><br><span class=\"line\">    return (</span><br><span class=\"line\">        &lt;main className=&quot;min-h-screen bg-slate-50 py-8&quot;&gt;</span><br><span class=\"line\">            &lt;div className=&quot;max-w-4xl mx-auto px-4&quot;&gt;</span><br><span class=\"line\">                &lt;h1 className=&quot;text-2xl font-semibold text-slate-900 mb-6&quot;&gt;</span><br><span class=\"line\">                    Albums</span><br><span class=\"line\">                &lt;/h1&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                &lt;div className=&quot;grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4&quot;&gt;</span><br><span class=\"line\">                    &#123;albums.map((album: &#123; id: number; title: string &#125;) =&gt; (</span><br><span class=\"line\">                        &lt;div</span><br><span class=\"line\">                            key=&#123;album.id&#125;</span><br><span class=\"line\">                            className=&quot;bg-white rounded-lg border border-slate-200 p-4 shadow-sm </span><br><span class=\"line\">                                       hover:shadow-md hover:-translate-y-0.5 </span><br><span class=\"line\">                                       transition-transform transition-shadow duration-150&quot;</span><br><span class=\"line\">                        &gt;</span><br><span class=\"line\">                            &lt;h3 className=&quot;text-base font-semibold text-slate-900 mb-1&quot;&gt;</span><br><span class=\"line\">                                &#123;album.title&#125;</span><br><span class=\"line\">                            &lt;/h3&gt;</span><br><span class=\"line\">                            &lt;p className=&quot;text-xs text-slate-500&quot;&gt;</span><br><span class=\"line\">                                ID: &#123;album.id&#125;</span><br><span class=\"line\">                            &lt;/p&gt;</span><br><span class=\"line\">                        &lt;/div&gt;</span><br><span class=\"line\">                    ))&#125;</span><br><span class=\"line\">                &lt;/div&gt;</span><br><span class=\"line\">            &lt;/div&gt;</span><br><span class=\"line\">        &lt;/main&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default AlbumsPage;</span><br></pre></td></tr></table></figure>\n\n<p>回到伺服器端跟客戶端之間的差別，伺服器端的方式有更多好處，像是載入的時間比較快，FCP表現更好。</p>\n<p><img src=\"/images/good-fcp-values-18.svg\" alt=\"良好的 FCP 值為 1.8 秒或更短，不良的值為 3.0 秒以上，介於兩者之間的值則需要改善\"></p>\n<p>也因為在server就先載入好，所以在瀏覽器可以查看到所有原始碼SEO相對也會比較好。</p>\n<p><img src=\"/images/image-18.png\"></p>\n<blockquote>\n<p>參考 <a href=\"https://www.youtube.com/@javascriptmastery\">JavaScript Mastery</a> 的教學影片 <a href=\"https://www.youtube.com/watch?v=I1V9YWqRIeI&t=1540s\">https://www.youtube.com/watch?v=I1V9YWqRIeI&t=1540s</a></p>\n</blockquote>\n"},{"layout":"post","title":"Android LocationApp","date":"2025-10-16T16:00:00.000Z","top_img":"/images/LocationApp.png","cover":"/images/LocationApp.png","_content":"\n這是一個練習定位權限的App，我將重要的部分記錄下來。\n\n```\n<uses-permission android:name=\"android.permission.INTERNET\" />\n<uses-permission android:name=\"android.permission.ACCESS_COARSE_LOCATION\" />\n<uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\n```\n\n```\n<uses-permission android:name=\"android.permission.INTERNET\" />\n<uses-permission android:name=\"android.permission.ACCESS_COARSE_LOCATION\" />\n<uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\n```\n\n- android.permission.INTERNET : 允許應用程式開啟**網路連線**\n\n- android.permission.ACCESS\\_COARSE\\_LOCATION : 允許應用程式存取使用**粗略的位置**\n\n- android.permission.ACCESS\\_FINE\\_LOCATION : 允許應用程式存取使用**精確的位置**\n\n## LocationUtils.kt\n\nhasLocationPermission function 回傳一個 `Boolean`→ `true` 或 `false`，代表有沒有定位權限。\n\n```\nclass LocationUtils(val context: Context) {\n    private val _fusedLocationClient: FusedLocationProviderClient =\n        LocationServices.getFusedLocationProviderClient(context)\n<div></div>\n    @SuppressLint(\"MissingPermission\")\n    fun requestLocationUpdates(viewModel: LocationViewModel) {\n        val locationCallback = object : LocationCallback() {\n            override fun onLocationResult(locationResult: LocationResult) {\n                super.onLocationResult(locationResult)\n                locationResult.lastLocation?.let {\n                    val location = LocationData(latitude = it.latitude, longitude = it.longitude)\n                    viewModel.updateLocation(location)\n                }\n            }\n        }\n        val locationRequest = LocationRequest.Builder(\n            Priority.PRIORITY_HIGH_ACCURACY, 1000\n        ).build()\n        _fusedLocationClient.requestLocationUpdates(\n            locationRequest,\n            locationCallback,\n            Looper.getMainLooper()\n        )\n    }\n<div></div>\n    fun hasLocationPermission(context: Context): Boolean {\n        return ContextCompat.checkSelfPermission(\n            context,\n            Manifest.permission.ACCESS_FINE_LOCATION\n        ) == PackageManager.PERMISSION_GRANTED\n                &&\n                ContextCompat.checkSelfPermission(\n                    context,\n                    Manifest.permission.ACCESS_COARSE_LOCATION\n                ) == PackageManager.PERMISSION_GRANTED\n    }\n<div></div>\n    fun reverseGeocodeLocation(location: LocationData): String {\n        // The Geocoder constructor expects a java.util.Locale\n        val geocoder = Geocoder(context, Locale.getDefault())\n        val coordinate = LatLng(location.latitude, location.longitude)\n        val addresses: MutableList<Address>? =\n            geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)\n<div></div>\n        return if (addresses?.isNotEmpty() == true) {\n            addresses[0]?.getAddressLine(0) ?: \"Address line not found\"\n        } else {\n            \"Address not found\"\n        }\n    }\n}\n```\n\n```\nclass LocationUtils(val context: Context) {\n    private val _fusedLocationClient: FusedLocationProviderClient =\n        LocationServices.getFusedLocationProviderClient(context)\n\n    @SuppressLint(\"MissingPermission\")\n    fun requestLocationUpdates(viewModel: LocationViewModel) {\n        val locationCallback = object : LocationCallback() {\n            override fun onLocationResult(locationResult: LocationResult) {\n                super.onLocationResult(locationResult)\n                locationResult.lastLocation?.let {\n                    val location = LocationData(latitude = it.latitude, longitude = it.longitude)\n                    viewModel.updateLocation(location)\n                }\n            }\n        }\n        val locationRequest = LocationRequest.Builder(\n            Priority.PRIORITY_HIGH_ACCURACY, 1000\n        ).build()\n        _fusedLocationClient.requestLocationUpdates(\n            locationRequest,\n            locationCallback,\n            Looper.getMainLooper()\n        )\n    }\n\n    fun hasLocationPermission(context: Context): Boolean {\n        return ContextCompat.checkSelfPermission(\n            context,\n            Manifest.permission.ACCESS_FINE_LOCATION\n        ) == PackageManager.PERMISSION_GRANTED\n                &&\n                ContextCompat.checkSelfPermission(\n                    context,\n                    Manifest.permission.ACCESS_COARSE_LOCATION\n                ) == PackageManager.PERMISSION_GRANTED\n    }\n\n    fun reverseGeocodeLocation(location: LocationData): String {\n        // The Geocoder constructor expects a java.util.Locale\n        val geocoder = Geocoder(context, Locale.getDefault())\n        val coordinate = LatLng(location.latitude, location.longitude)\n        val addresses: MutableList<Address>? =\n            geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)\n\n        return if (addresses?.isNotEmpty() == true) {\n            addresses[0]?.getAddressLine(0) ?: \"Address line not found\"\n        } else {\n            \"Address not found\"\n        }\n    }\n}\n```\n\n```\nprivate val _fusedLocationClient: FusedLocationProviderClient =\n    LocationServices.getFusedLocationProviderClient(context)\n```\n\n```\nprivate val _fusedLocationClient: FusedLocationProviderClient =\n    LocationServices.getFusedLocationProviderClient(context)\n```\n\n這是 Google 提供的 **Fused Location Provider API**，能整合 GPS、Wi-Fi、藍牙與行動網路的定位來源，讓定位更準確且省電。`_fusedLocationClient` 用來執行「請求位置更新」、「停止更新」、「取得最後位置」等操作。\n\n### requestLocationUpdates\n\n```\n@SuppressLint(\"MissingPermission\")\nfun requestLocationUpdates(viewModel: LocationViewModel) {\n```\n\n```\n@SuppressLint(\"MissingPermission\")\nfun requestLocationUpdates(viewModel: LocationViewModel) {\n```\n\n⚠️ 注意：這裡用了 `@SuppressLint(\"MissingPermission\")`，代表你**必須在呼叫這個函式前，確認已取得權限**（也就是前面 `LocationDisplay` 檢查的部分）。\n\n意思是保證外層一定會先檢查 hasLocationPermission() 才會進來，所以不用再提醒我 MissingPermission。\n\n這個函式會**每秒更新一次位置**（因為下面設定了 1000 毫秒），然後將新位置傳給你的 `LocationViewModel`。\n\n```\nval locationCallback = object : LocationCallback() {\n    override fun onLocationResult(locationResult: LocationResult) {\n        super.onLocationResult(locationResult)\n        locationResult.lastLocation?.let {\n            val location = LocationData(latitude = it.latitude, longitude = it.longitude)\n            viewModel.updateLocation(location)\n        }\n    }\n}\n```\n\n```\nval locationCallback = object : LocationCallback() {\n    override fun onLocationResult(locationResult: LocationResult) {\n        super.onLocationResult(locationResult)\n        locationResult.lastLocation?.let {\n            val location = LocationData(latitude = it.latitude, longitude = it.longitude)\n            viewModel.updateLocation(location)\n        }\n    }\n}\n```\n\n當系統取得新的定位資訊時，會呼叫 `onLocationResult`。\n\n`lastLocation` 是最新的 `Location` 物件（包含緯度與經度）。\n\n```\npackage com.example.locationapp\n<div></div>\ndata class LocationData(\n    val latitude: Double,\n    val longitude: Double\n)\n```\n\n```\npackage com.example.locationapp\n\ndata class LocationData(\n    val latitude: Double,\n    val longitude: Double\n)\n```\n\n`LocationData` 是我們定義的資料類別，用來包裝座標。\n\n呼叫 `viewModel.updateLocation(location)` → 把資料傳給 ViewModel 更新 UI。\n\n```\n_fusedLocationClient.requestLocationUpdates(\n    locationRequest,\n    locationCallback,\n    Looper.getMainLooper()\n)\n```\n\n```\n_fusedLocationClient.requestLocationUpdates(\n    locationRequest,\n    locationCallback,\n    Looper.getMainLooper()\n)\n```\n\n這行讓 app 持續監聽位置變化。\n\n### hasLocationPermission\n\n`LocationUtils` 要持有 `Context`，才能呼叫系統 API（如 `ContextCompat.checkSelfPermission`）來檢查權限。\n\nreturn 這段是重點：`ContextCompat.checkSelfPermission()` 是Android官方提供的工具，用來檢查 App 是否擁有某個權限。它會回傳一個整數值（`PERMISSION_GRANTED` 或 `PERMISSION_DENIED`）。\n\n這段程式碼的功能就像是你在檢查一個房間的門：\n\n> 「門有沒有上鎖？如果鎖是開著的，就代表我可以進去。」\n> \n> **`ContextCompat` (檢查員)：** 你可以把它想像成 Android 系統中的一位**通用檢查員**或**萬用工具箱**。它的工作就是確保你的程式碼在所有不同型號和版本的 Android 手機上都能正常運作（這就是 `Compat` 兼容性的意思）。\n> \n> **`.checkSelfPermission()` (檢查方法)：** 這是檢查員專門用來**檢查特定權限狀態**的方法。\n> \n> - **參數一 (`context`)：** 告訴檢查員「在哪個應用程式環境」下進行檢查。\n> \n> - **參數二 (`Manifest.permission.ACCESS_FINE_LOCATION`)：** 告訴檢查員「要檢查哪一種權限」。\n\n### 為什麼需要 `ContextCompat.checkSelfPermission()`？\n\n我們不直接使用 `PackageManager.PERMISSION_GRANTED` 進行判斷，是因為 **`PackageManager.PERMISSION_GRANTED` 只是一個「結果代碼」（密碼）**，而 **`ContextCompat.checkSelfPermission()` 才是「執行檢查的動作」**。\n\n### reverseGeocodeLocation\n\n```\nfun reverseGeocodeLocation(location: LocationData): String {\n    val geocoder = Geocoder(context, Locale.getDefault())\n    val coordinate = LatLng(location.latitude, location.longitude)\n    val addresses: MutableList<Address>? =\n        geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)\n```\n\n```\nfun reverseGeocodeLocation(location: LocationData): String {\n    val geocoder = Geocoder(context, Locale.getDefault())\n    val coordinate = LatLng(location.latitude, location.longitude)\n    val addresses: MutableList<Address>? =\n        geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)\n```\n\n用 `Geocoder` 根據經緯度查詢地點名稱。`getFromLocation()` 會回傳一個地址列表（可能含國家、城市、街道）。\n\n## MainActivity.kt\n\n```\n@Composable\nfun MyApp(modifier: Modifier) {\n    val context = LocalContext.current\n    val locationUtils = LocationUtils(context)\n    LocationDisplay(locationUtils = locationUtils, context = context)\n}\n```\n\n```\n@Composable\nfun MyApp(modifier: Modifier) {\n    val context = LocalContext.current\n    val locationUtils = LocationUtils(context)\n    LocationDisplay(locationUtils = locationUtils, context = context)\n}\n```\n\n```\nclass MainActivity : ComponentActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        enableEdgeToEdge()\n        setContent {\n            val viewModel: LocationViewModel = viewModel()\n            LocationAppTheme {\n                Scaffold(modifier = Modifier.fillMaxSize()) { innerPadding ->\n                    MyApp(viewModel = viewModel,modifier = Modifier.padding(innerPadding))\n                }\n            }\n        }\n    }\n}\n```\n\n```\nclass MainActivity : ComponentActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        enableEdgeToEdge()\n        setContent {\n            val viewModel: LocationViewModel = viewModel()\n            LocationAppTheme {\n                Scaffold(modifier = Modifier.fillMaxSize()) { innerPadding ->\n                    MyApp(viewModel = viewModel,modifier = Modifier.padding(innerPadding))\n                }\n            }\n        }\n    }\n}\n```\n\n**`Context`：** 是一個核心的 Android 系統類別，它提供了應用程式全域資訊，例如資源、資料庫、文件系統路徑，以及存取系統服務（如定位服務）的管道。\n\n**`LocalContext.current`：** 這是 Jetpack Compose 框架提供的一個 **CompositionLocal**。它用於在可組合函數中**存取** Android 應用程式的 **`Context`** 物件。\n\n`LocationDisplay(locationUtils = locationUtils, context = context)` 這行程式碼的作用是**調用**一個名為 `LocationDisplay` 的 **Compose UI 元件**，向它傳遞所需的資料和環境依賴。\n\n```\n@Composable\nfun LocationDisplay(\n    locationUtils: LocationUtils,\n    viewModel: LocationViewModel,\n    context: Context\n) {\n    val location = viewModel.location.value\n    \n    val address = location?.let {\n        locationUtils.reverseGeocodeLocation(location)\n    }\n<div></div>\n    val requestPermissionLauncher = rememberLauncherForActivityResult(\n        contract = ActivityResultContracts.RequestMultiplePermissions(),\n        onResult = { permissions ->\n            if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true\n                && permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true\n            ) {\n                // 擁有 location 權限\n                locationUtils.requestLocationUpdates(viewModel = viewModel)\n<div></div>\n            } else {\n                // 要求權限\n                val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(\n                    context as MainActivity,\n                    Manifest.permission.ACCESS_FINE_LOCATION\n                ) || ActivityCompat.shouldShowRequestPermissionRationale(\n                    context as MainActivity,\n                    Manifest.permission.ACCESS_COARSE_LOCATION\n                )\n<div></div>\n                if (rationaleRequired) {\n                    Toast.makeText(\n                        context,\n                        \"Location Permission is required for this feature to work\",\n                        Toast.LENGTH_LONG\n                    ).show()\n                } else {\n                    Toast.makeText(\n                        context,\n                        \"Location Permission is required, Please enable from settings\",\n                        Toast.LENGTH_LONG\n                    ).show()\n                }\n            }\n        }\n    )\n<div></div>\n    Column(\n        modifier = Modifier.fillMaxSize(),\n        horizontalAlignment = Alignment.CenterHorizontally,\n        verticalArrangement = Arrangement.Center\n    ) {\n        if(location != null) {\n            Text(\"Address: ${location.latitude} ${location.longitude} \\n $address \")\n        }\n        Text(text = \"Location not available\")\n<div></div>\n        Button(onClick = {\n            if (locationUtils.hasLocationPermission(context)) {\n                locationUtils.requestLocationUpdates(viewModel)\n            } else {\n                requestPermissionLauncher.launch(\n                    arrayOf(\n                        Manifest.permission.ACCESS_FINE_LOCATION,\n                        Manifest.permission.ACCESS_COARSE_LOCATION\n                    )\n                )\n            }\n        }) {\n            Text(text = \"Get Location\")\n        }\n    }\n}\n```\n\n```\n@Composable\nfun LocationDisplay(\n    locationUtils: LocationUtils,\n    viewModel: LocationViewModel,\n    context: Context\n) {\n    val location = viewModel.location.value\n    \n    val address = location?.let {\n        locationUtils.reverseGeocodeLocation(location)\n    }\n\n    val requestPermissionLauncher = rememberLauncherForActivityResult(\n        contract = ActivityResultContracts.RequestMultiplePermissions(),\n        onResult = { permissions ->\n            if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true\n                && permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true\n            ) {\n                // 擁有 location 權限\n                locationUtils.requestLocationUpdates(viewModel = viewModel)\n\n            } else {\n                // 要求權限\n                val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(\n                    context as MainActivity,\n                    Manifest.permission.ACCESS_FINE_LOCATION\n                ) || ActivityCompat.shouldShowRequestPermissionRationale(\n                    context as MainActivity,\n                    Manifest.permission.ACCESS_COARSE_LOCATION\n                )\n\n                if (rationaleRequired) {\n                    Toast.makeText(\n                        context,\n                        \"Location Permission is required for this feature to work\",\n                        Toast.LENGTH_LONG\n                    ).show()\n                } else {\n                    Toast.makeText(\n                        context,\n                        \"Location Permission is required, Please enable from settings\",\n                        Toast.LENGTH_LONG\n                    ).show()\n                }\n            }\n        }\n    )\n\n    Column(\n        modifier = Modifier.fillMaxSize(),\n        horizontalAlignment = Alignment.CenterHorizontally,\n        verticalArrangement = Arrangement.Center\n    ) {\n        if(location != null) {\n            Text(\"Address: ${location.latitude} ${location.longitude} \\n $address \")\n        }\n        Text(text = \"Location not available\")\n\n        Button(onClick = {\n            if (locationUtils.hasLocationPermission(context)) {\n                locationUtils.requestLocationUpdates(viewModel)\n            } else {\n                requestPermissionLauncher.launch(\n                    arrayOf(\n                        Manifest.permission.ACCESS_FINE_LOCATION,\n                        Manifest.permission.ACCESS_COARSE_LOCATION\n                    )\n                )\n            }\n        }) {\n            Text(text = \"Get Location\")\n        }\n    }\n}\n```\n\n主要公能：顯示一個文字 + 按鈕，並處理按下按鈕後檢查或請求定位權限。\n\ncontract = ActivityResultContracts.RequestMultiplePermissions()\n\n表示這個 launcher 可以一次請求多個權限（這裡是 coarse + fine）。\n\n`onResult = { permissions -> ... }`\n\n系統對話框關閉後，會回傳使用者是否授權。\n\n```\nif (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true\n    && permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true\n) {\n    // 已擁有定位權限\n} else {\n    // 尚未取得權限，顯示提示\n}\n```\n\n```\nif (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true\n    && permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true\n) {\n    // 已擁有定位權限\n} else {\n    // 尚未取得權限，顯示提示\n}\n```\n\n若兩個權限都有允許，目前就什麼都不做；否則，進入「沒有權限」的分支。\n\n如果沒權限 → 顯示提示 Toast\n\n```\nval rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(\n    context as MainActivity,\n    Manifest.permission.ACCESS_FINE_LOCATION\n) || ActivityCompat.shouldShowRequestPermissionRationale(\n    context as MainActivity,\n    Manifest.permission.ACCESS_COARSE_LOCATION\n)\n```\n\n```\nval rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(\n    context as MainActivity,\n    Manifest.permission.ACCESS_FINE_LOCATION\n) || ActivityCompat.shouldShowRequestPermissionRationale(\n    context as MainActivity,\n    Manifest.permission.ACCESS_COARSE_LOCATION\n)\n```\n\nshouldShowRequestPermissionRationale(…)\n\n這是 Android 的 API，用來判斷：\n\n- 使用者曾拒絕過權限（但沒勾「不再詢問」 → 回傳 `true`\n\n- 使用者勾了「不再詢問」或 第一次詢問 → 回傳 `false`\n\n```\nif (rationaleRequired) {\n    Toast.makeText(context, \"Location Permission is required for this feature to work\", Toast.LENGTH_LONG).show()\n} else {\n    Toast.makeText(context, \"Location Permission is required, Please enable from settings\", Toast.LENGTH_LONG).show()\n}\n```\n\n```\nif (rationaleRequired) {\n    Toast.makeText(context, \"Location Permission is required for this feature to work\", Toast.LENGTH_LONG).show()\n} else {\n    Toast.makeText(context, \"Location Permission is required, Please enable from settings\", Toast.LENGTH_LONG).show()\n}\n```\n\n![](/images/image-1.png)\n\n![](/images/image.png)\n\n![](/images/螢幕擷取畫面-2025-10-19-214356.png)\n\n## LocationViewModel.kt\n\n```\npackage com.example.locationapp\n<div></div>\nimport androidx.compose.runtime.State\nimport androidx.compose.runtime.mutableStateOf\nimport androidx.lifecycle.ViewModel\n<div></div>\nclass LocationViewModel: ViewModel() {\n    private val _location = mutableStateOf<LocationData?>(null)\n    val location: State<LocationData?> = _location\n<div></div>\n    fun updateLocation(newLocation: LocationData) {\n        _location.value = newLocation\n    }\n<div></div>\n}\n```\n\n```\npackage com.example.locationapp\n\nimport androidx.compose.runtime.State\nimport androidx.compose.runtime.mutableStateOf\nimport androidx.lifecycle.ViewModel\n\nclass LocationViewModel: ViewModel() {\n    private val _location = mutableStateOf<LocationData?>(null)\n    val location: State<LocationData?> = _location\n\n    fun updateLocation(newLocation: LocationData) {\n        _location.value = newLocation\n    }\n\n}\n```\n\n```\nprivate val _location = mutableStateOf<LocationData?>(null)\n```\n\n```\nprivate val _location = mutableStateOf<LocationData?>(null)\n```\n\nmutableStateOf 它包裝了一個變數，當值改變時，Compose UI 會**自動重新組合（recompose）**。\n\n`LocationData?` → 泛型裡面的 `?` 代表可以是 `null`，表示「可能還沒取得位置」。\n\n`_location` 是私有的可變，`location` 是公開的唯讀。\n\n```\nfun updateLocation(newLocation: LocationData) {\n    _location.value = newLocation\n}\n```\n\n```\nfun updateLocation(newLocation: LocationData) {\n    _location.value = newLocation\n}\n```\n\n當 `LocationUtils` 拿到新座標後，會呼叫updateLocation更新座標。\n","source":"_posts/android-locationapp.md","raw":"---\nlayout: post\ntitle: Android LocationApp\ndate: 2025-10-17\ntags:\n  - \"location-app\"\ncategories:\n  - \"android-app\"\n  - \"kotlin\"\ntop_img: /images/LocationApp.png\ncover: /images/LocationApp.png\n---\n\n這是一個練習定位權限的App，我將重要的部分記錄下來。\n\n```\n<uses-permission android:name=\"android.permission.INTERNET\" />\n<uses-permission android:name=\"android.permission.ACCESS_COARSE_LOCATION\" />\n<uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\n```\n\n```\n<uses-permission android:name=\"android.permission.INTERNET\" />\n<uses-permission android:name=\"android.permission.ACCESS_COARSE_LOCATION\" />\n<uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\n```\n\n- android.permission.INTERNET : 允許應用程式開啟**網路連線**\n\n- android.permission.ACCESS\\_COARSE\\_LOCATION : 允許應用程式存取使用**粗略的位置**\n\n- android.permission.ACCESS\\_FINE\\_LOCATION : 允許應用程式存取使用**精確的位置**\n\n## LocationUtils.kt\n\nhasLocationPermission function 回傳一個 `Boolean`→ `true` 或 `false`，代表有沒有定位權限。\n\n```\nclass LocationUtils(val context: Context) {\n    private val _fusedLocationClient: FusedLocationProviderClient =\n        LocationServices.getFusedLocationProviderClient(context)\n<div></div>\n    @SuppressLint(\"MissingPermission\")\n    fun requestLocationUpdates(viewModel: LocationViewModel) {\n        val locationCallback = object : LocationCallback() {\n            override fun onLocationResult(locationResult: LocationResult) {\n                super.onLocationResult(locationResult)\n                locationResult.lastLocation?.let {\n                    val location = LocationData(latitude = it.latitude, longitude = it.longitude)\n                    viewModel.updateLocation(location)\n                }\n            }\n        }\n        val locationRequest = LocationRequest.Builder(\n            Priority.PRIORITY_HIGH_ACCURACY, 1000\n        ).build()\n        _fusedLocationClient.requestLocationUpdates(\n            locationRequest,\n            locationCallback,\n            Looper.getMainLooper()\n        )\n    }\n<div></div>\n    fun hasLocationPermission(context: Context): Boolean {\n        return ContextCompat.checkSelfPermission(\n            context,\n            Manifest.permission.ACCESS_FINE_LOCATION\n        ) == PackageManager.PERMISSION_GRANTED\n                &&\n                ContextCompat.checkSelfPermission(\n                    context,\n                    Manifest.permission.ACCESS_COARSE_LOCATION\n                ) == PackageManager.PERMISSION_GRANTED\n    }\n<div></div>\n    fun reverseGeocodeLocation(location: LocationData): String {\n        // The Geocoder constructor expects a java.util.Locale\n        val geocoder = Geocoder(context, Locale.getDefault())\n        val coordinate = LatLng(location.latitude, location.longitude)\n        val addresses: MutableList<Address>? =\n            geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)\n<div></div>\n        return if (addresses?.isNotEmpty() == true) {\n            addresses[0]?.getAddressLine(0) ?: \"Address line not found\"\n        } else {\n            \"Address not found\"\n        }\n    }\n}\n```\n\n```\nclass LocationUtils(val context: Context) {\n    private val _fusedLocationClient: FusedLocationProviderClient =\n        LocationServices.getFusedLocationProviderClient(context)\n\n    @SuppressLint(\"MissingPermission\")\n    fun requestLocationUpdates(viewModel: LocationViewModel) {\n        val locationCallback = object : LocationCallback() {\n            override fun onLocationResult(locationResult: LocationResult) {\n                super.onLocationResult(locationResult)\n                locationResult.lastLocation?.let {\n                    val location = LocationData(latitude = it.latitude, longitude = it.longitude)\n                    viewModel.updateLocation(location)\n                }\n            }\n        }\n        val locationRequest = LocationRequest.Builder(\n            Priority.PRIORITY_HIGH_ACCURACY, 1000\n        ).build()\n        _fusedLocationClient.requestLocationUpdates(\n            locationRequest,\n            locationCallback,\n            Looper.getMainLooper()\n        )\n    }\n\n    fun hasLocationPermission(context: Context): Boolean {\n        return ContextCompat.checkSelfPermission(\n            context,\n            Manifest.permission.ACCESS_FINE_LOCATION\n        ) == PackageManager.PERMISSION_GRANTED\n                &&\n                ContextCompat.checkSelfPermission(\n                    context,\n                    Manifest.permission.ACCESS_COARSE_LOCATION\n                ) == PackageManager.PERMISSION_GRANTED\n    }\n\n    fun reverseGeocodeLocation(location: LocationData): String {\n        // The Geocoder constructor expects a java.util.Locale\n        val geocoder = Geocoder(context, Locale.getDefault())\n        val coordinate = LatLng(location.latitude, location.longitude)\n        val addresses: MutableList<Address>? =\n            geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)\n\n        return if (addresses?.isNotEmpty() == true) {\n            addresses[0]?.getAddressLine(0) ?: \"Address line not found\"\n        } else {\n            \"Address not found\"\n        }\n    }\n}\n```\n\n```\nprivate val _fusedLocationClient: FusedLocationProviderClient =\n    LocationServices.getFusedLocationProviderClient(context)\n```\n\n```\nprivate val _fusedLocationClient: FusedLocationProviderClient =\n    LocationServices.getFusedLocationProviderClient(context)\n```\n\n這是 Google 提供的 **Fused Location Provider API**，能整合 GPS、Wi-Fi、藍牙與行動網路的定位來源，讓定位更準確且省電。`_fusedLocationClient` 用來執行「請求位置更新」、「停止更新」、「取得最後位置」等操作。\n\n### requestLocationUpdates\n\n```\n@SuppressLint(\"MissingPermission\")\nfun requestLocationUpdates(viewModel: LocationViewModel) {\n```\n\n```\n@SuppressLint(\"MissingPermission\")\nfun requestLocationUpdates(viewModel: LocationViewModel) {\n```\n\n⚠️ 注意：這裡用了 `@SuppressLint(\"MissingPermission\")`，代表你**必須在呼叫這個函式前，確認已取得權限**（也就是前面 `LocationDisplay` 檢查的部分）。\n\n意思是保證外層一定會先檢查 hasLocationPermission() 才會進來，所以不用再提醒我 MissingPermission。\n\n這個函式會**每秒更新一次位置**（因為下面設定了 1000 毫秒），然後將新位置傳給你的 `LocationViewModel`。\n\n```\nval locationCallback = object : LocationCallback() {\n    override fun onLocationResult(locationResult: LocationResult) {\n        super.onLocationResult(locationResult)\n        locationResult.lastLocation?.let {\n            val location = LocationData(latitude = it.latitude, longitude = it.longitude)\n            viewModel.updateLocation(location)\n        }\n    }\n}\n```\n\n```\nval locationCallback = object : LocationCallback() {\n    override fun onLocationResult(locationResult: LocationResult) {\n        super.onLocationResult(locationResult)\n        locationResult.lastLocation?.let {\n            val location = LocationData(latitude = it.latitude, longitude = it.longitude)\n            viewModel.updateLocation(location)\n        }\n    }\n}\n```\n\n當系統取得新的定位資訊時，會呼叫 `onLocationResult`。\n\n`lastLocation` 是最新的 `Location` 物件（包含緯度與經度）。\n\n```\npackage com.example.locationapp\n<div></div>\ndata class LocationData(\n    val latitude: Double,\n    val longitude: Double\n)\n```\n\n```\npackage com.example.locationapp\n\ndata class LocationData(\n    val latitude: Double,\n    val longitude: Double\n)\n```\n\n`LocationData` 是我們定義的資料類別，用來包裝座標。\n\n呼叫 `viewModel.updateLocation(location)` → 把資料傳給 ViewModel 更新 UI。\n\n```\n_fusedLocationClient.requestLocationUpdates(\n    locationRequest,\n    locationCallback,\n    Looper.getMainLooper()\n)\n```\n\n```\n_fusedLocationClient.requestLocationUpdates(\n    locationRequest,\n    locationCallback,\n    Looper.getMainLooper()\n)\n```\n\n這行讓 app 持續監聽位置變化。\n\n### hasLocationPermission\n\n`LocationUtils` 要持有 `Context`，才能呼叫系統 API（如 `ContextCompat.checkSelfPermission`）來檢查權限。\n\nreturn 這段是重點：`ContextCompat.checkSelfPermission()` 是Android官方提供的工具，用來檢查 App 是否擁有某個權限。它會回傳一個整數值（`PERMISSION_GRANTED` 或 `PERMISSION_DENIED`）。\n\n這段程式碼的功能就像是你在檢查一個房間的門：\n\n> 「門有沒有上鎖？如果鎖是開著的，就代表我可以進去。」\n> \n> **`ContextCompat` (檢查員)：** 你可以把它想像成 Android 系統中的一位**通用檢查員**或**萬用工具箱**。它的工作就是確保你的程式碼在所有不同型號和版本的 Android 手機上都能正常運作（這就是 `Compat` 兼容性的意思）。\n> \n> **`.checkSelfPermission()` (檢查方法)：** 這是檢查員專門用來**檢查特定權限狀態**的方法。\n> \n> - **參數一 (`context`)：** 告訴檢查員「在哪個應用程式環境」下進行檢查。\n> \n> - **參數二 (`Manifest.permission.ACCESS_FINE_LOCATION`)：** 告訴檢查員「要檢查哪一種權限」。\n\n### 為什麼需要 `ContextCompat.checkSelfPermission()`？\n\n我們不直接使用 `PackageManager.PERMISSION_GRANTED` 進行判斷，是因為 **`PackageManager.PERMISSION_GRANTED` 只是一個「結果代碼」（密碼）**，而 **`ContextCompat.checkSelfPermission()` 才是「執行檢查的動作」**。\n\n### reverseGeocodeLocation\n\n```\nfun reverseGeocodeLocation(location: LocationData): String {\n    val geocoder = Geocoder(context, Locale.getDefault())\n    val coordinate = LatLng(location.latitude, location.longitude)\n    val addresses: MutableList<Address>? =\n        geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)\n```\n\n```\nfun reverseGeocodeLocation(location: LocationData): String {\n    val geocoder = Geocoder(context, Locale.getDefault())\n    val coordinate = LatLng(location.latitude, location.longitude)\n    val addresses: MutableList<Address>? =\n        geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)\n```\n\n用 `Geocoder` 根據經緯度查詢地點名稱。`getFromLocation()` 會回傳一個地址列表（可能含國家、城市、街道）。\n\n## MainActivity.kt\n\n```\n@Composable\nfun MyApp(modifier: Modifier) {\n    val context = LocalContext.current\n    val locationUtils = LocationUtils(context)\n    LocationDisplay(locationUtils = locationUtils, context = context)\n}\n```\n\n```\n@Composable\nfun MyApp(modifier: Modifier) {\n    val context = LocalContext.current\n    val locationUtils = LocationUtils(context)\n    LocationDisplay(locationUtils = locationUtils, context = context)\n}\n```\n\n```\nclass MainActivity : ComponentActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        enableEdgeToEdge()\n        setContent {\n            val viewModel: LocationViewModel = viewModel()\n            LocationAppTheme {\n                Scaffold(modifier = Modifier.fillMaxSize()) { innerPadding ->\n                    MyApp(viewModel = viewModel,modifier = Modifier.padding(innerPadding))\n                }\n            }\n        }\n    }\n}\n```\n\n```\nclass MainActivity : ComponentActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        enableEdgeToEdge()\n        setContent {\n            val viewModel: LocationViewModel = viewModel()\n            LocationAppTheme {\n                Scaffold(modifier = Modifier.fillMaxSize()) { innerPadding ->\n                    MyApp(viewModel = viewModel,modifier = Modifier.padding(innerPadding))\n                }\n            }\n        }\n    }\n}\n```\n\n**`Context`：** 是一個核心的 Android 系統類別，它提供了應用程式全域資訊，例如資源、資料庫、文件系統路徑，以及存取系統服務（如定位服務）的管道。\n\n**`LocalContext.current`：** 這是 Jetpack Compose 框架提供的一個 **CompositionLocal**。它用於在可組合函數中**存取** Android 應用程式的 **`Context`** 物件。\n\n`LocationDisplay(locationUtils = locationUtils, context = context)` 這行程式碼的作用是**調用**一個名為 `LocationDisplay` 的 **Compose UI 元件**，向它傳遞所需的資料和環境依賴。\n\n```\n@Composable\nfun LocationDisplay(\n    locationUtils: LocationUtils,\n    viewModel: LocationViewModel,\n    context: Context\n) {\n    val location = viewModel.location.value\n    \n    val address = location?.let {\n        locationUtils.reverseGeocodeLocation(location)\n    }\n<div></div>\n    val requestPermissionLauncher = rememberLauncherForActivityResult(\n        contract = ActivityResultContracts.RequestMultiplePermissions(),\n        onResult = { permissions ->\n            if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true\n                && permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true\n            ) {\n                // 擁有 location 權限\n                locationUtils.requestLocationUpdates(viewModel = viewModel)\n<div></div>\n            } else {\n                // 要求權限\n                val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(\n                    context as MainActivity,\n                    Manifest.permission.ACCESS_FINE_LOCATION\n                ) || ActivityCompat.shouldShowRequestPermissionRationale(\n                    context as MainActivity,\n                    Manifest.permission.ACCESS_COARSE_LOCATION\n                )\n<div></div>\n                if (rationaleRequired) {\n                    Toast.makeText(\n                        context,\n                        \"Location Permission is required for this feature to work\",\n                        Toast.LENGTH_LONG\n                    ).show()\n                } else {\n                    Toast.makeText(\n                        context,\n                        \"Location Permission is required, Please enable from settings\",\n                        Toast.LENGTH_LONG\n                    ).show()\n                }\n            }\n        }\n    )\n<div></div>\n    Column(\n        modifier = Modifier.fillMaxSize(),\n        horizontalAlignment = Alignment.CenterHorizontally,\n        verticalArrangement = Arrangement.Center\n    ) {\n        if(location != null) {\n            Text(\"Address: ${location.latitude} ${location.longitude} \\n $address \")\n        }\n        Text(text = \"Location not available\")\n<div></div>\n        Button(onClick = {\n            if (locationUtils.hasLocationPermission(context)) {\n                locationUtils.requestLocationUpdates(viewModel)\n            } else {\n                requestPermissionLauncher.launch(\n                    arrayOf(\n                        Manifest.permission.ACCESS_FINE_LOCATION,\n                        Manifest.permission.ACCESS_COARSE_LOCATION\n                    )\n                )\n            }\n        }) {\n            Text(text = \"Get Location\")\n        }\n    }\n}\n```\n\n```\n@Composable\nfun LocationDisplay(\n    locationUtils: LocationUtils,\n    viewModel: LocationViewModel,\n    context: Context\n) {\n    val location = viewModel.location.value\n    \n    val address = location?.let {\n        locationUtils.reverseGeocodeLocation(location)\n    }\n\n    val requestPermissionLauncher = rememberLauncherForActivityResult(\n        contract = ActivityResultContracts.RequestMultiplePermissions(),\n        onResult = { permissions ->\n            if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true\n                && permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true\n            ) {\n                // 擁有 location 權限\n                locationUtils.requestLocationUpdates(viewModel = viewModel)\n\n            } else {\n                // 要求權限\n                val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(\n                    context as MainActivity,\n                    Manifest.permission.ACCESS_FINE_LOCATION\n                ) || ActivityCompat.shouldShowRequestPermissionRationale(\n                    context as MainActivity,\n                    Manifest.permission.ACCESS_COARSE_LOCATION\n                )\n\n                if (rationaleRequired) {\n                    Toast.makeText(\n                        context,\n                        \"Location Permission is required for this feature to work\",\n                        Toast.LENGTH_LONG\n                    ).show()\n                } else {\n                    Toast.makeText(\n                        context,\n                        \"Location Permission is required, Please enable from settings\",\n                        Toast.LENGTH_LONG\n                    ).show()\n                }\n            }\n        }\n    )\n\n    Column(\n        modifier = Modifier.fillMaxSize(),\n        horizontalAlignment = Alignment.CenterHorizontally,\n        verticalArrangement = Arrangement.Center\n    ) {\n        if(location != null) {\n            Text(\"Address: ${location.latitude} ${location.longitude} \\n $address \")\n        }\n        Text(text = \"Location not available\")\n\n        Button(onClick = {\n            if (locationUtils.hasLocationPermission(context)) {\n                locationUtils.requestLocationUpdates(viewModel)\n            } else {\n                requestPermissionLauncher.launch(\n                    arrayOf(\n                        Manifest.permission.ACCESS_FINE_LOCATION,\n                        Manifest.permission.ACCESS_COARSE_LOCATION\n                    )\n                )\n            }\n        }) {\n            Text(text = \"Get Location\")\n        }\n    }\n}\n```\n\n主要公能：顯示一個文字 + 按鈕，並處理按下按鈕後檢查或請求定位權限。\n\ncontract = ActivityResultContracts.RequestMultiplePermissions()\n\n表示這個 launcher 可以一次請求多個權限（這裡是 coarse + fine）。\n\n`onResult = { permissions -> ... }`\n\n系統對話框關閉後，會回傳使用者是否授權。\n\n```\nif (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true\n    && permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true\n) {\n    // 已擁有定位權限\n} else {\n    // 尚未取得權限，顯示提示\n}\n```\n\n```\nif (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true\n    && permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true\n) {\n    // 已擁有定位權限\n} else {\n    // 尚未取得權限，顯示提示\n}\n```\n\n若兩個權限都有允許，目前就什麼都不做；否則，進入「沒有權限」的分支。\n\n如果沒權限 → 顯示提示 Toast\n\n```\nval rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(\n    context as MainActivity,\n    Manifest.permission.ACCESS_FINE_LOCATION\n) || ActivityCompat.shouldShowRequestPermissionRationale(\n    context as MainActivity,\n    Manifest.permission.ACCESS_COARSE_LOCATION\n)\n```\n\n```\nval rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(\n    context as MainActivity,\n    Manifest.permission.ACCESS_FINE_LOCATION\n) || ActivityCompat.shouldShowRequestPermissionRationale(\n    context as MainActivity,\n    Manifest.permission.ACCESS_COARSE_LOCATION\n)\n```\n\nshouldShowRequestPermissionRationale(…)\n\n這是 Android 的 API，用來判斷：\n\n- 使用者曾拒絕過權限（但沒勾「不再詢問」 → 回傳 `true`\n\n- 使用者勾了「不再詢問」或 第一次詢問 → 回傳 `false`\n\n```\nif (rationaleRequired) {\n    Toast.makeText(context, \"Location Permission is required for this feature to work\", Toast.LENGTH_LONG).show()\n} else {\n    Toast.makeText(context, \"Location Permission is required, Please enable from settings\", Toast.LENGTH_LONG).show()\n}\n```\n\n```\nif (rationaleRequired) {\n    Toast.makeText(context, \"Location Permission is required for this feature to work\", Toast.LENGTH_LONG).show()\n} else {\n    Toast.makeText(context, \"Location Permission is required, Please enable from settings\", Toast.LENGTH_LONG).show()\n}\n```\n\n![](/images/image-1.png)\n\n![](/images/image.png)\n\n![](/images/螢幕擷取畫面-2025-10-19-214356.png)\n\n## LocationViewModel.kt\n\n```\npackage com.example.locationapp\n<div></div>\nimport androidx.compose.runtime.State\nimport androidx.compose.runtime.mutableStateOf\nimport androidx.lifecycle.ViewModel\n<div></div>\nclass LocationViewModel: ViewModel() {\n    private val _location = mutableStateOf<LocationData?>(null)\n    val location: State<LocationData?> = _location\n<div></div>\n    fun updateLocation(newLocation: LocationData) {\n        _location.value = newLocation\n    }\n<div></div>\n}\n```\n\n```\npackage com.example.locationapp\n\nimport androidx.compose.runtime.State\nimport androidx.compose.runtime.mutableStateOf\nimport androidx.lifecycle.ViewModel\n\nclass LocationViewModel: ViewModel() {\n    private val _location = mutableStateOf<LocationData?>(null)\n    val location: State<LocationData?> = _location\n\n    fun updateLocation(newLocation: LocationData) {\n        _location.value = newLocation\n    }\n\n}\n```\n\n```\nprivate val _location = mutableStateOf<LocationData?>(null)\n```\n\n```\nprivate val _location = mutableStateOf<LocationData?>(null)\n```\n\nmutableStateOf 它包裝了一個變數，當值改變時，Compose UI 會**自動重新組合（recompose）**。\n\n`LocationData?` → 泛型裡面的 `?` 代表可以是 `null`，表示「可能還沒取得位置」。\n\n`_location` 是私有的可變，`location` 是公開的唯讀。\n\n```\nfun updateLocation(newLocation: LocationData) {\n    _location.value = newLocation\n}\n```\n\n```\nfun updateLocation(newLocation: LocationData) {\n    _location.value = newLocation\n}\n```\n\n當 `LocationUtils` 拿到新座標後，會呼叫updateLocation更新座標。\n","slug":"android-locationapp","published":1,"updated":"2026-01-28T14:17:25.062Z","_id":"cmkxg0krr0003rb8z54um3wrx","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>這是一個練習定位權限的App，我將重要的部分記錄下來。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>android.permission.INTERNET : 允許應用程式開啟<strong>網路連線</strong></p>\n</li>\n<li><p>android.permission.ACCESS_COARSE_LOCATION : 允許應用程式存取使用<strong>粗略的位置</strong></p>\n</li>\n<li><p>android.permission.ACCESS_FINE_LOCATION : 允許應用程式存取使用<strong>精確的位置</strong></p>\n</li>\n</ul>\n<h2 id=\"LocationUtils-kt\"><a href=\"#LocationUtils-kt\" class=\"headerlink\" title=\"LocationUtils.kt\"></a>LocationUtils.kt</h2><p>hasLocationPermission function 回傳一個 <code>Boolean</code>→ <code>true</code> 或 <code>false</code>，代表有沒有定位權限。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class LocationUtils(val context: Context) &#123;</span><br><span class=\"line\">    private val _fusedLocationClient: FusedLocationProviderClient =</span><br><span class=\"line\">        LocationServices.getFusedLocationProviderClient(context)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    @SuppressLint(&quot;MissingPermission&quot;)</span><br><span class=\"line\">    fun requestLocationUpdates(viewModel: LocationViewModel) &#123;</span><br><span class=\"line\">        val locationCallback = object : LocationCallback() &#123;</span><br><span class=\"line\">            override fun onLocationResult(locationResult: LocationResult) &#123;</span><br><span class=\"line\">                super.onLocationResult(locationResult)</span><br><span class=\"line\">                locationResult.lastLocation?.let &#123;</span><br><span class=\"line\">                    val location = LocationData(latitude = it.latitude, longitude = it.longitude)</span><br><span class=\"line\">                    viewModel.updateLocation(location)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        val locationRequest = LocationRequest.Builder(</span><br><span class=\"line\">            Priority.PRIORITY_HIGH_ACCURACY, 1000</span><br><span class=\"line\">        ).build()</span><br><span class=\"line\">        _fusedLocationClient.requestLocationUpdates(</span><br><span class=\"line\">            locationRequest,</span><br><span class=\"line\">            locationCallback,</span><br><span class=\"line\">            Looper.getMainLooper()</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    fun hasLocationPermission(context: Context): Boolean &#123;</span><br><span class=\"line\">        return ContextCompat.checkSelfPermission(</span><br><span class=\"line\">            context,</span><br><span class=\"line\">            Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">        ) == PackageManager.PERMISSION_GRANTED</span><br><span class=\"line\">                &amp;&amp;</span><br><span class=\"line\">                ContextCompat.checkSelfPermission(</span><br><span class=\"line\">                    context,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                ) == PackageManager.PERMISSION_GRANTED</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    fun reverseGeocodeLocation(location: LocationData): String &#123;</span><br><span class=\"line\">        // The Geocoder constructor expects a java.util.Locale</span><br><span class=\"line\">        val geocoder = Geocoder(context, Locale.getDefault())</span><br><span class=\"line\">        val coordinate = LatLng(location.latitude, location.longitude)</span><br><span class=\"line\">        val addresses: MutableList&lt;Address&gt;? =</span><br><span class=\"line\">            geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        return if (addresses?.isNotEmpty() == true) &#123;</span><br><span class=\"line\">            addresses[0]?.getAddressLine(0) ?: &quot;Address line not found&quot;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &quot;Address not found&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class LocationUtils(val context: Context) &#123;</span><br><span class=\"line\">    private val _fusedLocationClient: FusedLocationProviderClient =</span><br><span class=\"line\">        LocationServices.getFusedLocationProviderClient(context)</span><br><span class=\"line\"></span><br><span class=\"line\">    @SuppressLint(&quot;MissingPermission&quot;)</span><br><span class=\"line\">    fun requestLocationUpdates(viewModel: LocationViewModel) &#123;</span><br><span class=\"line\">        val locationCallback = object : LocationCallback() &#123;</span><br><span class=\"line\">            override fun onLocationResult(locationResult: LocationResult) &#123;</span><br><span class=\"line\">                super.onLocationResult(locationResult)</span><br><span class=\"line\">                locationResult.lastLocation?.let &#123;</span><br><span class=\"line\">                    val location = LocationData(latitude = it.latitude, longitude = it.longitude)</span><br><span class=\"line\">                    viewModel.updateLocation(location)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        val locationRequest = LocationRequest.Builder(</span><br><span class=\"line\">            Priority.PRIORITY_HIGH_ACCURACY, 1000</span><br><span class=\"line\">        ).build()</span><br><span class=\"line\">        _fusedLocationClient.requestLocationUpdates(</span><br><span class=\"line\">            locationRequest,</span><br><span class=\"line\">            locationCallback,</span><br><span class=\"line\">            Looper.getMainLooper()</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    fun hasLocationPermission(context: Context): Boolean &#123;</span><br><span class=\"line\">        return ContextCompat.checkSelfPermission(</span><br><span class=\"line\">            context,</span><br><span class=\"line\">            Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">        ) == PackageManager.PERMISSION_GRANTED</span><br><span class=\"line\">                &amp;&amp;</span><br><span class=\"line\">                ContextCompat.checkSelfPermission(</span><br><span class=\"line\">                    context,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                ) == PackageManager.PERMISSION_GRANTED</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    fun reverseGeocodeLocation(location: LocationData): String &#123;</span><br><span class=\"line\">        // The Geocoder constructor expects a java.util.Locale</span><br><span class=\"line\">        val geocoder = Geocoder(context, Locale.getDefault())</span><br><span class=\"line\">        val coordinate = LatLng(location.latitude, location.longitude)</span><br><span class=\"line\">        val addresses: MutableList&lt;Address&gt;? =</span><br><span class=\"line\">            geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)</span><br><span class=\"line\"></span><br><span class=\"line\">        return if (addresses?.isNotEmpty() == true) &#123;</span><br><span class=\"line\">            addresses[0]?.getAddressLine(0) ?: &quot;Address line not found&quot;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &quot;Address not found&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val _fusedLocationClient: FusedLocationProviderClient =</span><br><span class=\"line\">    LocationServices.getFusedLocationProviderClient(context)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val _fusedLocationClient: FusedLocationProviderClient =</span><br><span class=\"line\">    LocationServices.getFusedLocationProviderClient(context)</span><br></pre></td></tr></table></figure>\n\n<p>這是 Google 提供的 <strong>Fused Location Provider API</strong>，能整合 GPS、Wi-Fi、藍牙與行動網路的定位來源，讓定位更準確且省電。<code>_fusedLocationClient</code> 用來執行「請求位置更新」、「停止更新」、「取得最後位置」等操作。</p>\n<h3 id=\"requestLocationUpdates\"><a href=\"#requestLocationUpdates\" class=\"headerlink\" title=\"requestLocationUpdates\"></a>requestLocationUpdates</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@SuppressLint(&quot;MissingPermission&quot;)</span><br><span class=\"line\">fun requestLocationUpdates(viewModel: LocationViewModel) &#123;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@SuppressLint(&quot;MissingPermission&quot;)</span><br><span class=\"line\">fun requestLocationUpdates(viewModel: LocationViewModel) &#123;</span><br></pre></td></tr></table></figure>\n\n<p>⚠️ 注意：這裡用了 <code>@SuppressLint(&quot;MissingPermission&quot;)</code>，代表你<strong>必須在呼叫這個函式前，確認已取得權限</strong>（也就是前面 <code>LocationDisplay</code> 檢查的部分）。</p>\n<p>意思是保證外層一定會先檢查 hasLocationPermission() 才會進來，所以不用再提醒我 MissingPermission。</p>\n<p>這個函式會<strong>每秒更新一次位置</strong>（因為下面設定了 1000 毫秒），然後將新位置傳給你的 <code>LocationViewModel</code>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val locationCallback = object : LocationCallback() &#123;</span><br><span class=\"line\">    override fun onLocationResult(locationResult: LocationResult) &#123;</span><br><span class=\"line\">        super.onLocationResult(locationResult)</span><br><span class=\"line\">        locationResult.lastLocation?.let &#123;</span><br><span class=\"line\">            val location = LocationData(latitude = it.latitude, longitude = it.longitude)</span><br><span class=\"line\">            viewModel.updateLocation(location)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val locationCallback = object : LocationCallback() &#123;</span><br><span class=\"line\">    override fun onLocationResult(locationResult: LocationResult) &#123;</span><br><span class=\"line\">        super.onLocationResult(locationResult)</span><br><span class=\"line\">        locationResult.lastLocation?.let &#123;</span><br><span class=\"line\">            val location = LocationData(latitude = it.latitude, longitude = it.longitude)</span><br><span class=\"line\">            viewModel.updateLocation(location)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>當系統取得新的定位資訊時，會呼叫 <code>onLocationResult</code>。</p>\n<p><code>lastLocation</code> 是最新的 <code>Location</code> 物件（包含緯度與經度）。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.example.locationapp</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">data class LocationData(</span><br><span class=\"line\">    val latitude: Double,</span><br><span class=\"line\">    val longitude: Double</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.example.locationapp</span><br><span class=\"line\"></span><br><span class=\"line\">data class LocationData(</span><br><span class=\"line\">    val latitude: Double,</span><br><span class=\"line\">    val longitude: Double</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p><code>LocationData</code> 是我們定義的資料類別，用來包裝座標。</p>\n<p>呼叫 <code>viewModel.updateLocation(location)</code> → 把資料傳給 ViewModel 更新 UI。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_fusedLocationClient.requestLocationUpdates(</span><br><span class=\"line\">    locationRequest,</span><br><span class=\"line\">    locationCallback,</span><br><span class=\"line\">    Looper.getMainLooper()</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_fusedLocationClient.requestLocationUpdates(</span><br><span class=\"line\">    locationRequest,</span><br><span class=\"line\">    locationCallback,</span><br><span class=\"line\">    Looper.getMainLooper()</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>這行讓 app 持續監聽位置變化。</p>\n<h3 id=\"hasLocationPermission\"><a href=\"#hasLocationPermission\" class=\"headerlink\" title=\"hasLocationPermission\"></a>hasLocationPermission</h3><p><code>LocationUtils</code> 要持有 <code>Context</code>，才能呼叫系統 API（如 <code>ContextCompat.checkSelfPermission</code>）來檢查權限。</p>\n<p>return 這段是重點：<code>ContextCompat.checkSelfPermission()</code> 是Android官方提供的工具，用來檢查 App 是否擁有某個權限。它會回傳一個整數值（<code>PERMISSION_GRANTED</code> 或 <code>PERMISSION_DENIED</code>）。</p>\n<p>這段程式碼的功能就像是你在檢查一個房間的門：</p>\n<blockquote>\n<p>「門有沒有上鎖？如果鎖是開著的，就代表我可以進去。」</p>\n<p><strong><code>ContextCompat</code> (檢查員)：</strong> 你可以把它想像成 Android 系統中的一位<strong>通用檢查員</strong>或<strong>萬用工具箱</strong>。它的工作就是確保你的程式碼在所有不同型號和版本的 Android 手機上都能正常運作（這就是 <code>Compat</code> 兼容性的意思）。</p>\n<p><strong><code>.checkSelfPermission()</code> (檢查方法)：</strong> 這是檢查員專門用來<strong>檢查特定權限狀態</strong>的方法。</p>\n<ul>\n<li><p><strong>參數一 (<code>context</code>)：</strong> 告訴檢查員「在哪個應用程式環境」下進行檢查。</p>\n</li>\n<li><p><strong>參數二 (<code>Manifest.permission.ACCESS_FINE_LOCATION</code>)：</strong> 告訴檢查員「要檢查哪一種權限」。</p>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"為什麼需要-ContextCompat-checkSelfPermission-？\"><a href=\"#為什麼需要-ContextCompat-checkSelfPermission-？\" class=\"headerlink\" title=\"為什麼需要 ContextCompat.checkSelfPermission()？\"></a>為什麼需要 <code>ContextCompat.checkSelfPermission()</code>？</h3><p>我們不直接使用 <code>PackageManager.PERMISSION_GRANTED</code> 進行判斷，是因為 <strong><code>PackageManager.PERMISSION_GRANTED</code> 只是一個「結果代碼」（密碼）</strong>，而 <strong><code>ContextCompat.checkSelfPermission()</code> 才是「執行檢查的動作」</strong>。</p>\n<h3 id=\"reverseGeocodeLocation\"><a href=\"#reverseGeocodeLocation\" class=\"headerlink\" title=\"reverseGeocodeLocation\"></a>reverseGeocodeLocation</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun reverseGeocodeLocation(location: LocationData): String &#123;</span><br><span class=\"line\">    val geocoder = Geocoder(context, Locale.getDefault())</span><br><span class=\"line\">    val coordinate = LatLng(location.latitude, location.longitude)</span><br><span class=\"line\">    val addresses: MutableList&lt;Address&gt;? =</span><br><span class=\"line\">        geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun reverseGeocodeLocation(location: LocationData): String &#123;</span><br><span class=\"line\">    val geocoder = Geocoder(context, Locale.getDefault())</span><br><span class=\"line\">    val coordinate = LatLng(location.latitude, location.longitude)</span><br><span class=\"line\">    val addresses: MutableList&lt;Address&gt;? =</span><br><span class=\"line\">        geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)</span><br></pre></td></tr></table></figure>\n\n<p>用 <code>Geocoder</code> 根據經緯度查詢地點名稱。<code>getFromLocation()</code> 會回傳一個地址列表（可能含國家、城市、街道）。</p>\n<h2 id=\"MainActivity-kt\"><a href=\"#MainActivity-kt\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Composable</span><br><span class=\"line\">fun MyApp(modifier: Modifier) &#123;</span><br><span class=\"line\">    val context = LocalContext.current</span><br><span class=\"line\">    val locationUtils = LocationUtils(context)</span><br><span class=\"line\">    LocationDisplay(locationUtils = locationUtils, context = context)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Composable</span><br><span class=\"line\">fun MyApp(modifier: Modifier) &#123;</span><br><span class=\"line\">    val context = LocalContext.current</span><br><span class=\"line\">    val locationUtils = LocationUtils(context)</span><br><span class=\"line\">    LocationDisplay(locationUtils = locationUtils, context = context)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : ComponentActivity() &#123;</span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        enableEdgeToEdge()</span><br><span class=\"line\">        setContent &#123;</span><br><span class=\"line\">            val viewModel: LocationViewModel = viewModel()</span><br><span class=\"line\">            LocationAppTheme &#123;</span><br><span class=\"line\">                Scaffold(modifier = Modifier.fillMaxSize()) &#123; innerPadding -&gt;</span><br><span class=\"line\">                    MyApp(viewModel = viewModel,modifier = Modifier.padding(innerPadding))</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : ComponentActivity() &#123;</span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        enableEdgeToEdge()</span><br><span class=\"line\">        setContent &#123;</span><br><span class=\"line\">            val viewModel: LocationViewModel = viewModel()</span><br><span class=\"line\">            LocationAppTheme &#123;</span><br><span class=\"line\">                Scaffold(modifier = Modifier.fillMaxSize()) &#123; innerPadding -&gt;</span><br><span class=\"line\">                    MyApp(viewModel = viewModel,modifier = Modifier.padding(innerPadding))</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong><code>Context</code>：</strong> 是一個核心的 Android 系統類別，它提供了應用程式全域資訊，例如資源、資料庫、文件系統路徑，以及存取系統服務（如定位服務）的管道。</p>\n<p><strong><code>LocalContext.current</code>：</strong> 這是 Jetpack Compose 框架提供的一個 <strong>CompositionLocal</strong>。它用於在可組合函數中<strong>存取</strong> Android 應用程式的 <strong><code>Context</code></strong> 物件。</p>\n<p><code>LocationDisplay(locationUtils = locationUtils, context = context)</code> 這行程式碼的作用是<strong>調用</strong>一個名為 <code>LocationDisplay</code> 的 <strong>Compose UI 元件</strong>，向它傳遞所需的資料和環境依賴。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Composable</span><br><span class=\"line\">fun LocationDisplay(</span><br><span class=\"line\">    locationUtils: LocationUtils,</span><br><span class=\"line\">    viewModel: LocationViewModel,</span><br><span class=\"line\">    context: Context</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">    val location = viewModel.location.value</span><br><span class=\"line\">    </span><br><span class=\"line\">    val address = location?.let &#123;</span><br><span class=\"line\">        locationUtils.reverseGeocodeLocation(location)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    val requestPermissionLauncher = rememberLauncherForActivityResult(</span><br><span class=\"line\">        contract = ActivityResultContracts.RequestMultiplePermissions(),</span><br><span class=\"line\">        onResult = &#123; permissions -&gt;</span><br><span class=\"line\">            if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true</span><br><span class=\"line\">                &amp;&amp; permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true</span><br><span class=\"line\">            ) &#123;</span><br><span class=\"line\">                // 擁有 location 權限</span><br><span class=\"line\">                locationUtils.requestLocationUpdates(viewModel = viewModel)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                // 要求權限</span><br><span class=\"line\">                val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">                    context as MainActivity,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">                ) || ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">                    context as MainActivity,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                )</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">                if (rationaleRequired) &#123;</span><br><span class=\"line\">                    Toast.makeText(</span><br><span class=\"line\">                        context,</span><br><span class=\"line\">                        &quot;Location Permission is required for this feature to work&quot;,</span><br><span class=\"line\">                        Toast.LENGTH_LONG</span><br><span class=\"line\">                    ).show()</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    Toast.makeText(</span><br><span class=\"line\">                        context,</span><br><span class=\"line\">                        &quot;Location Permission is required, Please enable from settings&quot;,</span><br><span class=\"line\">                        Toast.LENGTH_LONG</span><br><span class=\"line\">                    ).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    Column(</span><br><span class=\"line\">        modifier = Modifier.fillMaxSize(),</span><br><span class=\"line\">        horizontalAlignment = Alignment.CenterHorizontally,</span><br><span class=\"line\">        verticalArrangement = Arrangement.Center</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">        if(location != null) &#123;</span><br><span class=\"line\">            Text(&quot;Address: $&#123;location.latitude&#125; $&#123;location.longitude&#125; \\n $address &quot;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Text(text = &quot;Location not available&quot;)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        Button(onClick = &#123;</span><br><span class=\"line\">            if (locationUtils.hasLocationPermission(context)) &#123;</span><br><span class=\"line\">                locationUtils.requestLocationUpdates(viewModel)</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                requestPermissionLauncher.launch(</span><br><span class=\"line\">                    arrayOf(</span><br><span class=\"line\">                        Manifest.permission.ACCESS_FINE_LOCATION,</span><br><span class=\"line\">                        Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                    )</span><br><span class=\"line\">                )</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;) &#123;</span><br><span class=\"line\">            Text(text = &quot;Get Location&quot;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Composable</span><br><span class=\"line\">fun LocationDisplay(</span><br><span class=\"line\">    locationUtils: LocationUtils,</span><br><span class=\"line\">    viewModel: LocationViewModel,</span><br><span class=\"line\">    context: Context</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">    val location = viewModel.location.value</span><br><span class=\"line\">    </span><br><span class=\"line\">    val address = location?.let &#123;</span><br><span class=\"line\">        locationUtils.reverseGeocodeLocation(location)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    val requestPermissionLauncher = rememberLauncherForActivityResult(</span><br><span class=\"line\">        contract = ActivityResultContracts.RequestMultiplePermissions(),</span><br><span class=\"line\">        onResult = &#123; permissions -&gt;</span><br><span class=\"line\">            if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true</span><br><span class=\"line\">                &amp;&amp; permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true</span><br><span class=\"line\">            ) &#123;</span><br><span class=\"line\">                // 擁有 location 權限</span><br><span class=\"line\">                locationUtils.requestLocationUpdates(viewModel = viewModel)</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                // 要求權限</span><br><span class=\"line\">                val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">                    context as MainActivity,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">                ) || ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">                    context as MainActivity,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                )</span><br><span class=\"line\"></span><br><span class=\"line\">                if (rationaleRequired) &#123;</span><br><span class=\"line\">                    Toast.makeText(</span><br><span class=\"line\">                        context,</span><br><span class=\"line\">                        &quot;Location Permission is required for this feature to work&quot;,</span><br><span class=\"line\">                        Toast.LENGTH_LONG</span><br><span class=\"line\">                    ).show()</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    Toast.makeText(</span><br><span class=\"line\">                        context,</span><br><span class=\"line\">                        &quot;Location Permission is required, Please enable from settings&quot;,</span><br><span class=\"line\">                        Toast.LENGTH_LONG</span><br><span class=\"line\">                    ).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    Column(</span><br><span class=\"line\">        modifier = Modifier.fillMaxSize(),</span><br><span class=\"line\">        horizontalAlignment = Alignment.CenterHorizontally,</span><br><span class=\"line\">        verticalArrangement = Arrangement.Center</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">        if(location != null) &#123;</span><br><span class=\"line\">            Text(&quot;Address: $&#123;location.latitude&#125; $&#123;location.longitude&#125; \\n $address &quot;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Text(text = &quot;Location not available&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">        Button(onClick = &#123;</span><br><span class=\"line\">            if (locationUtils.hasLocationPermission(context)) &#123;</span><br><span class=\"line\">                locationUtils.requestLocationUpdates(viewModel)</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                requestPermissionLauncher.launch(</span><br><span class=\"line\">                    arrayOf(</span><br><span class=\"line\">                        Manifest.permission.ACCESS_FINE_LOCATION,</span><br><span class=\"line\">                        Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                    )</span><br><span class=\"line\">                )</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;) &#123;</span><br><span class=\"line\">            Text(text = &quot;Get Location&quot;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>主要公能：顯示一個文字 + 按鈕，並處理按下按鈕後檢查或請求定位權限。</p>\n<p>contract &#x3D; ActivityResultContracts.RequestMultiplePermissions()</p>\n<p>表示這個 launcher 可以一次請求多個權限（這裡是 coarse + fine）。</p>\n<p><code>onResult = &#123; permissions -&gt; ... &#125;</code></p>\n<p>系統對話框關閉後，會回傳使用者是否授權。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true</span><br><span class=\"line\">    &amp;&amp; permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">    // 已擁有定位權限</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    // 尚未取得權限，顯示提示</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true</span><br><span class=\"line\">    &amp;&amp; permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">    // 已擁有定位權限</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    // 尚未取得權限，顯示提示</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>若兩個權限都有允許，目前就什麼都不做；否則，進入「沒有權限」的分支。</p>\n<p>如果沒權限 → 顯示提示 Toast</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">    context as MainActivity,</span><br><span class=\"line\">    Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">) || ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">    context as MainActivity,</span><br><span class=\"line\">    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">    context as MainActivity,</span><br><span class=\"line\">    Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">) || ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">    context as MainActivity,</span><br><span class=\"line\">    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>shouldShowRequestPermissionRationale(…)</p>\n<p>這是 Android 的 API，用來判斷：</p>\n<ul>\n<li><p>使用者曾拒絕過權限（但沒勾「不再詢問」 → 回傳 <code>true</code></p>\n</li>\n<li><p>使用者勾了「不再詢問」或 第一次詢問 → 回傳 <code>false</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (rationaleRequired) &#123;</span><br><span class=\"line\">    Toast.makeText(context, &quot;Location Permission is required for this feature to work&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    Toast.makeText(context, &quot;Location Permission is required, Please enable from settings&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (rationaleRequired) &#123;</span><br><span class=\"line\">    Toast.makeText(context, &quot;Location Permission is required for this feature to work&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    Toast.makeText(context, &quot;Location Permission is required, Please enable from settings&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/image-1.png\"></p>\n<p><img src=\"/images/image.png\"></p>\n<p><img src=\"/images/%E8%9E%A2%E5%B9%95%E6%93%B7%E5%8F%96%E7%95%AB%E9%9D%A2-2025-10-19-214356.png\"></p>\n<h2 id=\"LocationViewModel-kt\"><a href=\"#LocationViewModel-kt\" class=\"headerlink\" title=\"LocationViewModel.kt\"></a>LocationViewModel.kt</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.example.locationapp</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">import androidx.compose.runtime.State</span><br><span class=\"line\">import androidx.compose.runtime.mutableStateOf</span><br><span class=\"line\">import androidx.lifecycle.ViewModel</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">class LocationViewModel: ViewModel() &#123;</span><br><span class=\"line\">    private val _location = mutableStateOf&lt;LocationData?&gt;(null)</span><br><span class=\"line\">    val location: State&lt;LocationData?&gt; = _location</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    fun updateLocation(newLocation: LocationData) &#123;</span><br><span class=\"line\">        _location.value = newLocation</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.example.locationapp</span><br><span class=\"line\"></span><br><span class=\"line\">import androidx.compose.runtime.State</span><br><span class=\"line\">import androidx.compose.runtime.mutableStateOf</span><br><span class=\"line\">import androidx.lifecycle.ViewModel</span><br><span class=\"line\"></span><br><span class=\"line\">class LocationViewModel: ViewModel() &#123;</span><br><span class=\"line\">    private val _location = mutableStateOf&lt;LocationData?&gt;(null)</span><br><span class=\"line\">    val location: State&lt;LocationData?&gt; = _location</span><br><span class=\"line\"></span><br><span class=\"line\">    fun updateLocation(newLocation: LocationData) &#123;</span><br><span class=\"line\">        _location.value = newLocation</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val _location = mutableStateOf&lt;LocationData?&gt;(null)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val _location = mutableStateOf&lt;LocationData?&gt;(null)</span><br></pre></td></tr></table></figure>\n\n<p>mutableStateOf 它包裝了一個變數，當值改變時，Compose UI 會<strong>自動重新組合（recompose）</strong>。</p>\n<p><code>LocationData?</code> → 泛型裡面的 <code>?</code> 代表可以是 <code>null</code>，表示「可能還沒取得位置」。</p>\n<p><code>_location</code> 是私有的可變，<code>location</code> 是公開的唯讀。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun updateLocation(newLocation: LocationData) &#123;</span><br><span class=\"line\">    _location.value = newLocation</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun updateLocation(newLocation: LocationData) &#123;</span><br><span class=\"line\">    _location.value = newLocation</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>當 <code>LocationUtils</code> 拿到新座標後，會呼叫updateLocation更新座標。</p>\n","excerpt":"","more":"<p>這是一個練習定位權限的App，我將重要的部分記錄下來。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;</span><br><span class=\"line\">&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>android.permission.INTERNET : 允許應用程式開啟<strong>網路連線</strong></p>\n</li>\n<li><p>android.permission.ACCESS_COARSE_LOCATION : 允許應用程式存取使用<strong>粗略的位置</strong></p>\n</li>\n<li><p>android.permission.ACCESS_FINE_LOCATION : 允許應用程式存取使用<strong>精確的位置</strong></p>\n</li>\n</ul>\n<h2 id=\"LocationUtils-kt\"><a href=\"#LocationUtils-kt\" class=\"headerlink\" title=\"LocationUtils.kt\"></a>LocationUtils.kt</h2><p>hasLocationPermission function 回傳一個 <code>Boolean</code>→ <code>true</code> 或 <code>false</code>，代表有沒有定位權限。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class LocationUtils(val context: Context) &#123;</span><br><span class=\"line\">    private val _fusedLocationClient: FusedLocationProviderClient =</span><br><span class=\"line\">        LocationServices.getFusedLocationProviderClient(context)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    @SuppressLint(&quot;MissingPermission&quot;)</span><br><span class=\"line\">    fun requestLocationUpdates(viewModel: LocationViewModel) &#123;</span><br><span class=\"line\">        val locationCallback = object : LocationCallback() &#123;</span><br><span class=\"line\">            override fun onLocationResult(locationResult: LocationResult) &#123;</span><br><span class=\"line\">                super.onLocationResult(locationResult)</span><br><span class=\"line\">                locationResult.lastLocation?.let &#123;</span><br><span class=\"line\">                    val location = LocationData(latitude = it.latitude, longitude = it.longitude)</span><br><span class=\"line\">                    viewModel.updateLocation(location)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        val locationRequest = LocationRequest.Builder(</span><br><span class=\"line\">            Priority.PRIORITY_HIGH_ACCURACY, 1000</span><br><span class=\"line\">        ).build()</span><br><span class=\"line\">        _fusedLocationClient.requestLocationUpdates(</span><br><span class=\"line\">            locationRequest,</span><br><span class=\"line\">            locationCallback,</span><br><span class=\"line\">            Looper.getMainLooper()</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    fun hasLocationPermission(context: Context): Boolean &#123;</span><br><span class=\"line\">        return ContextCompat.checkSelfPermission(</span><br><span class=\"line\">            context,</span><br><span class=\"line\">            Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">        ) == PackageManager.PERMISSION_GRANTED</span><br><span class=\"line\">                &amp;&amp;</span><br><span class=\"line\">                ContextCompat.checkSelfPermission(</span><br><span class=\"line\">                    context,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                ) == PackageManager.PERMISSION_GRANTED</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    fun reverseGeocodeLocation(location: LocationData): String &#123;</span><br><span class=\"line\">        // The Geocoder constructor expects a java.util.Locale</span><br><span class=\"line\">        val geocoder = Geocoder(context, Locale.getDefault())</span><br><span class=\"line\">        val coordinate = LatLng(location.latitude, location.longitude)</span><br><span class=\"line\">        val addresses: MutableList&lt;Address&gt;? =</span><br><span class=\"line\">            geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        return if (addresses?.isNotEmpty() == true) &#123;</span><br><span class=\"line\">            addresses[0]?.getAddressLine(0) ?: &quot;Address line not found&quot;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &quot;Address not found&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class LocationUtils(val context: Context) &#123;</span><br><span class=\"line\">    private val _fusedLocationClient: FusedLocationProviderClient =</span><br><span class=\"line\">        LocationServices.getFusedLocationProviderClient(context)</span><br><span class=\"line\"></span><br><span class=\"line\">    @SuppressLint(&quot;MissingPermission&quot;)</span><br><span class=\"line\">    fun requestLocationUpdates(viewModel: LocationViewModel) &#123;</span><br><span class=\"line\">        val locationCallback = object : LocationCallback() &#123;</span><br><span class=\"line\">            override fun onLocationResult(locationResult: LocationResult) &#123;</span><br><span class=\"line\">                super.onLocationResult(locationResult)</span><br><span class=\"line\">                locationResult.lastLocation?.let &#123;</span><br><span class=\"line\">                    val location = LocationData(latitude = it.latitude, longitude = it.longitude)</span><br><span class=\"line\">                    viewModel.updateLocation(location)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        val locationRequest = LocationRequest.Builder(</span><br><span class=\"line\">            Priority.PRIORITY_HIGH_ACCURACY, 1000</span><br><span class=\"line\">        ).build()</span><br><span class=\"line\">        _fusedLocationClient.requestLocationUpdates(</span><br><span class=\"line\">            locationRequest,</span><br><span class=\"line\">            locationCallback,</span><br><span class=\"line\">            Looper.getMainLooper()</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    fun hasLocationPermission(context: Context): Boolean &#123;</span><br><span class=\"line\">        return ContextCompat.checkSelfPermission(</span><br><span class=\"line\">            context,</span><br><span class=\"line\">            Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">        ) == PackageManager.PERMISSION_GRANTED</span><br><span class=\"line\">                &amp;&amp;</span><br><span class=\"line\">                ContextCompat.checkSelfPermission(</span><br><span class=\"line\">                    context,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                ) == PackageManager.PERMISSION_GRANTED</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    fun reverseGeocodeLocation(location: LocationData): String &#123;</span><br><span class=\"line\">        // The Geocoder constructor expects a java.util.Locale</span><br><span class=\"line\">        val geocoder = Geocoder(context, Locale.getDefault())</span><br><span class=\"line\">        val coordinate = LatLng(location.latitude, location.longitude)</span><br><span class=\"line\">        val addresses: MutableList&lt;Address&gt;? =</span><br><span class=\"line\">            geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)</span><br><span class=\"line\"></span><br><span class=\"line\">        return if (addresses?.isNotEmpty() == true) &#123;</span><br><span class=\"line\">            addresses[0]?.getAddressLine(0) ?: &quot;Address line not found&quot;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &quot;Address not found&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val _fusedLocationClient: FusedLocationProviderClient =</span><br><span class=\"line\">    LocationServices.getFusedLocationProviderClient(context)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val _fusedLocationClient: FusedLocationProviderClient =</span><br><span class=\"line\">    LocationServices.getFusedLocationProviderClient(context)</span><br></pre></td></tr></table></figure>\n\n<p>這是 Google 提供的 <strong>Fused Location Provider API</strong>，能整合 GPS、Wi-Fi、藍牙與行動網路的定位來源，讓定位更準確且省電。<code>_fusedLocationClient</code> 用來執行「請求位置更新」、「停止更新」、「取得最後位置」等操作。</p>\n<h3 id=\"requestLocationUpdates\"><a href=\"#requestLocationUpdates\" class=\"headerlink\" title=\"requestLocationUpdates\"></a>requestLocationUpdates</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@SuppressLint(&quot;MissingPermission&quot;)</span><br><span class=\"line\">fun requestLocationUpdates(viewModel: LocationViewModel) &#123;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@SuppressLint(&quot;MissingPermission&quot;)</span><br><span class=\"line\">fun requestLocationUpdates(viewModel: LocationViewModel) &#123;</span><br></pre></td></tr></table></figure>\n\n<p>⚠️ 注意：這裡用了 <code>@SuppressLint(&quot;MissingPermission&quot;)</code>，代表你<strong>必須在呼叫這個函式前，確認已取得權限</strong>（也就是前面 <code>LocationDisplay</code> 檢查的部分）。</p>\n<p>意思是保證外層一定會先檢查 hasLocationPermission() 才會進來，所以不用再提醒我 MissingPermission。</p>\n<p>這個函式會<strong>每秒更新一次位置</strong>（因為下面設定了 1000 毫秒），然後將新位置傳給你的 <code>LocationViewModel</code>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val locationCallback = object : LocationCallback() &#123;</span><br><span class=\"line\">    override fun onLocationResult(locationResult: LocationResult) &#123;</span><br><span class=\"line\">        super.onLocationResult(locationResult)</span><br><span class=\"line\">        locationResult.lastLocation?.let &#123;</span><br><span class=\"line\">            val location = LocationData(latitude = it.latitude, longitude = it.longitude)</span><br><span class=\"line\">            viewModel.updateLocation(location)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val locationCallback = object : LocationCallback() &#123;</span><br><span class=\"line\">    override fun onLocationResult(locationResult: LocationResult) &#123;</span><br><span class=\"line\">        super.onLocationResult(locationResult)</span><br><span class=\"line\">        locationResult.lastLocation?.let &#123;</span><br><span class=\"line\">            val location = LocationData(latitude = it.latitude, longitude = it.longitude)</span><br><span class=\"line\">            viewModel.updateLocation(location)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>當系統取得新的定位資訊時，會呼叫 <code>onLocationResult</code>。</p>\n<p><code>lastLocation</code> 是最新的 <code>Location</code> 物件（包含緯度與經度）。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.example.locationapp</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">data class LocationData(</span><br><span class=\"line\">    val latitude: Double,</span><br><span class=\"line\">    val longitude: Double</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.example.locationapp</span><br><span class=\"line\"></span><br><span class=\"line\">data class LocationData(</span><br><span class=\"line\">    val latitude: Double,</span><br><span class=\"line\">    val longitude: Double</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p><code>LocationData</code> 是我們定義的資料類別，用來包裝座標。</p>\n<p>呼叫 <code>viewModel.updateLocation(location)</code> → 把資料傳給 ViewModel 更新 UI。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_fusedLocationClient.requestLocationUpdates(</span><br><span class=\"line\">    locationRequest,</span><br><span class=\"line\">    locationCallback,</span><br><span class=\"line\">    Looper.getMainLooper()</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_fusedLocationClient.requestLocationUpdates(</span><br><span class=\"line\">    locationRequest,</span><br><span class=\"line\">    locationCallback,</span><br><span class=\"line\">    Looper.getMainLooper()</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>這行讓 app 持續監聽位置變化。</p>\n<h3 id=\"hasLocationPermission\"><a href=\"#hasLocationPermission\" class=\"headerlink\" title=\"hasLocationPermission\"></a>hasLocationPermission</h3><p><code>LocationUtils</code> 要持有 <code>Context</code>，才能呼叫系統 API（如 <code>ContextCompat.checkSelfPermission</code>）來檢查權限。</p>\n<p>return 這段是重點：<code>ContextCompat.checkSelfPermission()</code> 是Android官方提供的工具，用來檢查 App 是否擁有某個權限。它會回傳一個整數值（<code>PERMISSION_GRANTED</code> 或 <code>PERMISSION_DENIED</code>）。</p>\n<p>這段程式碼的功能就像是你在檢查一個房間的門：</p>\n<blockquote>\n<p>「門有沒有上鎖？如果鎖是開著的，就代表我可以進去。」</p>\n<p><strong><code>ContextCompat</code> (檢查員)：</strong> 你可以把它想像成 Android 系統中的一位<strong>通用檢查員</strong>或<strong>萬用工具箱</strong>。它的工作就是確保你的程式碼在所有不同型號和版本的 Android 手機上都能正常運作（這就是 <code>Compat</code> 兼容性的意思）。</p>\n<p><strong><code>.checkSelfPermission()</code> (檢查方法)：</strong> 這是檢查員專門用來<strong>檢查特定權限狀態</strong>的方法。</p>\n<ul>\n<li><p><strong>參數一 (<code>context</code>)：</strong> 告訴檢查員「在哪個應用程式環境」下進行檢查。</p>\n</li>\n<li><p><strong>參數二 (<code>Manifest.permission.ACCESS_FINE_LOCATION</code>)：</strong> 告訴檢查員「要檢查哪一種權限」。</p>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"為什麼需要-ContextCompat-checkSelfPermission-？\"><a href=\"#為什麼需要-ContextCompat-checkSelfPermission-？\" class=\"headerlink\" title=\"為什麼需要 ContextCompat.checkSelfPermission()？\"></a>為什麼需要 <code>ContextCompat.checkSelfPermission()</code>？</h3><p>我們不直接使用 <code>PackageManager.PERMISSION_GRANTED</code> 進行判斷，是因為 <strong><code>PackageManager.PERMISSION_GRANTED</code> 只是一個「結果代碼」（密碼）</strong>，而 <strong><code>ContextCompat.checkSelfPermission()</code> 才是「執行檢查的動作」</strong>。</p>\n<h3 id=\"reverseGeocodeLocation\"><a href=\"#reverseGeocodeLocation\" class=\"headerlink\" title=\"reverseGeocodeLocation\"></a>reverseGeocodeLocation</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun reverseGeocodeLocation(location: LocationData): String &#123;</span><br><span class=\"line\">    val geocoder = Geocoder(context, Locale.getDefault())</span><br><span class=\"line\">    val coordinate = LatLng(location.latitude, location.longitude)</span><br><span class=\"line\">    val addresses: MutableList&lt;Address&gt;? =</span><br><span class=\"line\">        geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun reverseGeocodeLocation(location: LocationData): String &#123;</span><br><span class=\"line\">    val geocoder = Geocoder(context, Locale.getDefault())</span><br><span class=\"line\">    val coordinate = LatLng(location.latitude, location.longitude)</span><br><span class=\"line\">    val addresses: MutableList&lt;Address&gt;? =</span><br><span class=\"line\">        geocoder.getFromLocation(coordinate.latitude, coordinate.longitude, 1)</span><br></pre></td></tr></table></figure>\n\n<p>用 <code>Geocoder</code> 根據經緯度查詢地點名稱。<code>getFromLocation()</code> 會回傳一個地址列表（可能含國家、城市、街道）。</p>\n<h2 id=\"MainActivity-kt\"><a href=\"#MainActivity-kt\" class=\"headerlink\" title=\"MainActivity.kt\"></a>MainActivity.kt</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Composable</span><br><span class=\"line\">fun MyApp(modifier: Modifier) &#123;</span><br><span class=\"line\">    val context = LocalContext.current</span><br><span class=\"line\">    val locationUtils = LocationUtils(context)</span><br><span class=\"line\">    LocationDisplay(locationUtils = locationUtils, context = context)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Composable</span><br><span class=\"line\">fun MyApp(modifier: Modifier) &#123;</span><br><span class=\"line\">    val context = LocalContext.current</span><br><span class=\"line\">    val locationUtils = LocationUtils(context)</span><br><span class=\"line\">    LocationDisplay(locationUtils = locationUtils, context = context)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : ComponentActivity() &#123;</span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        enableEdgeToEdge()</span><br><span class=\"line\">        setContent &#123;</span><br><span class=\"line\">            val viewModel: LocationViewModel = viewModel()</span><br><span class=\"line\">            LocationAppTheme &#123;</span><br><span class=\"line\">                Scaffold(modifier = Modifier.fillMaxSize()) &#123; innerPadding -&gt;</span><br><span class=\"line\">                    MyApp(viewModel = viewModel,modifier = Modifier.padding(innerPadding))</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class MainActivity : ComponentActivity() &#123;</span><br><span class=\"line\">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class=\"line\">        super.onCreate(savedInstanceState)</span><br><span class=\"line\">        enableEdgeToEdge()</span><br><span class=\"line\">        setContent &#123;</span><br><span class=\"line\">            val viewModel: LocationViewModel = viewModel()</span><br><span class=\"line\">            LocationAppTheme &#123;</span><br><span class=\"line\">                Scaffold(modifier = Modifier.fillMaxSize()) &#123; innerPadding -&gt;</span><br><span class=\"line\">                    MyApp(viewModel = viewModel,modifier = Modifier.padding(innerPadding))</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong><code>Context</code>：</strong> 是一個核心的 Android 系統類別，它提供了應用程式全域資訊，例如資源、資料庫、文件系統路徑，以及存取系統服務（如定位服務）的管道。</p>\n<p><strong><code>LocalContext.current</code>：</strong> 這是 Jetpack Compose 框架提供的一個 <strong>CompositionLocal</strong>。它用於在可組合函數中<strong>存取</strong> Android 應用程式的 <strong><code>Context</code></strong> 物件。</p>\n<p><code>LocationDisplay(locationUtils = locationUtils, context = context)</code> 這行程式碼的作用是<strong>調用</strong>一個名為 <code>LocationDisplay</code> 的 <strong>Compose UI 元件</strong>，向它傳遞所需的資料和環境依賴。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Composable</span><br><span class=\"line\">fun LocationDisplay(</span><br><span class=\"line\">    locationUtils: LocationUtils,</span><br><span class=\"line\">    viewModel: LocationViewModel,</span><br><span class=\"line\">    context: Context</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">    val location = viewModel.location.value</span><br><span class=\"line\">    </span><br><span class=\"line\">    val address = location?.let &#123;</span><br><span class=\"line\">        locationUtils.reverseGeocodeLocation(location)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    val requestPermissionLauncher = rememberLauncherForActivityResult(</span><br><span class=\"line\">        contract = ActivityResultContracts.RequestMultiplePermissions(),</span><br><span class=\"line\">        onResult = &#123; permissions -&gt;</span><br><span class=\"line\">            if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true</span><br><span class=\"line\">                &amp;&amp; permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true</span><br><span class=\"line\">            ) &#123;</span><br><span class=\"line\">                // 擁有 location 權限</span><br><span class=\"line\">                locationUtils.requestLocationUpdates(viewModel = viewModel)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                // 要求權限</span><br><span class=\"line\">                val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">                    context as MainActivity,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">                ) || ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">                    context as MainActivity,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                )</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">                if (rationaleRequired) &#123;</span><br><span class=\"line\">                    Toast.makeText(</span><br><span class=\"line\">                        context,</span><br><span class=\"line\">                        &quot;Location Permission is required for this feature to work&quot;,</span><br><span class=\"line\">                        Toast.LENGTH_LONG</span><br><span class=\"line\">                    ).show()</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    Toast.makeText(</span><br><span class=\"line\">                        context,</span><br><span class=\"line\">                        &quot;Location Permission is required, Please enable from settings&quot;,</span><br><span class=\"line\">                        Toast.LENGTH_LONG</span><br><span class=\"line\">                    ).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    Column(</span><br><span class=\"line\">        modifier = Modifier.fillMaxSize(),</span><br><span class=\"line\">        horizontalAlignment = Alignment.CenterHorizontally,</span><br><span class=\"line\">        verticalArrangement = Arrangement.Center</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">        if(location != null) &#123;</span><br><span class=\"line\">            Text(&quot;Address: $&#123;location.latitude&#125; $&#123;location.longitude&#125; \\n $address &quot;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Text(text = &quot;Location not available&quot;)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        Button(onClick = &#123;</span><br><span class=\"line\">            if (locationUtils.hasLocationPermission(context)) &#123;</span><br><span class=\"line\">                locationUtils.requestLocationUpdates(viewModel)</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                requestPermissionLauncher.launch(</span><br><span class=\"line\">                    arrayOf(</span><br><span class=\"line\">                        Manifest.permission.ACCESS_FINE_LOCATION,</span><br><span class=\"line\">                        Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                    )</span><br><span class=\"line\">                )</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;) &#123;</span><br><span class=\"line\">            Text(text = &quot;Get Location&quot;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Composable</span><br><span class=\"line\">fun LocationDisplay(</span><br><span class=\"line\">    locationUtils: LocationUtils,</span><br><span class=\"line\">    viewModel: LocationViewModel,</span><br><span class=\"line\">    context: Context</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">    val location = viewModel.location.value</span><br><span class=\"line\">    </span><br><span class=\"line\">    val address = location?.let &#123;</span><br><span class=\"line\">        locationUtils.reverseGeocodeLocation(location)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    val requestPermissionLauncher = rememberLauncherForActivityResult(</span><br><span class=\"line\">        contract = ActivityResultContracts.RequestMultiplePermissions(),</span><br><span class=\"line\">        onResult = &#123; permissions -&gt;</span><br><span class=\"line\">            if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true</span><br><span class=\"line\">                &amp;&amp; permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true</span><br><span class=\"line\">            ) &#123;</span><br><span class=\"line\">                // 擁有 location 權限</span><br><span class=\"line\">                locationUtils.requestLocationUpdates(viewModel = viewModel)</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                // 要求權限</span><br><span class=\"line\">                val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">                    context as MainActivity,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">                ) || ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">                    context as MainActivity,</span><br><span class=\"line\">                    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                )</span><br><span class=\"line\"></span><br><span class=\"line\">                if (rationaleRequired) &#123;</span><br><span class=\"line\">                    Toast.makeText(</span><br><span class=\"line\">                        context,</span><br><span class=\"line\">                        &quot;Location Permission is required for this feature to work&quot;,</span><br><span class=\"line\">                        Toast.LENGTH_LONG</span><br><span class=\"line\">                    ).show()</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    Toast.makeText(</span><br><span class=\"line\">                        context,</span><br><span class=\"line\">                        &quot;Location Permission is required, Please enable from settings&quot;,</span><br><span class=\"line\">                        Toast.LENGTH_LONG</span><br><span class=\"line\">                    ).show()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\"></span><br><span class=\"line\">    Column(</span><br><span class=\"line\">        modifier = Modifier.fillMaxSize(),</span><br><span class=\"line\">        horizontalAlignment = Alignment.CenterHorizontally,</span><br><span class=\"line\">        verticalArrangement = Arrangement.Center</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">        if(location != null) &#123;</span><br><span class=\"line\">            Text(&quot;Address: $&#123;location.latitude&#125; $&#123;location.longitude&#125; \\n $address &quot;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Text(text = &quot;Location not available&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">        Button(onClick = &#123;</span><br><span class=\"line\">            if (locationUtils.hasLocationPermission(context)) &#123;</span><br><span class=\"line\">                locationUtils.requestLocationUpdates(viewModel)</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                requestPermissionLauncher.launch(</span><br><span class=\"line\">                    arrayOf(</span><br><span class=\"line\">                        Manifest.permission.ACCESS_FINE_LOCATION,</span><br><span class=\"line\">                        Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">                    )</span><br><span class=\"line\">                )</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;) &#123;</span><br><span class=\"line\">            Text(text = &quot;Get Location&quot;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>主要公能：顯示一個文字 + 按鈕，並處理按下按鈕後檢查或請求定位權限。</p>\n<p>contract &#x3D; ActivityResultContracts.RequestMultiplePermissions()</p>\n<p>表示這個 launcher 可以一次請求多個權限（這裡是 coarse + fine）。</p>\n<p><code>onResult = &#123; permissions -&gt; ... &#125;</code></p>\n<p>系統對話框關閉後，會回傳使用者是否授權。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true</span><br><span class=\"line\">    &amp;&amp; permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">    // 已擁有定位權限</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    // 尚未取得權限，顯示提示</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (permissions[Manifest.permission.ACCESS_COARSE_LOCATION] == true</span><br><span class=\"line\">    &amp;&amp; permissions[Manifest.permission.ACCESS_FINE_LOCATION] == true</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">    // 已擁有定位權限</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    // 尚未取得權限，顯示提示</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>若兩個權限都有允許，目前就什麼都不做；否則，進入「沒有權限」的分支。</p>\n<p>如果沒權限 → 顯示提示 Toast</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">    context as MainActivity,</span><br><span class=\"line\">    Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">) || ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">    context as MainActivity,</span><br><span class=\"line\">    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">val rationaleRequired = ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">    context as MainActivity,</span><br><span class=\"line\">    Manifest.permission.ACCESS_FINE_LOCATION</span><br><span class=\"line\">) || ActivityCompat.shouldShowRequestPermissionRationale(</span><br><span class=\"line\">    context as MainActivity,</span><br><span class=\"line\">    Manifest.permission.ACCESS_COARSE_LOCATION</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>shouldShowRequestPermissionRationale(…)</p>\n<p>這是 Android 的 API，用來判斷：</p>\n<ul>\n<li><p>使用者曾拒絕過權限（但沒勾「不再詢問」 → 回傳 <code>true</code></p>\n</li>\n<li><p>使用者勾了「不再詢問」或 第一次詢問 → 回傳 <code>false</code></p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (rationaleRequired) &#123;</span><br><span class=\"line\">    Toast.makeText(context, &quot;Location Permission is required for this feature to work&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    Toast.makeText(context, &quot;Location Permission is required, Please enable from settings&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (rationaleRequired) &#123;</span><br><span class=\"line\">    Toast.makeText(context, &quot;Location Permission is required for this feature to work&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">&#125; else &#123;</span><br><span class=\"line\">    Toast.makeText(context, &quot;Location Permission is required, Please enable from settings&quot;, Toast.LENGTH_LONG).show()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/image-1.png\"></p>\n<p><img src=\"/images/image.png\"></p>\n<p><img src=\"/images/%E8%9E%A2%E5%B9%95%E6%93%B7%E5%8F%96%E7%95%AB%E9%9D%A2-2025-10-19-214356.png\"></p>\n<h2 id=\"LocationViewModel-kt\"><a href=\"#LocationViewModel-kt\" class=\"headerlink\" title=\"LocationViewModel.kt\"></a>LocationViewModel.kt</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.example.locationapp</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">import androidx.compose.runtime.State</span><br><span class=\"line\">import androidx.compose.runtime.mutableStateOf</span><br><span class=\"line\">import androidx.lifecycle.ViewModel</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">class LocationViewModel: ViewModel() &#123;</span><br><span class=\"line\">    private val _location = mutableStateOf&lt;LocationData?&gt;(null)</span><br><span class=\"line\">    val location: State&lt;LocationData?&gt; = _location</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    fun updateLocation(newLocation: LocationData) &#123;</span><br><span class=\"line\">        _location.value = newLocation</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.example.locationapp</span><br><span class=\"line\"></span><br><span class=\"line\">import androidx.compose.runtime.State</span><br><span class=\"line\">import androidx.compose.runtime.mutableStateOf</span><br><span class=\"line\">import androidx.lifecycle.ViewModel</span><br><span class=\"line\"></span><br><span class=\"line\">class LocationViewModel: ViewModel() &#123;</span><br><span class=\"line\">    private val _location = mutableStateOf&lt;LocationData?&gt;(null)</span><br><span class=\"line\">    val location: State&lt;LocationData?&gt; = _location</span><br><span class=\"line\"></span><br><span class=\"line\">    fun updateLocation(newLocation: LocationData) &#123;</span><br><span class=\"line\">        _location.value = newLocation</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val _location = mutableStateOf&lt;LocationData?&gt;(null)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">private val _location = mutableStateOf&lt;LocationData?&gt;(null)</span><br></pre></td></tr></table></figure>\n\n<p>mutableStateOf 它包裝了一個變數，當值改變時，Compose UI 會<strong>自動重新組合（recompose）</strong>。</p>\n<p><code>LocationData?</code> → 泛型裡面的 <code>?</code> 代表可以是 <code>null</code>，表示「可能還沒取得位置」。</p>\n<p><code>_location</code> 是私有的可變，<code>location</code> 是公開的唯讀。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun updateLocation(newLocation: LocationData) &#123;</span><br><span class=\"line\">    _location.value = newLocation</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fun updateLocation(newLocation: LocationData) &#123;</span><br><span class=\"line\">    _location.value = newLocation</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>當 <code>LocationUtils</code> 拿到新座標後，會呼叫updateLocation更新座標。</p>\n"},{"layout":"post","title":"CPU 排程演算法之等待時間計算","date":"2025-10-20T16:00:00.000Z","top_img":"/images/CPU-排程.png","cover":"/images/CPU-排程.png","_content":"\n這次的作業主要是要根據以下四個行程（Processes），分別使用不同的 CPU 排程演算法，計算每個演算法的平均等待時間（Average Waiting Time, WT）。\n\n| 行程 | 到達時間 A | 分割時間 Burst | 優先順序 |\n| --- | --- | --- | --- |\n| P1 | 0 | 8 | 3 |\n| P2 | 1 | 4 | 1 |\n| P3 | 2 | 9 | 4 |\n| P4 | 3 | 5 | 2 |\n\n單位：時間單位\n\n需要計算的排程演算法如下：\n\n1. FCFS（First Come First Serve，先來先服務）\n\n3. SJF（Shortest Job First，非搶先）\n\n5. SRTF（Shortest Remaining Time First，可搶先）\n\n7. RR（Round Robin，時間片 q=4）\n\n9. Priority（分為非搶先與可搶先兩種）\n\n## 一、FCFS\n\n![](/images/image-3-1024x604.png)\n\n計算等待時間：\n\n- WT₁ = 8 - 8 = 0\n\n- WT₂ = 12 - 5 = 7\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 17 - 8 = 9\n\n平均等待時間：  \n(0 + 7 + 15 + 9) / 4 = **8.75**\n\n* * *\n\n## 二、SJF\n\n![](/images/image-4-1024x604.png)\n\n計算等待時間：\n\n- WT₁ = 8 - 8 = 0\n\n- WT₂ = 12 - 5 = 7\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 17 - 8 = 9\n\n平均等待時間：  \n(0 + 7 + 15 + 9) / 4 = **7.75**\n\n* * *\n\n## 三、SRTF\n\n![](/images/image-5-1024x669.png)\n\nP1 : 8 -> 7 -> 0\n\nP2 : 4 -> 0\n\nP3 : 9 -> 0\n\nP4 : 5 -> 0\n\n計算等待時間：\n\n- WT₁ = 17 - 8 = 9\n\n- WT₂ = 5 - 5 = 0\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 10 - 8 = 2\n\n平均等待時間：  \n(9 + 0 + 15 + 2) / 4 = **6.5**\n\n* * *\n\n## 四、RR（時間片 q = 4）\n\n![](/images/image-6-1024x604.png)\n\nP1 : 8 -> 4 -> 0\n\nP2 : 4 -> 0\n\nP3 : 9 -> 5 -> 1 -> 0\n\nP4 : 5 -> 1 -> 0\n\n行程執行順序：P1 → P2 → P3 → P4 → P1 → P3 → P4 → P3\n\n計算等待時間：\n\n- WT₁ = 20 - 8 = 12\n\n- WT₂ = 8 - 5 = 3\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 25 - 8 = 17\n\n平均等待時間：  \n(12 + 3 + 15 + 17) / 4 = **11.75**\n\n* * *\n\n## 五、Priority\n\n### (1) 非搶先 Priority\n\n![](/images/image-8-1024x604.png)\n\n行程執行順序：P1 → P2 → P4 → P3\n\n計算等待時間：\n\n- WT₁ = 8 - 8 = 0\n\n- WT₂ = 12 - 5 = 7\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 17 - 8 = 9\n\n平均等待時間：  \n(0 + 7 + 15 + 9) / 4 = **7.75**\n\n* * *\n\n### (2) 可搶先 Priority\n\n![](/images/image-9-1024x604.png)\n\nP1 : 8 -> 7 -> 0\n\nP2 : 4 -> 0\n\nP3 : 9 -> 0\n\nP4 : 5 -> 0\n\n行程執行順序：P1 → P2 → P4 -> P1 → P3\n\n計算等待時間：\n\n- WT₁ = 17 - 8 = 9\n\n- WT₂ = 5 - 5 = 0\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 10 - 8 = 2\n\n平均等待時間：  \n(9 + 0 + 15 + 2) / 4 = **6.5**\n\n* * *\n\n## 結論\n\n| 排程演算法 | 平均等待時間 (WT) |\n| --- | --- |\n| FCFS | 8.75 |\n| SJF（非搶先） | 7.75 |\n| SRTF（可搶先） | 6.5 |\n| RR（q=4） | 11.75 |\n| Priority（非搶先） | 7.75 |\n| Priority（可搶先） | 6.5 |\n\n由結果可看出，**可搶先型的 SRTF 與 Priority 演算法**在此案例中具有最短的平均等待時間（6.5），效率最佳。\n","source":"_posts/cpu-job-time.md","raw":"---\nlayout: post\ntitle: CPU 排程演算法之等待時間計算\ndate: 2025-10-21\ntags:\ncategories:\n  - \"operating-system\"\ntop_img: /images/CPU-排程.png\ncover: /images/CPU-排程.png\n---\n\n這次的作業主要是要根據以下四個行程（Processes），分別使用不同的 CPU 排程演算法，計算每個演算法的平均等待時間（Average Waiting Time, WT）。\n\n| 行程 | 到達時間 A | 分割時間 Burst | 優先順序 |\n| --- | --- | --- | --- |\n| P1 | 0 | 8 | 3 |\n| P2 | 1 | 4 | 1 |\n| P3 | 2 | 9 | 4 |\n| P4 | 3 | 5 | 2 |\n\n單位：時間單位\n\n需要計算的排程演算法如下：\n\n1. FCFS（First Come First Serve，先來先服務）\n\n3. SJF（Shortest Job First，非搶先）\n\n5. SRTF（Shortest Remaining Time First，可搶先）\n\n7. RR（Round Robin，時間片 q=4）\n\n9. Priority（分為非搶先與可搶先兩種）\n\n## 一、FCFS\n\n![](/images/image-3-1024x604.png)\n\n計算等待時間：\n\n- WT₁ = 8 - 8 = 0\n\n- WT₂ = 12 - 5 = 7\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 17 - 8 = 9\n\n平均等待時間：  \n(0 + 7 + 15 + 9) / 4 = **8.75**\n\n* * *\n\n## 二、SJF\n\n![](/images/image-4-1024x604.png)\n\n計算等待時間：\n\n- WT₁ = 8 - 8 = 0\n\n- WT₂ = 12 - 5 = 7\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 17 - 8 = 9\n\n平均等待時間：  \n(0 + 7 + 15 + 9) / 4 = **7.75**\n\n* * *\n\n## 三、SRTF\n\n![](/images/image-5-1024x669.png)\n\nP1 : 8 -> 7 -> 0\n\nP2 : 4 -> 0\n\nP3 : 9 -> 0\n\nP4 : 5 -> 0\n\n計算等待時間：\n\n- WT₁ = 17 - 8 = 9\n\n- WT₂ = 5 - 5 = 0\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 10 - 8 = 2\n\n平均等待時間：  \n(9 + 0 + 15 + 2) / 4 = **6.5**\n\n* * *\n\n## 四、RR（時間片 q = 4）\n\n![](/images/image-6-1024x604.png)\n\nP1 : 8 -> 4 -> 0\n\nP2 : 4 -> 0\n\nP3 : 9 -> 5 -> 1 -> 0\n\nP4 : 5 -> 1 -> 0\n\n行程執行順序：P1 → P2 → P3 → P4 → P1 → P3 → P4 → P3\n\n計算等待時間：\n\n- WT₁ = 20 - 8 = 12\n\n- WT₂ = 8 - 5 = 3\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 25 - 8 = 17\n\n平均等待時間：  \n(12 + 3 + 15 + 17) / 4 = **11.75**\n\n* * *\n\n## 五、Priority\n\n### (1) 非搶先 Priority\n\n![](/images/image-8-1024x604.png)\n\n行程執行順序：P1 → P2 → P4 → P3\n\n計算等待時間：\n\n- WT₁ = 8 - 8 = 0\n\n- WT₂ = 12 - 5 = 7\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 17 - 8 = 9\n\n平均等待時間：  \n(0 + 7 + 15 + 9) / 4 = **7.75**\n\n* * *\n\n### (2) 可搶先 Priority\n\n![](/images/image-9-1024x604.png)\n\nP1 : 8 -> 7 -> 0\n\nP2 : 4 -> 0\n\nP3 : 9 -> 0\n\nP4 : 5 -> 0\n\n行程執行順序：P1 → P2 → P4 -> P1 → P3\n\n計算等待時間：\n\n- WT₁ = 17 - 8 = 9\n\n- WT₂ = 5 - 5 = 0\n\n- WT₃ = 26 - 11 = 15\n\n- WT₄ = 10 - 8 = 2\n\n平均等待時間：  \n(9 + 0 + 15 + 2) / 4 = **6.5**\n\n* * *\n\n## 結論\n\n| 排程演算法 | 平均等待時間 (WT) |\n| --- | --- |\n| FCFS | 8.75 |\n| SJF（非搶先） | 7.75 |\n| SRTF（可搶先） | 6.5 |\n| RR（q=4） | 11.75 |\n| Priority（非搶先） | 7.75 |\n| Priority（可搶先） | 6.5 |\n\n由結果可看出，**可搶先型的 SRTF 與 Priority 演算法**在此案例中具有最短的平均等待時間（6.5），效率最佳。\n","slug":"cpu-job-time","published":1,"updated":"2026-01-28T14:17:25.062Z","_id":"cmkxg0krr0005rb8z4t5qgc3p","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>這次的作業主要是要根據以下四個行程（Processes），分別使用不同的 CPU 排程演算法，計算每個演算法的平均等待時間（Average Waiting Time, WT）。</p>\n<table>\n<thead>\n<tr>\n<th>行程</th>\n<th>到達時間 A</th>\n<th>分割時間 Burst</th>\n<th>優先順序</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>P1</td>\n<td>0</td>\n<td>8</td>\n<td>3</td>\n</tr>\n<tr>\n<td>P2</td>\n<td>1</td>\n<td>4</td>\n<td>1</td>\n</tr>\n<tr>\n<td>P3</td>\n<td>2</td>\n<td>9</td>\n<td>4</td>\n</tr>\n<tr>\n<td>P4</td>\n<td>3</td>\n<td>5</td>\n<td>2</td>\n</tr>\n</tbody></table>\n<p>單位：時間單位</p>\n<p>需要計算的排程演算法如下：</p>\n<ol>\n<li><p>FCFS（First Come First Serve，先來先服務）</p>\n</li>\n<li><p>SJF（Shortest Job First，非搶先）</p>\n</li>\n<li><p>SRTF（Shortest Remaining Time First，可搶先）</p>\n</li>\n<li><p>RR（Round Robin，時間片 q&#x3D;4）</p>\n</li>\n<li><p>Priority（分為非搶先與可搶先兩種）</p>\n</li>\n</ol>\n<h2 id=\"一、FCFS\"><a href=\"#一、FCFS\" class=\"headerlink\" title=\"一、FCFS\"></a>一、FCFS</h2><p><img src=\"/images/image-3-1024x604.png\"></p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 8 - 8 &#x3D; 0</p>\n</li>\n<li><p>WT₂ &#x3D; 12 - 5 &#x3D; 7</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 17 - 8 &#x3D; 9</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(0 + 7 + 15 + 9) &#x2F; 4 &#x3D; <strong>8.75</strong></p>\n<hr>\n<h2 id=\"二、SJF\"><a href=\"#二、SJF\" class=\"headerlink\" title=\"二、SJF\"></a>二、SJF</h2><p><img src=\"/images/image-4-1024x604.png\"></p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 8 - 8 &#x3D; 0</p>\n</li>\n<li><p>WT₂ &#x3D; 12 - 5 &#x3D; 7</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 17 - 8 &#x3D; 9</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(0 + 7 + 15 + 9) &#x2F; 4 &#x3D; <strong>7.75</strong></p>\n<hr>\n<h2 id=\"三、SRTF\"><a href=\"#三、SRTF\" class=\"headerlink\" title=\"三、SRTF\"></a>三、SRTF</h2><p><img src=\"/images/image-5-1024x669.png\"></p>\n<p>P1 : 8 -&gt; 7 -&gt; 0</p>\n<p>P2 : 4 -&gt; 0</p>\n<p>P3 : 9 -&gt; 0</p>\n<p>P4 : 5 -&gt; 0</p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 17 - 8 &#x3D; 9</p>\n</li>\n<li><p>WT₂ &#x3D; 5 - 5 &#x3D; 0</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 10 - 8 &#x3D; 2</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(9 + 0 + 15 + 2) &#x2F; 4 &#x3D; <strong>6.5</strong></p>\n<hr>\n<h2 id=\"四、RR（時間片-q-4）\"><a href=\"#四、RR（時間片-q-4）\" class=\"headerlink\" title=\"四、RR（時間片 q &#x3D; 4）\"></a>四、RR（時間片 q &#x3D; 4）</h2><p><img src=\"/images/image-6-1024x604.png\"></p>\n<p>P1 : 8 -&gt; 4 -&gt; 0</p>\n<p>P2 : 4 -&gt; 0</p>\n<p>P3 : 9 -&gt; 5 -&gt; 1 -&gt; 0</p>\n<p>P4 : 5 -&gt; 1 -&gt; 0</p>\n<p>行程執行順序：P1 → P2 → P3 → P4 → P1 → P3 → P4 → P3</p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 20 - 8 &#x3D; 12</p>\n</li>\n<li><p>WT₂ &#x3D; 8 - 5 &#x3D; 3</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 25 - 8 &#x3D; 17</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(12 + 3 + 15 + 17) &#x2F; 4 &#x3D; <strong>11.75</strong></p>\n<hr>\n<h2 id=\"五、Priority\"><a href=\"#五、Priority\" class=\"headerlink\" title=\"五、Priority\"></a>五、Priority</h2><h3 id=\"1-非搶先-Priority\"><a href=\"#1-非搶先-Priority\" class=\"headerlink\" title=\"(1) 非搶先 Priority\"></a>(1) 非搶先 Priority</h3><p><img src=\"/images/image-8-1024x604.png\"></p>\n<p>行程執行順序：P1 → P2 → P4 → P3</p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 8 - 8 &#x3D; 0</p>\n</li>\n<li><p>WT₂ &#x3D; 12 - 5 &#x3D; 7</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 17 - 8 &#x3D; 9</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(0 + 7 + 15 + 9) &#x2F; 4 &#x3D; <strong>7.75</strong></p>\n<hr>\n<h3 id=\"2-可搶先-Priority\"><a href=\"#2-可搶先-Priority\" class=\"headerlink\" title=\"(2) 可搶先 Priority\"></a>(2) 可搶先 Priority</h3><p><img src=\"/images/image-9-1024x604.png\"></p>\n<p>P1 : 8 -&gt; 7 -&gt; 0</p>\n<p>P2 : 4 -&gt; 0</p>\n<p>P3 : 9 -&gt; 0</p>\n<p>P4 : 5 -&gt; 0</p>\n<p>行程執行順序：P1 → P2 → P4 -&gt; P1 → P3</p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 17 - 8 &#x3D; 9</p>\n</li>\n<li><p>WT₂ &#x3D; 5 - 5 &#x3D; 0</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 10 - 8 &#x3D; 2</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(9 + 0 + 15 + 2) &#x2F; 4 &#x3D; <strong>6.5</strong></p>\n<hr>\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論\"></a>結論</h2><table>\n<thead>\n<tr>\n<th>排程演算法</th>\n<th>平均等待時間 (WT)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>FCFS</td>\n<td>8.75</td>\n</tr>\n<tr>\n<td>SJF（非搶先）</td>\n<td>7.75</td>\n</tr>\n<tr>\n<td>SRTF（可搶先）</td>\n<td>6.5</td>\n</tr>\n<tr>\n<td>RR（q&#x3D;4）</td>\n<td>11.75</td>\n</tr>\n<tr>\n<td>Priority（非搶先）</td>\n<td>7.75</td>\n</tr>\n<tr>\n<td>Priority（可搶先）</td>\n<td>6.5</td>\n</tr>\n</tbody></table>\n<p>由結果可看出，<strong>可搶先型的 SRTF 與 Priority 演算法</strong>在此案例中具有最短的平均等待時間（6.5），效率最佳。</p>\n","excerpt":"","more":"<p>這次的作業主要是要根據以下四個行程（Processes），分別使用不同的 CPU 排程演算法，計算每個演算法的平均等待時間（Average Waiting Time, WT）。</p>\n<table>\n<thead>\n<tr>\n<th>行程</th>\n<th>到達時間 A</th>\n<th>分割時間 Burst</th>\n<th>優先順序</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>P1</td>\n<td>0</td>\n<td>8</td>\n<td>3</td>\n</tr>\n<tr>\n<td>P2</td>\n<td>1</td>\n<td>4</td>\n<td>1</td>\n</tr>\n<tr>\n<td>P3</td>\n<td>2</td>\n<td>9</td>\n<td>4</td>\n</tr>\n<tr>\n<td>P4</td>\n<td>3</td>\n<td>5</td>\n<td>2</td>\n</tr>\n</tbody></table>\n<p>單位：時間單位</p>\n<p>需要計算的排程演算法如下：</p>\n<ol>\n<li><p>FCFS（First Come First Serve，先來先服務）</p>\n</li>\n<li><p>SJF（Shortest Job First，非搶先）</p>\n</li>\n<li><p>SRTF（Shortest Remaining Time First，可搶先）</p>\n</li>\n<li><p>RR（Round Robin，時間片 q&#x3D;4）</p>\n</li>\n<li><p>Priority（分為非搶先與可搶先兩種）</p>\n</li>\n</ol>\n<h2 id=\"一、FCFS\"><a href=\"#一、FCFS\" class=\"headerlink\" title=\"一、FCFS\"></a>一、FCFS</h2><p><img src=\"/images/image-3-1024x604.png\"></p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 8 - 8 &#x3D; 0</p>\n</li>\n<li><p>WT₂ &#x3D; 12 - 5 &#x3D; 7</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 17 - 8 &#x3D; 9</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(0 + 7 + 15 + 9) &#x2F; 4 &#x3D; <strong>8.75</strong></p>\n<hr>\n<h2 id=\"二、SJF\"><a href=\"#二、SJF\" class=\"headerlink\" title=\"二、SJF\"></a>二、SJF</h2><p><img src=\"/images/image-4-1024x604.png\"></p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 8 - 8 &#x3D; 0</p>\n</li>\n<li><p>WT₂ &#x3D; 12 - 5 &#x3D; 7</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 17 - 8 &#x3D; 9</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(0 + 7 + 15 + 9) &#x2F; 4 &#x3D; <strong>7.75</strong></p>\n<hr>\n<h2 id=\"三、SRTF\"><a href=\"#三、SRTF\" class=\"headerlink\" title=\"三、SRTF\"></a>三、SRTF</h2><p><img src=\"/images/image-5-1024x669.png\"></p>\n<p>P1 : 8 -&gt; 7 -&gt; 0</p>\n<p>P2 : 4 -&gt; 0</p>\n<p>P3 : 9 -&gt; 0</p>\n<p>P4 : 5 -&gt; 0</p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 17 - 8 &#x3D; 9</p>\n</li>\n<li><p>WT₂ &#x3D; 5 - 5 &#x3D; 0</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 10 - 8 &#x3D; 2</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(9 + 0 + 15 + 2) &#x2F; 4 &#x3D; <strong>6.5</strong></p>\n<hr>\n<h2 id=\"四、RR（時間片-q-4）\"><a href=\"#四、RR（時間片-q-4）\" class=\"headerlink\" title=\"四、RR（時間片 q &#x3D; 4）\"></a>四、RR（時間片 q &#x3D; 4）</h2><p><img src=\"/images/image-6-1024x604.png\"></p>\n<p>P1 : 8 -&gt; 4 -&gt; 0</p>\n<p>P2 : 4 -&gt; 0</p>\n<p>P3 : 9 -&gt; 5 -&gt; 1 -&gt; 0</p>\n<p>P4 : 5 -&gt; 1 -&gt; 0</p>\n<p>行程執行順序：P1 → P2 → P3 → P4 → P1 → P3 → P4 → P3</p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 20 - 8 &#x3D; 12</p>\n</li>\n<li><p>WT₂ &#x3D; 8 - 5 &#x3D; 3</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 25 - 8 &#x3D; 17</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(12 + 3 + 15 + 17) &#x2F; 4 &#x3D; <strong>11.75</strong></p>\n<hr>\n<h2 id=\"五、Priority\"><a href=\"#五、Priority\" class=\"headerlink\" title=\"五、Priority\"></a>五、Priority</h2><h3 id=\"1-非搶先-Priority\"><a href=\"#1-非搶先-Priority\" class=\"headerlink\" title=\"(1) 非搶先 Priority\"></a>(1) 非搶先 Priority</h3><p><img src=\"/images/image-8-1024x604.png\"></p>\n<p>行程執行順序：P1 → P2 → P4 → P3</p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 8 - 8 &#x3D; 0</p>\n</li>\n<li><p>WT₂ &#x3D; 12 - 5 &#x3D; 7</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 17 - 8 &#x3D; 9</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(0 + 7 + 15 + 9) &#x2F; 4 &#x3D; <strong>7.75</strong></p>\n<hr>\n<h3 id=\"2-可搶先-Priority\"><a href=\"#2-可搶先-Priority\" class=\"headerlink\" title=\"(2) 可搶先 Priority\"></a>(2) 可搶先 Priority</h3><p><img src=\"/images/image-9-1024x604.png\"></p>\n<p>P1 : 8 -&gt; 7 -&gt; 0</p>\n<p>P2 : 4 -&gt; 0</p>\n<p>P3 : 9 -&gt; 0</p>\n<p>P4 : 5 -&gt; 0</p>\n<p>行程執行順序：P1 → P2 → P4 -&gt; P1 → P3</p>\n<p>計算等待時間：</p>\n<ul>\n<li><p>WT₁ &#x3D; 17 - 8 &#x3D; 9</p>\n</li>\n<li><p>WT₂ &#x3D; 5 - 5 &#x3D; 0</p>\n</li>\n<li><p>WT₃ &#x3D; 26 - 11 &#x3D; 15</p>\n</li>\n<li><p>WT₄ &#x3D; 10 - 8 &#x3D; 2</p>\n</li>\n</ul>\n<p>平均等待時間：<br>(9 + 0 + 15 + 2) &#x2F; 4 &#x3D; <strong>6.5</strong></p>\n<hr>\n<h2 id=\"結論\"><a href=\"#結論\" class=\"headerlink\" title=\"結論\"></a>結論</h2><table>\n<thead>\n<tr>\n<th>排程演算法</th>\n<th>平均等待時間 (WT)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>FCFS</td>\n<td>8.75</td>\n</tr>\n<tr>\n<td>SJF（非搶先）</td>\n<td>7.75</td>\n</tr>\n<tr>\n<td>SRTF（可搶先）</td>\n<td>6.5</td>\n</tr>\n<tr>\n<td>RR（q&#x3D;4）</td>\n<td>11.75</td>\n</tr>\n<tr>\n<td>Priority（非搶先）</td>\n<td>7.75</td>\n</tr>\n<tr>\n<td>Priority（可搶先）</td>\n<td>6.5</td>\n</tr>\n</tbody></table>\n<p>由結果可看出，<strong>可搶先型的 SRTF 與 Priority 演算法</strong>在此案例中具有最短的平均等待時間（6.5），效率最佳。</p>\n"},{"layout":"post","title":"Training a Classifier","date":"2025-10-28T16:00:00.000Z","top_img":"/images/Pytorch.png","cover":"/images/Pytorch.png","_content":"\n程式碼與資料參考來源：[https://docs.pytorch.org/tutorials/beginner/blitz/cifar10\\_tutorial.html#define-a-convolutional-neural-network](https://docs.pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html#define-a-convolutional-neural-network)\n\n```\nimport torch\nimport torchvision\nimport torchvision.transforms as transforms\n```\n\n```\nimport torch\nimport torchvision\nimport torchvision.transforms as transforms\n```\n\n```\ntransform = transforms.Compose(\n    [transforms.ToTensor(),\n     transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))])\n<div></div>\nbatch_size = 4\n<div></div>\ntrainset = torchvision.datasets.CIFAR10(root='./data', train=True,\n                                        download=True, transform=transform)\ntrainloader = torch.utils.data.DataLoader(trainset, batch_size=batch_size,\n                                          shuffle=True, num_workers=2)\n<div></div>\ntestset = torchvision.datasets.CIFAR10(root='./data', train=False,\n                                       download=True, transform=transform)\ntestloader = torch.utils.data.DataLoader(testset, batch_size=batch_size,\n                                         shuffle=False, num_workers=2)\n<div></div>\nclasses = ('plane', 'car', 'bird', 'cat',\n           'deer', 'dog', 'frog', 'horse', 'ship', 'truck')\n```\n\n```\ntransform = transforms.Compose(\n    [transforms.ToTensor(),\n     transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))])\n\nbatch_size = 4\n\ntrainset = torchvision.datasets.CIFAR10(root='./data', train=True,\n                                        download=True, transform=transform)\ntrainloader = torch.utils.data.DataLoader(trainset, batch_size=batch_size,\n                                          shuffle=True, num_workers=2)\n\ntestset = torchvision.datasets.CIFAR10(root='./data', train=False,\n                                       download=True, transform=transform)\ntestloader = torch.utils.data.DataLoader(testset, batch_size=batch_size,\n                                         shuffle=False, num_workers=2)\n\nclasses = ('plane', 'car', 'bird', 'cat',\n           'deer', 'dog', 'frog', 'horse', 'ship', 'truck')\n```\n\n這段程式主要的目的，是建立一個可以讓 PyTorch 模型方便使用的影像資料載入流程。首先，程式定義了一個名為 `transform` 的轉換流程，這個轉換由兩個步驟組成。第一個步驟 `transforms.ToTensor()` 是把原本的影像（可能是 PIL Image 或 numpy 陣列）轉成 PyTorch 可以處理的 Tensor 格式，並且把像素值從 0～255 縮放到 0～1 之間。第二個步驟 `transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))` 則是將每個顏色通道進行標準化，把影像的數值範圍轉換成 -1 到 1 之間，這樣能讓模型在訓練時更穩定、更容易收斂。\n\n接著，`batch_size = 4` 表示每次從資料集中取出四張圖片，組成一個小批次（batch）來訓練。這樣做可以減少記憶體使用量，並加快訓練速度。\n\n在建立訓練資料集時，使用了 `torchvision.datasets.CIFAR10` 這個內建的資料集。CIFAR-10 是一個常見的影像分類資料集，裡面有 10 種不同類別的物體（例如飛機、汽車、貓、狗等）。參數 `root='./data'` 代表資料會被存放在專案資料夾中的 `data` 目錄下；`train=True` 指定要載入訓練資料；`download=True` 讓程式在本地沒有資料時自動從網路下載；而 `transform=transform` 則確保每張影像在載入時都會先經過剛剛定義的轉換流程。\n\n建立好訓練資料集後，`trainloader` 透過 `torch.utils.data.DataLoader` 將資料集包裝成可以分批次讀取的形式。這個物件會在訓練時自動提供圖片與標籤。`shuffle=True` 表示在每個訓練輪次（epoch）開始前，資料都會被隨機打亂，避免模型記住資料的順序而影響學習。`num_workers=2` 則是設定使用兩個背景執行緒加快資料載入的速度。\n\n測試資料的部分幾乎相同，只是 `train=False` 代表這次載入的是測試資料集，並且 `shuffle=False`，確保測試資料的順序固定，方便在評估模型時對照結果。\n\n最後，`classes` 定義了一個包含 10 個字串的元組，對應到 CIFAR-10 資料集的十個分類名稱，分別是飛機（plane）、汽車（car）、鳥（bird）、貓（cat）、鹿（deer）、狗（dog）、青蛙（frog）、馬（horse）、船（ship）以及卡車（truck）。\n\n```\nimport matplotlib.pyplot as plt\nimport numpy as np\n<div></div>\n# functions to show an image\n<div></div>\n\ndef imshow(img):\n    img = img / 2 + 0.5     # unnormalize\n    npimg = img.numpy()\n    plt.imshow(np.transpose(npimg, (1, 2, 0)))\n    plt.show()\n<div></div>\n\n# get some random training images\ndataiter = iter(trainloader)\nimages, labels = next(dataiter)\n<div></div>\n# show images\nimshow(torchvision.utils.make_grid(images))\n# print labels\nprint(' '.join(f'{classes[labels[j]]:5s}' for j in range(batch_size)))\n```\n\n```\nimport matplotlib.pyplot as plt\nimport numpy as np\n\n# functions to show an image\n\ndef imshow(img):\n    img = img / 2 + 0.5     # unnormalize\n    npimg = img.numpy()\n    plt.imshow(np.transpose(npimg, (1, 2, 0)))\n    plt.show()\n\n# get some random training images\ndataiter = iter(trainloader)\nimages, labels = next(dataiter)\n\n# show images\nimshow(torchvision.utils.make_grid(images))\n# print labels\nprint(' '.join(f'{classes[labels[j]]:5s}' for j in range(batch_size)))\n```\n\n這段程式的主要功能是從訓練資料集中隨機取出一批圖片，將它們組合起來顯示在螢幕上，並同時印出每張圖片所對應的分類名稱。它常用於訓練前的資料檢查，讓我們確認影像資料是否被正確載入與轉換。\n\n首先，程式匯入了 `matplotlib.pyplot` 和 `numpy`，前者用來繪製和顯示圖片，後者則是進行陣列處理。接著定義了一個名為 `imshow` 的函式，用來顯示影像。由於在資料載入時影像經過標準化（值從 `[0,1]` 變成 `[-1,1]`），因此在顯示之前需要進行反標準化，也就是 `img = img / 2 + 0.5` 這一行，把影像還原到可視範圍 `[0,1]`。接著 `npimg = img.numpy()` 將 PyTorch 的 Tensor 轉成 NumPy 陣列，因為 Matplotlib 只能處理 NumPy 格式的資料。再來，`np.transpose(npimg, (1, 2, 0))` 這行是把影像的維度順序從 `(channels, height, width)` 調整成 Matplotlib 所需要的 `(height, width, channels)`。最後透過 `plt.imshow()` 顯示圖片，`plt.show()` 則把圖形真正畫出來。\n\n在顯示影像之前，程式會先從訓練資料中取出一批圖片。這裡 `dataiter = iter(trainloader)` 建立一個可迭代物件，用來從資料載入器中取得資料，而 `images, labels = next(dataiter)` 則是取出下一批資料。這一批資料包含了四張圖片（因為之前設定 `batch_size = 4`），以及這四張圖片的標籤。\n\n![](/images/image-27.png)\n\n接著使用 `torchvision.utils.make_grid(images)` 將多張圖片排成一張網格，方便一次顯示多張影像。這個網格會被傳入 `imshow()` 函式中顯示出來。最後一行 `print(' '.join(f'{classes[labels[j]]:5s}' for j in range(batch_size)))` 則是依序把每張圖片的類別名稱印出來。它會根據 `labels` 取得每張圖片的類別代號，再利用 `classes` 對應到實際的名稱（例如 \"cat\"、\"dog\"、\"car\" 等），並用空格分隔後印在同一行。\n\n```\nimport torch.nn as nn\nimport torch.nn.functional as F\n<div></div>\n\nclass Net(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.conv1 = nn.Conv2d(3, 6, 5)\n        self.pool = nn.MaxPool2d(2, 2)\n        self.conv2 = nn.Conv2d(6, 16, 5)\n        self.fc1 = nn.Linear(16 * 5 * 5, 120)\n        self.fc2 = nn.Linear(120, 84)\n        self.fc3 = nn.Linear(84, 10)\n<div></div>\n    def forward(self, x):\n        x = self.pool(F.relu(self.conv1(x)))\n        x = self.pool(F.relu(self.conv2(x)))\n        x = torch.flatten(x, 1) # flatten all dimensions except batch\n        x = F.relu(self.fc1(x))\n        x = F.relu(self.fc2(x))\n        x = self.fc3(x)\n        return x\n<div></div>\n\nnet = Net()\n```\n\n```\nimport torch.nn as nn\nimport torch.nn.functional as F\n\nclass Net(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.conv1 = nn.Conv2d(3, 6, 5)\n        self.pool = nn.MaxPool2d(2, 2)\n        self.conv2 = nn.Conv2d(6, 16, 5)\n        self.fc1 = nn.Linear(16 * 5 * 5, 120)\n        self.fc2 = nn.Linear(120, 84)\n        self.fc3 = nn.Linear(84, 10)\n\n    def forward(self, x):\n        x = self.pool(F.relu(self.conv1(x)))\n        x = self.pool(F.relu(self.conv2(x)))\n        x = torch.flatten(x, 1) # flatten all dimensions except batch\n        x = F.relu(self.fc1(x))\n        x = F.relu(self.fc2(x))\n        x = self.fc3(x)\n        return x\n\nnet = Net()\n```\n\n這段程式定義並建立了一個基本的卷積神經網路（Convolutional Neural Network, CNN），用來進行影像分類。這個網路的結構與 LeNet 類似，是一個簡單但經典的 CNN 範例，常用於 CIFAR-10 這類小型影像資料集的學習實驗。\n\n首先，程式匯入了 `torch.nn` 與 `torch.nn.functional`。前者提供各種神經網路層的模組，例如卷積層、線性層（全連接層）等；後者則提供常用的函式操作，例如激活函式 ReLU（Rectified Linear Unit）等。\n\n接著，透過定義一個名為 `Net` 的類別來建立網路結構。這個類別繼承自 `nn.Module`，是 PyTorch 中所有模型的基底類別。`__init__` 方法中定義了網路的各個層。`self.conv1 = nn.Conv2d(3, 6, 5)` 是第一個卷積層，它的輸入有三個通道（對應到彩色影像的 R、G、B 三色），輸出六個特徵圖（feature maps），而卷積核（filter）的大小是 5×5。接著 `self.pool = nn.MaxPool2d(2, 2)` 是最大池化層，用於縮小影像尺寸，減少參數與計算量。`self.conv2 = nn.Conv2d(6, 16, 5)` 是第二個卷積層，輸入為六個通道、輸出十六個特徵圖，同樣使用 5×5 的卷積核。\n\n卷積層之後是三個全連接層（fully connected layers），也就是傳統神經網路的部分。`self.fc1 = nn.Linear(16 * 5 * 5, 120)` 代表第一個全連接層的輸入為 16×5×5 維的向量（也就是前面卷積與池化之後展平的結果），輸出為 120 個神經元。接著的 `self.fc2 = nn.Linear(120, 84)` 再將輸入從 120 維轉成 84 維，而最後一層 `self.fc3 = nn.Linear(84, 10)` 則輸出 10 維的結果，對應到 CIFAR-10 的十個分類類別。\n\n在 `forward` 方法中定義了資料的前向傳遞過程，也就是影像如何一步步通過網路。首先，輸入 `x` 經過第一個卷積層 `self.conv1`，然後經過 ReLU 激活函式轉換，再經過最大池化層縮小尺寸。接著進入第二個卷積層 `self.conv2`，同樣再經過 ReLU 與池化層。這兩次卷積與池化之後，影像的空間維度大幅縮小，但特徵變得更抽象、更具辨識能力。接下來使用 `torch.flatten(x, 1)` 將多維的特徵圖展平成一維向量（除了批次維度外），使其能夠輸入到全連接層。然後依序通過兩層帶有 ReLU 激活函式的全連接層，最後輸出到 `fc3`，產生最終的分類結果。\n\n最後一行 `net = Net()` 則是實際建立這個網路的實例。建立後的 `net` 物件就是一個可供訓練的 CNN 模型，能夠接收 CIFAR-10 的影像作為輸入，並輸出十個類別的預測結果。整體而言，這段程式展示了從卷積層、池化層到全連接層的完整 CNN 結構，構成了一個典型的影像分類模型。\n\n### 補充 : ReLU 的作用\n\n![](/images/image-28.png)\n\n它會**把所有負值剪掉，正值保留**。\n\n```\nimport torch.optim as optim\n<div></div>\ncriterion = nn.CrossEntropyLoss()\noptimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)\n```\n\n```\nimport torch.optim as optim\n\ncriterion = nn.CrossEntropyLoss()\noptimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)\n```\n\n這段程式的主要功能，是為神經網路設定**損失函數（loss function）與優化器（optimizer）**，也就是訓練模型時用來「評估表現」與「更新權重」的兩個關鍵步驟。它們就像訓練過程中的「老師」和「調整機制」，共同決定模型如何從錯誤中學習。\n\n首先，`criterion = nn.CrossEntropyLoss()` 這行定義了損失函數，使用的是交叉熵損失（Cross Entropy Loss）。交叉熵是一種在**分類問題**中最常見的損失函數，它用來衡量模型預測的機率分佈與真實答案之間的差距。舉例來說，若模型預測一張圖片是「貓」的機率為 0.9，而真實標籤確實是貓，那損失值就會很小；但如果模型預測是「狗」的機率為 0.9，損失值就會很大。這樣模型在訓練時會自動調整權重，讓正確類別的機率越來越高。CrossEntropyLoss 在 PyTorch 中同時結合了 **softmax**（將輸出轉為機率）與 **log loss**（計算對數誤差），因此不需要手動再對輸出做 softmax 處理。\n\n接著，`optimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)` 這行設定了優化器，使用的是隨機梯度下降法（Stochastic Gradient Descent, SGD）。在訓練神經網路時，模型會根據損失函數的值計算出梯度，表示權重應該如何調整以降低損失。SGD 就是透過這些梯度逐步更新模型的參數。`net.parameters()` 表示要讓優化器管理網路中所有可學習的權重；`lr=0.001` 則是設定學習率（learning rate），也就是每次更新權重時的步伐大小。學習率太大會導致訓練不穩定、損失值震盪；太小則會讓收斂速度變慢。最後的 `momentum=0.9` 是動量參數，它能幫助模型在訓練過程中更順利地前進，減少在局部最小值附近震盪的情況。動量的概念就像 推球一樣，當球在斜坡上滾動時，會保留部分前一次的速度，讓更新方向更平滑、加速收斂。\n\n總結來說，這段程式的作用是建立訓練模型時的「學習機制」：交叉熵損失負責告訴網路「預測錯了多少」，而 SGD 優化器則根據這些錯誤去微調權重，讓模型一步步學會更準確地分類影像。\n\n## Train the network\n\n```\nfor epoch in range(2):  # loop over the dataset multiple times\n<div></div>\n    running_loss = 0.0\n    for i, data in enumerate(trainloader, 0):\n        # get the inputs; data is a list of [inputs, labels]\n        inputs, labels = data\n<div></div>\n        # zero the parameter gradients\n        optimizer.zero_grad()\n<div></div>\n        # forward + backward + optimize\n        outputs = net(inputs)\n        loss = criterion(outputs, labels)\n        loss.backward()\n        optimizer.step()\n<div></div>\n        # print statistics\n        running_loss += loss.item()\n        if i % 2000 == 1999:    # print every 2000 mini-batches\n            print(f'[{epoch + 1}, {i + 1:5d}] loss: {running_loss / 2000:.3f}')\n            running_loss = 0.0\n<div></div>\nprint('Finished Training')\n```\n\n```\nfor epoch in range(2):  # loop over the dataset multiple times\n\n    running_loss = 0.0\n    for i, data in enumerate(trainloader, 0):\n        # get the inputs; data is a list of [inputs, labels]\n        inputs, labels = data\n\n        # zero the parameter gradients\n        optimizer.zero_grad()\n\n        # forward + backward + optimize\n        outputs = net(inputs)\n        loss = criterion(outputs, labels)\n        loss.backward()\n        optimizer.step()\n\n        # print statistics\n        running_loss += loss.item()\n        if i % 2000 == 1999:    # print every 2000 mini-batches\n            print(f'[{epoch + 1}, {i + 1:5d}] loss: {running_loss / 2000:.3f}')\n            running_loss = 0.0\n\nprint('Finished Training')\n```\n\n這段程式是整個模型訓練過程的核心，它讓神經網路能夠不斷從資料中學習、修正錯誤，進而提升分類準確率。最外層的 `for epoch in range(2):` 代表訓練要進行兩個回合（epoch），也就是讓模型將整個訓練資料集完整學習兩次。每個 epoch 開始前，先將 `running_loss` 設為 0，這個變數用來累積損失值，以便在訓練過程中觀察模型表現是否逐步改善。\n\n在每個 epoch 內部，`for i, data in enumerate(trainloader, 0):` 會從訓練資料載入器（`trainloader`）中依序取出資料批次（mini-batch）。每次取出的 `data` 由兩個部分組成：`inputs` 是輸入影像的張量（tensor），而 `labels` 是對應的真實分類標籤。由於前面設定過 `batch_size = 4`，因此每個批次會包含四張圖片與它們的標籤。\n\n接著，`optimizer.zero_grad()` 是一個非常重要的步驟，用來清除前一次訓練所累積的梯度（gradient）。在 PyTorch 中，梯度會自動累加，若不清零，前一批的梯度會干擾新的更新，使模型權重被錯誤地調整。清除梯度之後，就能安全地開始新的學習迭代。\n\n在這之後是整個學習流程的三個主要階段：前向傳播（forward）、反向傳播（backward）與參數更新（optimize）。`outputs = net(inputs)` 代表把輸入圖片送進神經網路中進行前向運算，網路會輸出一組預測結果。接著，`loss = criterion(outputs, labels)` 使用損失函數計算預測值與真實標籤之間的差距，損失值越大代表模型預測越不準確。`loss.backward()` 則是反向傳播的步驟，PyTorch 會根據損失值自動計算每個參數的梯度，也就是「模型應該怎麼修正自己」。最後，`optimizer.step()` 根據這些梯度更新模型的權重，使得網路在下一次預測時能更接近正確答案。\n\n在每次迭代結束後，`running_loss += loss.item()` 會把這一批的損失值加總起來。為了方便觀察訓練進展，程式設計成每訓練 2000 批資料時，就會印出一次平均損失值：`print(f'[{epoch + 1}, {i + 1:5d}] loss: {running_loss / 2000:.3f}')`。這樣可以直觀看出損失值是否持續下降，進而判斷模型是否正在有效地學習。印出後，`running_loss` 會被重置為 0，準備記錄下一段訓練的結果。\n\n當外層的迴圈結束後，代表模型已經完成所有訓練回合，`print('Finished Training')` 會顯示訓練完成的訊息。\n\n```\nPATH = './cifar_net.pth'\ntorch.save(net.state_dict(), PATH)\n```\n\n```\nPATH = './cifar_net.pth'\ntorch.save(net.state_dict(), PATH)\n```\n\n首先，`PATH = './cifar_net.pth'` 是設定模型要儲存的路徑與檔案名稱。這裡使用的 `'./cifar_net.pth'` 代表在目前的工作目錄下建立一個名為 **cifar\\_net.pth** 的檔案。副檔名 `.pth` 是 PyTorch 模型檔案的常見命名方式，代表「parameters of torch」（意即儲存的是模型的參數）。\n\n接下來的 `torch.save(net.state_dict(), PATH)` 是實際執行儲存的動作。這裡的 `net` 是前面訓練完成的神經網路，而 `net.state_dict()` 是一個特殊的字典（dictionary），裡面儲存了模型中所有層的**參數權重（weights）與偏差值（biases）**。換句話說，它只會保存模型「學到的知識」，而不是整個模型結構。這樣的設計讓儲存檔案更小、更靈活，也方便在不同環境中重新載入。\n\n```\ndataiter = iter(testloader)\nimages, labels = next(dataiter)\n<div></div>\n# print images\nimshow(torchvision.utils.make_grid(images))\nprint('GroundTruth: ', ' '.join(f'{classes[labels[j]]:5s}' for j in range(4)))\n```\n\n```\ndataiter = iter(testloader)\nimages, labels = next(dataiter)\n\n# print images\nimshow(torchvision.utils.make_grid(images))\nprint('GroundTruth: ', ' '.join(f'{classes[labels[j]]:5s}' for j in range(4)))\n```\n\n這段程式的功能是從測試資料集中隨機取出幾張圖片，顯示出它們的內容，並印出每張圖片的真實標籤（Ground Truth）。這通常是訓練完成後的第一個步驟，用來檢查測試資料是否正確載入，也方便之後與模型的預測結果進行比較。\n\n首先，`dataiter = iter(testloader)` 用來建立一個可迭代的資料讀取器。`testloader` 是先前設定好的測試資料載入器，裡面包含了 CIFAR-10 的測試圖片與對應標籤。接著，`images, labels = next(dataiter)` 從這個載入器中取出一批資料。這一批包含兩部分：`images` 是四張測試圖片的影像張量（tensor），`labels` 則是這四張圖片的真實類別標籤，以數字形式儲存。例如，若某張圖片的標籤是 3，就代表它屬於 CIFAR-10 類別中的「cat」。\n\n接下來的 `imshow(torchvision.utils.make_grid(images))` 是用來顯示圖片。由於這次取出的 `images` 是四張影像，因此使用 `torchvision.utils.make_grid(images)` 先把這四張圖排成一張大圖（grid），再交給 `imshow()` 函式顯示出來。`imshow()` 會先將影像資料反正規化（把像素值從 -1~1 的範圍還原為 0~1），然後利用 Matplotlib 將這張圖片網格畫出來。執行這行後，畫面上會出現四張並排的小圖片，也就是接下來模型要進行預測的測試樣本。\n\n![](/images/CleanShot-2025-10-29-at-11.41.16@2x-1024x385.png)\n\n最後一行 `print('GroundTruth: ', ' '.join(f'{classes[labels[j]]:5s}' for j in range(4)))` 則負責印出這四張圖片的真實類別名稱。這裡的 `classes` 是先前定義好的 CIFAR-10 類別名稱列表，例如 `('plane', 'car', 'bird', 'cat', 'deer', 'dog', 'frog', 'horse', 'ship', 'truck')`。`labels[j]` 會取出每張圖片的數字標籤，而 `classes[labels[j]]` 則將這些數字轉換為對應的文字名稱。`' '.join(...)` 用來把所有類別名稱以空格串起來，讓輸出更整齊。\n\n```\nnet = Net()\nnet.load_state_dict(torch.load(PATH, weights_only=True))\n```\n\n```\nnet = Net()\nnet.load_state_dict(torch.load(PATH, weights_only=True))\n```\n\n這段程式的主要功能是**重新載入先前訓練並儲存好的模型權重**，讓模型能夠直接使用訓練成果，而不必重新訓練。它通常出現在「模型測試」或「實際應用」的階段。\n\n首先，`net = Net()` 這行代表建立一個新的模型物件。這個 `Net` 是先前定義好的神經網路結構類別（包含卷積層、池化層、全連接層等）。這裡建立的 `net` 是一個「空白的模型骨架」，也就是只有網路的架構，尚未包含任何已學到的參數或權重。\n\n接下來的 `net.load_state_dict(torch.load(PATH, weights_only=True))` 是將儲存在檔案中的權重載入到這個模型中。前面的 `torch.load(PATH, weights_only=True)` 是從先前儲存的檔案（例如 `'./cifar_net.pth'`）中讀取模型參數。這個檔案是在訓練結束後用 `torch.save(net.state_dict(), PATH)` 儲存的，因此裡面包含了每一層神經網路的權重（weights）與偏差（biases）數值。\n\n`load_state_dict()` 則是 PyTorch 專門用來把這些儲存的參數載回模型的函式。當這個函式被呼叫時，它會根據模型層的名稱，自動將檔案中的權重一一對應回模型中相同名稱的層，讓這個新的 `net` 恢復成與訓練完成時相同的狀態。參數 `weights_only=True` 則指定只讀取權重數據，而不載入其他不必要的資訊（例如訓練時的設定或暫存變數），這樣可以確保載入過程簡潔且不受版本影響。\n\n```\noutputs = net(images)\n```\n\n```\noutputs = net(images)\n```\n\n`images` 是一批（batch）要測試的影像資料，通常是從 `testloader` 中取出來的四張圖片（因為你先前設定 `batch_size = 4`）。這些影像已經是經過 `transforms.ToTensor()` 和 `transforms.Normalize()` 處理的張量（tensor），形狀通常是 `(4, 3, 32, 32)`，分別代表：4 張圖片、3 個顏色通道（RGB）、以及 32×32 的解析度。\n\n`net` 是你的神經網路模型物件（由 `Net()` 建立，並載入了已訓練的權重）。當你把 `images` 傳進 `net()` 時，PyTorch 會自動呼叫 `Net` 類別裡定義的 `forward()` 函式。也就是說，這行程式會讓圖片依序通過：\n\n1. 卷積層（Conv2d） → 萃取影像特徵；\n\n3. ReLU 激活函式 → 引入非線性；\n\n5. 池化層（MaxPool2d） → 縮小影像尺寸；\n\n7. 全連接層（Linear） → 將特徵轉換成分類分數。\n\n這些層會依照你在 `forward()` 方法中定義的流程一層層運算，最終輸出模型對每張圖片的分類結果。\n\n```\n_, predicted = torch.max(outputs, 1)\n<div></div>\nprint('Predicted: ', ' '.join(f'{classes[predicted[j]]:5s}'\n                              for j in range(4)))\n```\n\n```\n_, predicted = torch.max(outputs, 1)\n\nprint('Predicted: ', ' '.join(f'{classes[predicted[j]]:5s}'\n                              for j in range(4)))\n```\n\n這裡使用了 PyTorch 的 `torch.max()` 函式，它的功能是**找出張量（tensor）中每一列的最大值以及它所在的位置**。  \n`outputs` 是模型對四張圖片的預測結果，形狀是 `(4, 10)`，其中：\n\n- 4 代表輸入的圖片數量；\n\n- 10 代表 CIFAR-10 的十個分類（例如飛機、汽車、貓、狗等）。\n\n對於每張圖片（每一列），模型會輸出 10 個數值，這些數值代表「模型認為該圖片屬於每個類別的信心分數」。  \n`torch.max(outputs, 1)` 的第二個參數 `1` 表示沿著「第 1 維」進行操作，也就是在每一列（每張圖片的 10 個分數）中尋找最大值。\n\n![](/images/CleanShot-2025-10-29-at-11.47.42@2x-1024x85.png)\n\n這個函式會回傳兩個結果：\n\n1. 最大值本身（這裡用 `_` 省略掉，因為我們只關心位置而不需要數值）；\n\n3. 最大值的索引位置，也就是每張圖片信心分數最高的類別代號。\n\n```\ncorrect = 0\ntotal = 0\n# since we're not training, we don't need to calculate the gradients for our outputs\nwith torch.no_grad():\n    for data in testloader:\n        images, labels = data\n        # calculate outputs by running images through the network\n        outputs = net(images)\n        # the class with the highest energy is what we choose as prediction\n        _, predicted = torch.max(outputs, 1)\n        total += labels.size(0)\n        correct += (predicted == labels).sum().item()\n<div></div>\nprint(f'Accuracy of the network on the 10000 test images: {100 * correct // total} %')\n```\n\n```\ncorrect = 0\ntotal = 0\n# since we're not training, we don't need to calculate the gradients for our outputs\nwith torch.no_grad():\n    for data in testloader:\n        images, labels = data\n        # calculate outputs by running images through the network\n        outputs = net(images)\n        # the class with the highest energy is what we choose as prediction\n        _, predicted = torch.max(outputs, 1)\n        total += labels.size(0)\n        correct += (predicted == labels).sum().item()\n\nprint(f'Accuracy of the network on the 10000 test images: {100 * correct // total} %')\n```\n\n`correct` 用來計算預測正確的圖片數量，`total` 則用來計算測試資料的總張數。最終會用這兩個數字來計算正確率。\n\n接著的 `with torch.no_grad():` 是 PyTorch 中常見的寫法，表示在這個區塊中**不需要追蹤梯度（gradients）**。在測試或推論階段，我們並不需要做反向傳播（backpropagation）或更新權重，因此可以關閉梯度計算來節省記憶體與運算時間。這樣能讓模型運行得更快，也避免誤修改權重。\n\n在程式中，`for data in testloader:` 會從測試資料載入器 `testloader` 中依序取出資料。每次取出的 `data` 代表一個批次（batch），其中包含四張測試圖片（`images`）及它們的真實標籤（`labels`）。接著，執行 `outputs = net(images)`，讓模型對這些圖片進行**前向傳播（forward pass）**，輸出每張圖片對應十個類別的分數（logits）。這些分數代表模型對每個類別的信心程度，分數越高表示模型越傾向認為圖片屬於該類別。\n\n之後的這行 `_, predicted = torch.max(outputs, 1)` 用來從模型的輸出中，取出每張圖片分數最高的那一個類別，作為模型的預測結果。這裡的 `predicted` 是一個包含四個數字的張量（tensor），每個數字代表模型認為圖片所屬的類別索引（例如 0 代表「plane」、1 代表「car」等）。換句話說，這一步是將模型的「信心分數」轉換成實際的「分類決策」。\n\n接著兩行 `total += labels.size(0)` 和 `correct += (predicted == labels).sum().item()` 是用來統計模型的預測表現。`labels.size(0)` 代表這一批圖片的數量（通常是 4），會加到 `total` 中，以累計測試圖片的總數。而 `(predicted == labels)` 會比較模型預測的類別與真實標籤是否一致，產生一個布林值陣列（例如 `[True, False, True, True]`）。使用 `.sum()` 會將其中的 `True` 視為 1、`False` 視為 0，相加後就能得到這一批中模型預測正確的圖片數。最後，`.item()` 會把這個張量轉換成普通的整數，再加到 `correct` 裡，表示目前累積的正確預測數量。\n\n當迴圈跑完所有測試資料後，模型就已經對整個測試集（共 10,000 張圖片）完成預測。\n\n![](/images/CleanShot-2025-10-29-at-11.57.50@2x-1024x45.png)\n\n代表模型在 10,000 張測試圖片中，有 53% 被正確分類。\n\n![](/images/CleanShot-2025-10-29-at-11.59.02@2x-1024x84.png)\n\n  \n這裡的 `100 * correct // total` 使用整數除法，讓結果以百分比的形式輸出。\n\n## Training on GPU\n\n```\ndevice = torch.device('cuda:0' if torch.cuda.is_available() else 'cpu')\n<div></div>\n# Assuming that we are on a CUDA machine, this should print a CUDA device:\n<div></div>\nprint(device)\n```\n\n```\ndevice = torch.device('cuda:0' if torch.cuda.is_available() else 'cpu')\n\n# Assuming that we are on a CUDA machine, this should print a CUDA device:\n\nprint(device)\n```\n\n`device = torch.device('cuda:0' if torch.cuda.is_available() else 'cpu')` 利用了 PyTorch 的 `torch.cuda.is_available()` 函式來檢查系統中是否安裝並啟用了 CUDA。若電腦中有支援的 NVIDIA 顯示卡且 CUDA 可用，這個函式會回傳 `True`，程式便會選擇 `'cuda:0'` 作為運算裝置，代表使用第 0 張 GPU（即第一張 GPU 卡）進行運算。若 CUDA 不可用，則回傳 `False`，程式會改用 `'cpu'`，也就是中央處理器進行運算。`torch.device()` 則會依據這個結果建立一個「裝置物件（device object）」，方便之後將模型或資料移動到指定的裝置上執行。\n\n接著這行 `print(device)` 會印出目前使用的運算裝置。如果系統有支援 CUDA 且 PyTorch 安裝的是 GPU 版本，輸出結果會是 `cuda:0`，表示模型將在 GPU 上執行；若系統中沒有可用的 GPU，則輸出為 `cpu`，代表程式會使用 CPU 進行運算。\n\n```\nnet.to(device)\n```\n\n```\nnet.to(device)\n```\n\n當你執行 `net.to(device)` 時，PyTorch 會把模型中所有的參數（包含權重 weights 與偏差 biases）從預設的 CPU 記憶體移動到目標裝置上。如果系統有支援 CUDA 且 GPU 可用，模型就會被移到顯示卡中運行；若沒有 GPU，則會保留在 CPU 上。\n\n```\ninputs, labels = data[0].to(device), data[1].to(device)\n```\n\n```\ninputs, labels = data[0].to(device), data[1].to(device)\n```\n\n`data[0]` 代表這一批的輸入圖片（影像張量），而 `data[1]` 則是對應的真實標籤（例如這張圖片是「貓」或「狗」）。這兩者最初都會存在 CPU 記憶體中，因為資料載入的預設裝置就是 CPU。\n\n`to(device)` 是 PyTorch 用來**把 Tensor 傳送到指定裝置**的方法。如果前面設定的 `device` 是 `'cuda:0'`，那這行指令會把 `inputs` 和 `labels` 都傳送到 GPU 記憶體中；如果沒有可用的 GPU，則會留在 CPU 上。這樣做可以確保模型（`net`）與資料位於相同的運算環境中，從而讓後續的運算（例如前向傳播、損失計算、反向傳播等）能夠正常執行。\n","source":"_posts/training-a-classifier.md","raw":"---\nlayout: post\ntitle: Training a Classifier\ndate: 2025-10-29\ntags:\ncategories:\n  - \"ai\"\n  - \"pytorch\"\ntop_img: /images/Pytorch.png\ncover: /images/Pytorch.png\n---\n\n程式碼與資料參考來源：[https://docs.pytorch.org/tutorials/beginner/blitz/cifar10\\_tutorial.html#define-a-convolutional-neural-network](https://docs.pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html#define-a-convolutional-neural-network)\n\n```\nimport torch\nimport torchvision\nimport torchvision.transforms as transforms\n```\n\n```\nimport torch\nimport torchvision\nimport torchvision.transforms as transforms\n```\n\n```\ntransform = transforms.Compose(\n    [transforms.ToTensor(),\n     transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))])\n<div></div>\nbatch_size = 4\n<div></div>\ntrainset = torchvision.datasets.CIFAR10(root='./data', train=True,\n                                        download=True, transform=transform)\ntrainloader = torch.utils.data.DataLoader(trainset, batch_size=batch_size,\n                                          shuffle=True, num_workers=2)\n<div></div>\ntestset = torchvision.datasets.CIFAR10(root='./data', train=False,\n                                       download=True, transform=transform)\ntestloader = torch.utils.data.DataLoader(testset, batch_size=batch_size,\n                                         shuffle=False, num_workers=2)\n<div></div>\nclasses = ('plane', 'car', 'bird', 'cat',\n           'deer', 'dog', 'frog', 'horse', 'ship', 'truck')\n```\n\n```\ntransform = transforms.Compose(\n    [transforms.ToTensor(),\n     transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))])\n\nbatch_size = 4\n\ntrainset = torchvision.datasets.CIFAR10(root='./data', train=True,\n                                        download=True, transform=transform)\ntrainloader = torch.utils.data.DataLoader(trainset, batch_size=batch_size,\n                                          shuffle=True, num_workers=2)\n\ntestset = torchvision.datasets.CIFAR10(root='./data', train=False,\n                                       download=True, transform=transform)\ntestloader = torch.utils.data.DataLoader(testset, batch_size=batch_size,\n                                         shuffle=False, num_workers=2)\n\nclasses = ('plane', 'car', 'bird', 'cat',\n           'deer', 'dog', 'frog', 'horse', 'ship', 'truck')\n```\n\n這段程式主要的目的，是建立一個可以讓 PyTorch 模型方便使用的影像資料載入流程。首先，程式定義了一個名為 `transform` 的轉換流程，這個轉換由兩個步驟組成。第一個步驟 `transforms.ToTensor()` 是把原本的影像（可能是 PIL Image 或 numpy 陣列）轉成 PyTorch 可以處理的 Tensor 格式，並且把像素值從 0～255 縮放到 0～1 之間。第二個步驟 `transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))` 則是將每個顏色通道進行標準化，把影像的數值範圍轉換成 -1 到 1 之間，這樣能讓模型在訓練時更穩定、更容易收斂。\n\n接著，`batch_size = 4` 表示每次從資料集中取出四張圖片，組成一個小批次（batch）來訓練。這樣做可以減少記憶體使用量，並加快訓練速度。\n\n在建立訓練資料集時，使用了 `torchvision.datasets.CIFAR10` 這個內建的資料集。CIFAR-10 是一個常見的影像分類資料集，裡面有 10 種不同類別的物體（例如飛機、汽車、貓、狗等）。參數 `root='./data'` 代表資料會被存放在專案資料夾中的 `data` 目錄下；`train=True` 指定要載入訓練資料；`download=True` 讓程式在本地沒有資料時自動從網路下載；而 `transform=transform` 則確保每張影像在載入時都會先經過剛剛定義的轉換流程。\n\n建立好訓練資料集後，`trainloader` 透過 `torch.utils.data.DataLoader` 將資料集包裝成可以分批次讀取的形式。這個物件會在訓練時自動提供圖片與標籤。`shuffle=True` 表示在每個訓練輪次（epoch）開始前，資料都會被隨機打亂，避免模型記住資料的順序而影響學習。`num_workers=2` 則是設定使用兩個背景執行緒加快資料載入的速度。\n\n測試資料的部分幾乎相同，只是 `train=False` 代表這次載入的是測試資料集，並且 `shuffle=False`，確保測試資料的順序固定，方便在評估模型時對照結果。\n\n最後，`classes` 定義了一個包含 10 個字串的元組，對應到 CIFAR-10 資料集的十個分類名稱，分別是飛機（plane）、汽車（car）、鳥（bird）、貓（cat）、鹿（deer）、狗（dog）、青蛙（frog）、馬（horse）、船（ship）以及卡車（truck）。\n\n```\nimport matplotlib.pyplot as plt\nimport numpy as np\n<div></div>\n# functions to show an image\n<div></div>\n\ndef imshow(img):\n    img = img / 2 + 0.5     # unnormalize\n    npimg = img.numpy()\n    plt.imshow(np.transpose(npimg, (1, 2, 0)))\n    plt.show()\n<div></div>\n\n# get some random training images\ndataiter = iter(trainloader)\nimages, labels = next(dataiter)\n<div></div>\n# show images\nimshow(torchvision.utils.make_grid(images))\n# print labels\nprint(' '.join(f'{classes[labels[j]]:5s}' for j in range(batch_size)))\n```\n\n```\nimport matplotlib.pyplot as plt\nimport numpy as np\n\n# functions to show an image\n\ndef imshow(img):\n    img = img / 2 + 0.5     # unnormalize\n    npimg = img.numpy()\n    plt.imshow(np.transpose(npimg, (1, 2, 0)))\n    plt.show()\n\n# get some random training images\ndataiter = iter(trainloader)\nimages, labels = next(dataiter)\n\n# show images\nimshow(torchvision.utils.make_grid(images))\n# print labels\nprint(' '.join(f'{classes[labels[j]]:5s}' for j in range(batch_size)))\n```\n\n這段程式的主要功能是從訓練資料集中隨機取出一批圖片，將它們組合起來顯示在螢幕上，並同時印出每張圖片所對應的分類名稱。它常用於訓練前的資料檢查，讓我們確認影像資料是否被正確載入與轉換。\n\n首先，程式匯入了 `matplotlib.pyplot` 和 `numpy`，前者用來繪製和顯示圖片，後者則是進行陣列處理。接著定義了一個名為 `imshow` 的函式，用來顯示影像。由於在資料載入時影像經過標準化（值從 `[0,1]` 變成 `[-1,1]`），因此在顯示之前需要進行反標準化，也就是 `img = img / 2 + 0.5` 這一行，把影像還原到可視範圍 `[0,1]`。接著 `npimg = img.numpy()` 將 PyTorch 的 Tensor 轉成 NumPy 陣列，因為 Matplotlib 只能處理 NumPy 格式的資料。再來，`np.transpose(npimg, (1, 2, 0))` 這行是把影像的維度順序從 `(channels, height, width)` 調整成 Matplotlib 所需要的 `(height, width, channels)`。最後透過 `plt.imshow()` 顯示圖片，`plt.show()` 則把圖形真正畫出來。\n\n在顯示影像之前，程式會先從訓練資料中取出一批圖片。這裡 `dataiter = iter(trainloader)` 建立一個可迭代物件，用來從資料載入器中取得資料，而 `images, labels = next(dataiter)` 則是取出下一批資料。這一批資料包含了四張圖片（因為之前設定 `batch_size = 4`），以及這四張圖片的標籤。\n\n![](/images/image-27.png)\n\n接著使用 `torchvision.utils.make_grid(images)` 將多張圖片排成一張網格，方便一次顯示多張影像。這個網格會被傳入 `imshow()` 函式中顯示出來。最後一行 `print(' '.join(f'{classes[labels[j]]:5s}' for j in range(batch_size)))` 則是依序把每張圖片的類別名稱印出來。它會根據 `labels` 取得每張圖片的類別代號，再利用 `classes` 對應到實際的名稱（例如 \"cat\"、\"dog\"、\"car\" 等），並用空格分隔後印在同一行。\n\n```\nimport torch.nn as nn\nimport torch.nn.functional as F\n<div></div>\n\nclass Net(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.conv1 = nn.Conv2d(3, 6, 5)\n        self.pool = nn.MaxPool2d(2, 2)\n        self.conv2 = nn.Conv2d(6, 16, 5)\n        self.fc1 = nn.Linear(16 * 5 * 5, 120)\n        self.fc2 = nn.Linear(120, 84)\n        self.fc3 = nn.Linear(84, 10)\n<div></div>\n    def forward(self, x):\n        x = self.pool(F.relu(self.conv1(x)))\n        x = self.pool(F.relu(self.conv2(x)))\n        x = torch.flatten(x, 1) # flatten all dimensions except batch\n        x = F.relu(self.fc1(x))\n        x = F.relu(self.fc2(x))\n        x = self.fc3(x)\n        return x\n<div></div>\n\nnet = Net()\n```\n\n```\nimport torch.nn as nn\nimport torch.nn.functional as F\n\nclass Net(nn.Module):\n    def __init__(self):\n        super().__init__()\n        self.conv1 = nn.Conv2d(3, 6, 5)\n        self.pool = nn.MaxPool2d(2, 2)\n        self.conv2 = nn.Conv2d(6, 16, 5)\n        self.fc1 = nn.Linear(16 * 5 * 5, 120)\n        self.fc2 = nn.Linear(120, 84)\n        self.fc3 = nn.Linear(84, 10)\n\n    def forward(self, x):\n        x = self.pool(F.relu(self.conv1(x)))\n        x = self.pool(F.relu(self.conv2(x)))\n        x = torch.flatten(x, 1) # flatten all dimensions except batch\n        x = F.relu(self.fc1(x))\n        x = F.relu(self.fc2(x))\n        x = self.fc3(x)\n        return x\n\nnet = Net()\n```\n\n這段程式定義並建立了一個基本的卷積神經網路（Convolutional Neural Network, CNN），用來進行影像分類。這個網路的結構與 LeNet 類似，是一個簡單但經典的 CNN 範例，常用於 CIFAR-10 這類小型影像資料集的學習實驗。\n\n首先，程式匯入了 `torch.nn` 與 `torch.nn.functional`。前者提供各種神經網路層的模組，例如卷積層、線性層（全連接層）等；後者則提供常用的函式操作，例如激活函式 ReLU（Rectified Linear Unit）等。\n\n接著，透過定義一個名為 `Net` 的類別來建立網路結構。這個類別繼承自 `nn.Module`，是 PyTorch 中所有模型的基底類別。`__init__` 方法中定義了網路的各個層。`self.conv1 = nn.Conv2d(3, 6, 5)` 是第一個卷積層，它的輸入有三個通道（對應到彩色影像的 R、G、B 三色），輸出六個特徵圖（feature maps），而卷積核（filter）的大小是 5×5。接著 `self.pool = nn.MaxPool2d(2, 2)` 是最大池化層，用於縮小影像尺寸，減少參數與計算量。`self.conv2 = nn.Conv2d(6, 16, 5)` 是第二個卷積層，輸入為六個通道、輸出十六個特徵圖，同樣使用 5×5 的卷積核。\n\n卷積層之後是三個全連接層（fully connected layers），也就是傳統神經網路的部分。`self.fc1 = nn.Linear(16 * 5 * 5, 120)` 代表第一個全連接層的輸入為 16×5×5 維的向量（也就是前面卷積與池化之後展平的結果），輸出為 120 個神經元。接著的 `self.fc2 = nn.Linear(120, 84)` 再將輸入從 120 維轉成 84 維，而最後一層 `self.fc3 = nn.Linear(84, 10)` 則輸出 10 維的結果，對應到 CIFAR-10 的十個分類類別。\n\n在 `forward` 方法中定義了資料的前向傳遞過程，也就是影像如何一步步通過網路。首先，輸入 `x` 經過第一個卷積層 `self.conv1`，然後經過 ReLU 激活函式轉換，再經過最大池化層縮小尺寸。接著進入第二個卷積層 `self.conv2`，同樣再經過 ReLU 與池化層。這兩次卷積與池化之後，影像的空間維度大幅縮小，但特徵變得更抽象、更具辨識能力。接下來使用 `torch.flatten(x, 1)` 將多維的特徵圖展平成一維向量（除了批次維度外），使其能夠輸入到全連接層。然後依序通過兩層帶有 ReLU 激活函式的全連接層，最後輸出到 `fc3`，產生最終的分類結果。\n\n最後一行 `net = Net()` 則是實際建立這個網路的實例。建立後的 `net` 物件就是一個可供訓練的 CNN 模型，能夠接收 CIFAR-10 的影像作為輸入，並輸出十個類別的預測結果。整體而言，這段程式展示了從卷積層、池化層到全連接層的完整 CNN 結構，構成了一個典型的影像分類模型。\n\n### 補充 : ReLU 的作用\n\n![](/images/image-28.png)\n\n它會**把所有負值剪掉，正值保留**。\n\n```\nimport torch.optim as optim\n<div></div>\ncriterion = nn.CrossEntropyLoss()\noptimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)\n```\n\n```\nimport torch.optim as optim\n\ncriterion = nn.CrossEntropyLoss()\noptimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)\n```\n\n這段程式的主要功能，是為神經網路設定**損失函數（loss function）與優化器（optimizer）**，也就是訓練模型時用來「評估表現」與「更新權重」的兩個關鍵步驟。它們就像訓練過程中的「老師」和「調整機制」，共同決定模型如何從錯誤中學習。\n\n首先，`criterion = nn.CrossEntropyLoss()` 這行定義了損失函數，使用的是交叉熵損失（Cross Entropy Loss）。交叉熵是一種在**分類問題**中最常見的損失函數，它用來衡量模型預測的機率分佈與真實答案之間的差距。舉例來說，若模型預測一張圖片是「貓」的機率為 0.9，而真實標籤確實是貓，那損失值就會很小；但如果模型預測是「狗」的機率為 0.9，損失值就會很大。這樣模型在訓練時會自動調整權重，讓正確類別的機率越來越高。CrossEntropyLoss 在 PyTorch 中同時結合了 **softmax**（將輸出轉為機率）與 **log loss**（計算對數誤差），因此不需要手動再對輸出做 softmax 處理。\n\n接著，`optimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)` 這行設定了優化器，使用的是隨機梯度下降法（Stochastic Gradient Descent, SGD）。在訓練神經網路時，模型會根據損失函數的值計算出梯度，表示權重應該如何調整以降低損失。SGD 就是透過這些梯度逐步更新模型的參數。`net.parameters()` 表示要讓優化器管理網路中所有可學習的權重；`lr=0.001` 則是設定學習率（learning rate），也就是每次更新權重時的步伐大小。學習率太大會導致訓練不穩定、損失值震盪；太小則會讓收斂速度變慢。最後的 `momentum=0.9` 是動量參數，它能幫助模型在訓練過程中更順利地前進，減少在局部最小值附近震盪的情況。動量的概念就像 推球一樣，當球在斜坡上滾動時，會保留部分前一次的速度，讓更新方向更平滑、加速收斂。\n\n總結來說，這段程式的作用是建立訓練模型時的「學習機制」：交叉熵損失負責告訴網路「預測錯了多少」，而 SGD 優化器則根據這些錯誤去微調權重，讓模型一步步學會更準確地分類影像。\n\n## Train the network\n\n```\nfor epoch in range(2):  # loop over the dataset multiple times\n<div></div>\n    running_loss = 0.0\n    for i, data in enumerate(trainloader, 0):\n        # get the inputs; data is a list of [inputs, labels]\n        inputs, labels = data\n<div></div>\n        # zero the parameter gradients\n        optimizer.zero_grad()\n<div></div>\n        # forward + backward + optimize\n        outputs = net(inputs)\n        loss = criterion(outputs, labels)\n        loss.backward()\n        optimizer.step()\n<div></div>\n        # print statistics\n        running_loss += loss.item()\n        if i % 2000 == 1999:    # print every 2000 mini-batches\n            print(f'[{epoch + 1}, {i + 1:5d}] loss: {running_loss / 2000:.3f}')\n            running_loss = 0.0\n<div></div>\nprint('Finished Training')\n```\n\n```\nfor epoch in range(2):  # loop over the dataset multiple times\n\n    running_loss = 0.0\n    for i, data in enumerate(trainloader, 0):\n        # get the inputs; data is a list of [inputs, labels]\n        inputs, labels = data\n\n        # zero the parameter gradients\n        optimizer.zero_grad()\n\n        # forward + backward + optimize\n        outputs = net(inputs)\n        loss = criterion(outputs, labels)\n        loss.backward()\n        optimizer.step()\n\n        # print statistics\n        running_loss += loss.item()\n        if i % 2000 == 1999:    # print every 2000 mini-batches\n            print(f'[{epoch + 1}, {i + 1:5d}] loss: {running_loss / 2000:.3f}')\n            running_loss = 0.0\n\nprint('Finished Training')\n```\n\n這段程式是整個模型訓練過程的核心，它讓神經網路能夠不斷從資料中學習、修正錯誤，進而提升分類準確率。最外層的 `for epoch in range(2):` 代表訓練要進行兩個回合（epoch），也就是讓模型將整個訓練資料集完整學習兩次。每個 epoch 開始前，先將 `running_loss` 設為 0，這個變數用來累積損失值，以便在訓練過程中觀察模型表現是否逐步改善。\n\n在每個 epoch 內部，`for i, data in enumerate(trainloader, 0):` 會從訓練資料載入器（`trainloader`）中依序取出資料批次（mini-batch）。每次取出的 `data` 由兩個部分組成：`inputs` 是輸入影像的張量（tensor），而 `labels` 是對應的真實分類標籤。由於前面設定過 `batch_size = 4`，因此每個批次會包含四張圖片與它們的標籤。\n\n接著，`optimizer.zero_grad()` 是一個非常重要的步驟，用來清除前一次訓練所累積的梯度（gradient）。在 PyTorch 中，梯度會自動累加，若不清零，前一批的梯度會干擾新的更新，使模型權重被錯誤地調整。清除梯度之後，就能安全地開始新的學習迭代。\n\n在這之後是整個學習流程的三個主要階段：前向傳播（forward）、反向傳播（backward）與參數更新（optimize）。`outputs = net(inputs)` 代表把輸入圖片送進神經網路中進行前向運算，網路會輸出一組預測結果。接著，`loss = criterion(outputs, labels)` 使用損失函數計算預測值與真實標籤之間的差距，損失值越大代表模型預測越不準確。`loss.backward()` 則是反向傳播的步驟，PyTorch 會根據損失值自動計算每個參數的梯度，也就是「模型應該怎麼修正自己」。最後，`optimizer.step()` 根據這些梯度更新模型的權重，使得網路在下一次預測時能更接近正確答案。\n\n在每次迭代結束後，`running_loss += loss.item()` 會把這一批的損失值加總起來。為了方便觀察訓練進展，程式設計成每訓練 2000 批資料時，就會印出一次平均損失值：`print(f'[{epoch + 1}, {i + 1:5d}] loss: {running_loss / 2000:.3f}')`。這樣可以直觀看出損失值是否持續下降，進而判斷模型是否正在有效地學習。印出後，`running_loss` 會被重置為 0，準備記錄下一段訓練的結果。\n\n當外層的迴圈結束後，代表模型已經完成所有訓練回合，`print('Finished Training')` 會顯示訓練完成的訊息。\n\n```\nPATH = './cifar_net.pth'\ntorch.save(net.state_dict(), PATH)\n```\n\n```\nPATH = './cifar_net.pth'\ntorch.save(net.state_dict(), PATH)\n```\n\n首先，`PATH = './cifar_net.pth'` 是設定模型要儲存的路徑與檔案名稱。這裡使用的 `'./cifar_net.pth'` 代表在目前的工作目錄下建立一個名為 **cifar\\_net.pth** 的檔案。副檔名 `.pth` 是 PyTorch 模型檔案的常見命名方式，代表「parameters of torch」（意即儲存的是模型的參數）。\n\n接下來的 `torch.save(net.state_dict(), PATH)` 是實際執行儲存的動作。這裡的 `net` 是前面訓練完成的神經網路，而 `net.state_dict()` 是一個特殊的字典（dictionary），裡面儲存了模型中所有層的**參數權重（weights）與偏差值（biases）**。換句話說，它只會保存模型「學到的知識」，而不是整個模型結構。這樣的設計讓儲存檔案更小、更靈活，也方便在不同環境中重新載入。\n\n```\ndataiter = iter(testloader)\nimages, labels = next(dataiter)\n<div></div>\n# print images\nimshow(torchvision.utils.make_grid(images))\nprint('GroundTruth: ', ' '.join(f'{classes[labels[j]]:5s}' for j in range(4)))\n```\n\n```\ndataiter = iter(testloader)\nimages, labels = next(dataiter)\n\n# print images\nimshow(torchvision.utils.make_grid(images))\nprint('GroundTruth: ', ' '.join(f'{classes[labels[j]]:5s}' for j in range(4)))\n```\n\n這段程式的功能是從測試資料集中隨機取出幾張圖片，顯示出它們的內容，並印出每張圖片的真實標籤（Ground Truth）。這通常是訓練完成後的第一個步驟，用來檢查測試資料是否正確載入，也方便之後與模型的預測結果進行比較。\n\n首先，`dataiter = iter(testloader)` 用來建立一個可迭代的資料讀取器。`testloader` 是先前設定好的測試資料載入器，裡面包含了 CIFAR-10 的測試圖片與對應標籤。接著，`images, labels = next(dataiter)` 從這個載入器中取出一批資料。這一批包含兩部分：`images` 是四張測試圖片的影像張量（tensor），`labels` 則是這四張圖片的真實類別標籤，以數字形式儲存。例如，若某張圖片的標籤是 3，就代表它屬於 CIFAR-10 類別中的「cat」。\n\n接下來的 `imshow(torchvision.utils.make_grid(images))` 是用來顯示圖片。由於這次取出的 `images` 是四張影像，因此使用 `torchvision.utils.make_grid(images)` 先把這四張圖排成一張大圖（grid），再交給 `imshow()` 函式顯示出來。`imshow()` 會先將影像資料反正規化（把像素值從 -1~1 的範圍還原為 0~1），然後利用 Matplotlib 將這張圖片網格畫出來。執行這行後，畫面上會出現四張並排的小圖片，也就是接下來模型要進行預測的測試樣本。\n\n![](/images/CleanShot-2025-10-29-at-11.41.16@2x-1024x385.png)\n\n最後一行 `print('GroundTruth: ', ' '.join(f'{classes[labels[j]]:5s}' for j in range(4)))` 則負責印出這四張圖片的真實類別名稱。這裡的 `classes` 是先前定義好的 CIFAR-10 類別名稱列表，例如 `('plane', 'car', 'bird', 'cat', 'deer', 'dog', 'frog', 'horse', 'ship', 'truck')`。`labels[j]` 會取出每張圖片的數字標籤，而 `classes[labels[j]]` 則將這些數字轉換為對應的文字名稱。`' '.join(...)` 用來把所有類別名稱以空格串起來，讓輸出更整齊。\n\n```\nnet = Net()\nnet.load_state_dict(torch.load(PATH, weights_only=True))\n```\n\n```\nnet = Net()\nnet.load_state_dict(torch.load(PATH, weights_only=True))\n```\n\n這段程式的主要功能是**重新載入先前訓練並儲存好的模型權重**，讓模型能夠直接使用訓練成果，而不必重新訓練。它通常出現在「模型測試」或「實際應用」的階段。\n\n首先，`net = Net()` 這行代表建立一個新的模型物件。這個 `Net` 是先前定義好的神經網路結構類別（包含卷積層、池化層、全連接層等）。這裡建立的 `net` 是一個「空白的模型骨架」，也就是只有網路的架構，尚未包含任何已學到的參數或權重。\n\n接下來的 `net.load_state_dict(torch.load(PATH, weights_only=True))` 是將儲存在檔案中的權重載入到這個模型中。前面的 `torch.load(PATH, weights_only=True)` 是從先前儲存的檔案（例如 `'./cifar_net.pth'`）中讀取模型參數。這個檔案是在訓練結束後用 `torch.save(net.state_dict(), PATH)` 儲存的，因此裡面包含了每一層神經網路的權重（weights）與偏差（biases）數值。\n\n`load_state_dict()` 則是 PyTorch 專門用來把這些儲存的參數載回模型的函式。當這個函式被呼叫時，它會根據模型層的名稱，自動將檔案中的權重一一對應回模型中相同名稱的層，讓這個新的 `net` 恢復成與訓練完成時相同的狀態。參數 `weights_only=True` 則指定只讀取權重數據，而不載入其他不必要的資訊（例如訓練時的設定或暫存變數），這樣可以確保載入過程簡潔且不受版本影響。\n\n```\noutputs = net(images)\n```\n\n```\noutputs = net(images)\n```\n\n`images` 是一批（batch）要測試的影像資料，通常是從 `testloader` 中取出來的四張圖片（因為你先前設定 `batch_size = 4`）。這些影像已經是經過 `transforms.ToTensor()` 和 `transforms.Normalize()` 處理的張量（tensor），形狀通常是 `(4, 3, 32, 32)`，分別代表：4 張圖片、3 個顏色通道（RGB）、以及 32×32 的解析度。\n\n`net` 是你的神經網路模型物件（由 `Net()` 建立，並載入了已訓練的權重）。當你把 `images` 傳進 `net()` 時，PyTorch 會自動呼叫 `Net` 類別裡定義的 `forward()` 函式。也就是說，這行程式會讓圖片依序通過：\n\n1. 卷積層（Conv2d） → 萃取影像特徵；\n\n3. ReLU 激活函式 → 引入非線性；\n\n5. 池化層（MaxPool2d） → 縮小影像尺寸；\n\n7. 全連接層（Linear） → 將特徵轉換成分類分數。\n\n這些層會依照你在 `forward()` 方法中定義的流程一層層運算，最終輸出模型對每張圖片的分類結果。\n\n```\n_, predicted = torch.max(outputs, 1)\n<div></div>\nprint('Predicted: ', ' '.join(f'{classes[predicted[j]]:5s}'\n                              for j in range(4)))\n```\n\n```\n_, predicted = torch.max(outputs, 1)\n\nprint('Predicted: ', ' '.join(f'{classes[predicted[j]]:5s}'\n                              for j in range(4)))\n```\n\n這裡使用了 PyTorch 的 `torch.max()` 函式，它的功能是**找出張量（tensor）中每一列的最大值以及它所在的位置**。  \n`outputs` 是模型對四張圖片的預測結果，形狀是 `(4, 10)`，其中：\n\n- 4 代表輸入的圖片數量；\n\n- 10 代表 CIFAR-10 的十個分類（例如飛機、汽車、貓、狗等）。\n\n對於每張圖片（每一列），模型會輸出 10 個數值，這些數值代表「模型認為該圖片屬於每個類別的信心分數」。  \n`torch.max(outputs, 1)` 的第二個參數 `1` 表示沿著「第 1 維」進行操作，也就是在每一列（每張圖片的 10 個分數）中尋找最大值。\n\n![](/images/CleanShot-2025-10-29-at-11.47.42@2x-1024x85.png)\n\n這個函式會回傳兩個結果：\n\n1. 最大值本身（這裡用 `_` 省略掉，因為我們只關心位置而不需要數值）；\n\n3. 最大值的索引位置，也就是每張圖片信心分數最高的類別代號。\n\n```\ncorrect = 0\ntotal = 0\n# since we're not training, we don't need to calculate the gradients for our outputs\nwith torch.no_grad():\n    for data in testloader:\n        images, labels = data\n        # calculate outputs by running images through the network\n        outputs = net(images)\n        # the class with the highest energy is what we choose as prediction\n        _, predicted = torch.max(outputs, 1)\n        total += labels.size(0)\n        correct += (predicted == labels).sum().item()\n<div></div>\nprint(f'Accuracy of the network on the 10000 test images: {100 * correct // total} %')\n```\n\n```\ncorrect = 0\ntotal = 0\n# since we're not training, we don't need to calculate the gradients for our outputs\nwith torch.no_grad():\n    for data in testloader:\n        images, labels = data\n        # calculate outputs by running images through the network\n        outputs = net(images)\n        # the class with the highest energy is what we choose as prediction\n        _, predicted = torch.max(outputs, 1)\n        total += labels.size(0)\n        correct += (predicted == labels).sum().item()\n\nprint(f'Accuracy of the network on the 10000 test images: {100 * correct // total} %')\n```\n\n`correct` 用來計算預測正確的圖片數量，`total` 則用來計算測試資料的總張數。最終會用這兩個數字來計算正確率。\n\n接著的 `with torch.no_grad():` 是 PyTorch 中常見的寫法，表示在這個區塊中**不需要追蹤梯度（gradients）**。在測試或推論階段，我們並不需要做反向傳播（backpropagation）或更新權重，因此可以關閉梯度計算來節省記憶體與運算時間。這樣能讓模型運行得更快，也避免誤修改權重。\n\n在程式中，`for data in testloader:` 會從測試資料載入器 `testloader` 中依序取出資料。每次取出的 `data` 代表一個批次（batch），其中包含四張測試圖片（`images`）及它們的真實標籤（`labels`）。接著，執行 `outputs = net(images)`，讓模型對這些圖片進行**前向傳播（forward pass）**，輸出每張圖片對應十個類別的分數（logits）。這些分數代表模型對每個類別的信心程度，分數越高表示模型越傾向認為圖片屬於該類別。\n\n之後的這行 `_, predicted = torch.max(outputs, 1)` 用來從模型的輸出中，取出每張圖片分數最高的那一個類別，作為模型的預測結果。這裡的 `predicted` 是一個包含四個數字的張量（tensor），每個數字代表模型認為圖片所屬的類別索引（例如 0 代表「plane」、1 代表「car」等）。換句話說，這一步是將模型的「信心分數」轉換成實際的「分類決策」。\n\n接著兩行 `total += labels.size(0)` 和 `correct += (predicted == labels).sum().item()` 是用來統計模型的預測表現。`labels.size(0)` 代表這一批圖片的數量（通常是 4），會加到 `total` 中，以累計測試圖片的總數。而 `(predicted == labels)` 會比較模型預測的類別與真實標籤是否一致，產生一個布林值陣列（例如 `[True, False, True, True]`）。使用 `.sum()` 會將其中的 `True` 視為 1、`False` 視為 0，相加後就能得到這一批中模型預測正確的圖片數。最後，`.item()` 會把這個張量轉換成普通的整數，再加到 `correct` 裡，表示目前累積的正確預測數量。\n\n當迴圈跑完所有測試資料後，模型就已經對整個測試集（共 10,000 張圖片）完成預測。\n\n![](/images/CleanShot-2025-10-29-at-11.57.50@2x-1024x45.png)\n\n代表模型在 10,000 張測試圖片中，有 53% 被正確分類。\n\n![](/images/CleanShot-2025-10-29-at-11.59.02@2x-1024x84.png)\n\n  \n這裡的 `100 * correct // total` 使用整數除法，讓結果以百分比的形式輸出。\n\n## Training on GPU\n\n```\ndevice = torch.device('cuda:0' if torch.cuda.is_available() else 'cpu')\n<div></div>\n# Assuming that we are on a CUDA machine, this should print a CUDA device:\n<div></div>\nprint(device)\n```\n\n```\ndevice = torch.device('cuda:0' if torch.cuda.is_available() else 'cpu')\n\n# Assuming that we are on a CUDA machine, this should print a CUDA device:\n\nprint(device)\n```\n\n`device = torch.device('cuda:0' if torch.cuda.is_available() else 'cpu')` 利用了 PyTorch 的 `torch.cuda.is_available()` 函式來檢查系統中是否安裝並啟用了 CUDA。若電腦中有支援的 NVIDIA 顯示卡且 CUDA 可用，這個函式會回傳 `True`，程式便會選擇 `'cuda:0'` 作為運算裝置，代表使用第 0 張 GPU（即第一張 GPU 卡）進行運算。若 CUDA 不可用，則回傳 `False`，程式會改用 `'cpu'`，也就是中央處理器進行運算。`torch.device()` 則會依據這個結果建立一個「裝置物件（device object）」，方便之後將模型或資料移動到指定的裝置上執行。\n\n接著這行 `print(device)` 會印出目前使用的運算裝置。如果系統有支援 CUDA 且 PyTorch 安裝的是 GPU 版本，輸出結果會是 `cuda:0`，表示模型將在 GPU 上執行；若系統中沒有可用的 GPU，則輸出為 `cpu`，代表程式會使用 CPU 進行運算。\n\n```\nnet.to(device)\n```\n\n```\nnet.to(device)\n```\n\n當你執行 `net.to(device)` 時，PyTorch 會把模型中所有的參數（包含權重 weights 與偏差 biases）從預設的 CPU 記憶體移動到目標裝置上。如果系統有支援 CUDA 且 GPU 可用，模型就會被移到顯示卡中運行；若沒有 GPU，則會保留在 CPU 上。\n\n```\ninputs, labels = data[0].to(device), data[1].to(device)\n```\n\n```\ninputs, labels = data[0].to(device), data[1].to(device)\n```\n\n`data[0]` 代表這一批的輸入圖片（影像張量），而 `data[1]` 則是對應的真實標籤（例如這張圖片是「貓」或「狗」）。這兩者最初都會存在 CPU 記憶體中，因為資料載入的預設裝置就是 CPU。\n\n`to(device)` 是 PyTorch 用來**把 Tensor 傳送到指定裝置**的方法。如果前面設定的 `device` 是 `'cuda:0'`，那這行指令會把 `inputs` 和 `labels` 都傳送到 GPU 記憶體中；如果沒有可用的 GPU，則會留在 CPU 上。這樣做可以確保模型（`net`）與資料位於相同的運算環境中，從而讓後續的運算（例如前向傳播、損失計算、反向傳播等）能夠正常執行。\n","slug":"training-a-classifier","published":1,"updated":"2026-01-28T14:17:25.067Z","_id":"cmkxg0krs0008rb8z2kho1yrw","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>程式碼與資料參考來源：<a href=\"https://docs.pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html#define-a-convolutional-neural-network\">https://docs.pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html#define-a-convolutional-neural-network</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch</span><br><span class=\"line\">import torchvision</span><br><span class=\"line\">import torchvision.transforms as transforms</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch</span><br><span class=\"line\">import torchvision</span><br><span class=\"line\">import torchvision.transforms as transforms</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">transform = transforms.Compose(</span><br><span class=\"line\">    [transforms.ToTensor(),</span><br><span class=\"line\">     transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))])</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">batch_size = 4</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">trainset = torchvision.datasets.CIFAR10(root=&#x27;./data&#x27;, train=True,</span><br><span class=\"line\">                                        download=True, transform=transform)</span><br><span class=\"line\">trainloader = torch.utils.data.DataLoader(trainset, batch_size=batch_size,</span><br><span class=\"line\">                                          shuffle=True, num_workers=2)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">testset = torchvision.datasets.CIFAR10(root=&#x27;./data&#x27;, train=False,</span><br><span class=\"line\">                                       download=True, transform=transform)</span><br><span class=\"line\">testloader = torch.utils.data.DataLoader(testset, batch_size=batch_size,</span><br><span class=\"line\">                                         shuffle=False, num_workers=2)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">classes = (&#x27;plane&#x27;, &#x27;car&#x27;, &#x27;bird&#x27;, &#x27;cat&#x27;,</span><br><span class=\"line\">           &#x27;deer&#x27;, &#x27;dog&#x27;, &#x27;frog&#x27;, &#x27;horse&#x27;, &#x27;ship&#x27;, &#x27;truck&#x27;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">transform = transforms.Compose(</span><br><span class=\"line\">    [transforms.ToTensor(),</span><br><span class=\"line\">     transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))])</span><br><span class=\"line\"></span><br><span class=\"line\">batch_size = 4</span><br><span class=\"line\"></span><br><span class=\"line\">trainset = torchvision.datasets.CIFAR10(root=&#x27;./data&#x27;, train=True,</span><br><span class=\"line\">                                        download=True, transform=transform)</span><br><span class=\"line\">trainloader = torch.utils.data.DataLoader(trainset, batch_size=batch_size,</span><br><span class=\"line\">                                          shuffle=True, num_workers=2)</span><br><span class=\"line\"></span><br><span class=\"line\">testset = torchvision.datasets.CIFAR10(root=&#x27;./data&#x27;, train=False,</span><br><span class=\"line\">                                       download=True, transform=transform)</span><br><span class=\"line\">testloader = torch.utils.data.DataLoader(testset, batch_size=batch_size,</span><br><span class=\"line\">                                         shuffle=False, num_workers=2)</span><br><span class=\"line\"></span><br><span class=\"line\">classes = (&#x27;plane&#x27;, &#x27;car&#x27;, &#x27;bird&#x27;, &#x27;cat&#x27;,</span><br><span class=\"line\">           &#x27;deer&#x27;, &#x27;dog&#x27;, &#x27;frog&#x27;, &#x27;horse&#x27;, &#x27;ship&#x27;, &#x27;truck&#x27;)</span><br></pre></td></tr></table></figure>\n\n<p>這段程式主要的目的，是建立一個可以讓 PyTorch 模型方便使用的影像資料載入流程。首先，程式定義了一個名為 <code>transform</code> 的轉換流程，這個轉換由兩個步驟組成。第一個步驟 <code>transforms.ToTensor()</code> 是把原本的影像（可能是 PIL Image 或 numpy 陣列）轉成 PyTorch 可以處理的 Tensor 格式，並且把像素值從 0～255 縮放到 0～1 之間。第二個步驟 <code>transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))</code> 則是將每個顏色通道進行標準化，把影像的數值範圍轉換成 -1 到 1 之間，這樣能讓模型在訓練時更穩定、更容易收斂。</p>\n<p>接著，<code>batch_size = 4</code> 表示每次從資料集中取出四張圖片，組成一個小批次（batch）來訓練。這樣做可以減少記憶體使用量，並加快訓練速度。</p>\n<p>在建立訓練資料集時，使用了 <code>torchvision.datasets.CIFAR10</code> 這個內建的資料集。CIFAR-10 是一個常見的影像分類資料集，裡面有 10 種不同類別的物體（例如飛機、汽車、貓、狗等）。參數 <code>root=&#39;./data&#39;</code> 代表資料會被存放在專案資料夾中的 <code>data</code> 目錄下；<code>train=True</code> 指定要載入訓練資料；<code>download=True</code> 讓程式在本地沒有資料時自動從網路下載；而 <code>transform=transform</code> 則確保每張影像在載入時都會先經過剛剛定義的轉換流程。</p>\n<p>建立好訓練資料集後，<code>trainloader</code> 透過 <code>torch.utils.data.DataLoader</code> 將資料集包裝成可以分批次讀取的形式。這個物件會在訓練時自動提供圖片與標籤。<code>shuffle=True</code> 表示在每個訓練輪次（epoch）開始前，資料都會被隨機打亂，避免模型記住資料的順序而影響學習。<code>num_workers=2</code> 則是設定使用兩個背景執行緒加快資料載入的速度。</p>\n<p>測試資料的部分幾乎相同，只是 <code>train=False</code> 代表這次載入的是測試資料集，並且 <code>shuffle=False</code>，確保測試資料的順序固定，方便在評估模型時對照結果。</p>\n<p>最後，<code>classes</code> 定義了一個包含 10 個字串的元組，對應到 CIFAR-10 資料集的十個分類名稱，分別是飛機（plane）、汽車（car）、鳥（bird）、貓（cat）、鹿（deer）、狗（dog）、青蛙（frog）、馬（horse）、船（ship）以及卡車（truck）。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import matplotlib.pyplot as plt</span><br><span class=\"line\">import numpy as np</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># functions to show an image</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">def imshow(img):</span><br><span class=\"line\">    img = img / 2 + 0.5     # unnormalize</span><br><span class=\"line\">    npimg = img.numpy()</span><br><span class=\"line\">    plt.imshow(np.transpose(npimg, (1, 2, 0)))</span><br><span class=\"line\">    plt.show()</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"># get some random training images</span><br><span class=\"line\">dataiter = iter(trainloader)</span><br><span class=\"line\">images, labels = next(dataiter)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># show images</span><br><span class=\"line\">imshow(torchvision.utils.make_grid(images))</span><br><span class=\"line\"># print labels</span><br><span class=\"line\">print(&#x27; &#x27;.join(f&#x27;&#123;classes[labels[j]]:5s&#125;&#x27; for j in range(batch_size)))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import matplotlib.pyplot as plt</span><br><span class=\"line\">import numpy as np</span><br><span class=\"line\"></span><br><span class=\"line\"># functions to show an image</span><br><span class=\"line\"></span><br><span class=\"line\">def imshow(img):</span><br><span class=\"line\">    img = img / 2 + 0.5     # unnormalize</span><br><span class=\"line\">    npimg = img.numpy()</span><br><span class=\"line\">    plt.imshow(np.transpose(npimg, (1, 2, 0)))</span><br><span class=\"line\">    plt.show()</span><br><span class=\"line\"></span><br><span class=\"line\"># get some random training images</span><br><span class=\"line\">dataiter = iter(trainloader)</span><br><span class=\"line\">images, labels = next(dataiter)</span><br><span class=\"line\"></span><br><span class=\"line\"># show images</span><br><span class=\"line\">imshow(torchvision.utils.make_grid(images))</span><br><span class=\"line\"># print labels</span><br><span class=\"line\">print(&#x27; &#x27;.join(f&#x27;&#123;classes[labels[j]]:5s&#125;&#x27; for j in range(batch_size)))</span><br></pre></td></tr></table></figure>\n\n<p>這段程式的主要功能是從訓練資料集中隨機取出一批圖片，將它們組合起來顯示在螢幕上，並同時印出每張圖片所對應的分類名稱。它常用於訓練前的資料檢查，讓我們確認影像資料是否被正確載入與轉換。</p>\n<p>首先，程式匯入了 <code>matplotlib.pyplot</code> 和 <code>numpy</code>，前者用來繪製和顯示圖片，後者則是進行陣列處理。接著定義了一個名為 <code>imshow</code> 的函式，用來顯示影像。由於在資料載入時影像經過標準化（值從 <code>[0,1]</code> 變成 <code>[-1,1]</code>），因此在顯示之前需要進行反標準化，也就是 <code>img = img / 2 + 0.5</code> 這一行，把影像還原到可視範圍 <code>[0,1]</code>。接著 <code>npimg = img.numpy()</code> 將 PyTorch 的 Tensor 轉成 NumPy 陣列，因為 Matplotlib 只能處理 NumPy 格式的資料。再來，<code>np.transpose(npimg, (1, 2, 0))</code> 這行是把影像的維度順序從 <code>(channels, height, width)</code> 調整成 Matplotlib 所需要的 <code>(height, width, channels)</code>。最後透過 <code>plt.imshow()</code> 顯示圖片，<code>plt.show()</code> 則把圖形真正畫出來。</p>\n<p>在顯示影像之前，程式會先從訓練資料中取出一批圖片。這裡 <code>dataiter = iter(trainloader)</code> 建立一個可迭代物件，用來從資料載入器中取得資料，而 <code>images, labels = next(dataiter)</code> 則是取出下一批資料。這一批資料包含了四張圖片（因為之前設定 <code>batch_size = 4</code>），以及這四張圖片的標籤。</p>\n<p><img src=\"/images/image-27.png\"></p>\n<p>接著使用 <code>torchvision.utils.make_grid(images)</code> 將多張圖片排成一張網格，方便一次顯示多張影像。這個網格會被傳入 <code>imshow()</code> 函式中顯示出來。最後一行 <code>print(&#39; &#39;.join(f&#39;&#123;classes[labels[j]]:5s&#125;&#39; for j in range(batch_size)))</code> 則是依序把每張圖片的類別名稱印出來。它會根據 <code>labels</code> 取得每張圖片的類別代號，再利用 <code>classes</code> 對應到實際的名稱（例如 “cat”、”dog”、”car” 等），並用空格分隔後印在同一行。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch.nn as nn</span><br><span class=\"line\">import torch.nn.functional as F</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">class Net(nn.Module):</span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        super().__init__()</span><br><span class=\"line\">        self.conv1 = nn.Conv2d(3, 6, 5)</span><br><span class=\"line\">        self.pool = nn.MaxPool2d(2, 2)</span><br><span class=\"line\">        self.conv2 = nn.Conv2d(6, 16, 5)</span><br><span class=\"line\">        self.fc1 = nn.Linear(16 * 5 * 5, 120)</span><br><span class=\"line\">        self.fc2 = nn.Linear(120, 84)</span><br><span class=\"line\">        self.fc3 = nn.Linear(84, 10)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    def forward(self, x):</span><br><span class=\"line\">        x = self.pool(F.relu(self.conv1(x)))</span><br><span class=\"line\">        x = self.pool(F.relu(self.conv2(x)))</span><br><span class=\"line\">        x = torch.flatten(x, 1) # flatten all dimensions except batch</span><br><span class=\"line\">        x = F.relu(self.fc1(x))</span><br><span class=\"line\">        x = F.relu(self.fc2(x))</span><br><span class=\"line\">        x = self.fc3(x)</span><br><span class=\"line\">        return x</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">net = Net()</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch.nn as nn</span><br><span class=\"line\">import torch.nn.functional as F</span><br><span class=\"line\"></span><br><span class=\"line\">class Net(nn.Module):</span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        super().__init__()</span><br><span class=\"line\">        self.conv1 = nn.Conv2d(3, 6, 5)</span><br><span class=\"line\">        self.pool = nn.MaxPool2d(2, 2)</span><br><span class=\"line\">        self.conv2 = nn.Conv2d(6, 16, 5)</span><br><span class=\"line\">        self.fc1 = nn.Linear(16 * 5 * 5, 120)</span><br><span class=\"line\">        self.fc2 = nn.Linear(120, 84)</span><br><span class=\"line\">        self.fc3 = nn.Linear(84, 10)</span><br><span class=\"line\"></span><br><span class=\"line\">    def forward(self, x):</span><br><span class=\"line\">        x = self.pool(F.relu(self.conv1(x)))</span><br><span class=\"line\">        x = self.pool(F.relu(self.conv2(x)))</span><br><span class=\"line\">        x = torch.flatten(x, 1) # flatten all dimensions except batch</span><br><span class=\"line\">        x = F.relu(self.fc1(x))</span><br><span class=\"line\">        x = F.relu(self.fc2(x))</span><br><span class=\"line\">        x = self.fc3(x)</span><br><span class=\"line\">        return x</span><br><span class=\"line\"></span><br><span class=\"line\">net = Net()</span><br></pre></td></tr></table></figure>\n\n<p>這段程式定義並建立了一個基本的卷積神經網路（Convolutional Neural Network, CNN），用來進行影像分類。這個網路的結構與 LeNet 類似，是一個簡單但經典的 CNN 範例，常用於 CIFAR-10 這類小型影像資料集的學習實驗。</p>\n<p>首先，程式匯入了 <code>torch.nn</code> 與 <code>torch.nn.functional</code>。前者提供各種神經網路層的模組，例如卷積層、線性層（全連接層）等；後者則提供常用的函式操作，例如激活函式 ReLU（Rectified Linear Unit）等。</p>\n<p>接著，透過定義一個名為 <code>Net</code> 的類別來建立網路結構。這個類別繼承自 <code>nn.Module</code>，是 PyTorch 中所有模型的基底類別。<code>__init__</code> 方法中定義了網路的各個層。<code>self.conv1 = nn.Conv2d(3, 6, 5)</code> 是第一個卷積層，它的輸入有三個通道（對應到彩色影像的 R、G、B 三色），輸出六個特徵圖（feature maps），而卷積核（filter）的大小是 5×5。接著 <code>self.pool = nn.MaxPool2d(2, 2)</code> 是最大池化層，用於縮小影像尺寸，減少參數與計算量。<code>self.conv2 = nn.Conv2d(6, 16, 5)</code> 是第二個卷積層，輸入為六個通道、輸出十六個特徵圖，同樣使用 5×5 的卷積核。</p>\n<p>卷積層之後是三個全連接層（fully connected layers），也就是傳統神經網路的部分。<code>self.fc1 = nn.Linear(16 * 5 * 5, 120)</code> 代表第一個全連接層的輸入為 16×5×5 維的向量（也就是前面卷積與池化之後展平的結果），輸出為 120 個神經元。接著的 <code>self.fc2 = nn.Linear(120, 84)</code> 再將輸入從 120 維轉成 84 維，而最後一層 <code>self.fc3 = nn.Linear(84, 10)</code> 則輸出 10 維的結果，對應到 CIFAR-10 的十個分類類別。</p>\n<p>在 <code>forward</code> 方法中定義了資料的前向傳遞過程，也就是影像如何一步步通過網路。首先，輸入 <code>x</code> 經過第一個卷積層 <code>self.conv1</code>，然後經過 ReLU 激活函式轉換，再經過最大池化層縮小尺寸。接著進入第二個卷積層 <code>self.conv2</code>，同樣再經過 ReLU 與池化層。這兩次卷積與池化之後，影像的空間維度大幅縮小，但特徵變得更抽象、更具辨識能力。接下來使用 <code>torch.flatten(x, 1)</code> 將多維的特徵圖展平成一維向量（除了批次維度外），使其能夠輸入到全連接層。然後依序通過兩層帶有 ReLU 激活函式的全連接層，最後輸出到 <code>fc3</code>，產生最終的分類結果。</p>\n<p>最後一行 <code>net = Net()</code> 則是實際建立這個網路的實例。建立後的 <code>net</code> 物件就是一個可供訓練的 CNN 模型，能夠接收 CIFAR-10 的影像作為輸入，並輸出十個類別的預測結果。整體而言，這段程式展示了從卷積層、池化層到全連接層的完整 CNN 結構，構成了一個典型的影像分類模型。</p>\n<h3 id=\"補充-ReLU-的作用\"><a href=\"#補充-ReLU-的作用\" class=\"headerlink\" title=\"補充 : ReLU 的作用\"></a>補充 : ReLU 的作用</h3><p><img src=\"/images/image-28.png\"></p>\n<p>它會<strong>把所有負值剪掉，正值保留</strong>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch.optim as optim</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">criterion = nn.CrossEntropyLoss()</span><br><span class=\"line\">optimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch.optim as optim</span><br><span class=\"line\"></span><br><span class=\"line\">criterion = nn.CrossEntropyLoss()</span><br><span class=\"line\">optimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)</span><br></pre></td></tr></table></figure>\n\n<p>這段程式的主要功能，是為神經網路設定<strong>損失函數（loss function）與優化器（optimizer）</strong>，也就是訓練模型時用來「評估表現」與「更新權重」的兩個關鍵步驟。它們就像訓練過程中的「老師」和「調整機制」，共同決定模型如何從錯誤中學習。</p>\n<p>首先，<code>criterion = nn.CrossEntropyLoss()</code> 這行定義了損失函數，使用的是交叉熵損失（Cross Entropy Loss）。交叉熵是一種在<strong>分類問題</strong>中最常見的損失函數，它用來衡量模型預測的機率分佈與真實答案之間的差距。舉例來說，若模型預測一張圖片是「貓」的機率為 0.9，而真實標籤確實是貓，那損失值就會很小；但如果模型預測是「狗」的機率為 0.9，損失值就會很大。這樣模型在訓練時會自動調整權重，讓正確類別的機率越來越高。CrossEntropyLoss 在 PyTorch 中同時結合了 <strong>softmax</strong>（將輸出轉為機率）與 <strong>log loss</strong>（計算對數誤差），因此不需要手動再對輸出做 softmax 處理。</p>\n<p>接著，<code>optimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)</code> 這行設定了優化器，使用的是隨機梯度下降法（Stochastic Gradient Descent, SGD）。在訓練神經網路時，模型會根據損失函數的值計算出梯度，表示權重應該如何調整以降低損失。SGD 就是透過這些梯度逐步更新模型的參數。<code>net.parameters()</code> 表示要讓優化器管理網路中所有可學習的權重；<code>lr=0.001</code> 則是設定學習率（learning rate），也就是每次更新權重時的步伐大小。學習率太大會導致訓練不穩定、損失值震盪；太小則會讓收斂速度變慢。最後的 <code>momentum=0.9</code> 是動量參數，它能幫助模型在訓練過程中更順利地前進，減少在局部最小值附近震盪的情況。動量的概念就像 推球一樣，當球在斜坡上滾動時，會保留部分前一次的速度，讓更新方向更平滑、加速收斂。</p>\n<p>總結來說，這段程式的作用是建立訓練模型時的「學習機制」：交叉熵損失負責告訴網路「預測錯了多少」，而 SGD 優化器則根據這些錯誤去微調權重，讓模型一步步學會更準確地分類影像。</p>\n<h2 id=\"Train-the-network\"><a href=\"#Train-the-network\" class=\"headerlink\" title=\"Train the network\"></a>Train the network</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for epoch in range(2):  # loop over the dataset multiple times</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    running_loss = 0.0</span><br><span class=\"line\">    for i, data in enumerate(trainloader, 0):</span><br><span class=\"line\">        # get the inputs; data is a list of [inputs, labels]</span><br><span class=\"line\">        inputs, labels = data</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        # zero the parameter gradients</span><br><span class=\"line\">        optimizer.zero_grad()</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        # forward + backward + optimize</span><br><span class=\"line\">        outputs = net(inputs)</span><br><span class=\"line\">        loss = criterion(outputs, labels)</span><br><span class=\"line\">        loss.backward()</span><br><span class=\"line\">        optimizer.step()</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        # print statistics</span><br><span class=\"line\">        running_loss += loss.item()</span><br><span class=\"line\">        if i % 2000 == 1999:    # print every 2000 mini-batches</span><br><span class=\"line\">            print(f&#x27;[&#123;epoch + 1&#125;, &#123;i + 1:5d&#125;] loss: &#123;running_loss / 2000:.3f&#125;&#x27;)</span><br><span class=\"line\">            running_loss = 0.0</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">print(&#x27;Finished Training&#x27;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for epoch in range(2):  # loop over the dataset multiple times</span><br><span class=\"line\"></span><br><span class=\"line\">    running_loss = 0.0</span><br><span class=\"line\">    for i, data in enumerate(trainloader, 0):</span><br><span class=\"line\">        # get the inputs; data is a list of [inputs, labels]</span><br><span class=\"line\">        inputs, labels = data</span><br><span class=\"line\"></span><br><span class=\"line\">        # zero the parameter gradients</span><br><span class=\"line\">        optimizer.zero_grad()</span><br><span class=\"line\"></span><br><span class=\"line\">        # forward + backward + optimize</span><br><span class=\"line\">        outputs = net(inputs)</span><br><span class=\"line\">        loss = criterion(outputs, labels)</span><br><span class=\"line\">        loss.backward()</span><br><span class=\"line\">        optimizer.step()</span><br><span class=\"line\"></span><br><span class=\"line\">        # print statistics</span><br><span class=\"line\">        running_loss += loss.item()</span><br><span class=\"line\">        if i % 2000 == 1999:    # print every 2000 mini-batches</span><br><span class=\"line\">            print(f&#x27;[&#123;epoch + 1&#125;, &#123;i + 1:5d&#125;] loss: &#123;running_loss / 2000:.3f&#125;&#x27;)</span><br><span class=\"line\">            running_loss = 0.0</span><br><span class=\"line\"></span><br><span class=\"line\">print(&#x27;Finished Training&#x27;)</span><br></pre></td></tr></table></figure>\n\n<p>這段程式是整個模型訓練過程的核心，它讓神經網路能夠不斷從資料中學習、修正錯誤，進而提升分類準確率。最外層的 <code>for epoch in range(2):</code> 代表訓練要進行兩個回合（epoch），也就是讓模型將整個訓練資料集完整學習兩次。每個 epoch 開始前，先將 <code>running_loss</code> 設為 0，這個變數用來累積損失值，以便在訓練過程中觀察模型表現是否逐步改善。</p>\n<p>在每個 epoch 內部，<code>for i, data in enumerate(trainloader, 0):</code> 會從訓練資料載入器（<code>trainloader</code>）中依序取出資料批次（mini-batch）。每次取出的 <code>data</code> 由兩個部分組成：<code>inputs</code> 是輸入影像的張量（tensor），而 <code>labels</code> 是對應的真實分類標籤。由於前面設定過 <code>batch_size = 4</code>，因此每個批次會包含四張圖片與它們的標籤。</p>\n<p>接著，<code>optimizer.zero_grad()</code> 是一個非常重要的步驟，用來清除前一次訓練所累積的梯度（gradient）。在 PyTorch 中，梯度會自動累加，若不清零，前一批的梯度會干擾新的更新，使模型權重被錯誤地調整。清除梯度之後，就能安全地開始新的學習迭代。</p>\n<p>在這之後是整個學習流程的三個主要階段：前向傳播（forward）、反向傳播（backward）與參數更新（optimize）。<code>outputs = net(inputs)</code> 代表把輸入圖片送進神經網路中進行前向運算，網路會輸出一組預測結果。接著，<code>loss = criterion(outputs, labels)</code> 使用損失函數計算預測值與真實標籤之間的差距，損失值越大代表模型預測越不準確。<code>loss.backward()</code> 則是反向傳播的步驟，PyTorch 會根據損失值自動計算每個參數的梯度，也就是「模型應該怎麼修正自己」。最後，<code>optimizer.step()</code> 根據這些梯度更新模型的權重，使得網路在下一次預測時能更接近正確答案。</p>\n<p>在每次迭代結束後，<code>running_loss += loss.item()</code> 會把這一批的損失值加總起來。為了方便觀察訓練進展，程式設計成每訓練 2000 批資料時，就會印出一次平均損失值：<code>print(f&#39;[&#123;epoch + 1&#125;, &#123;i + 1:5d&#125;] loss: &#123;running_loss / 2000:.3f&#125;&#39;)</code>。這樣可以直觀看出損失值是否持續下降，進而判斷模型是否正在有效地學習。印出後，<code>running_loss</code> 會被重置為 0，準備記錄下一段訓練的結果。</p>\n<p>當外層的迴圈結束後，代表模型已經完成所有訓練回合，<code>print(&#39;Finished Training&#39;)</code> 會顯示訓練完成的訊息。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PATH = &#x27;./cifar_net.pth&#x27;</span><br><span class=\"line\">torch.save(net.state_dict(), PATH)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PATH = &#x27;./cifar_net.pth&#x27;</span><br><span class=\"line\">torch.save(net.state_dict(), PATH)</span><br></pre></td></tr></table></figure>\n\n<p>首先，<code>PATH = &#39;./cifar_net.pth&#39;</code> 是設定模型要儲存的路徑與檔案名稱。這裡使用的 <code>&#39;./cifar_net.pth&#39;</code> 代表在目前的工作目錄下建立一個名為 <strong>cifar_net.pth</strong> 的檔案。副檔名 <code>.pth</code> 是 PyTorch 模型檔案的常見命名方式，代表「parameters of torch」（意即儲存的是模型的參數）。</p>\n<p>接下來的 <code>torch.save(net.state_dict(), PATH)</code> 是實際執行儲存的動作。這裡的 <code>net</code> 是前面訓練完成的神經網路，而 <code>net.state_dict()</code> 是一個特殊的字典（dictionary），裡面儲存了模型中所有層的<strong>參數權重（weights）與偏差值（biases）</strong>。換句話說，它只會保存模型「學到的知識」，而不是整個模型結構。這樣的設計讓儲存檔案更小、更靈活，也方便在不同環境中重新載入。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataiter = iter(testloader)</span><br><span class=\"line\">images, labels = next(dataiter)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># print images</span><br><span class=\"line\">imshow(torchvision.utils.make_grid(images))</span><br><span class=\"line\">print(&#x27;GroundTruth: &#x27;, &#x27; &#x27;.join(f&#x27;&#123;classes[labels[j]]:5s&#125;&#x27; for j in range(4)))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataiter = iter(testloader)</span><br><span class=\"line\">images, labels = next(dataiter)</span><br><span class=\"line\"></span><br><span class=\"line\"># print images</span><br><span class=\"line\">imshow(torchvision.utils.make_grid(images))</span><br><span class=\"line\">print(&#x27;GroundTruth: &#x27;, &#x27; &#x27;.join(f&#x27;&#123;classes[labels[j]]:5s&#125;&#x27; for j in range(4)))</span><br></pre></td></tr></table></figure>\n\n<p>這段程式的功能是從測試資料集中隨機取出幾張圖片，顯示出它們的內容，並印出每張圖片的真實標籤（Ground Truth）。這通常是訓練完成後的第一個步驟，用來檢查測試資料是否正確載入，也方便之後與模型的預測結果進行比較。</p>\n<p>首先，<code>dataiter = iter(testloader)</code> 用來建立一個可迭代的資料讀取器。<code>testloader</code> 是先前設定好的測試資料載入器，裡面包含了 CIFAR-10 的測試圖片與對應標籤。接著，<code>images, labels = next(dataiter)</code> 從這個載入器中取出一批資料。這一批包含兩部分：<code>images</code> 是四張測試圖片的影像張量（tensor），<code>labels</code> 則是這四張圖片的真實類別標籤，以數字形式儲存。例如，若某張圖片的標籤是 3，就代表它屬於 CIFAR-10 類別中的「cat」。</p>\n<p>接下來的 <code>imshow(torchvision.utils.make_grid(images))</code> 是用來顯示圖片。由於這次取出的 <code>images</code> 是四張影像，因此使用 <code>torchvision.utils.make_grid(images)</code> 先把這四張圖排成一張大圖（grid），再交給 <code>imshow()</code> 函式顯示出來。<code>imshow()</code> 會先將影像資料反正規化（把像素值從 -1<del>1 的範圍還原為 0</del>1），然後利用 Matplotlib 將這張圖片網格畫出來。執行這行後，畫面上會出現四張並排的小圖片，也就是接下來模型要進行預測的測試樣本。</p>\n<p><img src=\"/images/CleanShot-2025-10-29-at-11.41.16@2x-1024x385.png\"></p>\n<p>最後一行 <code>print(&#39;GroundTruth: &#39;, &#39; &#39;.join(f&#39;&#123;classes[labels[j]]:5s&#125;&#39; for j in range(4)))</code> 則負責印出這四張圖片的真實類別名稱。這裡的 <code>classes</code> 是先前定義好的 CIFAR-10 類別名稱列表，例如 <code>(&#39;plane&#39;, &#39;car&#39;, &#39;bird&#39;, &#39;cat&#39;, &#39;deer&#39;, &#39;dog&#39;, &#39;frog&#39;, &#39;horse&#39;, &#39;ship&#39;, &#39;truck&#39;)</code>。<code>labels[j]</code> 會取出每張圖片的數字標籤，而 <code>classes[labels[j]]</code> 則將這些數字轉換為對應的文字名稱。<code>&#39; &#39;.join(...)</code> 用來把所有類別名稱以空格串起來，讓輸出更整齊。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net = Net()</span><br><span class=\"line\">net.load_state_dict(torch.load(PATH, weights_only=True))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net = Net()</span><br><span class=\"line\">net.load_state_dict(torch.load(PATH, weights_only=True))</span><br></pre></td></tr></table></figure>\n\n<p>這段程式的主要功能是<strong>重新載入先前訓練並儲存好的模型權重</strong>，讓模型能夠直接使用訓練成果，而不必重新訓練。它通常出現在「模型測試」或「實際應用」的階段。</p>\n<p>首先，<code>net = Net()</code> 這行代表建立一個新的模型物件。這個 <code>Net</code> 是先前定義好的神經網路結構類別（包含卷積層、池化層、全連接層等）。這裡建立的 <code>net</code> 是一個「空白的模型骨架」，也就是只有網路的架構，尚未包含任何已學到的參數或權重。</p>\n<p>接下來的 <code>net.load_state_dict(torch.load(PATH, weights_only=True))</code> 是將儲存在檔案中的權重載入到這個模型中。前面的 <code>torch.load(PATH, weights_only=True)</code> 是從先前儲存的檔案（例如 <code>&#39;./cifar_net.pth&#39;</code>）中讀取模型參數。這個檔案是在訓練結束後用 <code>torch.save(net.state_dict(), PATH)</code> 儲存的，因此裡面包含了每一層神經網路的權重（weights）與偏差（biases）數值。</p>\n<p><code>load_state_dict()</code> 則是 PyTorch 專門用來把這些儲存的參數載回模型的函式。當這個函式被呼叫時，它會根據模型層的名稱，自動將檔案中的權重一一對應回模型中相同名稱的層，讓這個新的 <code>net</code> 恢復成與訓練完成時相同的狀態。參數 <code>weights_only=True</code> 則指定只讀取權重數據，而不載入其他不必要的資訊（例如訓練時的設定或暫存變數），這樣可以確保載入過程簡潔且不受版本影響。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">outputs = net(images)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">outputs = net(images)</span><br></pre></td></tr></table></figure>\n\n<p><code>images</code> 是一批（batch）要測試的影像資料，通常是從 <code>testloader</code> 中取出來的四張圖片（因為你先前設定 <code>batch_size = 4</code>）。這些影像已經是經過 <code>transforms.ToTensor()</code> 和 <code>transforms.Normalize()</code> 處理的張量（tensor），形狀通常是 <code>(4, 3, 32, 32)</code>，分別代表：4 張圖片、3 個顏色通道（RGB）、以及 32×32 的解析度。</p>\n<p><code>net</code> 是你的神經網路模型物件（由 <code>Net()</code> 建立，並載入了已訓練的權重）。當你把 <code>images</code> 傳進 <code>net()</code> 時，PyTorch 會自動呼叫 <code>Net</code> 類別裡定義的 <code>forward()</code> 函式。也就是說，這行程式會讓圖片依序通過：</p>\n<ol>\n<li><p>卷積層（Conv2d） → 萃取影像特徵；</p>\n</li>\n<li><p>ReLU 激活函式 → 引入非線性；</p>\n</li>\n<li><p>池化層（MaxPool2d） → 縮小影像尺寸；</p>\n</li>\n<li><p>全連接層（Linear） → 將特徵轉換成分類分數。</p>\n</li>\n</ol>\n<p>這些層會依照你在 <code>forward()</code> 方法中定義的流程一層層運算，最終輸出模型對每張圖片的分類結果。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_, predicted = torch.max(outputs, 1)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">print(&#x27;Predicted: &#x27;, &#x27; &#x27;.join(f&#x27;&#123;classes[predicted[j]]:5s&#125;&#x27;</span><br><span class=\"line\">                              for j in range(4)))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_, predicted = torch.max(outputs, 1)</span><br><span class=\"line\"></span><br><span class=\"line\">print(&#x27;Predicted: &#x27;, &#x27; &#x27;.join(f&#x27;&#123;classes[predicted[j]]:5s&#125;&#x27;</span><br><span class=\"line\">                              for j in range(4)))</span><br></pre></td></tr></table></figure>\n\n<p>這裡使用了 PyTorch 的 <code>torch.max()</code> 函式，它的功能是<strong>找出張量（tensor）中每一列的最大值以及它所在的位置</strong>。<br><code>outputs</code> 是模型對四張圖片的預測結果，形狀是 <code>(4, 10)</code>，其中：</p>\n<ul>\n<li><p>4 代表輸入的圖片數量；</p>\n</li>\n<li><p>10 代表 CIFAR-10 的十個分類（例如飛機、汽車、貓、狗等）。</p>\n</li>\n</ul>\n<p>對於每張圖片（每一列），模型會輸出 10 個數值，這些數值代表「模型認為該圖片屬於每個類別的信心分數」。<br><code>torch.max(outputs, 1)</code> 的第二個參數 <code>1</code> 表示沿著「第 1 維」進行操作，也就是在每一列（每張圖片的 10 個分數）中尋找最大值。</p>\n<p><img src=\"/images/CleanShot-2025-10-29-at-11.47.42@2x-1024x85.png\"></p>\n<p>這個函式會回傳兩個結果：</p>\n<ol>\n<li><p>最大值本身（這裡用 <code>_</code> 省略掉，因為我們只關心位置而不需要數值）；</p>\n</li>\n<li><p>最大值的索引位置，也就是每張圖片信心分數最高的類別代號。</p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">correct = 0</span><br><span class=\"line\">total = 0</span><br><span class=\"line\"># since we&#x27;re not training, we don&#x27;t need to calculate the gradients for our outputs</span><br><span class=\"line\">with torch.no_grad():</span><br><span class=\"line\">    for data in testloader:</span><br><span class=\"line\">        images, labels = data</span><br><span class=\"line\">        # calculate outputs by running images through the network</span><br><span class=\"line\">        outputs = net(images)</span><br><span class=\"line\">        # the class with the highest energy is what we choose as prediction</span><br><span class=\"line\">        _, predicted = torch.max(outputs, 1)</span><br><span class=\"line\">        total += labels.size(0)</span><br><span class=\"line\">        correct += (predicted == labels).sum().item()</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">print(f&#x27;Accuracy of the network on the 10000 test images: &#123;100 * correct // total&#125; %&#x27;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">correct = 0</span><br><span class=\"line\">total = 0</span><br><span class=\"line\"># since we&#x27;re not training, we don&#x27;t need to calculate the gradients for our outputs</span><br><span class=\"line\">with torch.no_grad():</span><br><span class=\"line\">    for data in testloader:</span><br><span class=\"line\">        images, labels = data</span><br><span class=\"line\">        # calculate outputs by running images through the network</span><br><span class=\"line\">        outputs = net(images)</span><br><span class=\"line\">        # the class with the highest energy is what we choose as prediction</span><br><span class=\"line\">        _, predicted = torch.max(outputs, 1)</span><br><span class=\"line\">        total += labels.size(0)</span><br><span class=\"line\">        correct += (predicted == labels).sum().item()</span><br><span class=\"line\"></span><br><span class=\"line\">print(f&#x27;Accuracy of the network on the 10000 test images: &#123;100 * correct // total&#125; %&#x27;)</span><br></pre></td></tr></table></figure>\n\n<p><code>correct</code> 用來計算預測正確的圖片數量，<code>total</code> 則用來計算測試資料的總張數。最終會用這兩個數字來計算正確率。</p>\n<p>接著的 <code>with torch.no_grad():</code> 是 PyTorch 中常見的寫法，表示在這個區塊中<strong>不需要追蹤梯度（gradients）</strong>。在測試或推論階段，我們並不需要做反向傳播（backpropagation）或更新權重，因此可以關閉梯度計算來節省記憶體與運算時間。這樣能讓模型運行得更快，也避免誤修改權重。</p>\n<p>在程式中，<code>for data in testloader:</code> 會從測試資料載入器 <code>testloader</code> 中依序取出資料。每次取出的 <code>data</code> 代表一個批次（batch），其中包含四張測試圖片（<code>images</code>）及它們的真實標籤（<code>labels</code>）。接著，執行 <code>outputs = net(images)</code>，讓模型對這些圖片進行<strong>前向傳播（forward pass）</strong>，輸出每張圖片對應十個類別的分數（logits）。這些分數代表模型對每個類別的信心程度，分數越高表示模型越傾向認為圖片屬於該類別。</p>\n<p>之後的這行 <code>_, predicted = torch.max(outputs, 1)</code> 用來從模型的輸出中，取出每張圖片分數最高的那一個類別，作為模型的預測結果。這裡的 <code>predicted</code> 是一個包含四個數字的張量（tensor），每個數字代表模型認為圖片所屬的類別索引（例如 0 代表「plane」、1 代表「car」等）。換句話說，這一步是將模型的「信心分數」轉換成實際的「分類決策」。</p>\n<p>接著兩行 <code>total += labels.size(0)</code> 和 <code>correct += (predicted == labels).sum().item()</code> 是用來統計模型的預測表現。<code>labels.size(0)</code> 代表這一批圖片的數量（通常是 4），會加到 <code>total</code> 中，以累計測試圖片的總數。而 <code>(predicted == labels)</code> 會比較模型預測的類別與真實標籤是否一致，產生一個布林值陣列（例如 <code>[True, False, True, True]</code>）。使用 <code>.sum()</code> 會將其中的 <code>True</code> 視為 1、<code>False</code> 視為 0，相加後就能得到這一批中模型預測正確的圖片數。最後，<code>.item()</code> 會把這個張量轉換成普通的整數，再加到 <code>correct</code> 裡，表示目前累積的正確預測數量。</p>\n<p>當迴圈跑完所有測試資料後，模型就已經對整個測試集（共 10,000 張圖片）完成預測。</p>\n<p><img src=\"/images/CleanShot-2025-10-29-at-11.57.50@2x-1024x45.png\"></p>\n<p>代表模型在 10,000 張測試圖片中，有 53% 被正確分類。</p>\n<p><img src=\"/images/CleanShot-2025-10-29-at-11.59.02@2x-1024x84.png\"></p>\n<p>這裡的 <code>100 * correct // total</code> 使用整數除法，讓結果以百分比的形式輸出。</p>\n<h2 id=\"Training-on-GPU\"><a href=\"#Training-on-GPU\" class=\"headerlink\" title=\"Training on GPU\"></a>Training on GPU</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">device = torch.device(&#x27;cuda:0&#x27; if torch.cuda.is_available() else &#x27;cpu&#x27;)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># Assuming that we are on a CUDA machine, this should print a CUDA device:</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">print(device)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">device = torch.device(&#x27;cuda:0&#x27; if torch.cuda.is_available() else &#x27;cpu&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\"># Assuming that we are on a CUDA machine, this should print a CUDA device:</span><br><span class=\"line\"></span><br><span class=\"line\">print(device)</span><br></pre></td></tr></table></figure>\n\n<p><code>device = torch.device(&#39;cuda:0&#39; if torch.cuda.is_available() else &#39;cpu&#39;)</code> 利用了 PyTorch 的 <code>torch.cuda.is_available()</code> 函式來檢查系統中是否安裝並啟用了 CUDA。若電腦中有支援的 NVIDIA 顯示卡且 CUDA 可用，這個函式會回傳 <code>True</code>，程式便會選擇 <code>&#39;cuda:0&#39;</code> 作為運算裝置，代表使用第 0 張 GPU（即第一張 GPU 卡）進行運算。若 CUDA 不可用，則回傳 <code>False</code>，程式會改用 <code>&#39;cpu&#39;</code>，也就是中央處理器進行運算。<code>torch.device()</code> 則會依據這個結果建立一個「裝置物件（device object）」，方便之後將模型或資料移動到指定的裝置上執行。</p>\n<p>接著這行 <code>print(device)</code> 會印出目前使用的運算裝置。如果系統有支援 CUDA 且 PyTorch 安裝的是 GPU 版本，輸出結果會是 <code>cuda:0</code>，表示模型將在 GPU 上執行；若系統中沒有可用的 GPU，則輸出為 <code>cpu</code>，代表程式會使用 CPU 進行運算。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net.to(device)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net.to(device)</span><br></pre></td></tr></table></figure>\n\n<p>當你執行 <code>net.to(device)</code> 時，PyTorch 會把模型中所有的參數（包含權重 weights 與偏差 biases）從預設的 CPU 記憶體移動到目標裝置上。如果系統有支援 CUDA 且 GPU 可用，模型就會被移到顯示卡中運行；若沒有 GPU，則會保留在 CPU 上。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inputs, labels = data[0].to(device), data[1].to(device)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inputs, labels = data[0].to(device), data[1].to(device)</span><br></pre></td></tr></table></figure>\n\n<p><code>data[0]</code> 代表這一批的輸入圖片（影像張量），而 <code>data[1]</code> 則是對應的真實標籤（例如這張圖片是「貓」或「狗」）。這兩者最初都會存在 CPU 記憶體中，因為資料載入的預設裝置就是 CPU。</p>\n<p><code>to(device)</code> 是 PyTorch 用來<strong>把 Tensor 傳送到指定裝置</strong>的方法。如果前面設定的 <code>device</code> 是 <code>&#39;cuda:0&#39;</code>，那這行指令會把 <code>inputs</code> 和 <code>labels</code> 都傳送到 GPU 記憶體中；如果沒有可用的 GPU，則會留在 CPU 上。這樣做可以確保模型（<code>net</code>）與資料位於相同的運算環境中，從而讓後續的運算（例如前向傳播、損失計算、反向傳播等）能夠正常執行。</p>\n","excerpt":"","more":"<p>程式碼與資料參考來源：<a href=\"https://docs.pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html#define-a-convolutional-neural-network\">https://docs.pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html#define-a-convolutional-neural-network</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch</span><br><span class=\"line\">import torchvision</span><br><span class=\"line\">import torchvision.transforms as transforms</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch</span><br><span class=\"line\">import torchvision</span><br><span class=\"line\">import torchvision.transforms as transforms</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">transform = transforms.Compose(</span><br><span class=\"line\">    [transforms.ToTensor(),</span><br><span class=\"line\">     transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))])</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">batch_size = 4</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">trainset = torchvision.datasets.CIFAR10(root=&#x27;./data&#x27;, train=True,</span><br><span class=\"line\">                                        download=True, transform=transform)</span><br><span class=\"line\">trainloader = torch.utils.data.DataLoader(trainset, batch_size=batch_size,</span><br><span class=\"line\">                                          shuffle=True, num_workers=2)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">testset = torchvision.datasets.CIFAR10(root=&#x27;./data&#x27;, train=False,</span><br><span class=\"line\">                                       download=True, transform=transform)</span><br><span class=\"line\">testloader = torch.utils.data.DataLoader(testset, batch_size=batch_size,</span><br><span class=\"line\">                                         shuffle=False, num_workers=2)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">classes = (&#x27;plane&#x27;, &#x27;car&#x27;, &#x27;bird&#x27;, &#x27;cat&#x27;,</span><br><span class=\"line\">           &#x27;deer&#x27;, &#x27;dog&#x27;, &#x27;frog&#x27;, &#x27;horse&#x27;, &#x27;ship&#x27;, &#x27;truck&#x27;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">transform = transforms.Compose(</span><br><span class=\"line\">    [transforms.ToTensor(),</span><br><span class=\"line\">     transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))])</span><br><span class=\"line\"></span><br><span class=\"line\">batch_size = 4</span><br><span class=\"line\"></span><br><span class=\"line\">trainset = torchvision.datasets.CIFAR10(root=&#x27;./data&#x27;, train=True,</span><br><span class=\"line\">                                        download=True, transform=transform)</span><br><span class=\"line\">trainloader = torch.utils.data.DataLoader(trainset, batch_size=batch_size,</span><br><span class=\"line\">                                          shuffle=True, num_workers=2)</span><br><span class=\"line\"></span><br><span class=\"line\">testset = torchvision.datasets.CIFAR10(root=&#x27;./data&#x27;, train=False,</span><br><span class=\"line\">                                       download=True, transform=transform)</span><br><span class=\"line\">testloader = torch.utils.data.DataLoader(testset, batch_size=batch_size,</span><br><span class=\"line\">                                         shuffle=False, num_workers=2)</span><br><span class=\"line\"></span><br><span class=\"line\">classes = (&#x27;plane&#x27;, &#x27;car&#x27;, &#x27;bird&#x27;, &#x27;cat&#x27;,</span><br><span class=\"line\">           &#x27;deer&#x27;, &#x27;dog&#x27;, &#x27;frog&#x27;, &#x27;horse&#x27;, &#x27;ship&#x27;, &#x27;truck&#x27;)</span><br></pre></td></tr></table></figure>\n\n<p>這段程式主要的目的，是建立一個可以讓 PyTorch 模型方便使用的影像資料載入流程。首先，程式定義了一個名為 <code>transform</code> 的轉換流程，這個轉換由兩個步驟組成。第一個步驟 <code>transforms.ToTensor()</code> 是把原本的影像（可能是 PIL Image 或 numpy 陣列）轉成 PyTorch 可以處理的 Tensor 格式，並且把像素值從 0～255 縮放到 0～1 之間。第二個步驟 <code>transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))</code> 則是將每個顏色通道進行標準化，把影像的數值範圍轉換成 -1 到 1 之間，這樣能讓模型在訓練時更穩定、更容易收斂。</p>\n<p>接著，<code>batch_size = 4</code> 表示每次從資料集中取出四張圖片，組成一個小批次（batch）來訓練。這樣做可以減少記憶體使用量，並加快訓練速度。</p>\n<p>在建立訓練資料集時，使用了 <code>torchvision.datasets.CIFAR10</code> 這個內建的資料集。CIFAR-10 是一個常見的影像分類資料集，裡面有 10 種不同類別的物體（例如飛機、汽車、貓、狗等）。參數 <code>root=&#39;./data&#39;</code> 代表資料會被存放在專案資料夾中的 <code>data</code> 目錄下；<code>train=True</code> 指定要載入訓練資料；<code>download=True</code> 讓程式在本地沒有資料時自動從網路下載；而 <code>transform=transform</code> 則確保每張影像在載入時都會先經過剛剛定義的轉換流程。</p>\n<p>建立好訓練資料集後，<code>trainloader</code> 透過 <code>torch.utils.data.DataLoader</code> 將資料集包裝成可以分批次讀取的形式。這個物件會在訓練時自動提供圖片與標籤。<code>shuffle=True</code> 表示在每個訓練輪次（epoch）開始前，資料都會被隨機打亂，避免模型記住資料的順序而影響學習。<code>num_workers=2</code> 則是設定使用兩個背景執行緒加快資料載入的速度。</p>\n<p>測試資料的部分幾乎相同，只是 <code>train=False</code> 代表這次載入的是測試資料集，並且 <code>shuffle=False</code>，確保測試資料的順序固定，方便在評估模型時對照結果。</p>\n<p>最後，<code>classes</code> 定義了一個包含 10 個字串的元組，對應到 CIFAR-10 資料集的十個分類名稱，分別是飛機（plane）、汽車（car）、鳥（bird）、貓（cat）、鹿（deer）、狗（dog）、青蛙（frog）、馬（horse）、船（ship）以及卡車（truck）。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import matplotlib.pyplot as plt</span><br><span class=\"line\">import numpy as np</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># functions to show an image</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">def imshow(img):</span><br><span class=\"line\">    img = img / 2 + 0.5     # unnormalize</span><br><span class=\"line\">    npimg = img.numpy()</span><br><span class=\"line\">    plt.imshow(np.transpose(npimg, (1, 2, 0)))</span><br><span class=\"line\">    plt.show()</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"># get some random training images</span><br><span class=\"line\">dataiter = iter(trainloader)</span><br><span class=\"line\">images, labels = next(dataiter)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># show images</span><br><span class=\"line\">imshow(torchvision.utils.make_grid(images))</span><br><span class=\"line\"># print labels</span><br><span class=\"line\">print(&#x27; &#x27;.join(f&#x27;&#123;classes[labels[j]]:5s&#125;&#x27; for j in range(batch_size)))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import matplotlib.pyplot as plt</span><br><span class=\"line\">import numpy as np</span><br><span class=\"line\"></span><br><span class=\"line\"># functions to show an image</span><br><span class=\"line\"></span><br><span class=\"line\">def imshow(img):</span><br><span class=\"line\">    img = img / 2 + 0.5     # unnormalize</span><br><span class=\"line\">    npimg = img.numpy()</span><br><span class=\"line\">    plt.imshow(np.transpose(npimg, (1, 2, 0)))</span><br><span class=\"line\">    plt.show()</span><br><span class=\"line\"></span><br><span class=\"line\"># get some random training images</span><br><span class=\"line\">dataiter = iter(trainloader)</span><br><span class=\"line\">images, labels = next(dataiter)</span><br><span class=\"line\"></span><br><span class=\"line\"># show images</span><br><span class=\"line\">imshow(torchvision.utils.make_grid(images))</span><br><span class=\"line\"># print labels</span><br><span class=\"line\">print(&#x27; &#x27;.join(f&#x27;&#123;classes[labels[j]]:5s&#125;&#x27; for j in range(batch_size)))</span><br></pre></td></tr></table></figure>\n\n<p>這段程式的主要功能是從訓練資料集中隨機取出一批圖片，將它們組合起來顯示在螢幕上，並同時印出每張圖片所對應的分類名稱。它常用於訓練前的資料檢查，讓我們確認影像資料是否被正確載入與轉換。</p>\n<p>首先，程式匯入了 <code>matplotlib.pyplot</code> 和 <code>numpy</code>，前者用來繪製和顯示圖片，後者則是進行陣列處理。接著定義了一個名為 <code>imshow</code> 的函式，用來顯示影像。由於在資料載入時影像經過標準化（值從 <code>[0,1]</code> 變成 <code>[-1,1]</code>），因此在顯示之前需要進行反標準化，也就是 <code>img = img / 2 + 0.5</code> 這一行，把影像還原到可視範圍 <code>[0,1]</code>。接著 <code>npimg = img.numpy()</code> 將 PyTorch 的 Tensor 轉成 NumPy 陣列，因為 Matplotlib 只能處理 NumPy 格式的資料。再來，<code>np.transpose(npimg, (1, 2, 0))</code> 這行是把影像的維度順序從 <code>(channels, height, width)</code> 調整成 Matplotlib 所需要的 <code>(height, width, channels)</code>。最後透過 <code>plt.imshow()</code> 顯示圖片，<code>plt.show()</code> 則把圖形真正畫出來。</p>\n<p>在顯示影像之前，程式會先從訓練資料中取出一批圖片。這裡 <code>dataiter = iter(trainloader)</code> 建立一個可迭代物件，用來從資料載入器中取得資料，而 <code>images, labels = next(dataiter)</code> 則是取出下一批資料。這一批資料包含了四張圖片（因為之前設定 <code>batch_size = 4</code>），以及這四張圖片的標籤。</p>\n<p><img src=\"/images/image-27.png\"></p>\n<p>接著使用 <code>torchvision.utils.make_grid(images)</code> 將多張圖片排成一張網格，方便一次顯示多張影像。這個網格會被傳入 <code>imshow()</code> 函式中顯示出來。最後一行 <code>print(&#39; &#39;.join(f&#39;&#123;classes[labels[j]]:5s&#125;&#39; for j in range(batch_size)))</code> 則是依序把每張圖片的類別名稱印出來。它會根據 <code>labels</code> 取得每張圖片的類別代號，再利用 <code>classes</code> 對應到實際的名稱（例如 “cat”、”dog”、”car” 等），並用空格分隔後印在同一行。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch.nn as nn</span><br><span class=\"line\">import torch.nn.functional as F</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">class Net(nn.Module):</span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        super().__init__()</span><br><span class=\"line\">        self.conv1 = nn.Conv2d(3, 6, 5)</span><br><span class=\"line\">        self.pool = nn.MaxPool2d(2, 2)</span><br><span class=\"line\">        self.conv2 = nn.Conv2d(6, 16, 5)</span><br><span class=\"line\">        self.fc1 = nn.Linear(16 * 5 * 5, 120)</span><br><span class=\"line\">        self.fc2 = nn.Linear(120, 84)</span><br><span class=\"line\">        self.fc3 = nn.Linear(84, 10)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    def forward(self, x):</span><br><span class=\"line\">        x = self.pool(F.relu(self.conv1(x)))</span><br><span class=\"line\">        x = self.pool(F.relu(self.conv2(x)))</span><br><span class=\"line\">        x = torch.flatten(x, 1) # flatten all dimensions except batch</span><br><span class=\"line\">        x = F.relu(self.fc1(x))</span><br><span class=\"line\">        x = F.relu(self.fc2(x))</span><br><span class=\"line\">        x = self.fc3(x)</span><br><span class=\"line\">        return x</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">net = Net()</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch.nn as nn</span><br><span class=\"line\">import torch.nn.functional as F</span><br><span class=\"line\"></span><br><span class=\"line\">class Net(nn.Module):</span><br><span class=\"line\">    def __init__(self):</span><br><span class=\"line\">        super().__init__()</span><br><span class=\"line\">        self.conv1 = nn.Conv2d(3, 6, 5)</span><br><span class=\"line\">        self.pool = nn.MaxPool2d(2, 2)</span><br><span class=\"line\">        self.conv2 = nn.Conv2d(6, 16, 5)</span><br><span class=\"line\">        self.fc1 = nn.Linear(16 * 5 * 5, 120)</span><br><span class=\"line\">        self.fc2 = nn.Linear(120, 84)</span><br><span class=\"line\">        self.fc3 = nn.Linear(84, 10)</span><br><span class=\"line\"></span><br><span class=\"line\">    def forward(self, x):</span><br><span class=\"line\">        x = self.pool(F.relu(self.conv1(x)))</span><br><span class=\"line\">        x = self.pool(F.relu(self.conv2(x)))</span><br><span class=\"line\">        x = torch.flatten(x, 1) # flatten all dimensions except batch</span><br><span class=\"line\">        x = F.relu(self.fc1(x))</span><br><span class=\"line\">        x = F.relu(self.fc2(x))</span><br><span class=\"line\">        x = self.fc3(x)</span><br><span class=\"line\">        return x</span><br><span class=\"line\"></span><br><span class=\"line\">net = Net()</span><br></pre></td></tr></table></figure>\n\n<p>這段程式定義並建立了一個基本的卷積神經網路（Convolutional Neural Network, CNN），用來進行影像分類。這個網路的結構與 LeNet 類似，是一個簡單但經典的 CNN 範例，常用於 CIFAR-10 這類小型影像資料集的學習實驗。</p>\n<p>首先，程式匯入了 <code>torch.nn</code> 與 <code>torch.nn.functional</code>。前者提供各種神經網路層的模組，例如卷積層、線性層（全連接層）等；後者則提供常用的函式操作，例如激活函式 ReLU（Rectified Linear Unit）等。</p>\n<p>接著，透過定義一個名為 <code>Net</code> 的類別來建立網路結構。這個類別繼承自 <code>nn.Module</code>，是 PyTorch 中所有模型的基底類別。<code>__init__</code> 方法中定義了網路的各個層。<code>self.conv1 = nn.Conv2d(3, 6, 5)</code> 是第一個卷積層，它的輸入有三個通道（對應到彩色影像的 R、G、B 三色），輸出六個特徵圖（feature maps），而卷積核（filter）的大小是 5×5。接著 <code>self.pool = nn.MaxPool2d(2, 2)</code> 是最大池化層，用於縮小影像尺寸，減少參數與計算量。<code>self.conv2 = nn.Conv2d(6, 16, 5)</code> 是第二個卷積層，輸入為六個通道、輸出十六個特徵圖，同樣使用 5×5 的卷積核。</p>\n<p>卷積層之後是三個全連接層（fully connected layers），也就是傳統神經網路的部分。<code>self.fc1 = nn.Linear(16 * 5 * 5, 120)</code> 代表第一個全連接層的輸入為 16×5×5 維的向量（也就是前面卷積與池化之後展平的結果），輸出為 120 個神經元。接著的 <code>self.fc2 = nn.Linear(120, 84)</code> 再將輸入從 120 維轉成 84 維，而最後一層 <code>self.fc3 = nn.Linear(84, 10)</code> 則輸出 10 維的結果，對應到 CIFAR-10 的十個分類類別。</p>\n<p>在 <code>forward</code> 方法中定義了資料的前向傳遞過程，也就是影像如何一步步通過網路。首先，輸入 <code>x</code> 經過第一個卷積層 <code>self.conv1</code>，然後經過 ReLU 激活函式轉換，再經過最大池化層縮小尺寸。接著進入第二個卷積層 <code>self.conv2</code>，同樣再經過 ReLU 與池化層。這兩次卷積與池化之後，影像的空間維度大幅縮小，但特徵變得更抽象、更具辨識能力。接下來使用 <code>torch.flatten(x, 1)</code> 將多維的特徵圖展平成一維向量（除了批次維度外），使其能夠輸入到全連接層。然後依序通過兩層帶有 ReLU 激活函式的全連接層，最後輸出到 <code>fc3</code>，產生最終的分類結果。</p>\n<p>最後一行 <code>net = Net()</code> 則是實際建立這個網路的實例。建立後的 <code>net</code> 物件就是一個可供訓練的 CNN 模型，能夠接收 CIFAR-10 的影像作為輸入，並輸出十個類別的預測結果。整體而言，這段程式展示了從卷積層、池化層到全連接層的完整 CNN 結構，構成了一個典型的影像分類模型。</p>\n<h3 id=\"補充-ReLU-的作用\"><a href=\"#補充-ReLU-的作用\" class=\"headerlink\" title=\"補充 : ReLU 的作用\"></a>補充 : ReLU 的作用</h3><p><img src=\"/images/image-28.png\"></p>\n<p>它會<strong>把所有負值剪掉，正值保留</strong>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch.optim as optim</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">criterion = nn.CrossEntropyLoss()</span><br><span class=\"line\">optimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import torch.optim as optim</span><br><span class=\"line\"></span><br><span class=\"line\">criterion = nn.CrossEntropyLoss()</span><br><span class=\"line\">optimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)</span><br></pre></td></tr></table></figure>\n\n<p>這段程式的主要功能，是為神經網路設定<strong>損失函數（loss function）與優化器（optimizer）</strong>，也就是訓練模型時用來「評估表現」與「更新權重」的兩個關鍵步驟。它們就像訓練過程中的「老師」和「調整機制」，共同決定模型如何從錯誤中學習。</p>\n<p>首先，<code>criterion = nn.CrossEntropyLoss()</code> 這行定義了損失函數，使用的是交叉熵損失（Cross Entropy Loss）。交叉熵是一種在<strong>分類問題</strong>中最常見的損失函數，它用來衡量模型預測的機率分佈與真實答案之間的差距。舉例來說，若模型預測一張圖片是「貓」的機率為 0.9，而真實標籤確實是貓，那損失值就會很小；但如果模型預測是「狗」的機率為 0.9，損失值就會很大。這樣模型在訓練時會自動調整權重，讓正確類別的機率越來越高。CrossEntropyLoss 在 PyTorch 中同時結合了 <strong>softmax</strong>（將輸出轉為機率）與 <strong>log loss</strong>（計算對數誤差），因此不需要手動再對輸出做 softmax 處理。</p>\n<p>接著，<code>optimizer = optim.SGD(net.parameters(), lr=0.001, momentum=0.9)</code> 這行設定了優化器，使用的是隨機梯度下降法（Stochastic Gradient Descent, SGD）。在訓練神經網路時，模型會根據損失函數的值計算出梯度，表示權重應該如何調整以降低損失。SGD 就是透過這些梯度逐步更新模型的參數。<code>net.parameters()</code> 表示要讓優化器管理網路中所有可學習的權重；<code>lr=0.001</code> 則是設定學習率（learning rate），也就是每次更新權重時的步伐大小。學習率太大會導致訓練不穩定、損失值震盪；太小則會讓收斂速度變慢。最後的 <code>momentum=0.9</code> 是動量參數，它能幫助模型在訓練過程中更順利地前進，減少在局部最小值附近震盪的情況。動量的概念就像 推球一樣，當球在斜坡上滾動時，會保留部分前一次的速度，讓更新方向更平滑、加速收斂。</p>\n<p>總結來說，這段程式的作用是建立訓練模型時的「學習機制」：交叉熵損失負責告訴網路「預測錯了多少」，而 SGD 優化器則根據這些錯誤去微調權重，讓模型一步步學會更準確地分類影像。</p>\n<h2 id=\"Train-the-network\"><a href=\"#Train-the-network\" class=\"headerlink\" title=\"Train the network\"></a>Train the network</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for epoch in range(2):  # loop over the dataset multiple times</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    running_loss = 0.0</span><br><span class=\"line\">    for i, data in enumerate(trainloader, 0):</span><br><span class=\"line\">        # get the inputs; data is a list of [inputs, labels]</span><br><span class=\"line\">        inputs, labels = data</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        # zero the parameter gradients</span><br><span class=\"line\">        optimizer.zero_grad()</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        # forward + backward + optimize</span><br><span class=\"line\">        outputs = net(inputs)</span><br><span class=\"line\">        loss = criterion(outputs, labels)</span><br><span class=\"line\">        loss.backward()</span><br><span class=\"line\">        optimizer.step()</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        # print statistics</span><br><span class=\"line\">        running_loss += loss.item()</span><br><span class=\"line\">        if i % 2000 == 1999:    # print every 2000 mini-batches</span><br><span class=\"line\">            print(f&#x27;[&#123;epoch + 1&#125;, &#123;i + 1:5d&#125;] loss: &#123;running_loss / 2000:.3f&#125;&#x27;)</span><br><span class=\"line\">            running_loss = 0.0</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">print(&#x27;Finished Training&#x27;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for epoch in range(2):  # loop over the dataset multiple times</span><br><span class=\"line\"></span><br><span class=\"line\">    running_loss = 0.0</span><br><span class=\"line\">    for i, data in enumerate(trainloader, 0):</span><br><span class=\"line\">        # get the inputs; data is a list of [inputs, labels]</span><br><span class=\"line\">        inputs, labels = data</span><br><span class=\"line\"></span><br><span class=\"line\">        # zero the parameter gradients</span><br><span class=\"line\">        optimizer.zero_grad()</span><br><span class=\"line\"></span><br><span class=\"line\">        # forward + backward + optimize</span><br><span class=\"line\">        outputs = net(inputs)</span><br><span class=\"line\">        loss = criterion(outputs, labels)</span><br><span class=\"line\">        loss.backward()</span><br><span class=\"line\">        optimizer.step()</span><br><span class=\"line\"></span><br><span class=\"line\">        # print statistics</span><br><span class=\"line\">        running_loss += loss.item()</span><br><span class=\"line\">        if i % 2000 == 1999:    # print every 2000 mini-batches</span><br><span class=\"line\">            print(f&#x27;[&#123;epoch + 1&#125;, &#123;i + 1:5d&#125;] loss: &#123;running_loss / 2000:.3f&#125;&#x27;)</span><br><span class=\"line\">            running_loss = 0.0</span><br><span class=\"line\"></span><br><span class=\"line\">print(&#x27;Finished Training&#x27;)</span><br></pre></td></tr></table></figure>\n\n<p>這段程式是整個模型訓練過程的核心，它讓神經網路能夠不斷從資料中學習、修正錯誤，進而提升分類準確率。最外層的 <code>for epoch in range(2):</code> 代表訓練要進行兩個回合（epoch），也就是讓模型將整個訓練資料集完整學習兩次。每個 epoch 開始前，先將 <code>running_loss</code> 設為 0，這個變數用來累積損失值，以便在訓練過程中觀察模型表現是否逐步改善。</p>\n<p>在每個 epoch 內部，<code>for i, data in enumerate(trainloader, 0):</code> 會從訓練資料載入器（<code>trainloader</code>）中依序取出資料批次（mini-batch）。每次取出的 <code>data</code> 由兩個部分組成：<code>inputs</code> 是輸入影像的張量（tensor），而 <code>labels</code> 是對應的真實分類標籤。由於前面設定過 <code>batch_size = 4</code>，因此每個批次會包含四張圖片與它們的標籤。</p>\n<p>接著，<code>optimizer.zero_grad()</code> 是一個非常重要的步驟，用來清除前一次訓練所累積的梯度（gradient）。在 PyTorch 中，梯度會自動累加，若不清零，前一批的梯度會干擾新的更新，使模型權重被錯誤地調整。清除梯度之後，就能安全地開始新的學習迭代。</p>\n<p>在這之後是整個學習流程的三個主要階段：前向傳播（forward）、反向傳播（backward）與參數更新（optimize）。<code>outputs = net(inputs)</code> 代表把輸入圖片送進神經網路中進行前向運算，網路會輸出一組預測結果。接著，<code>loss = criterion(outputs, labels)</code> 使用損失函數計算預測值與真實標籤之間的差距，損失值越大代表模型預測越不準確。<code>loss.backward()</code> 則是反向傳播的步驟，PyTorch 會根據損失值自動計算每個參數的梯度，也就是「模型應該怎麼修正自己」。最後，<code>optimizer.step()</code> 根據這些梯度更新模型的權重，使得網路在下一次預測時能更接近正確答案。</p>\n<p>在每次迭代結束後，<code>running_loss += loss.item()</code> 會把這一批的損失值加總起來。為了方便觀察訓練進展，程式設計成每訓練 2000 批資料時，就會印出一次平均損失值：<code>print(f&#39;[&#123;epoch + 1&#125;, &#123;i + 1:5d&#125;] loss: &#123;running_loss / 2000:.3f&#125;&#39;)</code>。這樣可以直觀看出損失值是否持續下降，進而判斷模型是否正在有效地學習。印出後，<code>running_loss</code> 會被重置為 0，準備記錄下一段訓練的結果。</p>\n<p>當外層的迴圈結束後，代表模型已經完成所有訓練回合，<code>print(&#39;Finished Training&#39;)</code> 會顯示訓練完成的訊息。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PATH = &#x27;./cifar_net.pth&#x27;</span><br><span class=\"line\">torch.save(net.state_dict(), PATH)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PATH = &#x27;./cifar_net.pth&#x27;</span><br><span class=\"line\">torch.save(net.state_dict(), PATH)</span><br></pre></td></tr></table></figure>\n\n<p>首先，<code>PATH = &#39;./cifar_net.pth&#39;</code> 是設定模型要儲存的路徑與檔案名稱。這裡使用的 <code>&#39;./cifar_net.pth&#39;</code> 代表在目前的工作目錄下建立一個名為 <strong>cifar_net.pth</strong> 的檔案。副檔名 <code>.pth</code> 是 PyTorch 模型檔案的常見命名方式，代表「parameters of torch」（意即儲存的是模型的參數）。</p>\n<p>接下來的 <code>torch.save(net.state_dict(), PATH)</code> 是實際執行儲存的動作。這裡的 <code>net</code> 是前面訓練完成的神經網路，而 <code>net.state_dict()</code> 是一個特殊的字典（dictionary），裡面儲存了模型中所有層的<strong>參數權重（weights）與偏差值（biases）</strong>。換句話說，它只會保存模型「學到的知識」，而不是整個模型結構。這樣的設計讓儲存檔案更小、更靈活，也方便在不同環境中重新載入。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataiter = iter(testloader)</span><br><span class=\"line\">images, labels = next(dataiter)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># print images</span><br><span class=\"line\">imshow(torchvision.utils.make_grid(images))</span><br><span class=\"line\">print(&#x27;GroundTruth: &#x27;, &#x27; &#x27;.join(f&#x27;&#123;classes[labels[j]]:5s&#125;&#x27; for j in range(4)))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataiter = iter(testloader)</span><br><span class=\"line\">images, labels = next(dataiter)</span><br><span class=\"line\"></span><br><span class=\"line\"># print images</span><br><span class=\"line\">imshow(torchvision.utils.make_grid(images))</span><br><span class=\"line\">print(&#x27;GroundTruth: &#x27;, &#x27; &#x27;.join(f&#x27;&#123;classes[labels[j]]:5s&#125;&#x27; for j in range(4)))</span><br></pre></td></tr></table></figure>\n\n<p>這段程式的功能是從測試資料集中隨機取出幾張圖片，顯示出它們的內容，並印出每張圖片的真實標籤（Ground Truth）。這通常是訓練完成後的第一個步驟，用來檢查測試資料是否正確載入，也方便之後與模型的預測結果進行比較。</p>\n<p>首先，<code>dataiter = iter(testloader)</code> 用來建立一個可迭代的資料讀取器。<code>testloader</code> 是先前設定好的測試資料載入器，裡面包含了 CIFAR-10 的測試圖片與對應標籤。接著，<code>images, labels = next(dataiter)</code> 從這個載入器中取出一批資料。這一批包含兩部分：<code>images</code> 是四張測試圖片的影像張量（tensor），<code>labels</code> 則是這四張圖片的真實類別標籤，以數字形式儲存。例如，若某張圖片的標籤是 3，就代表它屬於 CIFAR-10 類別中的「cat」。</p>\n<p>接下來的 <code>imshow(torchvision.utils.make_grid(images))</code> 是用來顯示圖片。由於這次取出的 <code>images</code> 是四張影像，因此使用 <code>torchvision.utils.make_grid(images)</code> 先把這四張圖排成一張大圖（grid），再交給 <code>imshow()</code> 函式顯示出來。<code>imshow()</code> 會先將影像資料反正規化（把像素值從 -1<del>1 的範圍還原為 0</del>1），然後利用 Matplotlib 將這張圖片網格畫出來。執行這行後，畫面上會出現四張並排的小圖片，也就是接下來模型要進行預測的測試樣本。</p>\n<p><img src=\"/images/CleanShot-2025-10-29-at-11.41.16@2x-1024x385.png\"></p>\n<p>最後一行 <code>print(&#39;GroundTruth: &#39;, &#39; &#39;.join(f&#39;&#123;classes[labels[j]]:5s&#125;&#39; for j in range(4)))</code> 則負責印出這四張圖片的真實類別名稱。這裡的 <code>classes</code> 是先前定義好的 CIFAR-10 類別名稱列表，例如 <code>(&#39;plane&#39;, &#39;car&#39;, &#39;bird&#39;, &#39;cat&#39;, &#39;deer&#39;, &#39;dog&#39;, &#39;frog&#39;, &#39;horse&#39;, &#39;ship&#39;, &#39;truck&#39;)</code>。<code>labels[j]</code> 會取出每張圖片的數字標籤，而 <code>classes[labels[j]]</code> 則將這些數字轉換為對應的文字名稱。<code>&#39; &#39;.join(...)</code> 用來把所有類別名稱以空格串起來，讓輸出更整齊。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net = Net()</span><br><span class=\"line\">net.load_state_dict(torch.load(PATH, weights_only=True))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net = Net()</span><br><span class=\"line\">net.load_state_dict(torch.load(PATH, weights_only=True))</span><br></pre></td></tr></table></figure>\n\n<p>這段程式的主要功能是<strong>重新載入先前訓練並儲存好的模型權重</strong>，讓模型能夠直接使用訓練成果，而不必重新訓練。它通常出現在「模型測試」或「實際應用」的階段。</p>\n<p>首先，<code>net = Net()</code> 這行代表建立一個新的模型物件。這個 <code>Net</code> 是先前定義好的神經網路結構類別（包含卷積層、池化層、全連接層等）。這裡建立的 <code>net</code> 是一個「空白的模型骨架」，也就是只有網路的架構，尚未包含任何已學到的參數或權重。</p>\n<p>接下來的 <code>net.load_state_dict(torch.load(PATH, weights_only=True))</code> 是將儲存在檔案中的權重載入到這個模型中。前面的 <code>torch.load(PATH, weights_only=True)</code> 是從先前儲存的檔案（例如 <code>&#39;./cifar_net.pth&#39;</code>）中讀取模型參數。這個檔案是在訓練結束後用 <code>torch.save(net.state_dict(), PATH)</code> 儲存的，因此裡面包含了每一層神經網路的權重（weights）與偏差（biases）數值。</p>\n<p><code>load_state_dict()</code> 則是 PyTorch 專門用來把這些儲存的參數載回模型的函式。當這個函式被呼叫時，它會根據模型層的名稱，自動將檔案中的權重一一對應回模型中相同名稱的層，讓這個新的 <code>net</code> 恢復成與訓練完成時相同的狀態。參數 <code>weights_only=True</code> 則指定只讀取權重數據，而不載入其他不必要的資訊（例如訓練時的設定或暫存變數），這樣可以確保載入過程簡潔且不受版本影響。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">outputs = net(images)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">outputs = net(images)</span><br></pre></td></tr></table></figure>\n\n<p><code>images</code> 是一批（batch）要測試的影像資料，通常是從 <code>testloader</code> 中取出來的四張圖片（因為你先前設定 <code>batch_size = 4</code>）。這些影像已經是經過 <code>transforms.ToTensor()</code> 和 <code>transforms.Normalize()</code> 處理的張量（tensor），形狀通常是 <code>(4, 3, 32, 32)</code>，分別代表：4 張圖片、3 個顏色通道（RGB）、以及 32×32 的解析度。</p>\n<p><code>net</code> 是你的神經網路模型物件（由 <code>Net()</code> 建立，並載入了已訓練的權重）。當你把 <code>images</code> 傳進 <code>net()</code> 時，PyTorch 會自動呼叫 <code>Net</code> 類別裡定義的 <code>forward()</code> 函式。也就是說，這行程式會讓圖片依序通過：</p>\n<ol>\n<li><p>卷積層（Conv2d） → 萃取影像特徵；</p>\n</li>\n<li><p>ReLU 激活函式 → 引入非線性；</p>\n</li>\n<li><p>池化層（MaxPool2d） → 縮小影像尺寸；</p>\n</li>\n<li><p>全連接層（Linear） → 將特徵轉換成分類分數。</p>\n</li>\n</ol>\n<p>這些層會依照你在 <code>forward()</code> 方法中定義的流程一層層運算，最終輸出模型對每張圖片的分類結果。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_, predicted = torch.max(outputs, 1)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">print(&#x27;Predicted: &#x27;, &#x27; &#x27;.join(f&#x27;&#123;classes[predicted[j]]:5s&#125;&#x27;</span><br><span class=\"line\">                              for j in range(4)))</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_, predicted = torch.max(outputs, 1)</span><br><span class=\"line\"></span><br><span class=\"line\">print(&#x27;Predicted: &#x27;, &#x27; &#x27;.join(f&#x27;&#123;classes[predicted[j]]:5s&#125;&#x27;</span><br><span class=\"line\">                              for j in range(4)))</span><br></pre></td></tr></table></figure>\n\n<p>這裡使用了 PyTorch 的 <code>torch.max()</code> 函式，它的功能是<strong>找出張量（tensor）中每一列的最大值以及它所在的位置</strong>。<br><code>outputs</code> 是模型對四張圖片的預測結果，形狀是 <code>(4, 10)</code>，其中：</p>\n<ul>\n<li><p>4 代表輸入的圖片數量；</p>\n</li>\n<li><p>10 代表 CIFAR-10 的十個分類（例如飛機、汽車、貓、狗等）。</p>\n</li>\n</ul>\n<p>對於每張圖片（每一列），模型會輸出 10 個數值，這些數值代表「模型認為該圖片屬於每個類別的信心分數」。<br><code>torch.max(outputs, 1)</code> 的第二個參數 <code>1</code> 表示沿著「第 1 維」進行操作，也就是在每一列（每張圖片的 10 個分數）中尋找最大值。</p>\n<p><img src=\"/images/CleanShot-2025-10-29-at-11.47.42@2x-1024x85.png\"></p>\n<p>這個函式會回傳兩個結果：</p>\n<ol>\n<li><p>最大值本身（這裡用 <code>_</code> 省略掉，因為我們只關心位置而不需要數值）；</p>\n</li>\n<li><p>最大值的索引位置，也就是每張圖片信心分數最高的類別代號。</p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">correct = 0</span><br><span class=\"line\">total = 0</span><br><span class=\"line\"># since we&#x27;re not training, we don&#x27;t need to calculate the gradients for our outputs</span><br><span class=\"line\">with torch.no_grad():</span><br><span class=\"line\">    for data in testloader:</span><br><span class=\"line\">        images, labels = data</span><br><span class=\"line\">        # calculate outputs by running images through the network</span><br><span class=\"line\">        outputs = net(images)</span><br><span class=\"line\">        # the class with the highest energy is what we choose as prediction</span><br><span class=\"line\">        _, predicted = torch.max(outputs, 1)</span><br><span class=\"line\">        total += labels.size(0)</span><br><span class=\"line\">        correct += (predicted == labels).sum().item()</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">print(f&#x27;Accuracy of the network on the 10000 test images: &#123;100 * correct // total&#125; %&#x27;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">correct = 0</span><br><span class=\"line\">total = 0</span><br><span class=\"line\"># since we&#x27;re not training, we don&#x27;t need to calculate the gradients for our outputs</span><br><span class=\"line\">with torch.no_grad():</span><br><span class=\"line\">    for data in testloader:</span><br><span class=\"line\">        images, labels = data</span><br><span class=\"line\">        # calculate outputs by running images through the network</span><br><span class=\"line\">        outputs = net(images)</span><br><span class=\"line\">        # the class with the highest energy is what we choose as prediction</span><br><span class=\"line\">        _, predicted = torch.max(outputs, 1)</span><br><span class=\"line\">        total += labels.size(0)</span><br><span class=\"line\">        correct += (predicted == labels).sum().item()</span><br><span class=\"line\"></span><br><span class=\"line\">print(f&#x27;Accuracy of the network on the 10000 test images: &#123;100 * correct // total&#125; %&#x27;)</span><br></pre></td></tr></table></figure>\n\n<p><code>correct</code> 用來計算預測正確的圖片數量，<code>total</code> 則用來計算測試資料的總張數。最終會用這兩個數字來計算正確率。</p>\n<p>接著的 <code>with torch.no_grad():</code> 是 PyTorch 中常見的寫法，表示在這個區塊中<strong>不需要追蹤梯度（gradients）</strong>。在測試或推論階段，我們並不需要做反向傳播（backpropagation）或更新權重，因此可以關閉梯度計算來節省記憶體與運算時間。這樣能讓模型運行得更快，也避免誤修改權重。</p>\n<p>在程式中，<code>for data in testloader:</code> 會從測試資料載入器 <code>testloader</code> 中依序取出資料。每次取出的 <code>data</code> 代表一個批次（batch），其中包含四張測試圖片（<code>images</code>）及它們的真實標籤（<code>labels</code>）。接著，執行 <code>outputs = net(images)</code>，讓模型對這些圖片進行<strong>前向傳播（forward pass）</strong>，輸出每張圖片對應十個類別的分數（logits）。這些分數代表模型對每個類別的信心程度，分數越高表示模型越傾向認為圖片屬於該類別。</p>\n<p>之後的這行 <code>_, predicted = torch.max(outputs, 1)</code> 用來從模型的輸出中，取出每張圖片分數最高的那一個類別，作為模型的預測結果。這裡的 <code>predicted</code> 是一個包含四個數字的張量（tensor），每個數字代表模型認為圖片所屬的類別索引（例如 0 代表「plane」、1 代表「car」等）。換句話說，這一步是將模型的「信心分數」轉換成實際的「分類決策」。</p>\n<p>接著兩行 <code>total += labels.size(0)</code> 和 <code>correct += (predicted == labels).sum().item()</code> 是用來統計模型的預測表現。<code>labels.size(0)</code> 代表這一批圖片的數量（通常是 4），會加到 <code>total</code> 中，以累計測試圖片的總數。而 <code>(predicted == labels)</code> 會比較模型預測的類別與真實標籤是否一致，產生一個布林值陣列（例如 <code>[True, False, True, True]</code>）。使用 <code>.sum()</code> 會將其中的 <code>True</code> 視為 1、<code>False</code> 視為 0，相加後就能得到這一批中模型預測正確的圖片數。最後，<code>.item()</code> 會把這個張量轉換成普通的整數，再加到 <code>correct</code> 裡，表示目前累積的正確預測數量。</p>\n<p>當迴圈跑完所有測試資料後，模型就已經對整個測試集（共 10,000 張圖片）完成預測。</p>\n<p><img src=\"/images/CleanShot-2025-10-29-at-11.57.50@2x-1024x45.png\"></p>\n<p>代表模型在 10,000 張測試圖片中，有 53% 被正確分類。</p>\n<p><img src=\"/images/CleanShot-2025-10-29-at-11.59.02@2x-1024x84.png\"></p>\n<p>這裡的 <code>100 * correct // total</code> 使用整數除法，讓結果以百分比的形式輸出。</p>\n<h2 id=\"Training-on-GPU\"><a href=\"#Training-on-GPU\" class=\"headerlink\" title=\"Training on GPU\"></a>Training on GPU</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">device = torch.device(&#x27;cuda:0&#x27; if torch.cuda.is_available() else &#x27;cpu&#x27;)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># Assuming that we are on a CUDA machine, this should print a CUDA device:</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">print(device)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">device = torch.device(&#x27;cuda:0&#x27; if torch.cuda.is_available() else &#x27;cpu&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\"># Assuming that we are on a CUDA machine, this should print a CUDA device:</span><br><span class=\"line\"></span><br><span class=\"line\">print(device)</span><br></pre></td></tr></table></figure>\n\n<p><code>device = torch.device(&#39;cuda:0&#39; if torch.cuda.is_available() else &#39;cpu&#39;)</code> 利用了 PyTorch 的 <code>torch.cuda.is_available()</code> 函式來檢查系統中是否安裝並啟用了 CUDA。若電腦中有支援的 NVIDIA 顯示卡且 CUDA 可用，這個函式會回傳 <code>True</code>，程式便會選擇 <code>&#39;cuda:0&#39;</code> 作為運算裝置，代表使用第 0 張 GPU（即第一張 GPU 卡）進行運算。若 CUDA 不可用，則回傳 <code>False</code>，程式會改用 <code>&#39;cpu&#39;</code>，也就是中央處理器進行運算。<code>torch.device()</code> 則會依據這個結果建立一個「裝置物件（device object）」，方便之後將模型或資料移動到指定的裝置上執行。</p>\n<p>接著這行 <code>print(device)</code> 會印出目前使用的運算裝置。如果系統有支援 CUDA 且 PyTorch 安裝的是 GPU 版本，輸出結果會是 <code>cuda:0</code>，表示模型將在 GPU 上執行；若系統中沒有可用的 GPU，則輸出為 <code>cpu</code>，代表程式會使用 CPU 進行運算。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net.to(device)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">net.to(device)</span><br></pre></td></tr></table></figure>\n\n<p>當你執行 <code>net.to(device)</code> 時，PyTorch 會把模型中所有的參數（包含權重 weights 與偏差 biases）從預設的 CPU 記憶體移動到目標裝置上。如果系統有支援 CUDA 且 GPU 可用，模型就會被移到顯示卡中運行；若沒有 GPU，則會保留在 CPU 上。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inputs, labels = data[0].to(device), data[1].to(device)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">inputs, labels = data[0].to(device), data[1].to(device)</span><br></pre></td></tr></table></figure>\n\n<p><code>data[0]</code> 代表這一批的輸入圖片（影像張量），而 <code>data[1]</code> 則是對應的真實標籤（例如這張圖片是「貓」或「狗」）。這兩者最初都會存在 CPU 記憶體中，因為資料載入的預設裝置就是 CPU。</p>\n<p><code>to(device)</code> 是 PyTorch 用來<strong>把 Tensor 傳送到指定裝置</strong>的方法。如果前面設定的 <code>device</code> 是 <code>&#39;cuda:0&#39;</code>，那這行指令會把 <code>inputs</code> 和 <code>labels</code> 都傳送到 GPU 記憶體中；如果沒有可用的 GPU，則會留在 CPU 上。這樣做可以確保模型（<code>net</code>）與資料位於相同的運算環境中，從而讓後續的運算（例如前向傳播、損失計算、反向傳播等）能夠正常執行。</p>\n"},{"layout":"post","title":"Ubuntu 新增 4GB Swap 教學文件","date":"2025-11-12T16:00:00.000Z","top_img":"/images/ubuntu-swap.png","cover":"/images/ubuntu-swap.png","_content":"\n以下為在 Ubuntu 24.04 主機上新增 4GB swap 的完整操作流程與解說，包含你實際執行的指令整理後的教學。\n\n## 📌 1. 查看磁碟使用狀況\n\n在新增 swap 前，先確認磁碟空間是否足夠：\n\n```\ndf -h\n```\n\n```\ndf -h\n```\n\n範例輸出：\n\n```\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda         25G   13G   11G  56% /\n```\n\n```\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda         25G   13G   11G  56% /\n```\n\n可見有 11GB 可用空間，足以建立新的 4GB swapfile。\n\n## 📌 2. 建立 4GB Swap File\n\n使用 `fallocate` 建立一個大小為 4GB 的 swap 檔案：\n\n```\nsudo fallocate -l 4G /swapfile2\n```\n\n```\nsudo fallocate -l 4G /swapfile2\n```\n\n## 📌 3. 設定 Swap 檔案權限\n\nSwap file 必須設定成只有 root 能讀寫，否則系統會拒絕使用：\n\n```\nsudo chmod 600 /swapfile2\n```\n\n```\nsudo chmod 600 /swapfile2\n```\n\n## 📘 額外補充：Linux 權限教學（給完全不懂的人）\n\n為了更容易理解，我用超白話方式說明：\n\n### 🔹 什麼是 Linux 權限？\n\nLinux 裡每個檔案與資料夾都有三種「身分」能對它做事：\n\n- **User（u）**：檔案的擁有者\n\n- **Group（g）**：與該檔案同群組的人\n\n- **Others（o）**：所有其他人（包含陌生人）\n\n每個身分都可以有三種權限：\n\n- **r = read（讀）**\n\n- **w = write（寫）**\n\n- **x = execute（執行）**\n\n### 🔹 數字是怎麼來的？\n\nLinux 會用一個「三位數」表示權限，例如：\n\nchmod 600 file\n\n代表：\n\n- 第一個數字（6）→ user 的權限\n\n- 第二個數字（0）→ group 的權限\n\n- 第三個數字（0）→ others 的權限\n\n那 6、0、0 是什麼意思？\n\n權限對應如下：\n\n- r = 4\n\n- w = 2\n\n- x = 1\n\n所以：\n\n- **6 = 4 + 2 = rw-（讀寫可）**\n\n- **0 = ---（完全沒權限）**\n\n### 🔹 用表格讓你秒懂\n\n| 數字 | 權限 | 意思 |\n| --- | --- | --- |\n| 7 | rwx | 讀寫執行全部可 |\n| 6 | rw- | 讀 + 寫 |\n| 5 | r-x | 讀 + 執行 |\n| 4 | r-- | 只有讀 |\n| 0 | \\--- | 什麼都不行 |\n\n### 🔹 swapfile 為什麼不能設 644 或 777？\n\n- 644 = 其他人能讀 → **完全不行**\n\n- 666 = 其他人能寫 → **大爆炸級資安問題**\n\n- 777 = 人人可讀寫執行 → **不要命了**\n\n因為 swapfile 裡可能包含：\n\n- 密碼明文\n\n- MySQL 的資料\n\n- 後台 session\n\n- 記憶體裡任何曾存在過的資料\n\n所以必須限制成：\n\n600（rw-------）\n\n這樣才能確保：\n\n- root 可以使用\n\n- 其他任何人都不能讀寫\n\n- 系統才能安全掛載 swapfile\n\n## 📌 4. 將檔案格式化成 Swap 空間\n\n將剛建立的檔案轉成 swap 格式：\n\n```\nsudo mkswap /swapfile2\n```\n\n```\nsudo mkswap /swapfile2\n```\n\n執行後會看到類似：\n\n```\nSetting up swapspace version 1, size = 4 GiB<br>UUID=xxxxx-xxxxx\n```\n\n```\nSetting up swapspace version 1, size = 4 GiB<br>UUID=xxxxx-xxxxx\n```\n\n## 📌 5. 啟用 Swap File\n\n讓 swapfile 立即生效：\n\n```\nsudo swapon /swapfile2\n```\n\n```\nsudo swapon /swapfile2\n```\n\n## 📌 6. 設定開機自動啟用 Swap\n\n把設定寫入 `/etc/fstab`：\n\n```\necho '/swapfile2 none swap sw 0 0' | sudo tee -a /etc/fstab\n```\n\n```\necho '/swapfile2 none swap sw 0 0' | sudo tee -a /etc/fstab\n```\n\n## 📌 7. 確認 Swap 是否成功新增\n\n使用 `free -h` 查看目前的記憶體與 swap 狀態：\n\n```\nfree -h\n```\n\n```\nfree -h\n```\n\n範例輸出：\n\n               ```\n               total        used        free      shared  buff/cache   available\nMem:           961Mi       873Mi        79Mi        71Mi       221Mi        88Mi\nSwap:          4.5Gi       520Mi       4.0Gi\n```\n\n```\n               total        used        free      shared  buff/cache   available\nMem:           961Mi       873Mi        79Mi        71Mi       221Mi        88Mi\nSwap:          4.5Gi       520Mi       4.0Gi\n```\n\n可以看到：\n\n- 原本的 512MB swap + 新增的 4GB → **總共 4.5GB swap**\n\n- 系統已成功使用新的 swap。\n","source":"_posts/ubuntu-swap-setting.md","raw":"---\nlayout: post\ntitle: Ubuntu 新增 4GB Swap 教學文件\ndate: 2025-11-13\ntags:\ncategories:\n  - \"ubuntu\"\n  - \"vm-setting\"\ntop_img: /images/ubuntu-swap.png\ncover: /images/ubuntu-swap.png\n---\n\n以下為在 Ubuntu 24.04 主機上新增 4GB swap 的完整操作流程與解說，包含你實際執行的指令整理後的教學。\n\n## 📌 1. 查看磁碟使用狀況\n\n在新增 swap 前，先確認磁碟空間是否足夠：\n\n```\ndf -h\n```\n\n```\ndf -h\n```\n\n範例輸出：\n\n```\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda         25G   13G   11G  56% /\n```\n\n```\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda         25G   13G   11G  56% /\n```\n\n可見有 11GB 可用空間，足以建立新的 4GB swapfile。\n\n## 📌 2. 建立 4GB Swap File\n\n使用 `fallocate` 建立一個大小為 4GB 的 swap 檔案：\n\n```\nsudo fallocate -l 4G /swapfile2\n```\n\n```\nsudo fallocate -l 4G /swapfile2\n```\n\n## 📌 3. 設定 Swap 檔案權限\n\nSwap file 必須設定成只有 root 能讀寫，否則系統會拒絕使用：\n\n```\nsudo chmod 600 /swapfile2\n```\n\n```\nsudo chmod 600 /swapfile2\n```\n\n## 📘 額外補充：Linux 權限教學（給完全不懂的人）\n\n為了更容易理解，我用超白話方式說明：\n\n### 🔹 什麼是 Linux 權限？\n\nLinux 裡每個檔案與資料夾都有三種「身分」能對它做事：\n\n- **User（u）**：檔案的擁有者\n\n- **Group（g）**：與該檔案同群組的人\n\n- **Others（o）**：所有其他人（包含陌生人）\n\n每個身分都可以有三種權限：\n\n- **r = read（讀）**\n\n- **w = write（寫）**\n\n- **x = execute（執行）**\n\n### 🔹 數字是怎麼來的？\n\nLinux 會用一個「三位數」表示權限，例如：\n\nchmod 600 file\n\n代表：\n\n- 第一個數字（6）→ user 的權限\n\n- 第二個數字（0）→ group 的權限\n\n- 第三個數字（0）→ others 的權限\n\n那 6、0、0 是什麼意思？\n\n權限對應如下：\n\n- r = 4\n\n- w = 2\n\n- x = 1\n\n所以：\n\n- **6 = 4 + 2 = rw-（讀寫可）**\n\n- **0 = ---（完全沒權限）**\n\n### 🔹 用表格讓你秒懂\n\n| 數字 | 權限 | 意思 |\n| --- | --- | --- |\n| 7 | rwx | 讀寫執行全部可 |\n| 6 | rw- | 讀 + 寫 |\n| 5 | r-x | 讀 + 執行 |\n| 4 | r-- | 只有讀 |\n| 0 | \\--- | 什麼都不行 |\n\n### 🔹 swapfile 為什麼不能設 644 或 777？\n\n- 644 = 其他人能讀 → **完全不行**\n\n- 666 = 其他人能寫 → **大爆炸級資安問題**\n\n- 777 = 人人可讀寫執行 → **不要命了**\n\n因為 swapfile 裡可能包含：\n\n- 密碼明文\n\n- MySQL 的資料\n\n- 後台 session\n\n- 記憶體裡任何曾存在過的資料\n\n所以必須限制成：\n\n600（rw-------）\n\n這樣才能確保：\n\n- root 可以使用\n\n- 其他任何人都不能讀寫\n\n- 系統才能安全掛載 swapfile\n\n## 📌 4. 將檔案格式化成 Swap 空間\n\n將剛建立的檔案轉成 swap 格式：\n\n```\nsudo mkswap /swapfile2\n```\n\n```\nsudo mkswap /swapfile2\n```\n\n執行後會看到類似：\n\n```\nSetting up swapspace version 1, size = 4 GiB<br>UUID=xxxxx-xxxxx\n```\n\n```\nSetting up swapspace version 1, size = 4 GiB<br>UUID=xxxxx-xxxxx\n```\n\n## 📌 5. 啟用 Swap File\n\n讓 swapfile 立即生效：\n\n```\nsudo swapon /swapfile2\n```\n\n```\nsudo swapon /swapfile2\n```\n\n## 📌 6. 設定開機自動啟用 Swap\n\n把設定寫入 `/etc/fstab`：\n\n```\necho '/swapfile2 none swap sw 0 0' | sudo tee -a /etc/fstab\n```\n\n```\necho '/swapfile2 none swap sw 0 0' | sudo tee -a /etc/fstab\n```\n\n## 📌 7. 確認 Swap 是否成功新增\n\n使用 `free -h` 查看目前的記憶體與 swap 狀態：\n\n```\nfree -h\n```\n\n```\nfree -h\n```\n\n範例輸出：\n\n               ```\n               total        used        free      shared  buff/cache   available\nMem:           961Mi       873Mi        79Mi        71Mi       221Mi        88Mi\nSwap:          4.5Gi       520Mi       4.0Gi\n```\n\n```\n               total        used        free      shared  buff/cache   available\nMem:           961Mi       873Mi        79Mi        71Mi       221Mi        88Mi\nSwap:          4.5Gi       520Mi       4.0Gi\n```\n\n可以看到：\n\n- 原本的 512MB swap + 新增的 4GB → **總共 4.5GB swap**\n\n- 系統已成功使用新的 swap。\n","slug":"ubuntu-swap-setting","published":1,"updated":"2026-01-28T14:17:25.067Z","_id":"cmkxg0krs000arb8z4n7n35cf","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>以下為在 Ubuntu 24.04 主機上新增 4GB swap 的完整操作流程與解說，包含你實際執行的指令整理後的教學。</p>\n<h2 id=\"📌-1-查看磁碟使用狀況\"><a href=\"#📌-1-查看磁碟使用狀況\" class=\"headerlink\" title=\"📌 1. 查看磁碟使用狀況\"></a>📌 1. 查看磁碟使用狀況</h2><p>在新增 swap 前，先確認磁碟空間是否足夠：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df -h</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df -h</span><br></pre></td></tr></table></figure>\n\n<p>範例輸出：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/sda         25G   13G   11G  56% /</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/sda         25G   13G   11G  56% /</span><br></pre></td></tr></table></figure>\n\n<p>可見有 11GB 可用空間，足以建立新的 4GB swapfile。</p>\n<h2 id=\"📌-2-建立-4GB-Swap-File\"><a href=\"#📌-2-建立-4GB-Swap-File\" class=\"headerlink\" title=\"📌 2. 建立 4GB Swap File\"></a>📌 2. 建立 4GB Swap File</h2><p>使用 <code>fallocate</code> 建立一個大小為 4GB 的 swap 檔案：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo fallocate -l 4G /swapfile2</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo fallocate -l 4G /swapfile2</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"📌-3-設定-Swap-檔案權限\"><a href=\"#📌-3-設定-Swap-檔案權限\" class=\"headerlink\" title=\"📌 3. 設定 Swap 檔案權限\"></a>📌 3. 設定 Swap 檔案權限</h2><p>Swap file 必須設定成只有 root 能讀寫，否則系統會拒絕使用：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod 600 /swapfile2</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod 600 /swapfile2</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"📘-額外補充：Linux-權限教學（給完全不懂的人）\"><a href=\"#📘-額外補充：Linux-權限教學（給完全不懂的人）\" class=\"headerlink\" title=\"📘 額外補充：Linux 權限教學（給完全不懂的人）\"></a>📘 額外補充：Linux 權限教學（給完全不懂的人）</h2><p>為了更容易理解，我用超白話方式說明：</p>\n<h3 id=\"🔹-什麼是-Linux-權限？\"><a href=\"#🔹-什麼是-Linux-權限？\" class=\"headerlink\" title=\"🔹 什麼是 Linux 權限？\"></a>🔹 什麼是 Linux 權限？</h3><p>Linux 裡每個檔案與資料夾都有三種「身分」能對它做事：</p>\n<ul>\n<li><p><strong>User（u）</strong>：檔案的擁有者</p>\n</li>\n<li><p><strong>Group（g）</strong>：與該檔案同群組的人</p>\n</li>\n<li><p><strong>Others（o）</strong>：所有其他人（包含陌生人）</p>\n</li>\n</ul>\n<p>每個身分都可以有三種權限：</p>\n<ul>\n<li><p><strong>r &#x3D; read（讀）</strong></p>\n</li>\n<li><p><strong>w &#x3D; write（寫）</strong></p>\n</li>\n<li><p><strong>x &#x3D; execute（執行）</strong></p>\n</li>\n</ul>\n<h3 id=\"🔹-數字是怎麼來的？\"><a href=\"#🔹-數字是怎麼來的？\" class=\"headerlink\" title=\"🔹 數字是怎麼來的？\"></a>🔹 數字是怎麼來的？</h3><p>Linux 會用一個「三位數」表示權限，例如：</p>\n<p>chmod 600 file</p>\n<p>代表：</p>\n<ul>\n<li><p>第一個數字（6）→ user 的權限</p>\n</li>\n<li><p>第二個數字（0）→ group 的權限</p>\n</li>\n<li><p>第三個數字（0）→ others 的權限</p>\n</li>\n</ul>\n<p>那 6、0、0 是什麼意思？</p>\n<p>權限對應如下：</p>\n<ul>\n<li><p>r &#x3D; 4</p>\n</li>\n<li><p>w &#x3D; 2</p>\n</li>\n<li><p>x &#x3D; 1</p>\n</li>\n</ul>\n<p>所以：</p>\n<ul>\n<li><p><strong>6 &#x3D; 4 + 2 &#x3D; rw-（讀寫可）</strong></p>\n</li>\n<li><p><strong>0 &#x3D; —（完全沒權限）</strong></p>\n</li>\n</ul>\n<h3 id=\"🔹-用表格讓你秒懂\"><a href=\"#🔹-用表格讓你秒懂\" class=\"headerlink\" title=\"🔹 用表格讓你秒懂\"></a>🔹 用表格讓你秒懂</h3><table>\n<thead>\n<tr>\n<th>數字</th>\n<th>權限</th>\n<th>意思</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>7</td>\n<td>rwx</td>\n<td>讀寫執行全部可</td>\n</tr>\n<tr>\n<td>6</td>\n<td>rw-</td>\n<td>讀 + 寫</td>\n</tr>\n<tr>\n<td>5</td>\n<td>r-x</td>\n<td>讀 + 執行</td>\n</tr>\n<tr>\n<td>4</td>\n<td>r–</td>\n<td>只有讀</td>\n</tr>\n<tr>\n<td>0</td>\n<td>-–</td>\n<td>什麼都不行</td>\n</tr>\n</tbody></table>\n<h3 id=\"🔹-swapfile-為什麼不能設-644-或-777？\"><a href=\"#🔹-swapfile-為什麼不能設-644-或-777？\" class=\"headerlink\" title=\"🔹 swapfile 為什麼不能設 644 或 777？\"></a>🔹 swapfile 為什麼不能設 644 或 777？</h3><ul>\n<li><p>644 &#x3D; 其他人能讀 → <strong>完全不行</strong></p>\n</li>\n<li><p>666 &#x3D; 其他人能寫 → <strong>大爆炸級資安問題</strong></p>\n</li>\n<li><p>777 &#x3D; 人人可讀寫執行 → <strong>不要命了</strong></p>\n</li>\n</ul>\n<p>因為 swapfile 裡可能包含：</p>\n<ul>\n<li><p>密碼明文</p>\n</li>\n<li><p>MySQL 的資料</p>\n</li>\n<li><p>後台 session</p>\n</li>\n<li><p>記憶體裡任何曾存在過的資料</p>\n</li>\n</ul>\n<p>所以必須限制成：</p>\n<p>600（rw——-）</p>\n<p>這樣才能確保：</p>\n<ul>\n<li><p>root 可以使用</p>\n</li>\n<li><p>其他任何人都不能讀寫</p>\n</li>\n<li><p>系統才能安全掛載 swapfile</p>\n</li>\n</ul>\n<h2 id=\"📌-4-將檔案格式化成-Swap-空間\"><a href=\"#📌-4-將檔案格式化成-Swap-空間\" class=\"headerlink\" title=\"📌 4. 將檔案格式化成 Swap 空間\"></a>📌 4. 將檔案格式化成 Swap 空間</h2><p>將剛建立的檔案轉成 swap 格式：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkswap /swapfile2</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkswap /swapfile2</span><br></pre></td></tr></table></figure>\n\n<p>執行後會看到類似：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Setting up swapspace version 1, size = 4 GiB&lt;br&gt;UUID=xxxxx-xxxxx</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Setting up swapspace version 1, size = 4 GiB&lt;br&gt;UUID=xxxxx-xxxxx</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"📌-5-啟用-Swap-File\"><a href=\"#📌-5-啟用-Swap-File\" class=\"headerlink\" title=\"📌 5. 啟用 Swap File\"></a>📌 5. 啟用 Swap File</h2><p>讓 swapfile 立即生效：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo swapon /swapfile2</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo swapon /swapfile2</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"📌-6-設定開機自動啟用-Swap\"><a href=\"#📌-6-設定開機自動啟用-Swap\" class=\"headerlink\" title=\"📌 6. 設定開機自動啟用 Swap\"></a>📌 6. 設定開機自動啟用 Swap</h2><p>把設定寫入 <code>/etc/fstab</code>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;/swapfile2 none swap sw 0 0&#x27; | sudo tee -a /etc/fstab</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;/swapfile2 none swap sw 0 0&#x27; | sudo tee -a /etc/fstab</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"📌-7-確認-Swap-是否成功新增\"><a href=\"#📌-7-確認-Swap-是否成功新增\" class=\"headerlink\" title=\"📌 7. 確認 Swap 是否成功新增\"></a>📌 7. 確認 Swap 是否成功新增</h2><p>使用 <code>free -h</code> 查看目前的記憶體與 swap 狀態：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">free -h</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">free -h</span><br></pre></td></tr></table></figure>\n\n<p>範例輸出：</p>\n<pre><code>           <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">               total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:           961Mi       873Mi        79Mi        71Mi       221Mi        88Mi</span><br><span class=\"line\">Swap:          4.5Gi       520Mi       4.0Gi</span><br></pre></td></tr></table></figure>\n</code></pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">               total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:           961Mi       873Mi        79Mi        71Mi       221Mi        88Mi</span><br><span class=\"line\">Swap:          4.5Gi       520Mi       4.0Gi</span><br></pre></td></tr></table></figure>\n\n<p>可以看到：</p>\n<ul>\n<li><p>原本的 512MB swap + 新增的 4GB → <strong>總共 4.5GB swap</strong></p>\n</li>\n<li><p>系統已成功使用新的 swap。</p>\n</li>\n</ul>\n","excerpt":"","more":"<p>以下為在 Ubuntu 24.04 主機上新增 4GB swap 的完整操作流程與解說，包含你實際執行的指令整理後的教學。</p>\n<h2 id=\"📌-1-查看磁碟使用狀況\"><a href=\"#📌-1-查看磁碟使用狀況\" class=\"headerlink\" title=\"📌 1. 查看磁碟使用狀況\"></a>📌 1. 查看磁碟使用狀況</h2><p>在新增 swap 前，先確認磁碟空間是否足夠：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df -h</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df -h</span><br></pre></td></tr></table></figure>\n\n<p>範例輸出：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/sda         25G   13G   11G  56% /</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class=\"line\">/dev/sda         25G   13G   11G  56% /</span><br></pre></td></tr></table></figure>\n\n<p>可見有 11GB 可用空間，足以建立新的 4GB swapfile。</p>\n<h2 id=\"📌-2-建立-4GB-Swap-File\"><a href=\"#📌-2-建立-4GB-Swap-File\" class=\"headerlink\" title=\"📌 2. 建立 4GB Swap File\"></a>📌 2. 建立 4GB Swap File</h2><p>使用 <code>fallocate</code> 建立一個大小為 4GB 的 swap 檔案：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo fallocate -l 4G /swapfile2</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo fallocate -l 4G /swapfile2</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"📌-3-設定-Swap-檔案權限\"><a href=\"#📌-3-設定-Swap-檔案權限\" class=\"headerlink\" title=\"📌 3. 設定 Swap 檔案權限\"></a>📌 3. 設定 Swap 檔案權限</h2><p>Swap file 必須設定成只有 root 能讀寫，否則系統會拒絕使用：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod 600 /swapfile2</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod 600 /swapfile2</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"📘-額外補充：Linux-權限教學（給完全不懂的人）\"><a href=\"#📘-額外補充：Linux-權限教學（給完全不懂的人）\" class=\"headerlink\" title=\"📘 額外補充：Linux 權限教學（給完全不懂的人）\"></a>📘 額外補充：Linux 權限教學（給完全不懂的人）</h2><p>為了更容易理解，我用超白話方式說明：</p>\n<h3 id=\"🔹-什麼是-Linux-權限？\"><a href=\"#🔹-什麼是-Linux-權限？\" class=\"headerlink\" title=\"🔹 什麼是 Linux 權限？\"></a>🔹 什麼是 Linux 權限？</h3><p>Linux 裡每個檔案與資料夾都有三種「身分」能對它做事：</p>\n<ul>\n<li><p><strong>User（u）</strong>：檔案的擁有者</p>\n</li>\n<li><p><strong>Group（g）</strong>：與該檔案同群組的人</p>\n</li>\n<li><p><strong>Others（o）</strong>：所有其他人（包含陌生人）</p>\n</li>\n</ul>\n<p>每個身分都可以有三種權限：</p>\n<ul>\n<li><p><strong>r &#x3D; read（讀）</strong></p>\n</li>\n<li><p><strong>w &#x3D; write（寫）</strong></p>\n</li>\n<li><p><strong>x &#x3D; execute（執行）</strong></p>\n</li>\n</ul>\n<h3 id=\"🔹-數字是怎麼來的？\"><a href=\"#🔹-數字是怎麼來的？\" class=\"headerlink\" title=\"🔹 數字是怎麼來的？\"></a>🔹 數字是怎麼來的？</h3><p>Linux 會用一個「三位數」表示權限，例如：</p>\n<p>chmod 600 file</p>\n<p>代表：</p>\n<ul>\n<li><p>第一個數字（6）→ user 的權限</p>\n</li>\n<li><p>第二個數字（0）→ group 的權限</p>\n</li>\n<li><p>第三個數字（0）→ others 的權限</p>\n</li>\n</ul>\n<p>那 6、0、0 是什麼意思？</p>\n<p>權限對應如下：</p>\n<ul>\n<li><p>r &#x3D; 4</p>\n</li>\n<li><p>w &#x3D; 2</p>\n</li>\n<li><p>x &#x3D; 1</p>\n</li>\n</ul>\n<p>所以：</p>\n<ul>\n<li><p><strong>6 &#x3D; 4 + 2 &#x3D; rw-（讀寫可）</strong></p>\n</li>\n<li><p><strong>0 &#x3D; —（完全沒權限）</strong></p>\n</li>\n</ul>\n<h3 id=\"🔹-用表格讓你秒懂\"><a href=\"#🔹-用表格讓你秒懂\" class=\"headerlink\" title=\"🔹 用表格讓你秒懂\"></a>🔹 用表格讓你秒懂</h3><table>\n<thead>\n<tr>\n<th>數字</th>\n<th>權限</th>\n<th>意思</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>7</td>\n<td>rwx</td>\n<td>讀寫執行全部可</td>\n</tr>\n<tr>\n<td>6</td>\n<td>rw-</td>\n<td>讀 + 寫</td>\n</tr>\n<tr>\n<td>5</td>\n<td>r-x</td>\n<td>讀 + 執行</td>\n</tr>\n<tr>\n<td>4</td>\n<td>r–</td>\n<td>只有讀</td>\n</tr>\n<tr>\n<td>0</td>\n<td>-–</td>\n<td>什麼都不行</td>\n</tr>\n</tbody></table>\n<h3 id=\"🔹-swapfile-為什麼不能設-644-或-777？\"><a href=\"#🔹-swapfile-為什麼不能設-644-或-777？\" class=\"headerlink\" title=\"🔹 swapfile 為什麼不能設 644 或 777？\"></a>🔹 swapfile 為什麼不能設 644 或 777？</h3><ul>\n<li><p>644 &#x3D; 其他人能讀 → <strong>完全不行</strong></p>\n</li>\n<li><p>666 &#x3D; 其他人能寫 → <strong>大爆炸級資安問題</strong></p>\n</li>\n<li><p>777 &#x3D; 人人可讀寫執行 → <strong>不要命了</strong></p>\n</li>\n</ul>\n<p>因為 swapfile 裡可能包含：</p>\n<ul>\n<li><p>密碼明文</p>\n</li>\n<li><p>MySQL 的資料</p>\n</li>\n<li><p>後台 session</p>\n</li>\n<li><p>記憶體裡任何曾存在過的資料</p>\n</li>\n</ul>\n<p>所以必須限制成：</p>\n<p>600（rw——-）</p>\n<p>這樣才能確保：</p>\n<ul>\n<li><p>root 可以使用</p>\n</li>\n<li><p>其他任何人都不能讀寫</p>\n</li>\n<li><p>系統才能安全掛載 swapfile</p>\n</li>\n</ul>\n<h2 id=\"📌-4-將檔案格式化成-Swap-空間\"><a href=\"#📌-4-將檔案格式化成-Swap-空間\" class=\"headerlink\" title=\"📌 4. 將檔案格式化成 Swap 空間\"></a>📌 4. 將檔案格式化成 Swap 空間</h2><p>將剛建立的檔案轉成 swap 格式：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkswap /swapfile2</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkswap /swapfile2</span><br></pre></td></tr></table></figure>\n\n<p>執行後會看到類似：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Setting up swapspace version 1, size = 4 GiB&lt;br&gt;UUID=xxxxx-xxxxx</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Setting up swapspace version 1, size = 4 GiB&lt;br&gt;UUID=xxxxx-xxxxx</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"📌-5-啟用-Swap-File\"><a href=\"#📌-5-啟用-Swap-File\" class=\"headerlink\" title=\"📌 5. 啟用 Swap File\"></a>📌 5. 啟用 Swap File</h2><p>讓 swapfile 立即生效：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo swapon /swapfile2</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo swapon /swapfile2</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"📌-6-設定開機自動啟用-Swap\"><a href=\"#📌-6-設定開機自動啟用-Swap\" class=\"headerlink\" title=\"📌 6. 設定開機自動啟用 Swap\"></a>📌 6. 設定開機自動啟用 Swap</h2><p>把設定寫入 <code>/etc/fstab</code>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;/swapfile2 none swap sw 0 0&#x27; | sudo tee -a /etc/fstab</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &#x27;/swapfile2 none swap sw 0 0&#x27; | sudo tee -a /etc/fstab</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"📌-7-確認-Swap-是否成功新增\"><a href=\"#📌-7-確認-Swap-是否成功新增\" class=\"headerlink\" title=\"📌 7. 確認 Swap 是否成功新增\"></a>📌 7. 確認 Swap 是否成功新增</h2><p>使用 <code>free -h</code> 查看目前的記憶體與 swap 狀態：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">free -h</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">free -h</span><br></pre></td></tr></table></figure>\n\n<p>範例輸出：</p>\n<pre><code>           <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">               total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:           961Mi       873Mi        79Mi        71Mi       221Mi        88Mi</span><br><span class=\"line\">Swap:          4.5Gi       520Mi       4.0Gi</span><br></pre></td></tr></table></figure>\n</code></pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">               total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:           961Mi       873Mi        79Mi        71Mi       221Mi        88Mi</span><br><span class=\"line\">Swap:          4.5Gi       520Mi       4.0Gi</span><br></pre></td></tr></table></figure>\n\n<p>可以看到：</p>\n<ul>\n<li><p>原本的 512MB swap + 新增的 4GB → <strong>總共 4.5GB swap</strong></p>\n</li>\n<li><p>系統已成功使用新的 swap。</p>\n</li>\n</ul>\n"},{"layout":"post","title":"Unity 場景切換以及 Data 共享","date":"2025-12-03T16:00:00.000Z","top_img":"/images/unity-data-scene.png","cover":"/images/unity-data-scene.png","_content":"\n這一篇文章主要是想分享 Unity的場景切換，那切換到不同的場景，要怎麼樣使用上一個場景所帶來的資料。\n\n## SongSelect Scene\n\n![](/images/CleanShot-2025-12-04-at-10.55.31.png)\n\n按下Start按鈕開始，要把資料帶到下一個遊戲頁面。\n\n![](/images/CleanShot-2025-12-04-at-10.56.41.png)\n\n## MusicData.cs\n\n```\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n<div></div>\n[CreateAssetMenu(fileName = \"MusicData\", menuName = \"Rhythm/MusicData\")]\npublic class MusicData : ScriptableObject\n{\n    public string musicName;\n    public string author;\n    public AudioClip audioClip;\n    public Sprite coverImage;\n    public int bpm;\n    public float length;\n}\n```\n\n```\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\n[CreateAssetMenu(fileName = \"MusicData\", menuName = \"Rhythm/MusicData\")]\npublic class MusicData : ScriptableObject\n{\n    public string musicName;\n    public string author;\n    public AudioClip audioClip;\n    public Sprite coverImage;\n    public int bpm;\n    public float length;\n}\n```\n\n## SongDetailUI.cs\n\n```\nusing UnityEngine;\nusing UnityEngine.UI;\nusing UnityEngine.SceneManagement;\n<div></div>\npublic class SongDetailUI : MonoBehaviour\n{\n    public Image coverImage;\n    public TMPro.TextMeshProUGUI titleText;\n    public TMPro.TextMeshProUGUI artistText;\n    public TMPro.TextMeshProUGUI infoText;\n    private MusicData current;\n<div></div>\n    public void ShowMusic(MusicData music)\n    {\n        current = music;\n        // 將音樂資料帶入右邊的detail UI\n        coverImage.sprite = music.coverImage;\n        titleText.text = music.musicName;\n        artistText.text = music.author;\n        infoText.text = $\"BPM: {music.bpm}  Length: {music.length}\";\n    }\n<div></div>\n    public void Btn_Play() {\n        if (current == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 將音樂存到GameData\n        GameData.selectedMusic = current;\n        SceneManager.LoadScene(\"GameScene\");\n    }\n}\n```\n\n```\nusing UnityEngine;\nusing UnityEngine.UI;\nusing UnityEngine.SceneManagement;\n\npublic class SongDetailUI : MonoBehaviour\n{\n    public Image coverImage;\n    public TMPro.TextMeshProUGUI titleText;\n    public TMPro.TextMeshProUGUI artistText;\n    public TMPro.TextMeshProUGUI infoText;\n    private MusicData current;\n\n    public void ShowMusic(MusicData music)\n    {\n        current = music;\n        // 將音樂資料帶入右邊的detail UI\n        coverImage.sprite = music.coverImage;\n        titleText.text = music.musicName;\n        artistText.text = music.author;\n        infoText.text = $\"BPM: {music.bpm}  Length: {music.length}\";\n    }\n\n    public void Btn_Play() {\n        if (current == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 將音樂存到GameData\n        GameData.selectedMusic = current;\n        SceneManager.LoadScene(\"GameScene\");\n    }\n}\n```\n\n## Button 觸發轉場\n\n在Start按鈕定義的事件\n\n    ```\n    public void Btn_Play() {\n        if (current == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 將音樂存到GameData\n        GameData.selectedMusic = current;\n        SceneManager.LoadScene(\"GameScene\");\n    }\n```\n\n```\n    public void Btn_Play() {\n        if (current == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 將音樂存到GameData\n        GameData.selectedMusic = current;\n        SceneManager.LoadScene(\"GameScene\");\n    }\n```\n\n在另外一個遊戲場景，已經可以聽到點擊的對應的資料音樂。\n\n透過 MusicData music = GameData.selectedMusic; 抓取剛剛的音樂。\n\n```\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n<div></div>\npublic class GameMusicPlayer : MonoBehaviour\n{\n    private void Start() {\n        MusicData music = GameData.selectedMusic;\n        if (music == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 抓到全域的AudioSource\n        AudioSource audio = GetComponent<AudioSource>();\n        audio.clip = music.audioClip;\n        audio.Play();\n<div></div>\n        Debug.Log(\"開始播放：\" + music.musicName);\n    }\n}\n```\n\n```\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\npublic class GameMusicPlayer : MonoBehaviour\n{\n    private void Start() {\n        MusicData music = GameData.selectedMusic;\n        if (music == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 抓到全域的AudioSource\n        AudioSource audio = GetComponent<AudioSource>();\n        audio.clip = music.audioClip;\n        audio.Play();\n\n        Debug.Log(\"開始播放：\" + music.musicName);\n    }\n}\n```\n\n成功取得音樂\n\n![](/images/CleanShot-2025-12-04-at-11.02.07.png)\n\n以上就是轉場還有資料怎麼使用的一個概略展示。\n","source":"_posts/unity-scene-data.md","raw":"---\nlayout: post\ntitle: Unity 場景切換以及 Data 共享\ndate: 2025-12-04\ntags:\ncategories:\n  - \"unity\"\ntop_img: /images/unity-data-scene.png\ncover: /images/unity-data-scene.png\n---\n\n這一篇文章主要是想分享 Unity的場景切換，那切換到不同的場景，要怎麼樣使用上一個場景所帶來的資料。\n\n## SongSelect Scene\n\n![](/images/CleanShot-2025-12-04-at-10.55.31.png)\n\n按下Start按鈕開始，要把資料帶到下一個遊戲頁面。\n\n![](/images/CleanShot-2025-12-04-at-10.56.41.png)\n\n## MusicData.cs\n\n```\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n<div></div>\n[CreateAssetMenu(fileName = \"MusicData\", menuName = \"Rhythm/MusicData\")]\npublic class MusicData : ScriptableObject\n{\n    public string musicName;\n    public string author;\n    public AudioClip audioClip;\n    public Sprite coverImage;\n    public int bpm;\n    public float length;\n}\n```\n\n```\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\n[CreateAssetMenu(fileName = \"MusicData\", menuName = \"Rhythm/MusicData\")]\npublic class MusicData : ScriptableObject\n{\n    public string musicName;\n    public string author;\n    public AudioClip audioClip;\n    public Sprite coverImage;\n    public int bpm;\n    public float length;\n}\n```\n\n## SongDetailUI.cs\n\n```\nusing UnityEngine;\nusing UnityEngine.UI;\nusing UnityEngine.SceneManagement;\n<div></div>\npublic class SongDetailUI : MonoBehaviour\n{\n    public Image coverImage;\n    public TMPro.TextMeshProUGUI titleText;\n    public TMPro.TextMeshProUGUI artistText;\n    public TMPro.TextMeshProUGUI infoText;\n    private MusicData current;\n<div></div>\n    public void ShowMusic(MusicData music)\n    {\n        current = music;\n        // 將音樂資料帶入右邊的detail UI\n        coverImage.sprite = music.coverImage;\n        titleText.text = music.musicName;\n        artistText.text = music.author;\n        infoText.text = $\"BPM: {music.bpm}  Length: {music.length}\";\n    }\n<div></div>\n    public void Btn_Play() {\n        if (current == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 將音樂存到GameData\n        GameData.selectedMusic = current;\n        SceneManager.LoadScene(\"GameScene\");\n    }\n}\n```\n\n```\nusing UnityEngine;\nusing UnityEngine.UI;\nusing UnityEngine.SceneManagement;\n\npublic class SongDetailUI : MonoBehaviour\n{\n    public Image coverImage;\n    public TMPro.TextMeshProUGUI titleText;\n    public TMPro.TextMeshProUGUI artistText;\n    public TMPro.TextMeshProUGUI infoText;\n    private MusicData current;\n\n    public void ShowMusic(MusicData music)\n    {\n        current = music;\n        // 將音樂資料帶入右邊的detail UI\n        coverImage.sprite = music.coverImage;\n        titleText.text = music.musicName;\n        artistText.text = music.author;\n        infoText.text = $\"BPM: {music.bpm}  Length: {music.length}\";\n    }\n\n    public void Btn_Play() {\n        if (current == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 將音樂存到GameData\n        GameData.selectedMusic = current;\n        SceneManager.LoadScene(\"GameScene\");\n    }\n}\n```\n\n## Button 觸發轉場\n\n在Start按鈕定義的事件\n\n    ```\n    public void Btn_Play() {\n        if (current == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 將音樂存到GameData\n        GameData.selectedMusic = current;\n        SceneManager.LoadScene(\"GameScene\");\n    }\n```\n\n```\n    public void Btn_Play() {\n        if (current == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 將音樂存到GameData\n        GameData.selectedMusic = current;\n        SceneManager.LoadScene(\"GameScene\");\n    }\n```\n\n在另外一個遊戲場景，已經可以聽到點擊的對應的資料音樂。\n\n透過 MusicData music = GameData.selectedMusic; 抓取剛剛的音樂。\n\n```\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n<div></div>\npublic class GameMusicPlayer : MonoBehaviour\n{\n    private void Start() {\n        MusicData music = GameData.selectedMusic;\n        if (music == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 抓到全域的AudioSource\n        AudioSource audio = GetComponent<AudioSource>();\n        audio.clip = music.audioClip;\n        audio.Play();\n<div></div>\n        Debug.Log(\"開始播放：\" + music.musicName);\n    }\n}\n```\n\n```\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\npublic class GameMusicPlayer : MonoBehaviour\n{\n    private void Start() {\n        MusicData music = GameData.selectedMusic;\n        if (music == null) {\n            Debug.LogError(\"沒有選擇歌曲，無法開始遊戲\");\n            return;\n        }\n        // 抓到全域的AudioSource\n        AudioSource audio = GetComponent<AudioSource>();\n        audio.clip = music.audioClip;\n        audio.Play();\n\n        Debug.Log(\"開始播放：\" + music.musicName);\n    }\n}\n```\n\n成功取得音樂\n\n![](/images/CleanShot-2025-12-04-at-11.02.07.png)\n\n以上就是轉場還有資料怎麼使用的一個概略展示。\n","slug":"unity-scene-data","published":1,"updated":"2026-01-28T14:17:25.068Z","_id":"cmkxg0krt000crb8zegou11na","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>這一篇文章主要是想分享 Unity的場景切換，那切換到不同的場景，要怎麼樣使用上一個場景所帶來的資料。</p>\n<h2 id=\"SongSelect-Scene\"><a href=\"#SongSelect-Scene\" class=\"headerlink\" title=\"SongSelect Scene\"></a>SongSelect Scene</h2><p><img src=\"/images/CleanShot-2025-12-04-at-10.55.31.png\"></p>\n<p>按下Start按鈕開始，要把資料帶到下一個遊戲頁面。</p>\n<p><img src=\"/images/CleanShot-2025-12-04-at-10.56.41.png\"></p>\n<h2 id=\"MusicData-cs\"><a href=\"#MusicData-cs\" class=\"headerlink\" title=\"MusicData.cs\"></a>MusicData.cs</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using System.Collections;</span><br><span class=\"line\">using System.Collections.Generic;</span><br><span class=\"line\">using UnityEngine;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">[CreateAssetMenu(fileName = &quot;MusicData&quot;, menuName = &quot;Rhythm/MusicData&quot;)]</span><br><span class=\"line\">public class MusicData : ScriptableObject</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public string musicName;</span><br><span class=\"line\">    public string author;</span><br><span class=\"line\">    public AudioClip audioClip;</span><br><span class=\"line\">    public Sprite coverImage;</span><br><span class=\"line\">    public int bpm;</span><br><span class=\"line\">    public float length;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using System.Collections;</span><br><span class=\"line\">using System.Collections.Generic;</span><br><span class=\"line\">using UnityEngine;</span><br><span class=\"line\"></span><br><span class=\"line\">[CreateAssetMenu(fileName = &quot;MusicData&quot;, menuName = &quot;Rhythm/MusicData&quot;)]</span><br><span class=\"line\">public class MusicData : ScriptableObject</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public string musicName;</span><br><span class=\"line\">    public string author;</span><br><span class=\"line\">    public AudioClip audioClip;</span><br><span class=\"line\">    public Sprite coverImage;</span><br><span class=\"line\">    public int bpm;</span><br><span class=\"line\">    public float length;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"SongDetailUI-cs\"><a href=\"#SongDetailUI-cs\" class=\"headerlink\" title=\"SongDetailUI.cs\"></a>SongDetailUI.cs</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using UnityEngine;</span><br><span class=\"line\">using UnityEngine.UI;</span><br><span class=\"line\">using UnityEngine.SceneManagement;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">public class SongDetailUI : MonoBehaviour</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public Image coverImage;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI titleText;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI artistText;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI infoText;</span><br><span class=\"line\">    private MusicData current;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    public void ShowMusic(MusicData music)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        current = music;</span><br><span class=\"line\">        // 將音樂資料帶入右邊的detail UI</span><br><span class=\"line\">        coverImage.sprite = music.coverImage;</span><br><span class=\"line\">        titleText.text = music.musicName;</span><br><span class=\"line\">        artistText.text = music.author;</span><br><span class=\"line\">        infoText.text = $&quot;BPM: &#123;music.bpm&#125;  Length: &#123;music.length&#125;&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    public void Btn_Play() &#123;</span><br><span class=\"line\">        if (current == null) &#123;</span><br><span class=\"line\">            Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // 將音樂存到GameData</span><br><span class=\"line\">        GameData.selectedMusic = current;</span><br><span class=\"line\">        SceneManager.LoadScene(&quot;GameScene&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using UnityEngine;</span><br><span class=\"line\">using UnityEngine.UI;</span><br><span class=\"line\">using UnityEngine.SceneManagement;</span><br><span class=\"line\"></span><br><span class=\"line\">public class SongDetailUI : MonoBehaviour</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public Image coverImage;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI titleText;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI artistText;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI infoText;</span><br><span class=\"line\">    private MusicData current;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void ShowMusic(MusicData music)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        current = music;</span><br><span class=\"line\">        // 將音樂資料帶入右邊的detail UI</span><br><span class=\"line\">        coverImage.sprite = music.coverImage;</span><br><span class=\"line\">        titleText.text = music.musicName;</span><br><span class=\"line\">        artistText.text = music.author;</span><br><span class=\"line\">        infoText.text = $&quot;BPM: &#123;music.bpm&#125;  Length: &#123;music.length&#125;&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void Btn_Play() &#123;</span><br><span class=\"line\">        if (current == null) &#123;</span><br><span class=\"line\">            Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // 將音樂存到GameData</span><br><span class=\"line\">        GameData.selectedMusic = current;</span><br><span class=\"line\">        SceneManager.LoadScene(&quot;GameScene&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Button-觸發轉場\"><a href=\"#Button-觸發轉場\" class=\"headerlink\" title=\"Button 觸發轉場\"></a>Button 觸發轉場</h2><p>在Start按鈕定義的事件</p>\n<pre><code><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void Btn_Play() &#123;</span><br><span class=\"line\">    if (current == null) &#123;</span><br><span class=\"line\">        Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // 將音樂存到GameData</span><br><span class=\"line\">    GameData.selectedMusic = current;</span><br><span class=\"line\">    SceneManager.LoadScene(&quot;GameScene&quot;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</code></pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void Btn_Play() &#123;</span><br><span class=\"line\">    if (current == null) &#123;</span><br><span class=\"line\">        Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // 將音樂存到GameData</span><br><span class=\"line\">    GameData.selectedMusic = current;</span><br><span class=\"line\">    SceneManager.LoadScene(&quot;GameScene&quot;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在另外一個遊戲場景，已經可以聽到點擊的對應的資料音樂。</p>\n<p>透過 MusicData music &#x3D; GameData.selectedMusic; 抓取剛剛的音樂。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using System.Collections;</span><br><span class=\"line\">using System.Collections.Generic;</span><br><span class=\"line\">using UnityEngine;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">public class GameMusicPlayer : MonoBehaviour</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    private void Start() &#123;</span><br><span class=\"line\">        MusicData music = GameData.selectedMusic;</span><br><span class=\"line\">        if (music == null) &#123;</span><br><span class=\"line\">            Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // 抓到全域的AudioSource</span><br><span class=\"line\">        AudioSource audio = GetComponent&lt;AudioSource&gt;();</span><br><span class=\"line\">        audio.clip = music.audioClip;</span><br><span class=\"line\">        audio.Play();</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        Debug.Log(&quot;開始播放：&quot; + music.musicName);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using System.Collections;</span><br><span class=\"line\">using System.Collections.Generic;</span><br><span class=\"line\">using UnityEngine;</span><br><span class=\"line\"></span><br><span class=\"line\">public class GameMusicPlayer : MonoBehaviour</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    private void Start() &#123;</span><br><span class=\"line\">        MusicData music = GameData.selectedMusic;</span><br><span class=\"line\">        if (music == null) &#123;</span><br><span class=\"line\">            Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // 抓到全域的AudioSource</span><br><span class=\"line\">        AudioSource audio = GetComponent&lt;AudioSource&gt;();</span><br><span class=\"line\">        audio.clip = music.audioClip;</span><br><span class=\"line\">        audio.Play();</span><br><span class=\"line\"></span><br><span class=\"line\">        Debug.Log(&quot;開始播放：&quot; + music.musicName);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>成功取得音樂</p>\n<p><img src=\"/images/CleanShot-2025-12-04-at-11.02.07.png\"></p>\n<p>以上就是轉場還有資料怎麼使用的一個概略展示。</p>\n","excerpt":"","more":"<p>這一篇文章主要是想分享 Unity的場景切換，那切換到不同的場景，要怎麼樣使用上一個場景所帶來的資料。</p>\n<h2 id=\"SongSelect-Scene\"><a href=\"#SongSelect-Scene\" class=\"headerlink\" title=\"SongSelect Scene\"></a>SongSelect Scene</h2><p><img src=\"/images/CleanShot-2025-12-04-at-10.55.31.png\"></p>\n<p>按下Start按鈕開始，要把資料帶到下一個遊戲頁面。</p>\n<p><img src=\"/images/CleanShot-2025-12-04-at-10.56.41.png\"></p>\n<h2 id=\"MusicData-cs\"><a href=\"#MusicData-cs\" class=\"headerlink\" title=\"MusicData.cs\"></a>MusicData.cs</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using System.Collections;</span><br><span class=\"line\">using System.Collections.Generic;</span><br><span class=\"line\">using UnityEngine;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">[CreateAssetMenu(fileName = &quot;MusicData&quot;, menuName = &quot;Rhythm/MusicData&quot;)]</span><br><span class=\"line\">public class MusicData : ScriptableObject</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public string musicName;</span><br><span class=\"line\">    public string author;</span><br><span class=\"line\">    public AudioClip audioClip;</span><br><span class=\"line\">    public Sprite coverImage;</span><br><span class=\"line\">    public int bpm;</span><br><span class=\"line\">    public float length;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using System.Collections;</span><br><span class=\"line\">using System.Collections.Generic;</span><br><span class=\"line\">using UnityEngine;</span><br><span class=\"line\"></span><br><span class=\"line\">[CreateAssetMenu(fileName = &quot;MusicData&quot;, menuName = &quot;Rhythm/MusicData&quot;)]</span><br><span class=\"line\">public class MusicData : ScriptableObject</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public string musicName;</span><br><span class=\"line\">    public string author;</span><br><span class=\"line\">    public AudioClip audioClip;</span><br><span class=\"line\">    public Sprite coverImage;</span><br><span class=\"line\">    public int bpm;</span><br><span class=\"line\">    public float length;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"SongDetailUI-cs\"><a href=\"#SongDetailUI-cs\" class=\"headerlink\" title=\"SongDetailUI.cs\"></a>SongDetailUI.cs</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using UnityEngine;</span><br><span class=\"line\">using UnityEngine.UI;</span><br><span class=\"line\">using UnityEngine.SceneManagement;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">public class SongDetailUI : MonoBehaviour</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public Image coverImage;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI titleText;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI artistText;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI infoText;</span><br><span class=\"line\">    private MusicData current;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    public void ShowMusic(MusicData music)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        current = music;</span><br><span class=\"line\">        // 將音樂資料帶入右邊的detail UI</span><br><span class=\"line\">        coverImage.sprite = music.coverImage;</span><br><span class=\"line\">        titleText.text = music.musicName;</span><br><span class=\"line\">        artistText.text = music.author;</span><br><span class=\"line\">        infoText.text = $&quot;BPM: &#123;music.bpm&#125;  Length: &#123;music.length&#125;&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    public void Btn_Play() &#123;</span><br><span class=\"line\">        if (current == null) &#123;</span><br><span class=\"line\">            Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // 將音樂存到GameData</span><br><span class=\"line\">        GameData.selectedMusic = current;</span><br><span class=\"line\">        SceneManager.LoadScene(&quot;GameScene&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using UnityEngine;</span><br><span class=\"line\">using UnityEngine.UI;</span><br><span class=\"line\">using UnityEngine.SceneManagement;</span><br><span class=\"line\"></span><br><span class=\"line\">public class SongDetailUI : MonoBehaviour</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    public Image coverImage;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI titleText;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI artistText;</span><br><span class=\"line\">    public TMPro.TextMeshProUGUI infoText;</span><br><span class=\"line\">    private MusicData current;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void ShowMusic(MusicData music)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        current = music;</span><br><span class=\"line\">        // 將音樂資料帶入右邊的detail UI</span><br><span class=\"line\">        coverImage.sprite = music.coverImage;</span><br><span class=\"line\">        titleText.text = music.musicName;</span><br><span class=\"line\">        artistText.text = music.author;</span><br><span class=\"line\">        infoText.text = $&quot;BPM: &#123;music.bpm&#125;  Length: &#123;music.length&#125;&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void Btn_Play() &#123;</span><br><span class=\"line\">        if (current == null) &#123;</span><br><span class=\"line\">            Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // 將音樂存到GameData</span><br><span class=\"line\">        GameData.selectedMusic = current;</span><br><span class=\"line\">        SceneManager.LoadScene(&quot;GameScene&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Button-觸發轉場\"><a href=\"#Button-觸發轉場\" class=\"headerlink\" title=\"Button 觸發轉場\"></a>Button 觸發轉場</h2><p>在Start按鈕定義的事件</p>\n<pre><code><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void Btn_Play() &#123;</span><br><span class=\"line\">    if (current == null) &#123;</span><br><span class=\"line\">        Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // 將音樂存到GameData</span><br><span class=\"line\">    GameData.selectedMusic = current;</span><br><span class=\"line\">    SceneManager.LoadScene(&quot;GameScene&quot;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</code></pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void Btn_Play() &#123;</span><br><span class=\"line\">    if (current == null) &#123;</span><br><span class=\"line\">        Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">        return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // 將音樂存到GameData</span><br><span class=\"line\">    GameData.selectedMusic = current;</span><br><span class=\"line\">    SceneManager.LoadScene(&quot;GameScene&quot;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在另外一個遊戲場景，已經可以聽到點擊的對應的資料音樂。</p>\n<p>透過 MusicData music &#x3D; GameData.selectedMusic; 抓取剛剛的音樂。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using System.Collections;</span><br><span class=\"line\">using System.Collections.Generic;</span><br><span class=\"line\">using UnityEngine;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">public class GameMusicPlayer : MonoBehaviour</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    private void Start() &#123;</span><br><span class=\"line\">        MusicData music = GameData.selectedMusic;</span><br><span class=\"line\">        if (music == null) &#123;</span><br><span class=\"line\">            Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // 抓到全域的AudioSource</span><br><span class=\"line\">        AudioSource audio = GetComponent&lt;AudioSource&gt;();</span><br><span class=\"line\">        audio.clip = music.audioClip;</span><br><span class=\"line\">        audio.Play();</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">        Debug.Log(&quot;開始播放：&quot; + music.musicName);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">using System.Collections;</span><br><span class=\"line\">using System.Collections.Generic;</span><br><span class=\"line\">using UnityEngine;</span><br><span class=\"line\"></span><br><span class=\"line\">public class GameMusicPlayer : MonoBehaviour</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    private void Start() &#123;</span><br><span class=\"line\">        MusicData music = GameData.selectedMusic;</span><br><span class=\"line\">        if (music == null) &#123;</span><br><span class=\"line\">            Debug.LogError(&quot;沒有選擇歌曲，無法開始遊戲&quot;);</span><br><span class=\"line\">            return;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        // 抓到全域的AudioSource</span><br><span class=\"line\">        AudioSource audio = GetComponent&lt;AudioSource&gt;();</span><br><span class=\"line\">        audio.clip = music.audioClip;</span><br><span class=\"line\">        audio.Play();</span><br><span class=\"line\"></span><br><span class=\"line\">        Debug.Log(&quot;開始播放：&quot; + music.musicName);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>成功取得音樂</p>\n<p><img src=\"/images/CleanShot-2025-12-04-at-11.02.07.png\"></p>\n<p>以上就是轉場還有資料怎麼使用的一個概略展示。</p>\n"},{"layout":"post","title":"Streamlit 結合 yolo 辨識圖片","date":"2025-11-30T16:00:00.000Z","top_img":"/images/streamlit_yolo.png","cover":"/images/streamlit_yolo.png","_content":"\n> 許子恆老師的上課筆記\n\n建立一個資料夾，我這邊取week13。\n\n在week13資料夾中下指令。\n\n他會自動建立基本的檔案，新版的python會使用pyproject.toml管理套件的版本。\n\n```\nuv init\n```\n\n```\nuv init\n```\n\n```\n// pyproject.toml\n[project]\nname = \"week13\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nreadme = \"README.md\"\nrequires-python = \">=3.13\"\ndependencies = [\n    \"altair==4.0\",\n    \"matplotlib>=3.10.7\",\n    \"pillow>=12.0.0\",\n    \"streamlit>=1.51.0\",\n    \"torch>=2.9.1\",\n    \"torchvision>=0.24.1\",\n    \"ultralytics>=8.3.233\",\n]\n```\n\n```\n// pyproject.toml\n[project]\nname = \"week13\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nreadme = \"README.md\"\nrequires-python = \">=3.13\"\ndependencies = [\n    \"altair==4.0\",\n    \"matplotlib>=3.10.7\",\n    \"pillow>=12.0.0\",\n    \"streamlit>=1.51.0\",\n    \"torch>=2.9.1\",\n    \"torchvision>=0.24.1\",\n    \"ultralytics>=8.3.233\",\n]\n```\n\n以及建立虛擬環境\n\n```\nuv venv\n```\n\n```\nuv venv\n```\n\n接著進入虛擬環境(Mac Book)\n\n```\nsource .venv/bin/activate\n```\n\n```\nsource .venv/bin/activate\n```\n\n安裝相關套件\n\n```\nuv add streamlit\nuv add torch torchvision \nuv add matplotlib\nuv add ultralytics\nuv add pillow\nuv add altair==4.0\n```\n\n```\nuv add streamlit\nuv add torch torchvision \nuv add matplotlib\nuv add ultralytics\nuv add pillow\nuv add altair==4.0\n```\n\n到這個網址下載訓練好的模型\n\n[https://github.com/fullmakeralchemist/teststream/tree/master](https://github.com/fullmakeralchemist/teststream/tree/master)\n\n在week13資料夾建立一個weights資料夾。\n\n接著把剛剛github裡面的best.pt檔案放到week13的weights資料夾中。\n\n並建立一個app.py\n\n```\n# 匯入所需的函式庫\nimport PIL\nimport streamlit as st\nfrom ultralytics import YOLO\n<div></div>\n# 替換成您的權重檔案的相對路徑\nmodel_path = 'weights/best.pt'\n<div></div>\n# 設定頁面佈局\nst.set_page_config(\n    page_title=\"物件偵測\",  # 設定頁面標題\n    page_icon=\"🤖\",      # 設定頁面圖示\n    layout=\"wide\",       # 設定佈局為寬版\n    initial_sidebar_state=\"expanded\",    # 預設展開側邊欄\n)\n<div></div>\n# 建立側邊欄\nwith st.sidebar:\n    st.header(\"圖片配置\")      # 在側邊欄新增標題\n    # 在側邊欄新增檔案上傳器，用於選擇圖片\n    source_img = st.file_uploader(\n        \"上傳圖片...\", type=(\"jpg\", \"jpeg\", \"png\", 'bmp', 'webp'))\n<div></div>\n    # 模型選項\n    confidence = float(st.slider(\n        \"選擇模型信心閾值\", 25, 100, 40)) / 100\n<div></div>\n# 建立主頁面標題\nst.title(\"物件偵測\")\nst.caption('上傳一張帶有這些:blue[手勢訊號]的照片：:+1:, :hand:, :i_love_you_hand_sign:, 和 :spock-hand:.')\nst.caption('然後點擊:blue[偵測物件]按鈕並查看結果。')\n# 在主頁面建立兩個欄位\ncol1, col2 = st.columns(2)\n<div></div>\n# 如果圖片已上傳，則將圖片新增到第一個欄位\nwith col1:\n    if source_img:\n        # 開啟上傳的圖片\n        uploaded_image = PIL.Image.open(source_img)\n        # 將上傳的圖片新增到頁面，並附上標題\n        st.image(source_img,\n                 caption=\"上傳的圖片\",\n                 use_column_width=True\n                 )\n<div></div>\ntry:\n    model = YOLO(model_path)\nexcept Exception as ex:\n    st.error(\n        f\"無法載入模型。請檢查指定的路徑：{model_path}\")\n    st.error(ex)\n<div></div>\nif st.sidebar.button('偵測物件'):\n    res = model.predict(uploaded_image,\n                        conf=confidence\n                        )\n    boxes = res[0].boxes\n    res_plotted = res[0].plot()[:, :, ::-1]\n    with col2:\n        st.image(res_plotted,\n                 caption='偵測結果圖片',\n                 use_column_width=True\n                 )\n        try:\n            with st.expander(\"偵測結果\"):\n                for box in boxes:\n                    st.write(box.xywh)\n        except Exception as ex:\n            st.write(\"尚未上傳圖片！\")\n```\n\n```\n# 匯入所需的函式庫\nimport PIL\nimport streamlit as st\nfrom ultralytics import YOLO\n\n# 替換成您的權重檔案的相對路徑\nmodel_path = 'weights/best.pt'\n\n# 設定頁面佈局\nst.set_page_config(\n    page_title=\"物件偵測\",  # 設定頁面標題\n    page_icon=\"🤖\",      # 設定頁面圖示\n    layout=\"wide\",       # 設定佈局為寬版\n    initial_sidebar_state=\"expanded\",    # 預設展開側邊欄\n)\n\n# 建立側邊欄\nwith st.sidebar:\n    st.header(\"圖片配置\")      # 在側邊欄新增標題\n    # 在側邊欄新增檔案上傳器，用於選擇圖片\n    source_img = st.file_uploader(\n        \"上傳圖片...\", type=(\"jpg\", \"jpeg\", \"png\", 'bmp', 'webp'))\n\n    # 模型選項\n    confidence = float(st.slider(\n        \"選擇模型信心閾值\", 25, 100, 40)) / 100\n\n# 建立主頁面標題\nst.title(\"物件偵測\")\nst.caption('上傳一張帶有這些:blue[手勢訊號]的照片：:+1:, :hand:, :i_love_you_hand_sign:, 和 :spock-hand:.')\nst.caption('然後點擊:blue[偵測物件]按鈕並查看結果。')\n# 在主頁面建立兩個欄位\ncol1, col2 = st.columns(2)\n\n# 如果圖片已上傳，則將圖片新增到第一個欄位\nwith col1:\n    if source_img:\n        # 開啟上傳的圖片\n        uploaded_image = PIL.Image.open(source_img)\n        # 將上傳的圖片新增到頁面，並附上標題\n        st.image(source_img,\n                 caption=\"上傳的圖片\",\n                 use_column_width=True\n                 )\n\ntry:\n    model = YOLO(model_path)\nexcept Exception as ex:\n    st.error(\n        f\"無法載入模型。請檢查指定的路徑：{model_path}\")\n    st.error(ex)\n\nif st.sidebar.button('偵測物件'):\n    res = model.predict(uploaded_image,\n                        conf=confidence\n                        )\n    boxes = res[0].boxes\n    res_plotted = res[0].plot()[:, :, ::-1]\n    with col2:\n        st.image(res_plotted,\n                 caption='偵測結果圖片',\n                 use_column_width=True\n                 )\n        try:\n            with st.expander(\"偵測結果\"):\n                for box in boxes:\n                    st.write(box.xywh)\n        except Exception as ex:\n            st.write(\"尚未上傳圖片！\")\n```\n\n執行 streamlit run app.py\n\n![](/images/CleanShot-2025-12-01-at-16.05.16-1024x660.png)\n\n上傳圖檔，按下偵測物件\n\n![](/images/CleanShot-2025-12-01-at-16.05.37-1024x660.png)\n","source":"_posts/streamlit-yolo.md","raw":"---\nlayout: post\ntitle: Streamlit 結合 yolo 辨識圖片\ndate: 2025-12-01\ntags:\n  - \"streamlit\"\n  - \"yolo\"\ncategories:\n  - \"ai\"\n  - \"pytorch\"\ntop_img: /images/streamlit_yolo.png\ncover: /images/streamlit_yolo.png\n---\n\n> 許子恆老師的上課筆記\n\n建立一個資料夾，我這邊取week13。\n\n在week13資料夾中下指令。\n\n他會自動建立基本的檔案，新版的python會使用pyproject.toml管理套件的版本。\n\n```\nuv init\n```\n\n```\nuv init\n```\n\n```\n// pyproject.toml\n[project]\nname = \"week13\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nreadme = \"README.md\"\nrequires-python = \">=3.13\"\ndependencies = [\n    \"altair==4.0\",\n    \"matplotlib>=3.10.7\",\n    \"pillow>=12.0.0\",\n    \"streamlit>=1.51.0\",\n    \"torch>=2.9.1\",\n    \"torchvision>=0.24.1\",\n    \"ultralytics>=8.3.233\",\n]\n```\n\n```\n// pyproject.toml\n[project]\nname = \"week13\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nreadme = \"README.md\"\nrequires-python = \">=3.13\"\ndependencies = [\n    \"altair==4.0\",\n    \"matplotlib>=3.10.7\",\n    \"pillow>=12.0.0\",\n    \"streamlit>=1.51.0\",\n    \"torch>=2.9.1\",\n    \"torchvision>=0.24.1\",\n    \"ultralytics>=8.3.233\",\n]\n```\n\n以及建立虛擬環境\n\n```\nuv venv\n```\n\n```\nuv venv\n```\n\n接著進入虛擬環境(Mac Book)\n\n```\nsource .venv/bin/activate\n```\n\n```\nsource .venv/bin/activate\n```\n\n安裝相關套件\n\n```\nuv add streamlit\nuv add torch torchvision \nuv add matplotlib\nuv add ultralytics\nuv add pillow\nuv add altair==4.0\n```\n\n```\nuv add streamlit\nuv add torch torchvision \nuv add matplotlib\nuv add ultralytics\nuv add pillow\nuv add altair==4.0\n```\n\n到這個網址下載訓練好的模型\n\n[https://github.com/fullmakeralchemist/teststream/tree/master](https://github.com/fullmakeralchemist/teststream/tree/master)\n\n在week13資料夾建立一個weights資料夾。\n\n接著把剛剛github裡面的best.pt檔案放到week13的weights資料夾中。\n\n並建立一個app.py\n\n```\n# 匯入所需的函式庫\nimport PIL\nimport streamlit as st\nfrom ultralytics import YOLO\n<div></div>\n# 替換成您的權重檔案的相對路徑\nmodel_path = 'weights/best.pt'\n<div></div>\n# 設定頁面佈局\nst.set_page_config(\n    page_title=\"物件偵測\",  # 設定頁面標題\n    page_icon=\"🤖\",      # 設定頁面圖示\n    layout=\"wide\",       # 設定佈局為寬版\n    initial_sidebar_state=\"expanded\",    # 預設展開側邊欄\n)\n<div></div>\n# 建立側邊欄\nwith st.sidebar:\n    st.header(\"圖片配置\")      # 在側邊欄新增標題\n    # 在側邊欄新增檔案上傳器，用於選擇圖片\n    source_img = st.file_uploader(\n        \"上傳圖片...\", type=(\"jpg\", \"jpeg\", \"png\", 'bmp', 'webp'))\n<div></div>\n    # 模型選項\n    confidence = float(st.slider(\n        \"選擇模型信心閾值\", 25, 100, 40)) / 100\n<div></div>\n# 建立主頁面標題\nst.title(\"物件偵測\")\nst.caption('上傳一張帶有這些:blue[手勢訊號]的照片：:+1:, :hand:, :i_love_you_hand_sign:, 和 :spock-hand:.')\nst.caption('然後點擊:blue[偵測物件]按鈕並查看結果。')\n# 在主頁面建立兩個欄位\ncol1, col2 = st.columns(2)\n<div></div>\n# 如果圖片已上傳，則將圖片新增到第一個欄位\nwith col1:\n    if source_img:\n        # 開啟上傳的圖片\n        uploaded_image = PIL.Image.open(source_img)\n        # 將上傳的圖片新增到頁面，並附上標題\n        st.image(source_img,\n                 caption=\"上傳的圖片\",\n                 use_column_width=True\n                 )\n<div></div>\ntry:\n    model = YOLO(model_path)\nexcept Exception as ex:\n    st.error(\n        f\"無法載入模型。請檢查指定的路徑：{model_path}\")\n    st.error(ex)\n<div></div>\nif st.sidebar.button('偵測物件'):\n    res = model.predict(uploaded_image,\n                        conf=confidence\n                        )\n    boxes = res[0].boxes\n    res_plotted = res[0].plot()[:, :, ::-1]\n    with col2:\n        st.image(res_plotted,\n                 caption='偵測結果圖片',\n                 use_column_width=True\n                 )\n        try:\n            with st.expander(\"偵測結果\"):\n                for box in boxes:\n                    st.write(box.xywh)\n        except Exception as ex:\n            st.write(\"尚未上傳圖片！\")\n```\n\n```\n# 匯入所需的函式庫\nimport PIL\nimport streamlit as st\nfrom ultralytics import YOLO\n\n# 替換成您的權重檔案的相對路徑\nmodel_path = 'weights/best.pt'\n\n# 設定頁面佈局\nst.set_page_config(\n    page_title=\"物件偵測\",  # 設定頁面標題\n    page_icon=\"🤖\",      # 設定頁面圖示\n    layout=\"wide\",       # 設定佈局為寬版\n    initial_sidebar_state=\"expanded\",    # 預設展開側邊欄\n)\n\n# 建立側邊欄\nwith st.sidebar:\n    st.header(\"圖片配置\")      # 在側邊欄新增標題\n    # 在側邊欄新增檔案上傳器，用於選擇圖片\n    source_img = st.file_uploader(\n        \"上傳圖片...\", type=(\"jpg\", \"jpeg\", \"png\", 'bmp', 'webp'))\n\n    # 模型選項\n    confidence = float(st.slider(\n        \"選擇模型信心閾值\", 25, 100, 40)) / 100\n\n# 建立主頁面標題\nst.title(\"物件偵測\")\nst.caption('上傳一張帶有這些:blue[手勢訊號]的照片：:+1:, :hand:, :i_love_you_hand_sign:, 和 :spock-hand:.')\nst.caption('然後點擊:blue[偵測物件]按鈕並查看結果。')\n# 在主頁面建立兩個欄位\ncol1, col2 = st.columns(2)\n\n# 如果圖片已上傳，則將圖片新增到第一個欄位\nwith col1:\n    if source_img:\n        # 開啟上傳的圖片\n        uploaded_image = PIL.Image.open(source_img)\n        # 將上傳的圖片新增到頁面，並附上標題\n        st.image(source_img,\n                 caption=\"上傳的圖片\",\n                 use_column_width=True\n                 )\n\ntry:\n    model = YOLO(model_path)\nexcept Exception as ex:\n    st.error(\n        f\"無法載入模型。請檢查指定的路徑：{model_path}\")\n    st.error(ex)\n\nif st.sidebar.button('偵測物件'):\n    res = model.predict(uploaded_image,\n                        conf=confidence\n                        )\n    boxes = res[0].boxes\n    res_plotted = res[0].plot()[:, :, ::-1]\n    with col2:\n        st.image(res_plotted,\n                 caption='偵測結果圖片',\n                 use_column_width=True\n                 )\n        try:\n            with st.expander(\"偵測結果\"):\n                for box in boxes:\n                    st.write(box.xywh)\n        except Exception as ex:\n            st.write(\"尚未上傳圖片！\")\n```\n\n執行 streamlit run app.py\n\n![](/images/CleanShot-2025-12-01-at-16.05.16-1024x660.png)\n\n上傳圖檔，按下偵測物件\n\n![](/images/CleanShot-2025-12-01-at-16.05.37-1024x660.png)\n","slug":"streamlit-yolo","published":1,"updated":"2026-01-28T14:17:25.066Z","_id":"cmkxg0krt000erb8zab8nfsfr","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><blockquote>\n<p>許子恆老師的上課筆記</p>\n</blockquote>\n<p>建立一個資料夾，我這邊取week13。</p>\n<p>在week13資料夾中下指令。</p>\n<p>他會自動建立基本的檔案，新版的python會使用pyproject.toml管理套件的版本。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv init</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv init</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// pyproject.toml</span><br><span class=\"line\">[project]</span><br><span class=\"line\">name = &quot;week13&quot;</span><br><span class=\"line\">version = &quot;0.1.0&quot;</span><br><span class=\"line\">description = &quot;Add your description here&quot;</span><br><span class=\"line\">readme = &quot;README.md&quot;</span><br><span class=\"line\">requires-python = &quot;&gt;=3.13&quot;</span><br><span class=\"line\">dependencies = [</span><br><span class=\"line\">    &quot;altair==4.0&quot;,</span><br><span class=\"line\">    &quot;matplotlib&gt;=3.10.7&quot;,</span><br><span class=\"line\">    &quot;pillow&gt;=12.0.0&quot;,</span><br><span class=\"line\">    &quot;streamlit&gt;=1.51.0&quot;,</span><br><span class=\"line\">    &quot;torch&gt;=2.9.1&quot;,</span><br><span class=\"line\">    &quot;torchvision&gt;=0.24.1&quot;,</span><br><span class=\"line\">    &quot;ultralytics&gt;=8.3.233&quot;,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// pyproject.toml</span><br><span class=\"line\">[project]</span><br><span class=\"line\">name = &quot;week13&quot;</span><br><span class=\"line\">version = &quot;0.1.0&quot;</span><br><span class=\"line\">description = &quot;Add your description here&quot;</span><br><span class=\"line\">readme = &quot;README.md&quot;</span><br><span class=\"line\">requires-python = &quot;&gt;=3.13&quot;</span><br><span class=\"line\">dependencies = [</span><br><span class=\"line\">    &quot;altair==4.0&quot;,</span><br><span class=\"line\">    &quot;matplotlib&gt;=3.10.7&quot;,</span><br><span class=\"line\">    &quot;pillow&gt;=12.0.0&quot;,</span><br><span class=\"line\">    &quot;streamlit&gt;=1.51.0&quot;,</span><br><span class=\"line\">    &quot;torch&gt;=2.9.1&quot;,</span><br><span class=\"line\">    &quot;torchvision&gt;=0.24.1&quot;,</span><br><span class=\"line\">    &quot;ultralytics&gt;=8.3.233&quot;,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>以及建立虛擬環境</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv venv</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv venv</span><br></pre></td></tr></table></figure>\n\n<p>接著進入虛擬環境(Mac Book)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source .venv/bin/activate</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source .venv/bin/activate</span><br></pre></td></tr></table></figure>\n\n<p>安裝相關套件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv add streamlit</span><br><span class=\"line\">uv add torch torchvision </span><br><span class=\"line\">uv add matplotlib</span><br><span class=\"line\">uv add ultralytics</span><br><span class=\"line\">uv add pillow</span><br><span class=\"line\">uv add altair==4.0</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv add streamlit</span><br><span class=\"line\">uv add torch torchvision </span><br><span class=\"line\">uv add matplotlib</span><br><span class=\"line\">uv add ultralytics</span><br><span class=\"line\">uv add pillow</span><br><span class=\"line\">uv add altair==4.0</span><br></pre></td></tr></table></figure>\n\n<p>到這個網址下載訓練好的模型</p>\n<p><a href=\"https://github.com/fullmakeralchemist/teststream/tree/master\">https://github.com/fullmakeralchemist/teststream/tree/master</a></p>\n<p>在week13資料夾建立一個weights資料夾。</p>\n<p>接著把剛剛github裡面的best.pt檔案放到week13的weights資料夾中。</p>\n<p>並建立一個app.py</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 匯入所需的函式庫</span><br><span class=\"line\">import PIL</span><br><span class=\"line\">import streamlit as st</span><br><span class=\"line\">from ultralytics import YOLO</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 替換成您的權重檔案的相對路徑</span><br><span class=\"line\">model_path = &#x27;weights/best.pt&#x27;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 設定頁面佈局</span><br><span class=\"line\">st.set_page_config(</span><br><span class=\"line\">    page_title=&quot;物件偵測&quot;,  # 設定頁面標題</span><br><span class=\"line\">    page_icon=&quot;🤖&quot;,      # 設定頁面圖示</span><br><span class=\"line\">    layout=&quot;wide&quot;,       # 設定佈局為寬版</span><br><span class=\"line\">    initial_sidebar_state=&quot;expanded&quot;,    # 預設展開側邊欄</span><br><span class=\"line\">)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 建立側邊欄</span><br><span class=\"line\">with st.sidebar:</span><br><span class=\"line\">    st.header(&quot;圖片配置&quot;)      # 在側邊欄新增標題</span><br><span class=\"line\">    # 在側邊欄新增檔案上傳器，用於選擇圖片</span><br><span class=\"line\">    source_img = st.file_uploader(</span><br><span class=\"line\">        &quot;上傳圖片...&quot;, type=(&quot;jpg&quot;, &quot;jpeg&quot;, &quot;png&quot;, &#x27;bmp&#x27;, &#x27;webp&#x27;))</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    # 模型選項</span><br><span class=\"line\">    confidence = float(st.slider(</span><br><span class=\"line\">        &quot;選擇模型信心閾值&quot;, 25, 100, 40)) / 100</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 建立主頁面標題</span><br><span class=\"line\">st.title(&quot;物件偵測&quot;)</span><br><span class=\"line\">st.caption(&#x27;上傳一張帶有這些:blue[手勢訊號]的照片：:+1:, :hand:, :i_love_you_hand_sign:, 和 :spock-hand:.&#x27;)</span><br><span class=\"line\">st.caption(&#x27;然後點擊:blue[偵測物件]按鈕並查看結果。&#x27;)</span><br><span class=\"line\"># 在主頁面建立兩個欄位</span><br><span class=\"line\">col1, col2 = st.columns(2)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 如果圖片已上傳，則將圖片新增到第一個欄位</span><br><span class=\"line\">with col1:</span><br><span class=\"line\">    if source_img:</span><br><span class=\"line\">        # 開啟上傳的圖片</span><br><span class=\"line\">        uploaded_image = PIL.Image.open(source_img)</span><br><span class=\"line\">        # 將上傳的圖片新增到頁面，並附上標題</span><br><span class=\"line\">        st.image(source_img,</span><br><span class=\"line\">                 caption=&quot;上傳的圖片&quot;,</span><br><span class=\"line\">                 use_column_width=True</span><br><span class=\"line\">                 )</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">try:</span><br><span class=\"line\">    model = YOLO(model_path)</span><br><span class=\"line\">except Exception as ex:</span><br><span class=\"line\">    st.error(</span><br><span class=\"line\">        f&quot;無法載入模型。請檢查指定的路徑：&#123;model_path&#125;&quot;)</span><br><span class=\"line\">    st.error(ex)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">if st.sidebar.button(&#x27;偵測物件&#x27;):</span><br><span class=\"line\">    res = model.predict(uploaded_image,</span><br><span class=\"line\">                        conf=confidence</span><br><span class=\"line\">                        )</span><br><span class=\"line\">    boxes = res[0].boxes</span><br><span class=\"line\">    res_plotted = res[0].plot()[:, :, ::-1]</span><br><span class=\"line\">    with col2:</span><br><span class=\"line\">        st.image(res_plotted,</span><br><span class=\"line\">                 caption=&#x27;偵測結果圖片&#x27;,</span><br><span class=\"line\">                 use_column_width=True</span><br><span class=\"line\">                 )</span><br><span class=\"line\">        try:</span><br><span class=\"line\">            with st.expander(&quot;偵測結果&quot;):</span><br><span class=\"line\">                for box in boxes:</span><br><span class=\"line\">                    st.write(box.xywh)</span><br><span class=\"line\">        except Exception as ex:</span><br><span class=\"line\">            st.write(&quot;尚未上傳圖片！&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 匯入所需的函式庫</span><br><span class=\"line\">import PIL</span><br><span class=\"line\">import streamlit as st</span><br><span class=\"line\">from ultralytics import YOLO</span><br><span class=\"line\"></span><br><span class=\"line\"># 替換成您的權重檔案的相對路徑</span><br><span class=\"line\">model_path = &#x27;weights/best.pt&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\"># 設定頁面佈局</span><br><span class=\"line\">st.set_page_config(</span><br><span class=\"line\">    page_title=&quot;物件偵測&quot;,  # 設定頁面標題</span><br><span class=\"line\">    page_icon=&quot;🤖&quot;,      # 設定頁面圖示</span><br><span class=\"line\">    layout=&quot;wide&quot;,       # 設定佈局為寬版</span><br><span class=\"line\">    initial_sidebar_state=&quot;expanded&quot;,    # 預設展開側邊欄</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"># 建立側邊欄</span><br><span class=\"line\">with st.sidebar:</span><br><span class=\"line\">    st.header(&quot;圖片配置&quot;)      # 在側邊欄新增標題</span><br><span class=\"line\">    # 在側邊欄新增檔案上傳器，用於選擇圖片</span><br><span class=\"line\">    source_img = st.file_uploader(</span><br><span class=\"line\">        &quot;上傳圖片...&quot;, type=(&quot;jpg&quot;, &quot;jpeg&quot;, &quot;png&quot;, &#x27;bmp&#x27;, &#x27;webp&#x27;))</span><br><span class=\"line\"></span><br><span class=\"line\">    # 模型選項</span><br><span class=\"line\">    confidence = float(st.slider(</span><br><span class=\"line\">        &quot;選擇模型信心閾值&quot;, 25, 100, 40)) / 100</span><br><span class=\"line\"></span><br><span class=\"line\"># 建立主頁面標題</span><br><span class=\"line\">st.title(&quot;物件偵測&quot;)</span><br><span class=\"line\">st.caption(&#x27;上傳一張帶有這些:blue[手勢訊號]的照片：:+1:, :hand:, :i_love_you_hand_sign:, 和 :spock-hand:.&#x27;)</span><br><span class=\"line\">st.caption(&#x27;然後點擊:blue[偵測物件]按鈕並查看結果。&#x27;)</span><br><span class=\"line\"># 在主頁面建立兩個欄位</span><br><span class=\"line\">col1, col2 = st.columns(2)</span><br><span class=\"line\"></span><br><span class=\"line\"># 如果圖片已上傳，則將圖片新增到第一個欄位</span><br><span class=\"line\">with col1:</span><br><span class=\"line\">    if source_img:</span><br><span class=\"line\">        # 開啟上傳的圖片</span><br><span class=\"line\">        uploaded_image = PIL.Image.open(source_img)</span><br><span class=\"line\">        # 將上傳的圖片新增到頁面，並附上標題</span><br><span class=\"line\">        st.image(source_img,</span><br><span class=\"line\">                 caption=&quot;上傳的圖片&quot;,</span><br><span class=\"line\">                 use_column_width=True</span><br><span class=\"line\">                 )</span><br><span class=\"line\"></span><br><span class=\"line\">try:</span><br><span class=\"line\">    model = YOLO(model_path)</span><br><span class=\"line\">except Exception as ex:</span><br><span class=\"line\">    st.error(</span><br><span class=\"line\">        f&quot;無法載入模型。請檢查指定的路徑：&#123;model_path&#125;&quot;)</span><br><span class=\"line\">    st.error(ex)</span><br><span class=\"line\"></span><br><span class=\"line\">if st.sidebar.button(&#x27;偵測物件&#x27;):</span><br><span class=\"line\">    res = model.predict(uploaded_image,</span><br><span class=\"line\">                        conf=confidence</span><br><span class=\"line\">                        )</span><br><span class=\"line\">    boxes = res[0].boxes</span><br><span class=\"line\">    res_plotted = res[0].plot()[:, :, ::-1]</span><br><span class=\"line\">    with col2:</span><br><span class=\"line\">        st.image(res_plotted,</span><br><span class=\"line\">                 caption=&#x27;偵測結果圖片&#x27;,</span><br><span class=\"line\">                 use_column_width=True</span><br><span class=\"line\">                 )</span><br><span class=\"line\">        try:</span><br><span class=\"line\">            with st.expander(&quot;偵測結果&quot;):</span><br><span class=\"line\">                for box in boxes:</span><br><span class=\"line\">                    st.write(box.xywh)</span><br><span class=\"line\">        except Exception as ex:</span><br><span class=\"line\">            st.write(&quot;尚未上傳圖片！&quot;)</span><br></pre></td></tr></table></figure>\n\n<p>執行 streamlit run app.py</p>\n<p><img src=\"/images/CleanShot-2025-12-01-at-16.05.16-1024x660.png\"></p>\n<p>上傳圖檔，按下偵測物件</p>\n<p><img src=\"/images/CleanShot-2025-12-01-at-16.05.37-1024x660.png\"></p>\n","excerpt":"","more":"<blockquote>\n<p>許子恆老師的上課筆記</p>\n</blockquote>\n<p>建立一個資料夾，我這邊取week13。</p>\n<p>在week13資料夾中下指令。</p>\n<p>他會自動建立基本的檔案，新版的python會使用pyproject.toml管理套件的版本。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv init</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv init</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// pyproject.toml</span><br><span class=\"line\">[project]</span><br><span class=\"line\">name = &quot;week13&quot;</span><br><span class=\"line\">version = &quot;0.1.0&quot;</span><br><span class=\"line\">description = &quot;Add your description here&quot;</span><br><span class=\"line\">readme = &quot;README.md&quot;</span><br><span class=\"line\">requires-python = &quot;&gt;=3.13&quot;</span><br><span class=\"line\">dependencies = [</span><br><span class=\"line\">    &quot;altair==4.0&quot;,</span><br><span class=\"line\">    &quot;matplotlib&gt;=3.10.7&quot;,</span><br><span class=\"line\">    &quot;pillow&gt;=12.0.0&quot;,</span><br><span class=\"line\">    &quot;streamlit&gt;=1.51.0&quot;,</span><br><span class=\"line\">    &quot;torch&gt;=2.9.1&quot;,</span><br><span class=\"line\">    &quot;torchvision&gt;=0.24.1&quot;,</span><br><span class=\"line\">    &quot;ultralytics&gt;=8.3.233&quot;,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// pyproject.toml</span><br><span class=\"line\">[project]</span><br><span class=\"line\">name = &quot;week13&quot;</span><br><span class=\"line\">version = &quot;0.1.0&quot;</span><br><span class=\"line\">description = &quot;Add your description here&quot;</span><br><span class=\"line\">readme = &quot;README.md&quot;</span><br><span class=\"line\">requires-python = &quot;&gt;=3.13&quot;</span><br><span class=\"line\">dependencies = [</span><br><span class=\"line\">    &quot;altair==4.0&quot;,</span><br><span class=\"line\">    &quot;matplotlib&gt;=3.10.7&quot;,</span><br><span class=\"line\">    &quot;pillow&gt;=12.0.0&quot;,</span><br><span class=\"line\">    &quot;streamlit&gt;=1.51.0&quot;,</span><br><span class=\"line\">    &quot;torch&gt;=2.9.1&quot;,</span><br><span class=\"line\">    &quot;torchvision&gt;=0.24.1&quot;,</span><br><span class=\"line\">    &quot;ultralytics&gt;=8.3.233&quot;,</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>以及建立虛擬環境</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv venv</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv venv</span><br></pre></td></tr></table></figure>\n\n<p>接著進入虛擬環境(Mac Book)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source .venv/bin/activate</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source .venv/bin/activate</span><br></pre></td></tr></table></figure>\n\n<p>安裝相關套件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv add streamlit</span><br><span class=\"line\">uv add torch torchvision </span><br><span class=\"line\">uv add matplotlib</span><br><span class=\"line\">uv add ultralytics</span><br><span class=\"line\">uv add pillow</span><br><span class=\"line\">uv add altair==4.0</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uv add streamlit</span><br><span class=\"line\">uv add torch torchvision </span><br><span class=\"line\">uv add matplotlib</span><br><span class=\"line\">uv add ultralytics</span><br><span class=\"line\">uv add pillow</span><br><span class=\"line\">uv add altair==4.0</span><br></pre></td></tr></table></figure>\n\n<p>到這個網址下載訓練好的模型</p>\n<p><a href=\"https://github.com/fullmakeralchemist/teststream/tree/master\">https://github.com/fullmakeralchemist/teststream/tree/master</a></p>\n<p>在week13資料夾建立一個weights資料夾。</p>\n<p>接著把剛剛github裡面的best.pt檔案放到week13的weights資料夾中。</p>\n<p>並建立一個app.py</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 匯入所需的函式庫</span><br><span class=\"line\">import PIL</span><br><span class=\"line\">import streamlit as st</span><br><span class=\"line\">from ultralytics import YOLO</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 替換成您的權重檔案的相對路徑</span><br><span class=\"line\">model_path = &#x27;weights/best.pt&#x27;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 設定頁面佈局</span><br><span class=\"line\">st.set_page_config(</span><br><span class=\"line\">    page_title=&quot;物件偵測&quot;,  # 設定頁面標題</span><br><span class=\"line\">    page_icon=&quot;🤖&quot;,      # 設定頁面圖示</span><br><span class=\"line\">    layout=&quot;wide&quot;,       # 設定佈局為寬版</span><br><span class=\"line\">    initial_sidebar_state=&quot;expanded&quot;,    # 預設展開側邊欄</span><br><span class=\"line\">)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 建立側邊欄</span><br><span class=\"line\">with st.sidebar:</span><br><span class=\"line\">    st.header(&quot;圖片配置&quot;)      # 在側邊欄新增標題</span><br><span class=\"line\">    # 在側邊欄新增檔案上傳器，用於選擇圖片</span><br><span class=\"line\">    source_img = st.file_uploader(</span><br><span class=\"line\">        &quot;上傳圖片...&quot;, type=(&quot;jpg&quot;, &quot;jpeg&quot;, &quot;png&quot;, &#x27;bmp&#x27;, &#x27;webp&#x27;))</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    # 模型選項</span><br><span class=\"line\">    confidence = float(st.slider(</span><br><span class=\"line\">        &quot;選擇模型信心閾值&quot;, 25, 100, 40)) / 100</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 建立主頁面標題</span><br><span class=\"line\">st.title(&quot;物件偵測&quot;)</span><br><span class=\"line\">st.caption(&#x27;上傳一張帶有這些:blue[手勢訊號]的照片：:+1:, :hand:, :i_love_you_hand_sign:, 和 :spock-hand:.&#x27;)</span><br><span class=\"line\">st.caption(&#x27;然後點擊:blue[偵測物件]按鈕並查看結果。&#x27;)</span><br><span class=\"line\"># 在主頁面建立兩個欄位</span><br><span class=\"line\">col1, col2 = st.columns(2)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 如果圖片已上傳，則將圖片新增到第一個欄位</span><br><span class=\"line\">with col1:</span><br><span class=\"line\">    if source_img:</span><br><span class=\"line\">        # 開啟上傳的圖片</span><br><span class=\"line\">        uploaded_image = PIL.Image.open(source_img)</span><br><span class=\"line\">        # 將上傳的圖片新增到頁面，並附上標題</span><br><span class=\"line\">        st.image(source_img,</span><br><span class=\"line\">                 caption=&quot;上傳的圖片&quot;,</span><br><span class=\"line\">                 use_column_width=True</span><br><span class=\"line\">                 )</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">try:</span><br><span class=\"line\">    model = YOLO(model_path)</span><br><span class=\"line\">except Exception as ex:</span><br><span class=\"line\">    st.error(</span><br><span class=\"line\">        f&quot;無法載入模型。請檢查指定的路徑：&#123;model_path&#125;&quot;)</span><br><span class=\"line\">    st.error(ex)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">if st.sidebar.button(&#x27;偵測物件&#x27;):</span><br><span class=\"line\">    res = model.predict(uploaded_image,</span><br><span class=\"line\">                        conf=confidence</span><br><span class=\"line\">                        )</span><br><span class=\"line\">    boxes = res[0].boxes</span><br><span class=\"line\">    res_plotted = res[0].plot()[:, :, ::-1]</span><br><span class=\"line\">    with col2:</span><br><span class=\"line\">        st.image(res_plotted,</span><br><span class=\"line\">                 caption=&#x27;偵測結果圖片&#x27;,</span><br><span class=\"line\">                 use_column_width=True</span><br><span class=\"line\">                 )</span><br><span class=\"line\">        try:</span><br><span class=\"line\">            with st.expander(&quot;偵測結果&quot;):</span><br><span class=\"line\">                for box in boxes:</span><br><span class=\"line\">                    st.write(box.xywh)</span><br><span class=\"line\">        except Exception as ex:</span><br><span class=\"line\">            st.write(&quot;尚未上傳圖片！&quot;)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 匯入所需的函式庫</span><br><span class=\"line\">import PIL</span><br><span class=\"line\">import streamlit as st</span><br><span class=\"line\">from ultralytics import YOLO</span><br><span class=\"line\"></span><br><span class=\"line\"># 替換成您的權重檔案的相對路徑</span><br><span class=\"line\">model_path = &#x27;weights/best.pt&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\"># 設定頁面佈局</span><br><span class=\"line\">st.set_page_config(</span><br><span class=\"line\">    page_title=&quot;物件偵測&quot;,  # 設定頁面標題</span><br><span class=\"line\">    page_icon=&quot;🤖&quot;,      # 設定頁面圖示</span><br><span class=\"line\">    layout=&quot;wide&quot;,       # 設定佈局為寬版</span><br><span class=\"line\">    initial_sidebar_state=&quot;expanded&quot;,    # 預設展開側邊欄</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"># 建立側邊欄</span><br><span class=\"line\">with st.sidebar:</span><br><span class=\"line\">    st.header(&quot;圖片配置&quot;)      # 在側邊欄新增標題</span><br><span class=\"line\">    # 在側邊欄新增檔案上傳器，用於選擇圖片</span><br><span class=\"line\">    source_img = st.file_uploader(</span><br><span class=\"line\">        &quot;上傳圖片...&quot;, type=(&quot;jpg&quot;, &quot;jpeg&quot;, &quot;png&quot;, &#x27;bmp&#x27;, &#x27;webp&#x27;))</span><br><span class=\"line\"></span><br><span class=\"line\">    # 模型選項</span><br><span class=\"line\">    confidence = float(st.slider(</span><br><span class=\"line\">        &quot;選擇模型信心閾值&quot;, 25, 100, 40)) / 100</span><br><span class=\"line\"></span><br><span class=\"line\"># 建立主頁面標題</span><br><span class=\"line\">st.title(&quot;物件偵測&quot;)</span><br><span class=\"line\">st.caption(&#x27;上傳一張帶有這些:blue[手勢訊號]的照片：:+1:, :hand:, :i_love_you_hand_sign:, 和 :spock-hand:.&#x27;)</span><br><span class=\"line\">st.caption(&#x27;然後點擊:blue[偵測物件]按鈕並查看結果。&#x27;)</span><br><span class=\"line\"># 在主頁面建立兩個欄位</span><br><span class=\"line\">col1, col2 = st.columns(2)</span><br><span class=\"line\"></span><br><span class=\"line\"># 如果圖片已上傳，則將圖片新增到第一個欄位</span><br><span class=\"line\">with col1:</span><br><span class=\"line\">    if source_img:</span><br><span class=\"line\">        # 開啟上傳的圖片</span><br><span class=\"line\">        uploaded_image = PIL.Image.open(source_img)</span><br><span class=\"line\">        # 將上傳的圖片新增到頁面，並附上標題</span><br><span class=\"line\">        st.image(source_img,</span><br><span class=\"line\">                 caption=&quot;上傳的圖片&quot;,</span><br><span class=\"line\">                 use_column_width=True</span><br><span class=\"line\">                 )</span><br><span class=\"line\"></span><br><span class=\"line\">try:</span><br><span class=\"line\">    model = YOLO(model_path)</span><br><span class=\"line\">except Exception as ex:</span><br><span class=\"line\">    st.error(</span><br><span class=\"line\">        f&quot;無法載入模型。請檢查指定的路徑：&#123;model_path&#125;&quot;)</span><br><span class=\"line\">    st.error(ex)</span><br><span class=\"line\"></span><br><span class=\"line\">if st.sidebar.button(&#x27;偵測物件&#x27;):</span><br><span class=\"line\">    res = model.predict(uploaded_image,</span><br><span class=\"line\">                        conf=confidence</span><br><span class=\"line\">                        )</span><br><span class=\"line\">    boxes = res[0].boxes</span><br><span class=\"line\">    res_plotted = res[0].plot()[:, :, ::-1]</span><br><span class=\"line\">    with col2:</span><br><span class=\"line\">        st.image(res_plotted,</span><br><span class=\"line\">                 caption=&#x27;偵測結果圖片&#x27;,</span><br><span class=\"line\">                 use_column_width=True</span><br><span class=\"line\">                 )</span><br><span class=\"line\">        try:</span><br><span class=\"line\">            with st.expander(&quot;偵測結果&quot;):</span><br><span class=\"line\">                for box in boxes:</span><br><span class=\"line\">                    st.write(box.xywh)</span><br><span class=\"line\">        except Exception as ex:</span><br><span class=\"line\">            st.write(&quot;尚未上傳圖片！&quot;)</span><br></pre></td></tr></table></figure>\n\n<p>執行 streamlit run app.py</p>\n<p><img src=\"/images/CleanShot-2025-12-01-at-16.05.16-1024x660.png\"></p>\n<p>上傳圖檔，按下偵測物件</p>\n<p><img src=\"/images/CleanShot-2025-12-01-at-16.05.37-1024x660.png\"></p>\n"},{"layout":"post","title":"WordPress 網站利用 Cron + Rclone 自動同步檔案到 Google Drive 完整教學","date":"2025-11-13T16:00:00.000Z","top_img":"/images/Gemini_Generated_Image_hqxfm7hqxfm7hqxf.png","cover":"/images/Gemini_Generated_Image_hqxfm7hqxfm7hqxf.png","_content":"\n`首先將示範你如何在 Ubuntu 上安裝 rclone、建立 Google Drive remote，最後撰寫Shell Script。`\n\n## 安裝 rclone\n\n```\nsudo apt install rclone -y\n```\n\n```\nsudo apt install rclone -y\n```\n\n  \n代表的意思：\n\n- `sudo`：以管理員權限執行。\n\n- `apt install rclone`：從套件庫安裝 rclone。\n\n- `-y`：自動同意所有安裝提示，不需要手動按 Yes。\n\n安裝完後 Ubuntu 會輸出一堆像是 Database、man-db、kernel upgrade 的提示，這些是系統正常的安裝訊息，與 rclone 本體無關。\n\n## 開始設定 rclone\n\n```\nrclone config\n```\n\n```\nrclone config\n```\n\n這會啟動互動式設定介面，讓你建立 remote。\n\n## 建立新 remote\n\n畫面問：\n\n```\nn) New remote\ns) Set configuration password\nq) Quit config\nn/s/q>\n```\n\n```\nn) New remote\ns) Set configuration password\nq) Quit config\nn/s/q>\n```\n\n你輸入：n\n\n代表「建立新的 remote」。\n\n## 設定 remote 名稱\n\n畫面問：\n\nEnter name for new remote.  \nname>\n\n輸入：gdrive\n\n意思是：你把這個 rclone 連線命名成 gdrive，之後所有操作都可以用 `gdrive:` 指向你的 Google Drive。\n\n## 選擇儲存服務類型\n\n畫面列出一大串支援的雲端，並問：\n\n```\nsudo apt install rclone -y\n```\n\n```\nsudo apt install rclone -y\n```\n\n你輸入：18\n\n代表選擇「Google Drive」。\n\n## client\\_id 與 client\\_secret\n\n畫面問：\n\n```\nclient_id>\nclient_secret>\n```\n\n直接按 Enter 留空。\n\n代表：\n\n- rclone 會使用官方內建的 Google OAuth client\n\n- 好處是簡單\n\n- 壞處是流量被限縮，不適合大量搬資料\n\n- 不過你的用途是備份用，留空也可以正常運作\n\n## scope 權限設定\n\n畫面問：\n\n```\nOption scope.\nScope that rclone should use when requesting access from drive.\nChoose a number from below, or type in your own value.\nPress Enter to leave empty.\n 1 / Full access all files, excluding Application Data Folder.\n   \\ (drive)\n 2 / Read-only access to file metadata and file contents.\n   \\ (drive.readonly)\n   / Access to files created by rclone only.\n 3 | These are visible in the drive website.\n   | File authorization is revoked when the user deauthorizes the app.\n   \\ (drive.file)\n   / Allows read and write access to the Application Data folder.\n 4 | This is not visible in the drive website.\n   \\ (drive.appfolder)\n   / Allows read-only access to file metadata but\n 5 | does not allow any access to read or download file content.\n   \\ (drive.metadata.readonly)\nscope> 1\n```\n\n```\nOption scope.\nScope that rclone should use when requesting access from drive.\nChoose a number from below, or type in your own value.\nPress Enter to leave empty.\n 1 / Full access all files, excluding Application Data Folder.\n   \\ (drive)\n 2 / Read-only access to file metadata and file contents.\n   \\ (drive.readonly)\n   / Access to files created by rclone only.\n 3 | These are visible in the drive website.\n   | File authorization is revoked when the user deauthorizes the app.\n   \\ (drive.file)\n   / Allows read and write access to the Application Data folder.\n 4 | This is not visible in the drive website.\n   \\ (drive.appfolder)\n   / Allows read-only access to file metadata but\n 5 | does not allow any access to read or download file content.\n   \\ (drive.metadata.readonly)\nscope> 1\n```\n\n輸入：1\n\n代表使用：\n\n```\nFull access all files, excluding Application Data Folder.\n```\n\n意思是：  \nrclone 可以對你的 Google Drive 執行讀寫與管理檔案，這是最完整的權限。\n\n## service\\_account\\_file\n\n畫面問：service\\_account\\_file>\n\n直接按Enter。代表你不用 Service Account，也不需要 JSON 憑證，而是使用一般 OAuth 流程登入。\n\n## advanced config\n\n畫面問：Edit advanced config? y/n>\n\n你輸入：n\n\n代表採用預設值，不進階調整。\n\n## 是否使用 auto-config\n\n畫面問：Use auto config? y/n>\n\n你輸入：n\n\n原因：你是在沒有 GUI 的遠端主機上操作，所以不能自動跳出瀏覽器登入。\n\n## 手動給 token (你的瀏覽器機器產出的)\n\n```\nOption config_token.\nFor this to work, you will need rclone available on a machine that has\na web browser available.\nFor more help and alternate methods see: https://rclone.org/remote_setup/\nExecute the following on the machine with the web browser (same rclone\nversion recommended):\n        rclone authorize \"drive\" \"授權碼\"\nThen paste the result.\nEnter a value.\nconfig_token>\n```\n\n```\nOption config_token.\nFor this to work, you will need rclone available on a machine that has\na web browser available.\nFor more help and alternate methods see: https://rclone.org/remote_setup/\nExecute the following on the machine with the web browser (same rclone\nversion recommended):\n        rclone authorize \"drive\" \"授權碼\"\nThen paste the result.\nEnter a value.\nconfig_token>\n```\n\n畫面問：config\\_token>\n\n在任何有瀏覽器的電腦開 Terminal\n\n輸入：\n\n```\nrclone authorize \"drive\" \"<授權碼>\"\n```\n\n```\nrclone authorize \"drive\" \"<授權碼>\"\n```\n\n![](/images/image-2-1024x510.png)\n\n這一步代表：你透過另一台有網頁瀏覽器的機器完成 Google OAuth 登入，再把結果回傳到伺服器。\n\n## Shared Drive 是否要設定\n\n畫面問：Configure this as a Shared Drive? y/n>\n\n你輸入：y\n\n代表問 Google Drive 是否有 Team Drive。  \n你沒有 Team Drive，所以顯示：No Shared Drives found\n\n## 完成設定並儲存\n\n最後 rclone 問：Keep this \"gdrive\" remote?\n\n你輸入：y\n\n設定就正式完成。\n\n## 測試 remote 是否正常\n\n你輸入：\n\n```\nrclone ls gdrive:\n```\n\n```\nrclone ls gdrive:\n```\n\n重點是要加冒號。執行後，你看到 Google Drive 裡全部的檔案列表。代表 gdrive remote 設定成功。\n\n![](/images/image-3-1024x526.png)\n\n# 接著是 Shell Script 與 cron 排程設定\n\n本備份系統用於在 Linux 伺服器上自動備份多個 WordPress 網站，包括：\n\n- 資料庫備份\n\n- WordPress 主程式備份（排除 uploads）\n\n- Uploads 獨立備份\n\n- 上傳至 Google Drive\n\n- 本機不保留備份檔案\n\n- 由單一設定檔管理多個網站\n\n備份工具：\n\n- mysqldump\n\n- tar\n\n- rclone (Google Drive 備份上傳)\n\n- cron (排程)\n\n## 備份資料夾結構\n\n將建立以下結構：\n\n```\n/root/backup/\n ├── config/\n │     └── sites.conf\n └── scripts/\n       ├── backup-all.sh\n       └── backup-uploads.sh\n```\n\n```\n/root/backup/\n ├── config/\n │     └── sites.conf\n └── scripts/\n       ├── backup-all.sh\n       └── backup-uploads.sh\n```\n\n## 建立系統目錄\n\n```\nsudo mkdir -p /root/backup/config\nsudo mkdir -p /root/backup/scripts\n```\n\n```\nsudo mkdir -p /root/backup/config\nsudo mkdir -p /root/backup/scripts\n```\n\n## 設定檔 sites.conf\n\n所有網站資訊集中管理於：\n\n```\n/root/backup/config/sites.conf\n```\n\n```\n/root/backup/config/sites.conf\n```\n\n格式如下：\n\n```\n# SITE_NAME | DB_NAME | DB_USER | DB_PASS | WP_PATH\n<div></div>\nstackpenguin|網頁對應的資料庫|資料庫使用者|密碼|網頁路徑\n```\n\n```\n# SITE_NAME | DB_NAME | DB_USER | DB_PASS | WP_PATH\n\nstackpenguin|網頁對應的資料庫|資料庫使用者|密碼|網頁路徑\n```\n\n若有多個站點，每行新增一筆資料即可。\n\n## Script：備份資料庫與 WordPress 主程式\n\n檔案位置：\n\n```\n/root/backup/scripts/backup-all.sh\n```\n\n```\n/root/backup/scripts/backup-all.sh\n```\n\n內容如下：\n\n```\n#!/bin/bash\n<div></div>\nCONFIG=\"/root/backup/config/sites.conf\"\nDATE=$(date +\"%Y-%m-%d-%H%M\")\nREMOTE=\"gdrive\"\nREMOTE_BASE=\"wordpress-backups\"\n<div></div>\nwhile IFS='|' read -r SITE DB_NAME DB_USER DB_PASS WP_PATH\ndo\n    # 跳過空行與註解行\n    [[ -z \"$SITE\" || \"$SITE\" =~ ^# ]] && continue\n<div></div>\n    echo \"=====================================\"\n    echo \"開始備份：$SITE（DB + 主程式）\"\n    echo \"=====================================\"\n<div></div>\n    TMP_DIR=\"/tmp/wp-backup-${SITE}-${DATE}\"\n    mkdir -p \"$TMP_DIR\"\n<div></div>\n    #######################################\n    # 1. 備份資料庫（.sql）\n    #######################################\n    DB_FILE=\"$TMP_DIR/db-${SITE}-${DATE}.sql\"\n<div></div>\n    echo \"➤ 備份資料庫中…\"\n    mysqldump --single-transaction --quick --skip-lock-tables \\\n        -u\"$DB_USER\" -p\"$DB_PASS\" \"$DB_NAME\" > \"$DB_FILE\"\n<div></div>\n    echo \"➤ 上傳資料庫…（含進度）\"\n    rclone copy \"$DB_FILE\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/\" -P\n<div></div>\n    echo \"➤ 清除舊版資料庫備份…（保留最新 2 份）\"\n    rclone ls \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/\" \\\n        | sort -k2 \\\n        | head -n -2 \\\n        | awk '{print $2}' \\\n        | while read OLD_FILE\n    do\n        echo \"刪除：$OLD_FILE\"\n        rclone delete \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/${OLD_FILE}\"\n    done\n<div></div>\n    #######################################\n    # 2. 備份主程式（排除 uploads）\n    #######################################\n    WP_FILE=\"$TMP_DIR/wp-${SITE}-${DATE}.tar.gz\"\n<div></div>\n    echo \"➤ 壓縮 WordPress 主程式…（不含 uploads）\"\n    tar -czf \"$WP_FILE\" \\\n        --exclude=\"${WP_PATH}/wp-content/uploads\" \\\n        \"$WP_PATH\"\n<div></div>\n    echo \"➤ 上傳主程式…（含進度）\"\n    rclone copy \"$WP_FILE\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/\" -P\n<div></div>\n    echo \"➤ 清除舊版主程式備份…（保留最新 2 份）\"\n    rclone ls \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/\" \\\n        | sort -k2 \\\n        | head -n -2 \\\n        | awk '{print $2}' \\\n        | while read OLD_FILE\n    do\n        echo \"刪除：$OLD_FILE\"\n        rclone delete \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/${OLD_FILE}\"\n    done\n<div></div>\n    #######################################\n    # 3. 清除暫存\n    #######################################\n    rm -rf \"$TMP_DIR\"\n<div></div>\n    echo \"=== ${SITE} 主程式與資料庫備份完成 ===\"\n    echo \"\"\n<div></div>\ndone < \"$CONFIG\"\n<div></div>\necho \"全部網站的 DB + 主程式備份已完成\"\n```\n\n```\n#!/bin/bash\n\nCONFIG=\"/root/backup/config/sites.conf\"\nDATE=$(date +\"%Y-%m-%d-%H%M\")\nREMOTE=\"gdrive\"\nREMOTE_BASE=\"wordpress-backups\"\n\nwhile IFS='|' read -r SITE DB_NAME DB_USER DB_PASS WP_PATH\ndo\n    # 跳過空行與註解行\n    [[ -z \"$SITE\" || \"$SITE\" =~ ^# ]] && continue\n\n    echo \"=====================================\"\n    echo \"開始備份：$SITE（DB + 主程式）\"\n    echo \"=====================================\"\n\n    TMP_DIR=\"/tmp/wp-backup-${SITE}-${DATE}\"\n    mkdir -p \"$TMP_DIR\"\n\n    #######################################\n    # 1. 備份資料庫（.sql）\n    #######################################\n    DB_FILE=\"$TMP_DIR/db-${SITE}-${DATE}.sql\"\n\n    echo \"➤ 備份資料庫中…\"\n    mysqldump --single-transaction --quick --skip-lock-tables \\\n        -u\"$DB_USER\" -p\"$DB_PASS\" \"$DB_NAME\" > \"$DB_FILE\"\n\n    echo \"➤ 上傳資料庫…（含進度）\"\n    rclone copy \"$DB_FILE\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/\" -P\n\n    echo \"➤ 清除舊版資料庫備份…（保留最新 2 份）\"\n    rclone ls \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/\" \\\n        | sort -k2 \\\n        | head -n -2 \\\n        | awk '{print $2}' \\\n        | while read OLD_FILE\n    do\n        echo \"刪除：$OLD_FILE\"\n        rclone delete \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/${OLD_FILE}\"\n    done\n\n    #######################################\n    # 2. 備份主程式（排除 uploads）\n    #######################################\n    WP_FILE=\"$TMP_DIR/wp-${SITE}-${DATE}.tar.gz\"\n\n    echo \"➤ 壓縮 WordPress 主程式…（不含 uploads）\"\n    tar -czf \"$WP_FILE\" \\\n        --exclude=\"${WP_PATH}/wp-content/uploads\" \\\n        \"$WP_PATH\"\n\n    echo \"➤ 上傳主程式…（含進度）\"\n    rclone copy \"$WP_FILE\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/\" -P\n\n    echo \"➤ 清除舊版主程式備份…（保留最新 2 份）\"\n    rclone ls \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/\" \\\n        | sort -k2 \\\n        | head -n -2 \\\n        | awk '{print $2}' \\\n        | while read OLD_FILE\n    do\n        echo \"刪除：$OLD_FILE\"\n        rclone delete \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/${OLD_FILE}\"\n    done\n\n    #######################################\n    # 3. 清除暫存\n    #######################################\n    rm -rf \"$TMP_DIR\"\n\n    echo \"=== ${SITE} 主程式與資料庫備份完成 ===\"\n    echo \"\"\n\ndone < \"$CONFIG\"\n\necho \"全部網站的 DB + 主程式備份已完成\"\n```\n\n## Script：備份 uploads\n\n檔案位置：\n\n```\n/root/backup/scripts/backup-uploads.sh\n```\n\n```\n/root/backup/scripts/backup-uploads.sh\n```\n\n內容如下：\n\n```\n#!/bin/bash\n<div></div>\nCONFIG=\"/root/backup/config/sites.conf\"\nDATE=$(date +\"%Y-%m-%d-%H%M\")\n<div></div>\nREMOTE=\"gdrive\"\nREMOTE_BASE=\"wordpress-backups\"\n<div></div>\nwhile IFS='|' read -r SITE DB_NAME DB_USER DB_PASS WP_PATH\ndo\n    # 跳過空行與註解\n    [[ -z \"$SITE\" || \"$SITE\" =~ ^# ]] && continue\n<div></div>\n    UPLOAD_PATH=\"${WP_PATH}/wp-content/uploads\"\n<div></div>\n    echo \"===============================\"\n    echo \"開始備份 uploads：${SITE}\"\n    echo \"===============================\"\n<div></div>\n    TMP_DIR=\"/tmp/wp-uploads-${SITE}-${DATE}\"\n    mkdir -p \"$TMP_DIR\"\n<div></div>\n    UPLOAD_FILE=\"${TMP_DIR}/uploads-${SITE}-${DATE}.tar.gz\"\n<div></div>\n    # 壓縮 uploads\n    tar -czf \"$UPLOAD_FILE\" \"$UPLOAD_PATH\"\n<div></div>\n    # 上傳至 Google Drive\n    rclone copy \"$TMP_DIR\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/uploads/\"\n<div></div>\n    # 刪除暫存資料\n    rm -rf \"$TMP_DIR\"\n<div></div>\n    echo \"=== ${SITE} uploads 備份完成 ===\"\n    echo \"\"\ndone < \"$CONFIG\"\n<div></div>\necho \"所有網站 uploads 備份完成\"\n```\n\n```\n#!/bin/bash\n\nCONFIG=\"/root/backup/config/sites.conf\"\nDATE=$(date +\"%Y-%m-%d-%H%M\")\n\nREMOTE=\"gdrive\"\nREMOTE_BASE=\"wordpress-backups\"\n\nwhile IFS='|' read -r SITE DB_NAME DB_USER DB_PASS WP_PATH\ndo\n    # 跳過空行與註解\n    [[ -z \"$SITE\" || \"$SITE\" =~ ^# ]] && continue\n\n    UPLOAD_PATH=\"${WP_PATH}/wp-content/uploads\"\n\n    echo \"===============================\"\n    echo \"開始備份 uploads：${SITE}\"\n    echo \"===============================\"\n\n    TMP_DIR=\"/tmp/wp-uploads-${SITE}-${DATE}\"\n    mkdir -p \"$TMP_DIR\"\n\n    UPLOAD_FILE=\"${TMP_DIR}/uploads-${SITE}-${DATE}.tar.gz\"\n\n    # 壓縮 uploads\n    tar -czf \"$UPLOAD_FILE\" \"$UPLOAD_PATH\"\n\n    # 上傳至 Google Drive\n    rclone copy \"$TMP_DIR\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/uploads/\"\n\n    # 刪除暫存資料\n    rm -rf \"$TMP_DIR\"\n\n    echo \"=== ${SITE} uploads 備份完成 ===\"\n    echo \"\"\ndone < \"$CONFIG\"\n\necho \"所有網站 uploads 備份完成\"\n```\n\n## Script 權限設\n\n```\nsudo chmod +x /root/backup/scripts/backup-all.sh<br>sudo chmod +x /root/backup/scripts/backup-uploads.sh\n```\n\n```\nsudo chmod +x /root/backup/scripts/backup-all.sh<br>sudo chmod +x /root/backup/scripts/backup-uploads.sh\n```\n\n## 排程 cron 設定\n\n設定 root cron：\n\n```\nsudo crontab -e\n```\n\n```\nsudo crontab -e\n```\n\n加入：\n\n```\n# 每日凌晨 3 點：DB + 主程式備份\n0 3 * * * /root/backup/scripts/backup-all.sh >/dev/null 2>&1\n<div></div>\n# 每週一凌晨 4 點：uploads 備份\n0 4 * * 1 /root/backup/scripts/backup-uploads.sh >/dev/null 2>&1\n```\n\n```\n# 每日凌晨 3 點：DB + 主程式備份\n0 3 * * * /root/backup/scripts/backup-all.sh >/dev/null 2>&1\n\n# 每週一凌晨 4 點：uploads 備份\n0 4 * * 1 /root/backup/scripts/backup-uploads.sh >/dev/null 2>&1\n```\n\n## 測試備份流程\n\n### 測試 DB + 主程式\n\n```\nsudo /root/backup/scripts/backup-all.sh\n```\n\n```\nsudo /root/backup/scripts/backup-all.sh\n```\n\n### 測試 uploads\n\n```\nsudo /root/backup/scripts/backup-uploads.sh\n```\n\n```\nsudo /root/backup/scripts/backup-uploads.sh\n```\n\n## 備份位置\n\n備份檔案將會出現在 Google Drive：\n\n![](/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png)\n\n![](/images/CleanShot-2025-11-15-at-15.00.18-1024x611.png)\n\n![](/images/CleanShot-2025-11-15-at-15.00.44-1024x611.png)\n\n![](/images/CleanShot-2025-11-15-at-15.01.04-1024x611.png)\n\n## 注意事項\n\n1. rclone remote 名稱必須為 gdrive，若不同需修改 script。\n\n3. 需要確保 WordPress 資料庫使用者具備 PROCESS 權限： `GRANT PROCESS ON *.* TO 'zhuangwp'@'localhost'; FLUSH PRIVILEGES;`\n\n5. 若新增網站，只需在 sites.conf 新增一行即可。\n\n7. 本機不會保留任何備份檔案，全部在 /tmp 完成後會刪除。\n\n我也試了備份的檔案能夠在本地恢復，可以閱讀這一篇。\n\nhttps://cms.stackpenguin.com/2025/11/15/wp-restore-local/\n","source":"_posts/wp-cron-backup.md","raw":"---\nlayout: post\ntitle: WordPress 網站利用 Cron + Rclone 自動同步檔案到 Google Drive 完整教學\ndate: 2025-11-14\ntags:\n  - \"wordpress-備份\"\ncategories:\n  - \"vm-setting\"\n  - \"wordpress\"\ntop_img: /images/Gemini_Generated_Image_hqxfm7hqxfm7hqxf.png\ncover: /images/Gemini_Generated_Image_hqxfm7hqxfm7hqxf.png\n---\n\n`首先將示範你如何在 Ubuntu 上安裝 rclone、建立 Google Drive remote，最後撰寫Shell Script。`\n\n## 安裝 rclone\n\n```\nsudo apt install rclone -y\n```\n\n```\nsudo apt install rclone -y\n```\n\n  \n代表的意思：\n\n- `sudo`：以管理員權限執行。\n\n- `apt install rclone`：從套件庫安裝 rclone。\n\n- `-y`：自動同意所有安裝提示，不需要手動按 Yes。\n\n安裝完後 Ubuntu 會輸出一堆像是 Database、man-db、kernel upgrade 的提示，這些是系統正常的安裝訊息，與 rclone 本體無關。\n\n## 開始設定 rclone\n\n```\nrclone config\n```\n\n```\nrclone config\n```\n\n這會啟動互動式設定介面，讓你建立 remote。\n\n## 建立新 remote\n\n畫面問：\n\n```\nn) New remote\ns) Set configuration password\nq) Quit config\nn/s/q>\n```\n\n```\nn) New remote\ns) Set configuration password\nq) Quit config\nn/s/q>\n```\n\n你輸入：n\n\n代表「建立新的 remote」。\n\n## 設定 remote 名稱\n\n畫面問：\n\nEnter name for new remote.  \nname>\n\n輸入：gdrive\n\n意思是：你把這個 rclone 連線命名成 gdrive，之後所有操作都可以用 `gdrive:` 指向你的 Google Drive。\n\n## 選擇儲存服務類型\n\n畫面列出一大串支援的雲端，並問：\n\n```\nsudo apt install rclone -y\n```\n\n```\nsudo apt install rclone -y\n```\n\n你輸入：18\n\n代表選擇「Google Drive」。\n\n## client\\_id 與 client\\_secret\n\n畫面問：\n\n```\nclient_id>\nclient_secret>\n```\n\n直接按 Enter 留空。\n\n代表：\n\n- rclone 會使用官方內建的 Google OAuth client\n\n- 好處是簡單\n\n- 壞處是流量被限縮，不適合大量搬資料\n\n- 不過你的用途是備份用，留空也可以正常運作\n\n## scope 權限設定\n\n畫面問：\n\n```\nOption scope.\nScope that rclone should use when requesting access from drive.\nChoose a number from below, or type in your own value.\nPress Enter to leave empty.\n 1 / Full access all files, excluding Application Data Folder.\n   \\ (drive)\n 2 / Read-only access to file metadata and file contents.\n   \\ (drive.readonly)\n   / Access to files created by rclone only.\n 3 | These are visible in the drive website.\n   | File authorization is revoked when the user deauthorizes the app.\n   \\ (drive.file)\n   / Allows read and write access to the Application Data folder.\n 4 | This is not visible in the drive website.\n   \\ (drive.appfolder)\n   / Allows read-only access to file metadata but\n 5 | does not allow any access to read or download file content.\n   \\ (drive.metadata.readonly)\nscope> 1\n```\n\n```\nOption scope.\nScope that rclone should use when requesting access from drive.\nChoose a number from below, or type in your own value.\nPress Enter to leave empty.\n 1 / Full access all files, excluding Application Data Folder.\n   \\ (drive)\n 2 / Read-only access to file metadata and file contents.\n   \\ (drive.readonly)\n   / Access to files created by rclone only.\n 3 | These are visible in the drive website.\n   | File authorization is revoked when the user deauthorizes the app.\n   \\ (drive.file)\n   / Allows read and write access to the Application Data folder.\n 4 | This is not visible in the drive website.\n   \\ (drive.appfolder)\n   / Allows read-only access to file metadata but\n 5 | does not allow any access to read or download file content.\n   \\ (drive.metadata.readonly)\nscope> 1\n```\n\n輸入：1\n\n代表使用：\n\n```\nFull access all files, excluding Application Data Folder.\n```\n\n意思是：  \nrclone 可以對你的 Google Drive 執行讀寫與管理檔案，這是最完整的權限。\n\n## service\\_account\\_file\n\n畫面問：service\\_account\\_file>\n\n直接按Enter。代表你不用 Service Account，也不需要 JSON 憑證，而是使用一般 OAuth 流程登入。\n\n## advanced config\n\n畫面問：Edit advanced config? y/n>\n\n你輸入：n\n\n代表採用預設值，不進階調整。\n\n## 是否使用 auto-config\n\n畫面問：Use auto config? y/n>\n\n你輸入：n\n\n原因：你是在沒有 GUI 的遠端主機上操作，所以不能自動跳出瀏覽器登入。\n\n## 手動給 token (你的瀏覽器機器產出的)\n\n```\nOption config_token.\nFor this to work, you will need rclone available on a machine that has\na web browser available.\nFor more help and alternate methods see: https://rclone.org/remote_setup/\nExecute the following on the machine with the web browser (same rclone\nversion recommended):\n        rclone authorize \"drive\" \"授權碼\"\nThen paste the result.\nEnter a value.\nconfig_token>\n```\n\n```\nOption config_token.\nFor this to work, you will need rclone available on a machine that has\na web browser available.\nFor more help and alternate methods see: https://rclone.org/remote_setup/\nExecute the following on the machine with the web browser (same rclone\nversion recommended):\n        rclone authorize \"drive\" \"授權碼\"\nThen paste the result.\nEnter a value.\nconfig_token>\n```\n\n畫面問：config\\_token>\n\n在任何有瀏覽器的電腦開 Terminal\n\n輸入：\n\n```\nrclone authorize \"drive\" \"<授權碼>\"\n```\n\n```\nrclone authorize \"drive\" \"<授權碼>\"\n```\n\n![](/images/image-2-1024x510.png)\n\n這一步代表：你透過另一台有網頁瀏覽器的機器完成 Google OAuth 登入，再把結果回傳到伺服器。\n\n## Shared Drive 是否要設定\n\n畫面問：Configure this as a Shared Drive? y/n>\n\n你輸入：y\n\n代表問 Google Drive 是否有 Team Drive。  \n你沒有 Team Drive，所以顯示：No Shared Drives found\n\n## 完成設定並儲存\n\n最後 rclone 問：Keep this \"gdrive\" remote?\n\n你輸入：y\n\n設定就正式完成。\n\n## 測試 remote 是否正常\n\n你輸入：\n\n```\nrclone ls gdrive:\n```\n\n```\nrclone ls gdrive:\n```\n\n重點是要加冒號。執行後，你看到 Google Drive 裡全部的檔案列表。代表 gdrive remote 設定成功。\n\n![](/images/image-3-1024x526.png)\n\n# 接著是 Shell Script 與 cron 排程設定\n\n本備份系統用於在 Linux 伺服器上自動備份多個 WordPress 網站，包括：\n\n- 資料庫備份\n\n- WordPress 主程式備份（排除 uploads）\n\n- Uploads 獨立備份\n\n- 上傳至 Google Drive\n\n- 本機不保留備份檔案\n\n- 由單一設定檔管理多個網站\n\n備份工具：\n\n- mysqldump\n\n- tar\n\n- rclone (Google Drive 備份上傳)\n\n- cron (排程)\n\n## 備份資料夾結構\n\n將建立以下結構：\n\n```\n/root/backup/\n ├── config/\n │     └── sites.conf\n └── scripts/\n       ├── backup-all.sh\n       └── backup-uploads.sh\n```\n\n```\n/root/backup/\n ├── config/\n │     └── sites.conf\n └── scripts/\n       ├── backup-all.sh\n       └── backup-uploads.sh\n```\n\n## 建立系統目錄\n\n```\nsudo mkdir -p /root/backup/config\nsudo mkdir -p /root/backup/scripts\n```\n\n```\nsudo mkdir -p /root/backup/config\nsudo mkdir -p /root/backup/scripts\n```\n\n## 設定檔 sites.conf\n\n所有網站資訊集中管理於：\n\n```\n/root/backup/config/sites.conf\n```\n\n```\n/root/backup/config/sites.conf\n```\n\n格式如下：\n\n```\n# SITE_NAME | DB_NAME | DB_USER | DB_PASS | WP_PATH\n<div></div>\nstackpenguin|網頁對應的資料庫|資料庫使用者|密碼|網頁路徑\n```\n\n```\n# SITE_NAME | DB_NAME | DB_USER | DB_PASS | WP_PATH\n\nstackpenguin|網頁對應的資料庫|資料庫使用者|密碼|網頁路徑\n```\n\n若有多個站點，每行新增一筆資料即可。\n\n## Script：備份資料庫與 WordPress 主程式\n\n檔案位置：\n\n```\n/root/backup/scripts/backup-all.sh\n```\n\n```\n/root/backup/scripts/backup-all.sh\n```\n\n內容如下：\n\n```\n#!/bin/bash\n<div></div>\nCONFIG=\"/root/backup/config/sites.conf\"\nDATE=$(date +\"%Y-%m-%d-%H%M\")\nREMOTE=\"gdrive\"\nREMOTE_BASE=\"wordpress-backups\"\n<div></div>\nwhile IFS='|' read -r SITE DB_NAME DB_USER DB_PASS WP_PATH\ndo\n    # 跳過空行與註解行\n    [[ -z \"$SITE\" || \"$SITE\" =~ ^# ]] && continue\n<div></div>\n    echo \"=====================================\"\n    echo \"開始備份：$SITE（DB + 主程式）\"\n    echo \"=====================================\"\n<div></div>\n    TMP_DIR=\"/tmp/wp-backup-${SITE}-${DATE}\"\n    mkdir -p \"$TMP_DIR\"\n<div></div>\n    #######################################\n    # 1. 備份資料庫（.sql）\n    #######################################\n    DB_FILE=\"$TMP_DIR/db-${SITE}-${DATE}.sql\"\n<div></div>\n    echo \"➤ 備份資料庫中…\"\n    mysqldump --single-transaction --quick --skip-lock-tables \\\n        -u\"$DB_USER\" -p\"$DB_PASS\" \"$DB_NAME\" > \"$DB_FILE\"\n<div></div>\n    echo \"➤ 上傳資料庫…（含進度）\"\n    rclone copy \"$DB_FILE\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/\" -P\n<div></div>\n    echo \"➤ 清除舊版資料庫備份…（保留最新 2 份）\"\n    rclone ls \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/\" \\\n        | sort -k2 \\\n        | head -n -2 \\\n        | awk '{print $2}' \\\n        | while read OLD_FILE\n    do\n        echo \"刪除：$OLD_FILE\"\n        rclone delete \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/${OLD_FILE}\"\n    done\n<div></div>\n    #######################################\n    # 2. 備份主程式（排除 uploads）\n    #######################################\n    WP_FILE=\"$TMP_DIR/wp-${SITE}-${DATE}.tar.gz\"\n<div></div>\n    echo \"➤ 壓縮 WordPress 主程式…（不含 uploads）\"\n    tar -czf \"$WP_FILE\" \\\n        --exclude=\"${WP_PATH}/wp-content/uploads\" \\\n        \"$WP_PATH\"\n<div></div>\n    echo \"➤ 上傳主程式…（含進度）\"\n    rclone copy \"$WP_FILE\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/\" -P\n<div></div>\n    echo \"➤ 清除舊版主程式備份…（保留最新 2 份）\"\n    rclone ls \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/\" \\\n        | sort -k2 \\\n        | head -n -2 \\\n        | awk '{print $2}' \\\n        | while read OLD_FILE\n    do\n        echo \"刪除：$OLD_FILE\"\n        rclone delete \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/${OLD_FILE}\"\n    done\n<div></div>\n    #######################################\n    # 3. 清除暫存\n    #######################################\n    rm -rf \"$TMP_DIR\"\n<div></div>\n    echo \"=== ${SITE} 主程式與資料庫備份完成 ===\"\n    echo \"\"\n<div></div>\ndone < \"$CONFIG\"\n<div></div>\necho \"全部網站的 DB + 主程式備份已完成\"\n```\n\n```\n#!/bin/bash\n\nCONFIG=\"/root/backup/config/sites.conf\"\nDATE=$(date +\"%Y-%m-%d-%H%M\")\nREMOTE=\"gdrive\"\nREMOTE_BASE=\"wordpress-backups\"\n\nwhile IFS='|' read -r SITE DB_NAME DB_USER DB_PASS WP_PATH\ndo\n    # 跳過空行與註解行\n    [[ -z \"$SITE\" || \"$SITE\" =~ ^# ]] && continue\n\n    echo \"=====================================\"\n    echo \"開始備份：$SITE（DB + 主程式）\"\n    echo \"=====================================\"\n\n    TMP_DIR=\"/tmp/wp-backup-${SITE}-${DATE}\"\n    mkdir -p \"$TMP_DIR\"\n\n    #######################################\n    # 1. 備份資料庫（.sql）\n    #######################################\n    DB_FILE=\"$TMP_DIR/db-${SITE}-${DATE}.sql\"\n\n    echo \"➤ 備份資料庫中…\"\n    mysqldump --single-transaction --quick --skip-lock-tables \\\n        -u\"$DB_USER\" -p\"$DB_PASS\" \"$DB_NAME\" > \"$DB_FILE\"\n\n    echo \"➤ 上傳資料庫…（含進度）\"\n    rclone copy \"$DB_FILE\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/\" -P\n\n    echo \"➤ 清除舊版資料庫備份…（保留最新 2 份）\"\n    rclone ls \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/\" \\\n        | sort -k2 \\\n        | head -n -2 \\\n        | awk '{print $2}' \\\n        | while read OLD_FILE\n    do\n        echo \"刪除：$OLD_FILE\"\n        rclone delete \"${REMOTE}:/${REMOTE_BASE}/${SITE}/db/${OLD_FILE}\"\n    done\n\n    #######################################\n    # 2. 備份主程式（排除 uploads）\n    #######################################\n    WP_FILE=\"$TMP_DIR/wp-${SITE}-${DATE}.tar.gz\"\n\n    echo \"➤ 壓縮 WordPress 主程式…（不含 uploads）\"\n    tar -czf \"$WP_FILE\" \\\n        --exclude=\"${WP_PATH}/wp-content/uploads\" \\\n        \"$WP_PATH\"\n\n    echo \"➤ 上傳主程式…（含進度）\"\n    rclone copy \"$WP_FILE\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/\" -P\n\n    echo \"➤ 清除舊版主程式備份…（保留最新 2 份）\"\n    rclone ls \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/\" \\\n        | sort -k2 \\\n        | head -n -2 \\\n        | awk '{print $2}' \\\n        | while read OLD_FILE\n    do\n        echo \"刪除：$OLD_FILE\"\n        rclone delete \"${REMOTE}:/${REMOTE_BASE}/${SITE}/main/${OLD_FILE}\"\n    done\n\n    #######################################\n    # 3. 清除暫存\n    #######################################\n    rm -rf \"$TMP_DIR\"\n\n    echo \"=== ${SITE} 主程式與資料庫備份完成 ===\"\n    echo \"\"\n\ndone < \"$CONFIG\"\n\necho \"全部網站的 DB + 主程式備份已完成\"\n```\n\n## Script：備份 uploads\n\n檔案位置：\n\n```\n/root/backup/scripts/backup-uploads.sh\n```\n\n```\n/root/backup/scripts/backup-uploads.sh\n```\n\n內容如下：\n\n```\n#!/bin/bash\n<div></div>\nCONFIG=\"/root/backup/config/sites.conf\"\nDATE=$(date +\"%Y-%m-%d-%H%M\")\n<div></div>\nREMOTE=\"gdrive\"\nREMOTE_BASE=\"wordpress-backups\"\n<div></div>\nwhile IFS='|' read -r SITE DB_NAME DB_USER DB_PASS WP_PATH\ndo\n    # 跳過空行與註解\n    [[ -z \"$SITE\" || \"$SITE\" =~ ^# ]] && continue\n<div></div>\n    UPLOAD_PATH=\"${WP_PATH}/wp-content/uploads\"\n<div></div>\n    echo \"===============================\"\n    echo \"開始備份 uploads：${SITE}\"\n    echo \"===============================\"\n<div></div>\n    TMP_DIR=\"/tmp/wp-uploads-${SITE}-${DATE}\"\n    mkdir -p \"$TMP_DIR\"\n<div></div>\n    UPLOAD_FILE=\"${TMP_DIR}/uploads-${SITE}-${DATE}.tar.gz\"\n<div></div>\n    # 壓縮 uploads\n    tar -czf \"$UPLOAD_FILE\" \"$UPLOAD_PATH\"\n<div></div>\n    # 上傳至 Google Drive\n    rclone copy \"$TMP_DIR\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/uploads/\"\n<div></div>\n    # 刪除暫存資料\n    rm -rf \"$TMP_DIR\"\n<div></div>\n    echo \"=== ${SITE} uploads 備份完成 ===\"\n    echo \"\"\ndone < \"$CONFIG\"\n<div></div>\necho \"所有網站 uploads 備份完成\"\n```\n\n```\n#!/bin/bash\n\nCONFIG=\"/root/backup/config/sites.conf\"\nDATE=$(date +\"%Y-%m-%d-%H%M\")\n\nREMOTE=\"gdrive\"\nREMOTE_BASE=\"wordpress-backups\"\n\nwhile IFS='|' read -r SITE DB_NAME DB_USER DB_PASS WP_PATH\ndo\n    # 跳過空行與註解\n    [[ -z \"$SITE\" || \"$SITE\" =~ ^# ]] && continue\n\n    UPLOAD_PATH=\"${WP_PATH}/wp-content/uploads\"\n\n    echo \"===============================\"\n    echo \"開始備份 uploads：${SITE}\"\n    echo \"===============================\"\n\n    TMP_DIR=\"/tmp/wp-uploads-${SITE}-${DATE}\"\n    mkdir -p \"$TMP_DIR\"\n\n    UPLOAD_FILE=\"${TMP_DIR}/uploads-${SITE}-${DATE}.tar.gz\"\n\n    # 壓縮 uploads\n    tar -czf \"$UPLOAD_FILE\" \"$UPLOAD_PATH\"\n\n    # 上傳至 Google Drive\n    rclone copy \"$TMP_DIR\" \"${REMOTE}:/${REMOTE_BASE}/${SITE}/uploads/\"\n\n    # 刪除暫存資料\n    rm -rf \"$TMP_DIR\"\n\n    echo \"=== ${SITE} uploads 備份完成 ===\"\n    echo \"\"\ndone < \"$CONFIG\"\n\necho \"所有網站 uploads 備份完成\"\n```\n\n## Script 權限設\n\n```\nsudo chmod +x /root/backup/scripts/backup-all.sh<br>sudo chmod +x /root/backup/scripts/backup-uploads.sh\n```\n\n```\nsudo chmod +x /root/backup/scripts/backup-all.sh<br>sudo chmod +x /root/backup/scripts/backup-uploads.sh\n```\n\n## 排程 cron 設定\n\n設定 root cron：\n\n```\nsudo crontab -e\n```\n\n```\nsudo crontab -e\n```\n\n加入：\n\n```\n# 每日凌晨 3 點：DB + 主程式備份\n0 3 * * * /root/backup/scripts/backup-all.sh >/dev/null 2>&1\n<div></div>\n# 每週一凌晨 4 點：uploads 備份\n0 4 * * 1 /root/backup/scripts/backup-uploads.sh >/dev/null 2>&1\n```\n\n```\n# 每日凌晨 3 點：DB + 主程式備份\n0 3 * * * /root/backup/scripts/backup-all.sh >/dev/null 2>&1\n\n# 每週一凌晨 4 點：uploads 備份\n0 4 * * 1 /root/backup/scripts/backup-uploads.sh >/dev/null 2>&1\n```\n\n## 測試備份流程\n\n### 測試 DB + 主程式\n\n```\nsudo /root/backup/scripts/backup-all.sh\n```\n\n```\nsudo /root/backup/scripts/backup-all.sh\n```\n\n### 測試 uploads\n\n```\nsudo /root/backup/scripts/backup-uploads.sh\n```\n\n```\nsudo /root/backup/scripts/backup-uploads.sh\n```\n\n## 備份位置\n\n備份檔案將會出現在 Google Drive：\n\n![](/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png)\n\n![](/images/CleanShot-2025-11-15-at-15.00.18-1024x611.png)\n\n![](/images/CleanShot-2025-11-15-at-15.00.44-1024x611.png)\n\n![](/images/CleanShot-2025-11-15-at-15.01.04-1024x611.png)\n\n## 注意事項\n\n1. rclone remote 名稱必須為 gdrive，若不同需修改 script。\n\n3. 需要確保 WordPress 資料庫使用者具備 PROCESS 權限： `GRANT PROCESS ON *.* TO 'zhuangwp'@'localhost'; FLUSH PRIVILEGES;`\n\n5. 若新增網站，只需在 sites.conf 新增一行即可。\n\n7. 本機不會保留任何備份檔案，全部在 /tmp 完成後會刪除。\n\n我也試了備份的檔案能夠在本地恢復，可以閱讀這一篇。\n\nhttps://cms.stackpenguin.com/2025/11/15/wp-restore-local/\n","slug":"wp-cron-backup","published":1,"updated":"2026-01-28T14:17:25.069Z","_id":"cmkxg0krt000grb8zg1csac9w","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p><code>首先將示範你如何在 Ubuntu 上安裝 rclone、建立 Google Drive remote，最後撰寫Shell Script。</code></p>\n<h2 id=\"安裝-rclone\"><a href=\"#安裝-rclone\" class=\"headerlink\" title=\"安裝 rclone\"></a>安裝 rclone</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install rclone -y</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install rclone -y</span><br></pre></td></tr></table></figure>\n\n<p>代表的意思：</p>\n<ul>\n<li><p><code>sudo</code>：以管理員權限執行。</p>\n</li>\n<li><p><code>apt install rclone</code>：從套件庫安裝 rclone。</p>\n</li>\n<li><p><code>-y</code>：自動同意所有安裝提示，不需要手動按 Yes。</p>\n</li>\n</ul>\n<p>安裝完後 Ubuntu 會輸出一堆像是 Database、man-db、kernel upgrade 的提示，這些是系統正常的安裝訊息，與 rclone 本體無關。</p>\n<h2 id=\"開始設定-rclone\"><a href=\"#開始設定-rclone\" class=\"headerlink\" title=\"開始設定 rclone\"></a>開始設定 rclone</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone config</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone config</span><br></pre></td></tr></table></figure>\n\n<p>這會啟動互動式設定介面，讓你建立 remote。</p>\n<h2 id=\"建立新-remote\"><a href=\"#建立新-remote\" class=\"headerlink\" title=\"建立新 remote\"></a>建立新 remote</h2><p>畫面問：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">n) New remote</span><br><span class=\"line\">s) Set configuration password</span><br><span class=\"line\">q) Quit config</span><br><span class=\"line\">n/s/q&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">n) New remote</span><br><span class=\"line\">s) Set configuration password</span><br><span class=\"line\">q) Quit config</span><br><span class=\"line\">n/s/q&gt;</span><br></pre></td></tr></table></figure>\n\n<p>你輸入：n</p>\n<p>代表「建立新的 remote」。</p>\n<h2 id=\"設定-remote-名稱\"><a href=\"#設定-remote-名稱\" class=\"headerlink\" title=\"設定 remote 名稱\"></a>設定 remote 名稱</h2><p>畫面問：</p>\n<p>Enter name for new remote.<br>name&gt;</p>\n<p>輸入：gdrive</p>\n<p>意思是：你把這個 rclone 連線命名成 gdrive，之後所有操作都可以用 <code>gdrive:</code> 指向你的 Google Drive。</p>\n<h2 id=\"選擇儲存服務類型\"><a href=\"#選擇儲存服務類型\" class=\"headerlink\" title=\"選擇儲存服務類型\"></a>選擇儲存服務類型</h2><p>畫面列出一大串支援的雲端，並問：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install rclone -y</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install rclone -y</span><br></pre></td></tr></table></figure>\n\n<p>你輸入：18</p>\n<p>代表選擇「Google Drive」。</p>\n<h2 id=\"client-id-與-client-secret\"><a href=\"#client-id-與-client-secret\" class=\"headerlink\" title=\"client_id 與 client_secret\"></a>client_id 與 client_secret</h2><p>畫面問：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client_id&gt;</span><br><span class=\"line\">client_secret&gt;</span><br></pre></td></tr></table></figure>\n\n<p>直接按 Enter 留空。</p>\n<p>代表：</p>\n<ul>\n<li><p>rclone 會使用官方內建的 Google OAuth client</p>\n</li>\n<li><p>好處是簡單</p>\n</li>\n<li><p>壞處是流量被限縮，不適合大量搬資料</p>\n</li>\n<li><p>不過你的用途是備份用，留空也可以正常運作</p>\n</li>\n</ul>\n<h2 id=\"scope-權限設定\"><a href=\"#scope-權限設定\" class=\"headerlink\" title=\"scope 權限設定\"></a>scope 權限設定</h2><p>畫面問：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Option scope.</span><br><span class=\"line\">Scope that rclone should use when requesting access from drive.</span><br><span class=\"line\">Choose a number from below, or type in your own value.</span><br><span class=\"line\">Press Enter to leave empty.</span><br><span class=\"line\"> 1 / Full access all files, excluding Application Data Folder.</span><br><span class=\"line\">   \\ (drive)</span><br><span class=\"line\"> 2 / Read-only access to file metadata and file contents.</span><br><span class=\"line\">   \\ (drive.readonly)</span><br><span class=\"line\">   / Access to files created by rclone only.</span><br><span class=\"line\"> 3 | These are visible in the drive website.</span><br><span class=\"line\">   | File authorization is revoked when the user deauthorizes the app.</span><br><span class=\"line\">   \\ (drive.file)</span><br><span class=\"line\">   / Allows read and write access to the Application Data folder.</span><br><span class=\"line\"> 4 | This is not visible in the drive website.</span><br><span class=\"line\">   \\ (drive.appfolder)</span><br><span class=\"line\">   / Allows read-only access to file metadata but</span><br><span class=\"line\"> 5 | does not allow any access to read or download file content.</span><br><span class=\"line\">   \\ (drive.metadata.readonly)</span><br><span class=\"line\">scope&gt; 1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Option scope.</span><br><span class=\"line\">Scope that rclone should use when requesting access from drive.</span><br><span class=\"line\">Choose a number from below, or type in your own value.</span><br><span class=\"line\">Press Enter to leave empty.</span><br><span class=\"line\"> 1 / Full access all files, excluding Application Data Folder.</span><br><span class=\"line\">   \\ (drive)</span><br><span class=\"line\"> 2 / Read-only access to file metadata and file contents.</span><br><span class=\"line\">   \\ (drive.readonly)</span><br><span class=\"line\">   / Access to files created by rclone only.</span><br><span class=\"line\"> 3 | These are visible in the drive website.</span><br><span class=\"line\">   | File authorization is revoked when the user deauthorizes the app.</span><br><span class=\"line\">   \\ (drive.file)</span><br><span class=\"line\">   / Allows read and write access to the Application Data folder.</span><br><span class=\"line\"> 4 | This is not visible in the drive website.</span><br><span class=\"line\">   \\ (drive.appfolder)</span><br><span class=\"line\">   / Allows read-only access to file metadata but</span><br><span class=\"line\"> 5 | does not allow any access to read or download file content.</span><br><span class=\"line\">   \\ (drive.metadata.readonly)</span><br><span class=\"line\">scope&gt; 1</span><br></pre></td></tr></table></figure>\n\n<p>輸入：1</p>\n<p>代表使用：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Full access all files, excluding Application Data Folder.</span><br></pre></td></tr></table></figure>\n\n<p>意思是：<br>rclone 可以對你的 Google Drive 執行讀寫與管理檔案，這是最完整的權限。</p>\n<h2 id=\"service-account-file\"><a href=\"#service-account-file\" class=\"headerlink\" title=\"service_account_file\"></a>service_account_file</h2><p>畫面問：service_account_file&gt;</p>\n<p>直接按Enter。代表你不用 Service Account，也不需要 JSON 憑證，而是使用一般 OAuth 流程登入。</p>\n<h2 id=\"advanced-config\"><a href=\"#advanced-config\" class=\"headerlink\" title=\"advanced config\"></a>advanced config</h2><p>畫面問：Edit advanced config? y&#x2F;n&gt;</p>\n<p>你輸入：n</p>\n<p>代表採用預設值，不進階調整。</p>\n<h2 id=\"是否使用-auto-config\"><a href=\"#是否使用-auto-config\" class=\"headerlink\" title=\"是否使用 auto-config\"></a>是否使用 auto-config</h2><p>畫面問：Use auto config? y&#x2F;n&gt;</p>\n<p>你輸入：n</p>\n<p>原因：你是在沒有 GUI 的遠端主機上操作，所以不能自動跳出瀏覽器登入。</p>\n<h2 id=\"手動給-token-你的瀏覽器機器產出的\"><a href=\"#手動給-token-你的瀏覽器機器產出的\" class=\"headerlink\" title=\"手動給 token (你的瀏覽器機器產出的)\"></a>手動給 token (你的瀏覽器機器產出的)</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Option config_token.</span><br><span class=\"line\">For this to work, you will need rclone available on a machine that has</span><br><span class=\"line\">a web browser available.</span><br><span class=\"line\">For more help and alternate methods see: https://rclone.org/remote_setup/</span><br><span class=\"line\">Execute the following on the machine with the web browser (same rclone</span><br><span class=\"line\">version recommended):</span><br><span class=\"line\">        rclone authorize &quot;drive&quot; &quot;授權碼&quot;</span><br><span class=\"line\">Then paste the result.</span><br><span class=\"line\">Enter a value.</span><br><span class=\"line\">config_token&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Option config_token.</span><br><span class=\"line\">For this to work, you will need rclone available on a machine that has</span><br><span class=\"line\">a web browser available.</span><br><span class=\"line\">For more help and alternate methods see: https://rclone.org/remote_setup/</span><br><span class=\"line\">Execute the following on the machine with the web browser (same rclone</span><br><span class=\"line\">version recommended):</span><br><span class=\"line\">        rclone authorize &quot;drive&quot; &quot;授權碼&quot;</span><br><span class=\"line\">Then paste the result.</span><br><span class=\"line\">Enter a value.</span><br><span class=\"line\">config_token&gt;</span><br></pre></td></tr></table></figure>\n\n<p>畫面問：config_token&gt;</p>\n<p>在任何有瀏覽器的電腦開 Terminal</p>\n<p>輸入：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone authorize &quot;drive&quot; &quot;&lt;授權碼&gt;&quot;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone authorize &quot;drive&quot; &quot;&lt;授權碼&gt;&quot;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/image-2-1024x510.png\"></p>\n<p>這一步代表：你透過另一台有網頁瀏覽器的機器完成 Google OAuth 登入，再把結果回傳到伺服器。</p>\n<h2 id=\"Shared-Drive-是否要設定\"><a href=\"#Shared-Drive-是否要設定\" class=\"headerlink\" title=\"Shared Drive 是否要設定\"></a>Shared Drive 是否要設定</h2><p>畫面問：Configure this as a Shared Drive? y&#x2F;n&gt;</p>\n<p>你輸入：y</p>\n<p>代表問 Google Drive 是否有 Team Drive。<br>你沒有 Team Drive，所以顯示：No Shared Drives found</p>\n<h2 id=\"完成設定並儲存\"><a href=\"#完成設定並儲存\" class=\"headerlink\" title=\"完成設定並儲存\"></a>完成設定並儲存</h2><p>最後 rclone 問：Keep this “gdrive” remote?</p>\n<p>你輸入：y</p>\n<p>設定就正式完成。</p>\n<h2 id=\"測試-remote-是否正常\"><a href=\"#測試-remote-是否正常\" class=\"headerlink\" title=\"測試 remote 是否正常\"></a>測試 remote 是否正常</h2><p>你輸入：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone ls gdrive:</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone ls gdrive:</span><br></pre></td></tr></table></figure>\n\n<p>重點是要加冒號。執行後，你看到 Google Drive 裡全部的檔案列表。代表 gdrive remote 設定成功。</p>\n<p><img src=\"/images/image-3-1024x526.png\"></p>\n<h1 id=\"接著是-Shell-Script-與-cron-排程設定\"><a href=\"#接著是-Shell-Script-與-cron-排程設定\" class=\"headerlink\" title=\"接著是 Shell Script 與 cron 排程設定\"></a>接著是 Shell Script 與 cron 排程設定</h1><p>本備份系統用於在 Linux 伺服器上自動備份多個 WordPress 網站，包括：</p>\n<ul>\n<li><p>資料庫備份</p>\n</li>\n<li><p>WordPress 主程式備份（排除 uploads）</p>\n</li>\n<li><p>Uploads 獨立備份</p>\n</li>\n<li><p>上傳至 Google Drive</p>\n</li>\n<li><p>本機不保留備份檔案</p>\n</li>\n<li><p>由單一設定檔管理多個網站</p>\n</li>\n</ul>\n<p>備份工具：</p>\n<ul>\n<li><p>mysqldump</p>\n</li>\n<li><p>tar</p>\n</li>\n<li><p>rclone (Google Drive 備份上傳)</p>\n</li>\n<li><p>cron (排程)</p>\n</li>\n</ul>\n<h2 id=\"備份資料夾結構\"><a href=\"#備份資料夾結構\" class=\"headerlink\" title=\"備份資料夾結構\"></a>備份資料夾結構</h2><p>將建立以下結構：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/</span><br><span class=\"line\"> ├── config/</span><br><span class=\"line\"> │     └── sites.conf</span><br><span class=\"line\"> └── scripts/</span><br><span class=\"line\">       ├── backup-all.sh</span><br><span class=\"line\">       └── backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/</span><br><span class=\"line\"> ├── config/</span><br><span class=\"line\"> │     └── sites.conf</span><br><span class=\"line\"> └── scripts/</span><br><span class=\"line\">       ├── backup-all.sh</span><br><span class=\"line\">       └── backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建立系統目錄\"><a href=\"#建立系統目錄\" class=\"headerlink\" title=\"建立系統目錄\"></a>建立系統目錄</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /root/backup/config</span><br><span class=\"line\">sudo mkdir -p /root/backup/scripts</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /root/backup/config</span><br><span class=\"line\">sudo mkdir -p /root/backup/scripts</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"設定檔-sites-conf\"><a href=\"#設定檔-sites-conf\" class=\"headerlink\" title=\"設定檔 sites.conf\"></a>設定檔 sites.conf</h2><p>所有網站資訊集中管理於：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/config/sites.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/config/sites.conf</span><br></pre></td></tr></table></figure>\n\n<p>格式如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># SITE_NAME | DB_NAME | DB_USER | DB_PASS | WP_PATH</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">stackpenguin|網頁對應的資料庫|資料庫使用者|密碼|網頁路徑</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># SITE_NAME | DB_NAME | DB_USER | DB_PASS | WP_PATH</span><br><span class=\"line\"></span><br><span class=\"line\">stackpenguin|網頁對應的資料庫|資料庫使用者|密碼|網頁路徑</span><br></pre></td></tr></table></figure>\n\n<p>若有多個站點，每行新增一筆資料即可。</p>\n<h2 id=\"Script：備份資料庫與-WordPress-主程式\"><a href=\"#Script：備份資料庫與-WordPress-主程式\" class=\"headerlink\" title=\"Script：備份資料庫與 WordPress 主程式\"></a>Script：備份資料庫與 WordPress 主程式</h2><p>檔案位置：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/scripts/backup-all.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/scripts/backup-all.sh</span><br></pre></td></tr></table></figure>\n\n<p>內容如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">CONFIG=&quot;/root/backup/config/sites.conf&quot;</span><br><span class=\"line\">DATE=$(date +&quot;%Y-%m-%d-%H%M&quot;)</span><br><span class=\"line\">REMOTE=&quot;gdrive&quot;</span><br><span class=\"line\">REMOTE_BASE=&quot;wordpress-backups&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">while IFS=&#x27;|&#x27; read -r SITE DB_NAME DB_USER DB_PASS WP_PATH</span><br><span class=\"line\">do</span><br><span class=\"line\">    # 跳過空行與註解行</span><br><span class=\"line\">    [[ -z &quot;$SITE&quot; || &quot;$SITE&quot; =~ ^# ]] &amp;&amp; continue</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;=====================================&quot;</span><br><span class=\"line\">    echo &quot;開始備份：$SITE（DB + 主程式）&quot;</span><br><span class=\"line\">    echo &quot;=====================================&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    TMP_DIR=&quot;/tmp/wp-backup-$&#123;SITE&#125;-$&#123;DATE&#125;&quot;</span><br><span class=\"line\">    mkdir -p &quot;$TMP_DIR&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 1. 備份資料庫（.sql）</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    DB_FILE=&quot;$TMP_DIR/db-$&#123;SITE&#125;-$&#123;DATE&#125;.sql&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 備份資料庫中…&quot;</span><br><span class=\"line\">    mysqldump --single-transaction --quick --skip-lock-tables \\</span><br><span class=\"line\">        -u&quot;$DB_USER&quot; -p&quot;$DB_PASS&quot; &quot;$DB_NAME&quot; &gt; &quot;$DB_FILE&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 上傳資料庫…（含進度）&quot;</span><br><span class=\"line\">    rclone copy &quot;$DB_FILE&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/&quot; -P</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 清除舊版資料庫備份…（保留最新 2 份）&quot;</span><br><span class=\"line\">    rclone ls &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/&quot; \\</span><br><span class=\"line\">        | sort -k2 \\</span><br><span class=\"line\">        | head -n -2 \\</span><br><span class=\"line\">        | awk &#x27;&#123;print $2&#125;&#x27; \\</span><br><span class=\"line\">        | while read OLD_FILE</span><br><span class=\"line\">    do</span><br><span class=\"line\">        echo &quot;刪除：$OLD_FILE&quot;</span><br><span class=\"line\">        rclone delete &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/$&#123;OLD_FILE&#125;&quot;</span><br><span class=\"line\">    done</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 2. 備份主程式（排除 uploads）</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    WP_FILE=&quot;$TMP_DIR/wp-$&#123;SITE&#125;-$&#123;DATE&#125;.tar.gz&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 壓縮 WordPress 主程式…（不含 uploads）&quot;</span><br><span class=\"line\">    tar -czf &quot;$WP_FILE&quot; \\</span><br><span class=\"line\">        --exclude=&quot;$&#123;WP_PATH&#125;/wp-content/uploads&quot; \\</span><br><span class=\"line\">        &quot;$WP_PATH&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 上傳主程式…（含進度）&quot;</span><br><span class=\"line\">    rclone copy &quot;$WP_FILE&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/&quot; -P</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 清除舊版主程式備份…（保留最新 2 份）&quot;</span><br><span class=\"line\">    rclone ls &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/&quot; \\</span><br><span class=\"line\">        | sort -k2 \\</span><br><span class=\"line\">        | head -n -2 \\</span><br><span class=\"line\">        | awk &#x27;&#123;print $2&#125;&#x27; \\</span><br><span class=\"line\">        | while read OLD_FILE</span><br><span class=\"line\">    do</span><br><span class=\"line\">        echo &quot;刪除：$OLD_FILE&quot;</span><br><span class=\"line\">        rclone delete &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/$&#123;OLD_FILE&#125;&quot;</span><br><span class=\"line\">    done</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 3. 清除暫存</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    rm -rf &quot;$TMP_DIR&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;=== $&#123;SITE&#125; 主程式與資料庫備份完成 ===&quot;</span><br><span class=\"line\">    echo &quot;&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">done &lt; &quot;$CONFIG&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">echo &quot;全部網站的 DB + 主程式備份已完成&quot;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">CONFIG=&quot;/root/backup/config/sites.conf&quot;</span><br><span class=\"line\">DATE=$(date +&quot;%Y-%m-%d-%H%M&quot;)</span><br><span class=\"line\">REMOTE=&quot;gdrive&quot;</span><br><span class=\"line\">REMOTE_BASE=&quot;wordpress-backups&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">while IFS=&#x27;|&#x27; read -r SITE DB_NAME DB_USER DB_PASS WP_PATH</span><br><span class=\"line\">do</span><br><span class=\"line\">    # 跳過空行與註解行</span><br><span class=\"line\">    [[ -z &quot;$SITE&quot; || &quot;$SITE&quot; =~ ^# ]] &amp;&amp; continue</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;=====================================&quot;</span><br><span class=\"line\">    echo &quot;開始備份：$SITE（DB + 主程式）&quot;</span><br><span class=\"line\">    echo &quot;=====================================&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    TMP_DIR=&quot;/tmp/wp-backup-$&#123;SITE&#125;-$&#123;DATE&#125;&quot;</span><br><span class=\"line\">    mkdir -p &quot;$TMP_DIR&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 1. 備份資料庫（.sql）</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    DB_FILE=&quot;$TMP_DIR/db-$&#123;SITE&#125;-$&#123;DATE&#125;.sql&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 備份資料庫中…&quot;</span><br><span class=\"line\">    mysqldump --single-transaction --quick --skip-lock-tables \\</span><br><span class=\"line\">        -u&quot;$DB_USER&quot; -p&quot;$DB_PASS&quot; &quot;$DB_NAME&quot; &gt; &quot;$DB_FILE&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 上傳資料庫…（含進度）&quot;</span><br><span class=\"line\">    rclone copy &quot;$DB_FILE&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/&quot; -P</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 清除舊版資料庫備份…（保留最新 2 份）&quot;</span><br><span class=\"line\">    rclone ls &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/&quot; \\</span><br><span class=\"line\">        | sort -k2 \\</span><br><span class=\"line\">        | head -n -2 \\</span><br><span class=\"line\">        | awk &#x27;&#123;print $2&#125;&#x27; \\</span><br><span class=\"line\">        | while read OLD_FILE</span><br><span class=\"line\">    do</span><br><span class=\"line\">        echo &quot;刪除：$OLD_FILE&quot;</span><br><span class=\"line\">        rclone delete &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/$&#123;OLD_FILE&#125;&quot;</span><br><span class=\"line\">    done</span><br><span class=\"line\"></span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 2. 備份主程式（排除 uploads）</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    WP_FILE=&quot;$TMP_DIR/wp-$&#123;SITE&#125;-$&#123;DATE&#125;.tar.gz&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 壓縮 WordPress 主程式…（不含 uploads）&quot;</span><br><span class=\"line\">    tar -czf &quot;$WP_FILE&quot; \\</span><br><span class=\"line\">        --exclude=&quot;$&#123;WP_PATH&#125;/wp-content/uploads&quot; \\</span><br><span class=\"line\">        &quot;$WP_PATH&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 上傳主程式…（含進度）&quot;</span><br><span class=\"line\">    rclone copy &quot;$WP_FILE&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/&quot; -P</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 清除舊版主程式備份…（保留最新 2 份）&quot;</span><br><span class=\"line\">    rclone ls &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/&quot; \\</span><br><span class=\"line\">        | sort -k2 \\</span><br><span class=\"line\">        | head -n -2 \\</span><br><span class=\"line\">        | awk &#x27;&#123;print $2&#125;&#x27; \\</span><br><span class=\"line\">        | while read OLD_FILE</span><br><span class=\"line\">    do</span><br><span class=\"line\">        echo &quot;刪除：$OLD_FILE&quot;</span><br><span class=\"line\">        rclone delete &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/$&#123;OLD_FILE&#125;&quot;</span><br><span class=\"line\">    done</span><br><span class=\"line\"></span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 3. 清除暫存</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    rm -rf &quot;$TMP_DIR&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;=== $&#123;SITE&#125; 主程式與資料庫備份完成 ===&quot;</span><br><span class=\"line\">    echo &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done &lt; &quot;$CONFIG&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;全部網站的 DB + 主程式備份已完成&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Script：備份-uploads\"><a href=\"#Script：備份-uploads\" class=\"headerlink\" title=\"Script：備份 uploads\"></a>Script：備份 uploads</h2><p>檔案位置：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<p>內容如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">CONFIG=&quot;/root/backup/config/sites.conf&quot;</span><br><span class=\"line\">DATE=$(date +&quot;%Y-%m-%d-%H%M&quot;)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">REMOTE=&quot;gdrive&quot;</span><br><span class=\"line\">REMOTE_BASE=&quot;wordpress-backups&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">while IFS=&#x27;|&#x27; read -r SITE DB_NAME DB_USER DB_PASS WP_PATH</span><br><span class=\"line\">do</span><br><span class=\"line\">    # 跳過空行與註解</span><br><span class=\"line\">    [[ -z &quot;$SITE&quot; || &quot;$SITE&quot; =~ ^# ]] &amp;&amp; continue</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    UPLOAD_PATH=&quot;$&#123;WP_PATH&#125;/wp-content/uploads&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;===============================&quot;</span><br><span class=\"line\">    echo &quot;開始備份 uploads：$&#123;SITE&#125;&quot;</span><br><span class=\"line\">    echo &quot;===============================&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    TMP_DIR=&quot;/tmp/wp-uploads-$&#123;SITE&#125;-$&#123;DATE&#125;&quot;</span><br><span class=\"line\">    mkdir -p &quot;$TMP_DIR&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    UPLOAD_FILE=&quot;$&#123;TMP_DIR&#125;/uploads-$&#123;SITE&#125;-$&#123;DATE&#125;.tar.gz&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    # 壓縮 uploads</span><br><span class=\"line\">    tar -czf &quot;$UPLOAD_FILE&quot; &quot;$UPLOAD_PATH&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    # 上傳至 Google Drive</span><br><span class=\"line\">    rclone copy &quot;$TMP_DIR&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/uploads/&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    # 刪除暫存資料</span><br><span class=\"line\">    rm -rf &quot;$TMP_DIR&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;=== $&#123;SITE&#125; uploads 備份完成 ===&quot;</span><br><span class=\"line\">    echo &quot;&quot;</span><br><span class=\"line\">done &lt; &quot;$CONFIG&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">echo &quot;所有網站 uploads 備份完成&quot;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">CONFIG=&quot;/root/backup/config/sites.conf&quot;</span><br><span class=\"line\">DATE=$(date +&quot;%Y-%m-%d-%H%M&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">REMOTE=&quot;gdrive&quot;</span><br><span class=\"line\">REMOTE_BASE=&quot;wordpress-backups&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">while IFS=&#x27;|&#x27; read -r SITE DB_NAME DB_USER DB_PASS WP_PATH</span><br><span class=\"line\">do</span><br><span class=\"line\">    # 跳過空行與註解</span><br><span class=\"line\">    [[ -z &quot;$SITE&quot; || &quot;$SITE&quot; =~ ^# ]] &amp;&amp; continue</span><br><span class=\"line\"></span><br><span class=\"line\">    UPLOAD_PATH=&quot;$&#123;WP_PATH&#125;/wp-content/uploads&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;===============================&quot;</span><br><span class=\"line\">    echo &quot;開始備份 uploads：$&#123;SITE&#125;&quot;</span><br><span class=\"line\">    echo &quot;===============================&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    TMP_DIR=&quot;/tmp/wp-uploads-$&#123;SITE&#125;-$&#123;DATE&#125;&quot;</span><br><span class=\"line\">    mkdir -p &quot;$TMP_DIR&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    UPLOAD_FILE=&quot;$&#123;TMP_DIR&#125;/uploads-$&#123;SITE&#125;-$&#123;DATE&#125;.tar.gz&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    # 壓縮 uploads</span><br><span class=\"line\">    tar -czf &quot;$UPLOAD_FILE&quot; &quot;$UPLOAD_PATH&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    # 上傳至 Google Drive</span><br><span class=\"line\">    rclone copy &quot;$TMP_DIR&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/uploads/&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    # 刪除暫存資料</span><br><span class=\"line\">    rm -rf &quot;$TMP_DIR&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;=== $&#123;SITE&#125; uploads 備份完成 ===&quot;</span><br><span class=\"line\">    echo &quot;&quot;</span><br><span class=\"line\">done &lt; &quot;$CONFIG&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;所有網站 uploads 備份完成&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Script-權限設\"><a href=\"#Script-權限設\" class=\"headerlink\" title=\"Script 權限設\"></a>Script 權限設</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod +x /root/backup/scripts/backup-all.sh&lt;br&gt;sudo chmod +x /root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod +x /root/backup/scripts/backup-all.sh&lt;br&gt;sudo chmod +x /root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"排程-cron-設定\"><a href=\"#排程-cron-設定\" class=\"headerlink\" title=\"排程 cron 設定\"></a>排程 cron 設定</h2><p>設定 root cron：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo crontab -e</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo crontab -e</span><br></pre></td></tr></table></figure>\n\n<p>加入：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 每日凌晨 3 點：DB + 主程式備份</span><br><span class=\"line\">0 3 * * * /root/backup/scripts/backup-all.sh &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 每週一凌晨 4 點：uploads 備份</span><br><span class=\"line\">0 4 * * 1 /root/backup/scripts/backup-uploads.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 每日凌晨 3 點：DB + 主程式備份</span><br><span class=\"line\">0 3 * * * /root/backup/scripts/backup-all.sh &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\"></span><br><span class=\"line\"># 每週一凌晨 4 點：uploads 備份</span><br><span class=\"line\">0 4 * * 1 /root/backup/scripts/backup-uploads.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"測試備份流程\"><a href=\"#測試備份流程\" class=\"headerlink\" title=\"測試備份流程\"></a>測試備份流程</h2><h3 id=\"測試-DB-主程式\"><a href=\"#測試-DB-主程式\" class=\"headerlink\" title=\"測試 DB + 主程式\"></a>測試 DB + 主程式</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /root/backup/scripts/backup-all.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /root/backup/scripts/backup-all.sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"測試-uploads\"><a href=\"#測試-uploads\" class=\"headerlink\" title=\"測試 uploads\"></a>測試 uploads</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"備份位置\"><a href=\"#備份位置\" class=\"headerlink\" title=\"備份位置\"></a>備份位置</h2><p>備份檔案將會出現在 Google Drive：</p>\n<p><img src=\"/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png\"></p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-15.00.18-1024x611.png\"></p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-15.00.44-1024x611.png\"></p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-15.01.04-1024x611.png\"></p>\n<h2 id=\"注意事項\"><a href=\"#注意事項\" class=\"headerlink\" title=\"注意事項\"></a>注意事項</h2><ol>\n<li><p>rclone remote 名稱必須為 gdrive，若不同需修改 script。</p>\n</li>\n<li><p>需要確保 WordPress 資料庫使用者具備 PROCESS 權限： <code>GRANT PROCESS ON *.* TO &#39;zhuangwp&#39;@&#39;localhost&#39;; FLUSH PRIVILEGES;</code></p>\n</li>\n<li><p>若新增網站，只需在 sites.conf 新增一行即可。</p>\n</li>\n<li><p>本機不會保留任何備份檔案，全部在 &#x2F;tmp 完成後會刪除。</p>\n</li>\n</ol>\n<p>我也試了備份的檔案能夠在本地恢復，可以閱讀這一篇。</p>\n<p><a href=\"https://cms.stackpenguin.com/2025/11/15/wp-restore-local/\">https://cms.stackpenguin.com/2025/11/15/wp-restore-local/</a></p>\n","excerpt":"","more":"<p><code>首先將示範你如何在 Ubuntu 上安裝 rclone、建立 Google Drive remote，最後撰寫Shell Script。</code></p>\n<h2 id=\"安裝-rclone\"><a href=\"#安裝-rclone\" class=\"headerlink\" title=\"安裝 rclone\"></a>安裝 rclone</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install rclone -y</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install rclone -y</span><br></pre></td></tr></table></figure>\n\n<p>代表的意思：</p>\n<ul>\n<li><p><code>sudo</code>：以管理員權限執行。</p>\n</li>\n<li><p><code>apt install rclone</code>：從套件庫安裝 rclone。</p>\n</li>\n<li><p><code>-y</code>：自動同意所有安裝提示，不需要手動按 Yes。</p>\n</li>\n</ul>\n<p>安裝完後 Ubuntu 會輸出一堆像是 Database、man-db、kernel upgrade 的提示，這些是系統正常的安裝訊息，與 rclone 本體無關。</p>\n<h2 id=\"開始設定-rclone\"><a href=\"#開始設定-rclone\" class=\"headerlink\" title=\"開始設定 rclone\"></a>開始設定 rclone</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone config</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone config</span><br></pre></td></tr></table></figure>\n\n<p>這會啟動互動式設定介面，讓你建立 remote。</p>\n<h2 id=\"建立新-remote\"><a href=\"#建立新-remote\" class=\"headerlink\" title=\"建立新 remote\"></a>建立新 remote</h2><p>畫面問：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">n) New remote</span><br><span class=\"line\">s) Set configuration password</span><br><span class=\"line\">q) Quit config</span><br><span class=\"line\">n/s/q&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">n) New remote</span><br><span class=\"line\">s) Set configuration password</span><br><span class=\"line\">q) Quit config</span><br><span class=\"line\">n/s/q&gt;</span><br></pre></td></tr></table></figure>\n\n<p>你輸入：n</p>\n<p>代表「建立新的 remote」。</p>\n<h2 id=\"設定-remote-名稱\"><a href=\"#設定-remote-名稱\" class=\"headerlink\" title=\"設定 remote 名稱\"></a>設定 remote 名稱</h2><p>畫面問：</p>\n<p>Enter name for new remote.<br>name&gt;</p>\n<p>輸入：gdrive</p>\n<p>意思是：你把這個 rclone 連線命名成 gdrive，之後所有操作都可以用 <code>gdrive:</code> 指向你的 Google Drive。</p>\n<h2 id=\"選擇儲存服務類型\"><a href=\"#選擇儲存服務類型\" class=\"headerlink\" title=\"選擇儲存服務類型\"></a>選擇儲存服務類型</h2><p>畫面列出一大串支援的雲端，並問：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install rclone -y</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install rclone -y</span><br></pre></td></tr></table></figure>\n\n<p>你輸入：18</p>\n<p>代表選擇「Google Drive」。</p>\n<h2 id=\"client-id-與-client-secret\"><a href=\"#client-id-與-client-secret\" class=\"headerlink\" title=\"client_id 與 client_secret\"></a>client_id 與 client_secret</h2><p>畫面問：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">client_id&gt;</span><br><span class=\"line\">client_secret&gt;</span><br></pre></td></tr></table></figure>\n\n<p>直接按 Enter 留空。</p>\n<p>代表：</p>\n<ul>\n<li><p>rclone 會使用官方內建的 Google OAuth client</p>\n</li>\n<li><p>好處是簡單</p>\n</li>\n<li><p>壞處是流量被限縮，不適合大量搬資料</p>\n</li>\n<li><p>不過你的用途是備份用，留空也可以正常運作</p>\n</li>\n</ul>\n<h2 id=\"scope-權限設定\"><a href=\"#scope-權限設定\" class=\"headerlink\" title=\"scope 權限設定\"></a>scope 權限設定</h2><p>畫面問：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Option scope.</span><br><span class=\"line\">Scope that rclone should use when requesting access from drive.</span><br><span class=\"line\">Choose a number from below, or type in your own value.</span><br><span class=\"line\">Press Enter to leave empty.</span><br><span class=\"line\"> 1 / Full access all files, excluding Application Data Folder.</span><br><span class=\"line\">   \\ (drive)</span><br><span class=\"line\"> 2 / Read-only access to file metadata and file contents.</span><br><span class=\"line\">   \\ (drive.readonly)</span><br><span class=\"line\">   / Access to files created by rclone only.</span><br><span class=\"line\"> 3 | These are visible in the drive website.</span><br><span class=\"line\">   | File authorization is revoked when the user deauthorizes the app.</span><br><span class=\"line\">   \\ (drive.file)</span><br><span class=\"line\">   / Allows read and write access to the Application Data folder.</span><br><span class=\"line\"> 4 | This is not visible in the drive website.</span><br><span class=\"line\">   \\ (drive.appfolder)</span><br><span class=\"line\">   / Allows read-only access to file metadata but</span><br><span class=\"line\"> 5 | does not allow any access to read or download file content.</span><br><span class=\"line\">   \\ (drive.metadata.readonly)</span><br><span class=\"line\">scope&gt; 1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Option scope.</span><br><span class=\"line\">Scope that rclone should use when requesting access from drive.</span><br><span class=\"line\">Choose a number from below, or type in your own value.</span><br><span class=\"line\">Press Enter to leave empty.</span><br><span class=\"line\"> 1 / Full access all files, excluding Application Data Folder.</span><br><span class=\"line\">   \\ (drive)</span><br><span class=\"line\"> 2 / Read-only access to file metadata and file contents.</span><br><span class=\"line\">   \\ (drive.readonly)</span><br><span class=\"line\">   / Access to files created by rclone only.</span><br><span class=\"line\"> 3 | These are visible in the drive website.</span><br><span class=\"line\">   | File authorization is revoked when the user deauthorizes the app.</span><br><span class=\"line\">   \\ (drive.file)</span><br><span class=\"line\">   / Allows read and write access to the Application Data folder.</span><br><span class=\"line\"> 4 | This is not visible in the drive website.</span><br><span class=\"line\">   \\ (drive.appfolder)</span><br><span class=\"line\">   / Allows read-only access to file metadata but</span><br><span class=\"line\"> 5 | does not allow any access to read or download file content.</span><br><span class=\"line\">   \\ (drive.metadata.readonly)</span><br><span class=\"line\">scope&gt; 1</span><br></pre></td></tr></table></figure>\n\n<p>輸入：1</p>\n<p>代表使用：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Full access all files, excluding Application Data Folder.</span><br></pre></td></tr></table></figure>\n\n<p>意思是：<br>rclone 可以對你的 Google Drive 執行讀寫與管理檔案，這是最完整的權限。</p>\n<h2 id=\"service-account-file\"><a href=\"#service-account-file\" class=\"headerlink\" title=\"service_account_file\"></a>service_account_file</h2><p>畫面問：service_account_file&gt;</p>\n<p>直接按Enter。代表你不用 Service Account，也不需要 JSON 憑證，而是使用一般 OAuth 流程登入。</p>\n<h2 id=\"advanced-config\"><a href=\"#advanced-config\" class=\"headerlink\" title=\"advanced config\"></a>advanced config</h2><p>畫面問：Edit advanced config? y&#x2F;n&gt;</p>\n<p>你輸入：n</p>\n<p>代表採用預設值，不進階調整。</p>\n<h2 id=\"是否使用-auto-config\"><a href=\"#是否使用-auto-config\" class=\"headerlink\" title=\"是否使用 auto-config\"></a>是否使用 auto-config</h2><p>畫面問：Use auto config? y&#x2F;n&gt;</p>\n<p>你輸入：n</p>\n<p>原因：你是在沒有 GUI 的遠端主機上操作，所以不能自動跳出瀏覽器登入。</p>\n<h2 id=\"手動給-token-你的瀏覽器機器產出的\"><a href=\"#手動給-token-你的瀏覽器機器產出的\" class=\"headerlink\" title=\"手動給 token (你的瀏覽器機器產出的)\"></a>手動給 token (你的瀏覽器機器產出的)</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Option config_token.</span><br><span class=\"line\">For this to work, you will need rclone available on a machine that has</span><br><span class=\"line\">a web browser available.</span><br><span class=\"line\">For more help and alternate methods see: https://rclone.org/remote_setup/</span><br><span class=\"line\">Execute the following on the machine with the web browser (same rclone</span><br><span class=\"line\">version recommended):</span><br><span class=\"line\">        rclone authorize &quot;drive&quot; &quot;授權碼&quot;</span><br><span class=\"line\">Then paste the result.</span><br><span class=\"line\">Enter a value.</span><br><span class=\"line\">config_token&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Option config_token.</span><br><span class=\"line\">For this to work, you will need rclone available on a machine that has</span><br><span class=\"line\">a web browser available.</span><br><span class=\"line\">For more help and alternate methods see: https://rclone.org/remote_setup/</span><br><span class=\"line\">Execute the following on the machine with the web browser (same rclone</span><br><span class=\"line\">version recommended):</span><br><span class=\"line\">        rclone authorize &quot;drive&quot; &quot;授權碼&quot;</span><br><span class=\"line\">Then paste the result.</span><br><span class=\"line\">Enter a value.</span><br><span class=\"line\">config_token&gt;</span><br></pre></td></tr></table></figure>\n\n<p>畫面問：config_token&gt;</p>\n<p>在任何有瀏覽器的電腦開 Terminal</p>\n<p>輸入：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone authorize &quot;drive&quot; &quot;&lt;授權碼&gt;&quot;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone authorize &quot;drive&quot; &quot;&lt;授權碼&gt;&quot;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/image-2-1024x510.png\"></p>\n<p>這一步代表：你透過另一台有網頁瀏覽器的機器完成 Google OAuth 登入，再把結果回傳到伺服器。</p>\n<h2 id=\"Shared-Drive-是否要設定\"><a href=\"#Shared-Drive-是否要設定\" class=\"headerlink\" title=\"Shared Drive 是否要設定\"></a>Shared Drive 是否要設定</h2><p>畫面問：Configure this as a Shared Drive? y&#x2F;n&gt;</p>\n<p>你輸入：y</p>\n<p>代表問 Google Drive 是否有 Team Drive。<br>你沒有 Team Drive，所以顯示：No Shared Drives found</p>\n<h2 id=\"完成設定並儲存\"><a href=\"#完成設定並儲存\" class=\"headerlink\" title=\"完成設定並儲存\"></a>完成設定並儲存</h2><p>最後 rclone 問：Keep this “gdrive” remote?</p>\n<p>你輸入：y</p>\n<p>設定就正式完成。</p>\n<h2 id=\"測試-remote-是否正常\"><a href=\"#測試-remote-是否正常\" class=\"headerlink\" title=\"測試 remote 是否正常\"></a>測試 remote 是否正常</h2><p>你輸入：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone ls gdrive:</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rclone ls gdrive:</span><br></pre></td></tr></table></figure>\n\n<p>重點是要加冒號。執行後，你看到 Google Drive 裡全部的檔案列表。代表 gdrive remote 設定成功。</p>\n<p><img src=\"/images/image-3-1024x526.png\"></p>\n<h1 id=\"接著是-Shell-Script-與-cron-排程設定\"><a href=\"#接著是-Shell-Script-與-cron-排程設定\" class=\"headerlink\" title=\"接著是 Shell Script 與 cron 排程設定\"></a>接著是 Shell Script 與 cron 排程設定</h1><p>本備份系統用於在 Linux 伺服器上自動備份多個 WordPress 網站，包括：</p>\n<ul>\n<li><p>資料庫備份</p>\n</li>\n<li><p>WordPress 主程式備份（排除 uploads）</p>\n</li>\n<li><p>Uploads 獨立備份</p>\n</li>\n<li><p>上傳至 Google Drive</p>\n</li>\n<li><p>本機不保留備份檔案</p>\n</li>\n<li><p>由單一設定檔管理多個網站</p>\n</li>\n</ul>\n<p>備份工具：</p>\n<ul>\n<li><p>mysqldump</p>\n</li>\n<li><p>tar</p>\n</li>\n<li><p>rclone (Google Drive 備份上傳)</p>\n</li>\n<li><p>cron (排程)</p>\n</li>\n</ul>\n<h2 id=\"備份資料夾結構\"><a href=\"#備份資料夾結構\" class=\"headerlink\" title=\"備份資料夾結構\"></a>備份資料夾結構</h2><p>將建立以下結構：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/</span><br><span class=\"line\"> ├── config/</span><br><span class=\"line\"> │     └── sites.conf</span><br><span class=\"line\"> └── scripts/</span><br><span class=\"line\">       ├── backup-all.sh</span><br><span class=\"line\">       └── backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/</span><br><span class=\"line\"> ├── config/</span><br><span class=\"line\"> │     └── sites.conf</span><br><span class=\"line\"> └── scripts/</span><br><span class=\"line\">       ├── backup-all.sh</span><br><span class=\"line\">       └── backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建立系統目錄\"><a href=\"#建立系統目錄\" class=\"headerlink\" title=\"建立系統目錄\"></a>建立系統目錄</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /root/backup/config</span><br><span class=\"line\">sudo mkdir -p /root/backup/scripts</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /root/backup/config</span><br><span class=\"line\">sudo mkdir -p /root/backup/scripts</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"設定檔-sites-conf\"><a href=\"#設定檔-sites-conf\" class=\"headerlink\" title=\"設定檔 sites.conf\"></a>設定檔 sites.conf</h2><p>所有網站資訊集中管理於：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/config/sites.conf</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/config/sites.conf</span><br></pre></td></tr></table></figure>\n\n<p>格式如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># SITE_NAME | DB_NAME | DB_USER | DB_PASS | WP_PATH</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">stackpenguin|網頁對應的資料庫|資料庫使用者|密碼|網頁路徑</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># SITE_NAME | DB_NAME | DB_USER | DB_PASS | WP_PATH</span><br><span class=\"line\"></span><br><span class=\"line\">stackpenguin|網頁對應的資料庫|資料庫使用者|密碼|網頁路徑</span><br></pre></td></tr></table></figure>\n\n<p>若有多個站點，每行新增一筆資料即可。</p>\n<h2 id=\"Script：備份資料庫與-WordPress-主程式\"><a href=\"#Script：備份資料庫與-WordPress-主程式\" class=\"headerlink\" title=\"Script：備份資料庫與 WordPress 主程式\"></a>Script：備份資料庫與 WordPress 主程式</h2><p>檔案位置：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/scripts/backup-all.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/scripts/backup-all.sh</span><br></pre></td></tr></table></figure>\n\n<p>內容如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">CONFIG=&quot;/root/backup/config/sites.conf&quot;</span><br><span class=\"line\">DATE=$(date +&quot;%Y-%m-%d-%H%M&quot;)</span><br><span class=\"line\">REMOTE=&quot;gdrive&quot;</span><br><span class=\"line\">REMOTE_BASE=&quot;wordpress-backups&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">while IFS=&#x27;|&#x27; read -r SITE DB_NAME DB_USER DB_PASS WP_PATH</span><br><span class=\"line\">do</span><br><span class=\"line\">    # 跳過空行與註解行</span><br><span class=\"line\">    [[ -z &quot;$SITE&quot; || &quot;$SITE&quot; =~ ^# ]] &amp;&amp; continue</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;=====================================&quot;</span><br><span class=\"line\">    echo &quot;開始備份：$SITE（DB + 主程式）&quot;</span><br><span class=\"line\">    echo &quot;=====================================&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    TMP_DIR=&quot;/tmp/wp-backup-$&#123;SITE&#125;-$&#123;DATE&#125;&quot;</span><br><span class=\"line\">    mkdir -p &quot;$TMP_DIR&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 1. 備份資料庫（.sql）</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    DB_FILE=&quot;$TMP_DIR/db-$&#123;SITE&#125;-$&#123;DATE&#125;.sql&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 備份資料庫中…&quot;</span><br><span class=\"line\">    mysqldump --single-transaction --quick --skip-lock-tables \\</span><br><span class=\"line\">        -u&quot;$DB_USER&quot; -p&quot;$DB_PASS&quot; &quot;$DB_NAME&quot; &gt; &quot;$DB_FILE&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 上傳資料庫…（含進度）&quot;</span><br><span class=\"line\">    rclone copy &quot;$DB_FILE&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/&quot; -P</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 清除舊版資料庫備份…（保留最新 2 份）&quot;</span><br><span class=\"line\">    rclone ls &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/&quot; \\</span><br><span class=\"line\">        | sort -k2 \\</span><br><span class=\"line\">        | head -n -2 \\</span><br><span class=\"line\">        | awk &#x27;&#123;print $2&#125;&#x27; \\</span><br><span class=\"line\">        | while read OLD_FILE</span><br><span class=\"line\">    do</span><br><span class=\"line\">        echo &quot;刪除：$OLD_FILE&quot;</span><br><span class=\"line\">        rclone delete &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/$&#123;OLD_FILE&#125;&quot;</span><br><span class=\"line\">    done</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 2. 備份主程式（排除 uploads）</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    WP_FILE=&quot;$TMP_DIR/wp-$&#123;SITE&#125;-$&#123;DATE&#125;.tar.gz&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 壓縮 WordPress 主程式…（不含 uploads）&quot;</span><br><span class=\"line\">    tar -czf &quot;$WP_FILE&quot; \\</span><br><span class=\"line\">        --exclude=&quot;$&#123;WP_PATH&#125;/wp-content/uploads&quot; \\</span><br><span class=\"line\">        &quot;$WP_PATH&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 上傳主程式…（含進度）&quot;</span><br><span class=\"line\">    rclone copy &quot;$WP_FILE&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/&quot; -P</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;➤ 清除舊版主程式備份…（保留最新 2 份）&quot;</span><br><span class=\"line\">    rclone ls &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/&quot; \\</span><br><span class=\"line\">        | sort -k2 \\</span><br><span class=\"line\">        | head -n -2 \\</span><br><span class=\"line\">        | awk &#x27;&#123;print $2&#125;&#x27; \\</span><br><span class=\"line\">        | while read OLD_FILE</span><br><span class=\"line\">    do</span><br><span class=\"line\">        echo &quot;刪除：$OLD_FILE&quot;</span><br><span class=\"line\">        rclone delete &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/$&#123;OLD_FILE&#125;&quot;</span><br><span class=\"line\">    done</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 3. 清除暫存</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    rm -rf &quot;$TMP_DIR&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;=== $&#123;SITE&#125; 主程式與資料庫備份完成 ===&quot;</span><br><span class=\"line\">    echo &quot;&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">done &lt; &quot;$CONFIG&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">echo &quot;全部網站的 DB + 主程式備份已完成&quot;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">CONFIG=&quot;/root/backup/config/sites.conf&quot;</span><br><span class=\"line\">DATE=$(date +&quot;%Y-%m-%d-%H%M&quot;)</span><br><span class=\"line\">REMOTE=&quot;gdrive&quot;</span><br><span class=\"line\">REMOTE_BASE=&quot;wordpress-backups&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">while IFS=&#x27;|&#x27; read -r SITE DB_NAME DB_USER DB_PASS WP_PATH</span><br><span class=\"line\">do</span><br><span class=\"line\">    # 跳過空行與註解行</span><br><span class=\"line\">    [[ -z &quot;$SITE&quot; || &quot;$SITE&quot; =~ ^# ]] &amp;&amp; continue</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;=====================================&quot;</span><br><span class=\"line\">    echo &quot;開始備份：$SITE（DB + 主程式）&quot;</span><br><span class=\"line\">    echo &quot;=====================================&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    TMP_DIR=&quot;/tmp/wp-backup-$&#123;SITE&#125;-$&#123;DATE&#125;&quot;</span><br><span class=\"line\">    mkdir -p &quot;$TMP_DIR&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 1. 備份資料庫（.sql）</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    DB_FILE=&quot;$TMP_DIR/db-$&#123;SITE&#125;-$&#123;DATE&#125;.sql&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 備份資料庫中…&quot;</span><br><span class=\"line\">    mysqldump --single-transaction --quick --skip-lock-tables \\</span><br><span class=\"line\">        -u&quot;$DB_USER&quot; -p&quot;$DB_PASS&quot; &quot;$DB_NAME&quot; &gt; &quot;$DB_FILE&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 上傳資料庫…（含進度）&quot;</span><br><span class=\"line\">    rclone copy &quot;$DB_FILE&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/&quot; -P</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 清除舊版資料庫備份…（保留最新 2 份）&quot;</span><br><span class=\"line\">    rclone ls &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/&quot; \\</span><br><span class=\"line\">        | sort -k2 \\</span><br><span class=\"line\">        | head -n -2 \\</span><br><span class=\"line\">        | awk &#x27;&#123;print $2&#125;&#x27; \\</span><br><span class=\"line\">        | while read OLD_FILE</span><br><span class=\"line\">    do</span><br><span class=\"line\">        echo &quot;刪除：$OLD_FILE&quot;</span><br><span class=\"line\">        rclone delete &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/db/$&#123;OLD_FILE&#125;&quot;</span><br><span class=\"line\">    done</span><br><span class=\"line\"></span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 2. 備份主程式（排除 uploads）</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    WP_FILE=&quot;$TMP_DIR/wp-$&#123;SITE&#125;-$&#123;DATE&#125;.tar.gz&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 壓縮 WordPress 主程式…（不含 uploads）&quot;</span><br><span class=\"line\">    tar -czf &quot;$WP_FILE&quot; \\</span><br><span class=\"line\">        --exclude=&quot;$&#123;WP_PATH&#125;/wp-content/uploads&quot; \\</span><br><span class=\"line\">        &quot;$WP_PATH&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 上傳主程式…（含進度）&quot;</span><br><span class=\"line\">    rclone copy &quot;$WP_FILE&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/&quot; -P</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;➤ 清除舊版主程式備份…（保留最新 2 份）&quot;</span><br><span class=\"line\">    rclone ls &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/&quot; \\</span><br><span class=\"line\">        | sort -k2 \\</span><br><span class=\"line\">        | head -n -2 \\</span><br><span class=\"line\">        | awk &#x27;&#123;print $2&#125;&#x27; \\</span><br><span class=\"line\">        | while read OLD_FILE</span><br><span class=\"line\">    do</span><br><span class=\"line\">        echo &quot;刪除：$OLD_FILE&quot;</span><br><span class=\"line\">        rclone delete &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/main/$&#123;OLD_FILE&#125;&quot;</span><br><span class=\"line\">    done</span><br><span class=\"line\"></span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    # 3. 清除暫存</span><br><span class=\"line\">    #######################################</span><br><span class=\"line\">    rm -rf &quot;$TMP_DIR&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;=== $&#123;SITE&#125; 主程式與資料庫備份完成 ===&quot;</span><br><span class=\"line\">    echo &quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">done &lt; &quot;$CONFIG&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;全部網站的 DB + 主程式備份已完成&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Script：備份-uploads\"><a href=\"#Script：備份-uploads\" class=\"headerlink\" title=\"Script：備份 uploads\"></a>Script：備份 uploads</h2><p>檔案位置：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<p>內容如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">CONFIG=&quot;/root/backup/config/sites.conf&quot;</span><br><span class=\"line\">DATE=$(date +&quot;%Y-%m-%d-%H%M&quot;)</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">REMOTE=&quot;gdrive&quot;</span><br><span class=\"line\">REMOTE_BASE=&quot;wordpress-backups&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">while IFS=&#x27;|&#x27; read -r SITE DB_NAME DB_USER DB_PASS WP_PATH</span><br><span class=\"line\">do</span><br><span class=\"line\">    # 跳過空行與註解</span><br><span class=\"line\">    [[ -z &quot;$SITE&quot; || &quot;$SITE&quot; =~ ^# ]] &amp;&amp; continue</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    UPLOAD_PATH=&quot;$&#123;WP_PATH&#125;/wp-content/uploads&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;===============================&quot;</span><br><span class=\"line\">    echo &quot;開始備份 uploads：$&#123;SITE&#125;&quot;</span><br><span class=\"line\">    echo &quot;===============================&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    TMP_DIR=&quot;/tmp/wp-uploads-$&#123;SITE&#125;-$&#123;DATE&#125;&quot;</span><br><span class=\"line\">    mkdir -p &quot;$TMP_DIR&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    UPLOAD_FILE=&quot;$&#123;TMP_DIR&#125;/uploads-$&#123;SITE&#125;-$&#123;DATE&#125;.tar.gz&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    # 壓縮 uploads</span><br><span class=\"line\">    tar -czf &quot;$UPLOAD_FILE&quot; &quot;$UPLOAD_PATH&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    # 上傳至 Google Drive</span><br><span class=\"line\">    rclone copy &quot;$TMP_DIR&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/uploads/&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    # 刪除暫存資料</span><br><span class=\"line\">    rm -rf &quot;$TMP_DIR&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    echo &quot;=== $&#123;SITE&#125; uploads 備份完成 ===&quot;</span><br><span class=\"line\">    echo &quot;&quot;</span><br><span class=\"line\">done &lt; &quot;$CONFIG&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">echo &quot;所有網站 uploads 備份完成&quot;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">CONFIG=&quot;/root/backup/config/sites.conf&quot;</span><br><span class=\"line\">DATE=$(date +&quot;%Y-%m-%d-%H%M&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">REMOTE=&quot;gdrive&quot;</span><br><span class=\"line\">REMOTE_BASE=&quot;wordpress-backups&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">while IFS=&#x27;|&#x27; read -r SITE DB_NAME DB_USER DB_PASS WP_PATH</span><br><span class=\"line\">do</span><br><span class=\"line\">    # 跳過空行與註解</span><br><span class=\"line\">    [[ -z &quot;$SITE&quot; || &quot;$SITE&quot; =~ ^# ]] &amp;&amp; continue</span><br><span class=\"line\"></span><br><span class=\"line\">    UPLOAD_PATH=&quot;$&#123;WP_PATH&#125;/wp-content/uploads&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;===============================&quot;</span><br><span class=\"line\">    echo &quot;開始備份 uploads：$&#123;SITE&#125;&quot;</span><br><span class=\"line\">    echo &quot;===============================&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    TMP_DIR=&quot;/tmp/wp-uploads-$&#123;SITE&#125;-$&#123;DATE&#125;&quot;</span><br><span class=\"line\">    mkdir -p &quot;$TMP_DIR&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    UPLOAD_FILE=&quot;$&#123;TMP_DIR&#125;/uploads-$&#123;SITE&#125;-$&#123;DATE&#125;.tar.gz&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    # 壓縮 uploads</span><br><span class=\"line\">    tar -czf &quot;$UPLOAD_FILE&quot; &quot;$UPLOAD_PATH&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    # 上傳至 Google Drive</span><br><span class=\"line\">    rclone copy &quot;$TMP_DIR&quot; &quot;$&#123;REMOTE&#125;:/$&#123;REMOTE_BASE&#125;/$&#123;SITE&#125;/uploads/&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    # 刪除暫存資料</span><br><span class=\"line\">    rm -rf &quot;$TMP_DIR&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    echo &quot;=== $&#123;SITE&#125; uploads 備份完成 ===&quot;</span><br><span class=\"line\">    echo &quot;&quot;</span><br><span class=\"line\">done &lt; &quot;$CONFIG&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &quot;所有網站 uploads 備份完成&quot;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Script-權限設\"><a href=\"#Script-權限設\" class=\"headerlink\" title=\"Script 權限設\"></a>Script 權限設</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod +x /root/backup/scripts/backup-all.sh&lt;br&gt;sudo chmod +x /root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod +x /root/backup/scripts/backup-all.sh&lt;br&gt;sudo chmod +x /root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"排程-cron-設定\"><a href=\"#排程-cron-設定\" class=\"headerlink\" title=\"排程 cron 設定\"></a>排程 cron 設定</h2><p>設定 root cron：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo crontab -e</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo crontab -e</span><br></pre></td></tr></table></figure>\n\n<p>加入：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 每日凌晨 3 點：DB + 主程式備份</span><br><span class=\"line\">0 3 * * * /root/backup/scripts/backup-all.sh &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\"># 每週一凌晨 4 點：uploads 備份</span><br><span class=\"line\">0 4 * * 1 /root/backup/scripts/backup-uploads.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 每日凌晨 3 點：DB + 主程式備份</span><br><span class=\"line\">0 3 * * * /root/backup/scripts/backup-all.sh &gt;/dev/null 2&gt;&amp;1</span><br><span class=\"line\"></span><br><span class=\"line\"># 每週一凌晨 4 點：uploads 備份</span><br><span class=\"line\">0 4 * * 1 /root/backup/scripts/backup-uploads.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"測試備份流程\"><a href=\"#測試備份流程\" class=\"headerlink\" title=\"測試備份流程\"></a>測試備份流程</h2><h3 id=\"測試-DB-主程式\"><a href=\"#測試-DB-主程式\" class=\"headerlink\" title=\"測試 DB + 主程式\"></a>測試 DB + 主程式</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /root/backup/scripts/backup-all.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /root/backup/scripts/backup-all.sh</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"測試-uploads\"><a href=\"#測試-uploads\" class=\"headerlink\" title=\"測試 uploads\"></a>測試 uploads</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo /root/backup/scripts/backup-uploads.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"備份位置\"><a href=\"#備份位置\" class=\"headerlink\" title=\"備份位置\"></a>備份位置</h2><p>備份檔案將會出現在 Google Drive：</p>\n<p><img src=\"/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png\"></p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-15.00.18-1024x611.png\"></p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-15.00.44-1024x611.png\"></p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-15.01.04-1024x611.png\"></p>\n<h2 id=\"注意事項\"><a href=\"#注意事項\" class=\"headerlink\" title=\"注意事項\"></a>注意事項</h2><ol>\n<li><p>rclone remote 名稱必須為 gdrive，若不同需修改 script。</p>\n</li>\n<li><p>需要確保 WordPress 資料庫使用者具備 PROCESS 權限： <code>GRANT PROCESS ON *.* TO &#39;zhuangwp&#39;@&#39;localhost&#39;; FLUSH PRIVILEGES;</code></p>\n</li>\n<li><p>若新增網站，只需在 sites.conf 新增一行即可。</p>\n</li>\n<li><p>本機不會保留任何備份檔案，全部在 &#x2F;tmp 完成後會刪除。</p>\n</li>\n</ol>\n<p>我也試了備份的檔案能夠在本地恢復，可以閱讀這一篇。</p>\n<p><a href=\"https://cms.stackpenguin.com/2025/11/15/wp-restore-local/\">https://cms.stackpenguin.com/2025/11/15/wp-restore-local/</a></p>\n"},{"layout":"post","title":"Mac Docker 惡意軟體？","date":"2025-04-03T16:00:00.000Z","top_img":"/images/Docker.png","cover":"/images/Docker.png","_content":"\n參考：[MacOS 將 Docker 檢測為惡意軟體問題](https://andywangtw.dev/post/macos-%E5%B0%87-docker-%E6%AA%A2%E6%B8%AC%E7%82%BA%E6%83%A1%E6%84%8F%E8%BB%9F%E9%AB%94%E5%95%8F%E9%A1%8C/)\n\n* * *\n\n## 🔧 修復`com.docker.vmnetd`問題\n\n當你在 macOS 上啟動 Docker Desktop 時，可能會遇到如下錯誤訊息：\n\n> 「未打開 'com.docker.vmnetd'，因為它包含惡意軟體。」\n\n這是因為 macOS 的 Gatekeeper 誤判 Docker 的網路代理元件為惡意程式。以下步驟可以手動修復該問題，讓 Docker 能正常運作。\n\n* * *\n\n## 使用終端機手修復\n\n### 📌 步驟一：刪除現有的 Helper Tools\n\n打開「終端機」，輸入以下指令來移除出錯的元件：\n\n```\nsudo rm /Library/PrivilegedHelperTools/com.docker.vmnetdnsudo rm /Library/PrivilegedHelperTools/com.docker.socket\n```\n\nBash\n\n系統會要求你輸入密碼，請輸入你的 Mac 登入密碼（輸入時畫面不會顯示字元，屬正常現象）。\n\n* * *\n\n### 📌 步驟二：重新複製官方檔案\n\n從 Docker Desktop 應用程式中，重新將正確的 `com.docker.vmnetd` 複製回系統目錄：\n\n```\nsudo cp /Applications/Docker.app/Contents/Library/LaunchServices/com.docker.vmnetd /Library/PrivilegedHelperTools/\n```\n\nBash\n","source":"_posts/mac-docker-error.md","raw":"---\nlayout: post\ntitle: Mac Docker 惡意軟體？\ndate: 2025-04-04\ntags:\ncategories:\n  - \"docker\"\ntop_img: /images/Docker.png\ncover: /images/Docker.png\n---\n\n參考：[MacOS 將 Docker 檢測為惡意軟體問題](https://andywangtw.dev/post/macos-%E5%B0%87-docker-%E6%AA%A2%E6%B8%AC%E7%82%BA%E6%83%A1%E6%84%8F%E8%BB%9F%E9%AB%94%E5%95%8F%E9%A1%8C/)\n\n* * *\n\n## 🔧 修復`com.docker.vmnetd`問題\n\n當你在 macOS 上啟動 Docker Desktop 時，可能會遇到如下錯誤訊息：\n\n> 「未打開 'com.docker.vmnetd'，因為它包含惡意軟體。」\n\n這是因為 macOS 的 Gatekeeper 誤判 Docker 的網路代理元件為惡意程式。以下步驟可以手動修復該問題，讓 Docker 能正常運作。\n\n* * *\n\n## 使用終端機手修復\n\n### 📌 步驟一：刪除現有的 Helper Tools\n\n打開「終端機」，輸入以下指令來移除出錯的元件：\n\n```\nsudo rm /Library/PrivilegedHelperTools/com.docker.vmnetdnsudo rm /Library/PrivilegedHelperTools/com.docker.socket\n```\n\nBash\n\n系統會要求你輸入密碼，請輸入你的 Mac 登入密碼（輸入時畫面不會顯示字元，屬正常現象）。\n\n* * *\n\n### 📌 步驟二：重新複製官方檔案\n\n從 Docker Desktop 應用程式中，重新將正確的 `com.docker.vmnetd` 複製回系統目錄：\n\n```\nsudo cp /Applications/Docker.app/Contents/Library/LaunchServices/com.docker.vmnetd /Library/PrivilegedHelperTools/\n```\n\nBash\n","slug":"mac-docker-error","published":1,"updated":"2026-01-28T14:17:25.064Z","_id":"cmkxg0kru000jrb8z6m0nfmey","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>參考：<a href=\"https://andywangtw.dev/post/macos-%E5%B0%87-docker-%E6%AA%A2%E6%B8%AC%E7%82%BA%E6%83%A1%E6%84%8F%E8%BB%9F%E9%AB%94%E5%95%8F%E9%A1%8C/\">MacOS 將 Docker 檢測為惡意軟體問題</a></p>\n<hr>\n<h2 id=\"🔧-修復com-docker-vmnetd問題\"><a href=\"#🔧-修復com-docker-vmnetd問題\" class=\"headerlink\" title=\"🔧 修復com.docker.vmnetd問題\"></a>🔧 修復<code>com.docker.vmnetd</code>問題</h2><p>當你在 macOS 上啟動 Docker Desktop 時，可能會遇到如下錯誤訊息：</p>\n<blockquote>\n<p>「未打開 ‘com.docker.vmnetd’，因為它包含惡意軟體。」</p>\n</blockquote>\n<p>這是因為 macOS 的 Gatekeeper 誤判 Docker 的網路代理元件為惡意程式。以下步驟可以手動修復該問題，讓 Docker 能正常運作。</p>\n<hr>\n<h2 id=\"使用終端機手修復\"><a href=\"#使用終端機手修復\" class=\"headerlink\" title=\"使用終端機手修復\"></a>使用終端機手修復</h2><h3 id=\"📌-步驟一：刪除現有的-Helper-Tools\"><a href=\"#📌-步驟一：刪除現有的-Helper-Tools\" class=\"headerlink\" title=\"📌 步驟一：刪除現有的 Helper Tools\"></a>📌 步驟一：刪除現有的 Helper Tools</h3><p>打開「終端機」，輸入以下指令來移除出錯的元件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm /Library/PrivilegedHelperTools/com.docker.vmnetdnsudo rm /Library/PrivilegedHelperTools/com.docker.socket</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>系統會要求你輸入密碼，請輸入你的 Mac 登入密碼（輸入時畫面不會顯示字元，屬正常現象）。</p>\n<hr>\n<h3 id=\"📌-步驟二：重新複製官方檔案\"><a href=\"#📌-步驟二：重新複製官方檔案\" class=\"headerlink\" title=\"📌 步驟二：重新複製官方檔案\"></a>📌 步驟二：重新複製官方檔案</h3><p>從 Docker Desktop 應用程式中，重新將正確的 <code>com.docker.vmnetd</code> 複製回系統目錄：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cp /Applications/Docker.app/Contents/Library/LaunchServices/com.docker.vmnetd /Library/PrivilegedHelperTools/</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n","excerpt":"","more":"<p>參考：<a href=\"https://andywangtw.dev/post/macos-%E5%B0%87-docker-%E6%AA%A2%E6%B8%AC%E7%82%BA%E6%83%A1%E6%84%8F%E8%BB%9F%E9%AB%94%E5%95%8F%E9%A1%8C/\">MacOS 將 Docker 檢測為惡意軟體問題</a></p>\n<hr>\n<h2 id=\"🔧-修復com-docker-vmnetd問題\"><a href=\"#🔧-修復com-docker-vmnetd問題\" class=\"headerlink\" title=\"🔧 修復com.docker.vmnetd問題\"></a>🔧 修復<code>com.docker.vmnetd</code>問題</h2><p>當你在 macOS 上啟動 Docker Desktop 時，可能會遇到如下錯誤訊息：</p>\n<blockquote>\n<p>「未打開 ‘com.docker.vmnetd’，因為它包含惡意軟體。」</p>\n</blockquote>\n<p>這是因為 macOS 的 Gatekeeper 誤判 Docker 的網路代理元件為惡意程式。以下步驟可以手動修復該問題，讓 Docker 能正常運作。</p>\n<hr>\n<h2 id=\"使用終端機手修復\"><a href=\"#使用終端機手修復\" class=\"headerlink\" title=\"使用終端機手修復\"></a>使用終端機手修復</h2><h3 id=\"📌-步驟一：刪除現有的-Helper-Tools\"><a href=\"#📌-步驟一：刪除現有的-Helper-Tools\" class=\"headerlink\" title=\"📌 步驟一：刪除現有的 Helper Tools\"></a>📌 步驟一：刪除現有的 Helper Tools</h3><p>打開「終端機」，輸入以下指令來移除出錯的元件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm /Library/PrivilegedHelperTools/com.docker.vmnetdnsudo rm /Library/PrivilegedHelperTools/com.docker.socket</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n<p>系統會要求你輸入密碼，請輸入你的 Mac 登入密碼（輸入時畫面不會顯示字元，屬正常現象）。</p>\n<hr>\n<h3 id=\"📌-步驟二：重新複製官方檔案\"><a href=\"#📌-步驟二：重新複製官方檔案\" class=\"headerlink\" title=\"📌 步驟二：重新複製官方檔案\"></a>📌 步驟二：重新複製官方檔案</h3><p>從 Docker Desktop 應用程式中，重新將正確的 <code>com.docker.vmnetd</code> 複製回系統目錄：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cp /Applications/Docker.app/Contents/Library/LaunchServices/com.docker.vmnetd /Library/PrivilegedHelperTools/</span><br></pre></td></tr></table></figure>\n\n<p>Bash</p>\n"},{"layout":"post","title":"Yolov9 實作練習","date":"2025-10-25T16:00:00.000Z","top_img":"/images/YOLOv9.png","cover":"/images/YOLOv9.png","_content":"\n內容全參考影片 : [https://www.youtube.com/watch?v=tMwyxKttZd0&t=60s](https://www.youtube.com/watch?v=tMwyxKttZd0&t=60s)\n\n![](/images/image-10.png)\n\n首先建立一個Conda的虛擬環境，之後進入後先下載labelImg。\n\n```\n(Labelimg) C:\\Users\\pudy6>pip install labelImg\n```\n\n```\n(Labelimg) C:\\Users\\pudy6>pip install labelImg\n```\n\n如果labelImg閃退，建議不用進到虛擬環境，直接去下載[LabelImg](https://github.com/HumanSignal/labelImg/releases)。\n\n![](/images/image-11-1024x594.png)\n\n建立一個dataset資料夾\n\n```\ndataset\n├─images\n│  ├─test(測試集)\n│  ├─train(訓練集)\n│  └─val(驗證集)\n└─labels\n    ├─test\n    ├─train\n    └─val\n```\n\n```\ndataset\n├─images\n│  ├─test(測試集)\n│  ├─train(訓練集)\n│  └─val(驗證集)\n└─labels\n    ├─test\n    ├─train\n    └─val\n```\n\n8:1:1\n\n![](/images/image-12-1024x594.png)\n\n點擊Open Dir打開訓練集的圖片資料夾。\n\n![](/images/image-26.png)\n\n![](/images/image-14-1024x594.png)\n\n接著要選擇剛剛資料夾中的Label資料夾\n\n![](/images/image-25.png)\n\n![](/images/image-16-1024x594.png)\n\n![](/images/image-17-1024x593.png)\n\n要改成YOLO的格式，就可以開始框了\n\n![](/images/image-18-1024x542.png)\n\n建議開啟這兩個。\n\n接著下載[yolov9](https://github.com/WongKinYiu/yolov9)的專案包，解壓縮後進入資料夾。\n\n我將yolov9-main改為yolov9，依據個人喜好。\n\n```\n(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9>pip install -r requirements.txt\n```\n\n```\n(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9>pip install -r requirements.txt\n```\n\n接著安裝相關套件，然後進入到PyTorch依據自己的版本下載。\n\n![](/images/image-21-1024x459.png)\n\n![](/images/image-19.png)\n\n安裝的過程我們可以先將dataset搬到data底下。\n\n![](/images/image-20-1024x664.png)\n\n接著更改coco.yaml這支檔案我將它改名為datasets.yaml。\n\n![](/images/image-22-1024x554.png)\n\n### train.py 參數解析：\n\n| 參數 | 你目前設定值 | 說明 |\n| --- | --- | --- |\n| `--weights` | `yolov9-c-converted.pt` | 預訓練權重（模型初始值） |\n| `--data` | `data/datasets.yaml` | 資料集配置（train/val 路徑與類別） |\n| `--hyp` | `data/hyps/hyp.scratch-high.yaml` | 超參數設定（學習率、增強等） |\n| `--epochs` | `100` | 訓練回合數 |\n| `--batch-size` | `4` | 每次訓練批次（因為 GPU 6GB 限制） |\n| `--img` | `512` | 訓練圖片大小（寬高） |\n| `--device` | `0` | 使用 GPU 0（RTX 2060） |\n| `--workers` | `1` | 資料載入執行緒數量（Windows 建議設低） |\n| `--cache` | 開啟 | 預先載入影像，加快訓練速度 |\n| `--optimizer` | 預設 `SGD` | 最佳化器（可改為 Adam / AdamW） |\n| `--freeze` | `[0]` | 不凍結層（全部訓練） |\n| `--single-cls` | False | 多類別訓練 |\n| `--project` | `runs/train` | 輸出資料夾 |\n| `--name` | `exp7` | 訓練結果名稱 |\n| `--save-period` | `-1` | 不定期保存模型（僅保存最佳/最後） |\n| `--noval` | False | 每個 epoch 都驗證 |\n| `--patience` | `100` | 提前停止條件（未改） |\n\n### 超參數檔（hyp.scratch-high.yaml）主要內容：\n\n| 超參數 | 你目前設定 | 說明 |\n| --- | --- | --- |\n| `lr0` | 0.01 | 初始學習率 |\n| `lrf` | 0.01 | 最終學習率比例 |\n| `momentum` | 0.937 | 動量（影響更新穩定性） |\n| `weight_decay` | 0.0005 | 權重衰減（防止過擬合） |\n| `box` | 7.5 | 邊界框損失權重 |\n| `cls` | 0.5 | 類別損失權重 |\n| `obj` | 0.7 | 物件置信度損失權重 |\n| `iou_t` | 0.2 | IoU 閾值 |\n| `fl_gamma` | 0.0 | Focal Loss 參數 |\n| `hsv_h/s/v` | 0.015 / 0.7 / 0.4 | 顏色增強（色相、飽和度、亮度） |\n| `translate` | 0.1 | 平移比例 |\n| `scale` | 0.9 | 縮放比例 |\n| `mixup` | 0.15 | 圖像混合比例 |\n| `copy_paste` | 0.3 | 分割貼上比例 |\n\n調整完後就可以開始訓練。\n\n![](/images/image-23-1024x448.png)\n\n## 二、驗證指令 val.py\n\n```\n(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9>python val.py\n```\n\n```\n(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9>python val.py\n```\n\n跑完後你會在runs\\\\val\\\\exp2看到驗證後的圖像。\n\n![](/images/image-24-1024x604.png)\n\n## YOLOv9 訓練相關問題\n\n### ❌ 問題 1：`File not found: data/hyps/hyp.scratch-low.yaml`\n\n**原因：** 檔案路徑錯誤或名稱不一致。\n\n**✅ 解法：**  \n確定你有這些檔案：\n\n```\nyolov9/data/hyps/hyp.scratch-low.yaml\nyolov9/data/hyps/hyp.scratch-high.yaml\n```\n\n```\nyolov9/data/hyps/hyp.scratch-low.yaml\nyolov9/data/hyps/hyp.scratch-high.yaml\n```\n\n如果沒有，從官方 repo 重新下載或複製一份。\n","source":"_posts/yolov9-practice.md","raw":"---\nlayout: post\ntitle: Yolov9 實作練習\ndate: 2025-10-26\ntags:\ncategories:\n  - \"ai\"\n  - \"pytorch\"\ntop_img: /images/YOLOv9.png\ncover: /images/YOLOv9.png\n---\n\n內容全參考影片 : [https://www.youtube.com/watch?v=tMwyxKttZd0&t=60s](https://www.youtube.com/watch?v=tMwyxKttZd0&t=60s)\n\n![](/images/image-10.png)\n\n首先建立一個Conda的虛擬環境，之後進入後先下載labelImg。\n\n```\n(Labelimg) C:\\Users\\pudy6>pip install labelImg\n```\n\n```\n(Labelimg) C:\\Users\\pudy6>pip install labelImg\n```\n\n如果labelImg閃退，建議不用進到虛擬環境，直接去下載[LabelImg](https://github.com/HumanSignal/labelImg/releases)。\n\n![](/images/image-11-1024x594.png)\n\n建立一個dataset資料夾\n\n```\ndataset\n├─images\n│  ├─test(測試集)\n│  ├─train(訓練集)\n│  └─val(驗證集)\n└─labels\n    ├─test\n    ├─train\n    └─val\n```\n\n```\ndataset\n├─images\n│  ├─test(測試集)\n│  ├─train(訓練集)\n│  └─val(驗證集)\n└─labels\n    ├─test\n    ├─train\n    └─val\n```\n\n8:1:1\n\n![](/images/image-12-1024x594.png)\n\n點擊Open Dir打開訓練集的圖片資料夾。\n\n![](/images/image-26.png)\n\n![](/images/image-14-1024x594.png)\n\n接著要選擇剛剛資料夾中的Label資料夾\n\n![](/images/image-25.png)\n\n![](/images/image-16-1024x594.png)\n\n![](/images/image-17-1024x593.png)\n\n要改成YOLO的格式，就可以開始框了\n\n![](/images/image-18-1024x542.png)\n\n建議開啟這兩個。\n\n接著下載[yolov9](https://github.com/WongKinYiu/yolov9)的專案包，解壓縮後進入資料夾。\n\n我將yolov9-main改為yolov9，依據個人喜好。\n\n```\n(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9>pip install -r requirements.txt\n```\n\n```\n(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9>pip install -r requirements.txt\n```\n\n接著安裝相關套件，然後進入到PyTorch依據自己的版本下載。\n\n![](/images/image-21-1024x459.png)\n\n![](/images/image-19.png)\n\n安裝的過程我們可以先將dataset搬到data底下。\n\n![](/images/image-20-1024x664.png)\n\n接著更改coco.yaml這支檔案我將它改名為datasets.yaml。\n\n![](/images/image-22-1024x554.png)\n\n### train.py 參數解析：\n\n| 參數 | 你目前設定值 | 說明 |\n| --- | --- | --- |\n| `--weights` | `yolov9-c-converted.pt` | 預訓練權重（模型初始值） |\n| `--data` | `data/datasets.yaml` | 資料集配置（train/val 路徑與類別） |\n| `--hyp` | `data/hyps/hyp.scratch-high.yaml` | 超參數設定（學習率、增強等） |\n| `--epochs` | `100` | 訓練回合數 |\n| `--batch-size` | `4` | 每次訓練批次（因為 GPU 6GB 限制） |\n| `--img` | `512` | 訓練圖片大小（寬高） |\n| `--device` | `0` | 使用 GPU 0（RTX 2060） |\n| `--workers` | `1` | 資料載入執行緒數量（Windows 建議設低） |\n| `--cache` | 開啟 | 預先載入影像，加快訓練速度 |\n| `--optimizer` | 預設 `SGD` | 最佳化器（可改為 Adam / AdamW） |\n| `--freeze` | `[0]` | 不凍結層（全部訓練） |\n| `--single-cls` | False | 多類別訓練 |\n| `--project` | `runs/train` | 輸出資料夾 |\n| `--name` | `exp7` | 訓練結果名稱 |\n| `--save-period` | `-1` | 不定期保存模型（僅保存最佳/最後） |\n| `--noval` | False | 每個 epoch 都驗證 |\n| `--patience` | `100` | 提前停止條件（未改） |\n\n### 超參數檔（hyp.scratch-high.yaml）主要內容：\n\n| 超參數 | 你目前設定 | 說明 |\n| --- | --- | --- |\n| `lr0` | 0.01 | 初始學習率 |\n| `lrf` | 0.01 | 最終學習率比例 |\n| `momentum` | 0.937 | 動量（影響更新穩定性） |\n| `weight_decay` | 0.0005 | 權重衰減（防止過擬合） |\n| `box` | 7.5 | 邊界框損失權重 |\n| `cls` | 0.5 | 類別損失權重 |\n| `obj` | 0.7 | 物件置信度損失權重 |\n| `iou_t` | 0.2 | IoU 閾值 |\n| `fl_gamma` | 0.0 | Focal Loss 參數 |\n| `hsv_h/s/v` | 0.015 / 0.7 / 0.4 | 顏色增強（色相、飽和度、亮度） |\n| `translate` | 0.1 | 平移比例 |\n| `scale` | 0.9 | 縮放比例 |\n| `mixup` | 0.15 | 圖像混合比例 |\n| `copy_paste` | 0.3 | 分割貼上比例 |\n\n調整完後就可以開始訓練。\n\n![](/images/image-23-1024x448.png)\n\n## 二、驗證指令 val.py\n\n```\n(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9>python val.py\n```\n\n```\n(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9>python val.py\n```\n\n跑完後你會在runs\\\\val\\\\exp2看到驗證後的圖像。\n\n![](/images/image-24-1024x604.png)\n\n## YOLOv9 訓練相關問題\n\n### ❌ 問題 1：`File not found: data/hyps/hyp.scratch-low.yaml`\n\n**原因：** 檔案路徑錯誤或名稱不一致。\n\n**✅ 解法：**  \n確定你有這些檔案：\n\n```\nyolov9/data/hyps/hyp.scratch-low.yaml\nyolov9/data/hyps/hyp.scratch-high.yaml\n```\n\n```\nyolov9/data/hyps/hyp.scratch-low.yaml\nyolov9/data/hyps/hyp.scratch-high.yaml\n```\n\n如果沒有，從官方 repo 重新下載或複製一份。\n","slug":"yolov9-practice","published":1,"updated":"2026-01-28T14:17:25.069Z","_id":"cmkxg0kru000mrb8z2vwa2log","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>內容全參考影片 : <a href=\"https://www.youtube.com/watch?v=tMwyxKttZd0&t=60s\">https://www.youtube.com/watch?v=tMwyxKttZd0&t=60s</a></p>\n<p><img src=\"/images/image-10.png\"></p>\n<p>首先建立一個Conda的虛擬環境，之後進入後先下載labelImg。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6&gt;pip install labelImg</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6&gt;pip install labelImg</span><br></pre></td></tr></table></figure>\n\n<p>如果labelImg閃退，建議不用進到虛擬環境，直接去下載<a href=\"https://github.com/HumanSignal/labelImg/releases\">LabelImg</a>。</p>\n<p><img src=\"/images/image-11-1024x594.png\"></p>\n<p>建立一個dataset資料夾</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataset</span><br><span class=\"line\">├─images</span><br><span class=\"line\">│  ├─test(測試集)</span><br><span class=\"line\">│  ├─train(訓練集)</span><br><span class=\"line\">│  └─val(驗證集)</span><br><span class=\"line\">└─labels</span><br><span class=\"line\">    ├─test</span><br><span class=\"line\">    ├─train</span><br><span class=\"line\">    └─val</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataset</span><br><span class=\"line\">├─images</span><br><span class=\"line\">│  ├─test(測試集)</span><br><span class=\"line\">│  ├─train(訓練集)</span><br><span class=\"line\">│  └─val(驗證集)</span><br><span class=\"line\">└─labels</span><br><span class=\"line\">    ├─test</span><br><span class=\"line\">    ├─train</span><br><span class=\"line\">    └─val</span><br></pre></td></tr></table></figure>\n\n<p>8:1:1</p>\n<p><img src=\"/images/image-12-1024x594.png\"></p>\n<p>點擊Open Dir打開訓練集的圖片資料夾。</p>\n<p><img src=\"/images/image-26.png\"></p>\n<p><img src=\"/images/image-14-1024x594.png\"></p>\n<p>接著要選擇剛剛資料夾中的Label資料夾</p>\n<p><img src=\"/images/image-25.png\"></p>\n<p><img src=\"/images/image-16-1024x594.png\"></p>\n<p><img src=\"/images/image-17-1024x593.png\"></p>\n<p>要改成YOLO的格式，就可以開始框了</p>\n<p><img src=\"/images/image-18-1024x542.png\"></p>\n<p>建議開啟這兩個。</p>\n<p>接著下載<a href=\"https://github.com/WongKinYiu/yolov9\">yolov9</a>的專案包，解壓縮後進入資料夾。</p>\n<p>我將yolov9-main改為yolov9，依據個人喜好。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9&gt;pip install -r requirements.txt</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9&gt;pip install -r requirements.txt</span><br></pre></td></tr></table></figure>\n\n<p>接著安裝相關套件，然後進入到PyTorch依據自己的版本下載。</p>\n<p><img src=\"/images/image-21-1024x459.png\"></p>\n<p><img src=\"/images/image-19.png\"></p>\n<p>安裝的過程我們可以先將dataset搬到data底下。</p>\n<p><img src=\"/images/image-20-1024x664.png\"></p>\n<p>接著更改coco.yaml這支檔案我將它改名為datasets.yaml。</p>\n<p><img src=\"/images/image-22-1024x554.png\"></p>\n<h3 id=\"train-py-參數解析：\"><a href=\"#train-py-參數解析：\" class=\"headerlink\" title=\"train.py 參數解析：\"></a>train.py 參數解析：</h3><table>\n<thead>\n<tr>\n<th>參數</th>\n<th>你目前設定值</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>--weights</code></td>\n<td><code>yolov9-c-converted.pt</code></td>\n<td>預訓練權重（模型初始值）</td>\n</tr>\n<tr>\n<td><code>--data</code></td>\n<td><code>data/datasets.yaml</code></td>\n<td>資料集配置（train&#x2F;val 路徑與類別）</td>\n</tr>\n<tr>\n<td><code>--hyp</code></td>\n<td><code>data/hyps/hyp.scratch-high.yaml</code></td>\n<td>超參數設定（學習率、增強等）</td>\n</tr>\n<tr>\n<td><code>--epochs</code></td>\n<td><code>100</code></td>\n<td>訓練回合數</td>\n</tr>\n<tr>\n<td><code>--batch-size</code></td>\n<td><code>4</code></td>\n<td>每次訓練批次（因為 GPU 6GB 限制）</td>\n</tr>\n<tr>\n<td><code>--img</code></td>\n<td><code>512</code></td>\n<td>訓練圖片大小（寬高）</td>\n</tr>\n<tr>\n<td><code>--device</code></td>\n<td><code>0</code></td>\n<td>使用 GPU 0（RTX 2060）</td>\n</tr>\n<tr>\n<td><code>--workers</code></td>\n<td><code>1</code></td>\n<td>資料載入執行緒數量（Windows 建議設低）</td>\n</tr>\n<tr>\n<td><code>--cache</code></td>\n<td>開啟</td>\n<td>預先載入影像，加快訓練速度</td>\n</tr>\n<tr>\n<td><code>--optimizer</code></td>\n<td>預設 <code>SGD</code></td>\n<td>最佳化器（可改為 Adam &#x2F; AdamW）</td>\n</tr>\n<tr>\n<td><code>--freeze</code></td>\n<td><code>[0]</code></td>\n<td>不凍結層（全部訓練）</td>\n</tr>\n<tr>\n<td><code>--single-cls</code></td>\n<td>False</td>\n<td>多類別訓練</td>\n</tr>\n<tr>\n<td><code>--project</code></td>\n<td><code>runs/train</code></td>\n<td>輸出資料夾</td>\n</tr>\n<tr>\n<td><code>--name</code></td>\n<td><code>exp7</code></td>\n<td>訓練結果名稱</td>\n</tr>\n<tr>\n<td><code>--save-period</code></td>\n<td><code>-1</code></td>\n<td>不定期保存模型（僅保存最佳&#x2F;最後）</td>\n</tr>\n<tr>\n<td><code>--noval</code></td>\n<td>False</td>\n<td>每個 epoch 都驗證</td>\n</tr>\n<tr>\n<td><code>--patience</code></td>\n<td><code>100</code></td>\n<td>提前停止條件（未改）</td>\n</tr>\n</tbody></table>\n<h3 id=\"超參數檔（hyp-scratch-high-yaml）主要內容：\"><a href=\"#超參數檔（hyp-scratch-high-yaml）主要內容：\" class=\"headerlink\" title=\"超參數檔（hyp.scratch-high.yaml）主要內容：\"></a>超參數檔（hyp.scratch-high.yaml）主要內容：</h3><table>\n<thead>\n<tr>\n<th>超參數</th>\n<th>你目前設定</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>lr0</code></td>\n<td>0.01</td>\n<td>初始學習率</td>\n</tr>\n<tr>\n<td><code>lrf</code></td>\n<td>0.01</td>\n<td>最終學習率比例</td>\n</tr>\n<tr>\n<td><code>momentum</code></td>\n<td>0.937</td>\n<td>動量（影響更新穩定性）</td>\n</tr>\n<tr>\n<td><code>weight_decay</code></td>\n<td>0.0005</td>\n<td>權重衰減（防止過擬合）</td>\n</tr>\n<tr>\n<td><code>box</code></td>\n<td>7.5</td>\n<td>邊界框損失權重</td>\n</tr>\n<tr>\n<td><code>cls</code></td>\n<td>0.5</td>\n<td>類別損失權重</td>\n</tr>\n<tr>\n<td><code>obj</code></td>\n<td>0.7</td>\n<td>物件置信度損失權重</td>\n</tr>\n<tr>\n<td><code>iou_t</code></td>\n<td>0.2</td>\n<td>IoU 閾值</td>\n</tr>\n<tr>\n<td><code>fl_gamma</code></td>\n<td>0.0</td>\n<td>Focal Loss 參數</td>\n</tr>\n<tr>\n<td><code>hsv_h/s/v</code></td>\n<td>0.015 &#x2F; 0.7 &#x2F; 0.4</td>\n<td>顏色增強（色相、飽和度、亮度）</td>\n</tr>\n<tr>\n<td><code>translate</code></td>\n<td>0.1</td>\n<td>平移比例</td>\n</tr>\n<tr>\n<td><code>scale</code></td>\n<td>0.9</td>\n<td>縮放比例</td>\n</tr>\n<tr>\n<td><code>mixup</code></td>\n<td>0.15</td>\n<td>圖像混合比例</td>\n</tr>\n<tr>\n<td><code>copy_paste</code></td>\n<td>0.3</td>\n<td>分割貼上比例</td>\n</tr>\n</tbody></table>\n<p>調整完後就可以開始訓練。</p>\n<p><img src=\"/images/image-23-1024x448.png\"></p>\n<h2 id=\"二、驗證指令-val-py\"><a href=\"#二、驗證指令-val-py\" class=\"headerlink\" title=\"二、驗證指令 val.py\"></a>二、驗證指令 val.py</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9&gt;python val.py</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9&gt;python val.py</span><br></pre></td></tr></table></figure>\n\n<p>跑完後你會在runs\\val\\exp2看到驗證後的圖像。</p>\n<p><img src=\"/images/image-24-1024x604.png\"></p>\n<h2 id=\"YOLOv9-訓練相關問題\"><a href=\"#YOLOv9-訓練相關問題\" class=\"headerlink\" title=\"YOLOv9 訓練相關問題\"></a>YOLOv9 訓練相關問題</h2><h3 id=\"❌-問題-1：File-not-found-data-hyps-hyp-scratch-low-yaml\"><a href=\"#❌-問題-1：File-not-found-data-hyps-hyp-scratch-low-yaml\" class=\"headerlink\" title=\"❌ 問題 1：File not found: data/hyps/hyp.scratch-low.yaml\"></a>❌ 問題 1：<code>File not found: data/hyps/hyp.scratch-low.yaml</code></h3><p><strong>原因：</strong> 檔案路徑錯誤或名稱不一致。</p>\n<p><strong>✅ 解法：</strong><br>確定你有這些檔案：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yolov9/data/hyps/hyp.scratch-low.yaml</span><br><span class=\"line\">yolov9/data/hyps/hyp.scratch-high.yaml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yolov9/data/hyps/hyp.scratch-low.yaml</span><br><span class=\"line\">yolov9/data/hyps/hyp.scratch-high.yaml</span><br></pre></td></tr></table></figure>\n\n<p>如果沒有，從官方 repo 重新下載或複製一份。</p>\n","excerpt":"","more":"<p>內容全參考影片 : <a href=\"https://www.youtube.com/watch?v=tMwyxKttZd0&t=60s\">https://www.youtube.com/watch?v=tMwyxKttZd0&t=60s</a></p>\n<p><img src=\"/images/image-10.png\"></p>\n<p>首先建立一個Conda的虛擬環境，之後進入後先下載labelImg。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6&gt;pip install labelImg</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6&gt;pip install labelImg</span><br></pre></td></tr></table></figure>\n\n<p>如果labelImg閃退，建議不用進到虛擬環境，直接去下載<a href=\"https://github.com/HumanSignal/labelImg/releases\">LabelImg</a>。</p>\n<p><img src=\"/images/image-11-1024x594.png\"></p>\n<p>建立一個dataset資料夾</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataset</span><br><span class=\"line\">├─images</span><br><span class=\"line\">│  ├─test(測試集)</span><br><span class=\"line\">│  ├─train(訓練集)</span><br><span class=\"line\">│  └─val(驗證集)</span><br><span class=\"line\">└─labels</span><br><span class=\"line\">    ├─test</span><br><span class=\"line\">    ├─train</span><br><span class=\"line\">    └─val</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dataset</span><br><span class=\"line\">├─images</span><br><span class=\"line\">│  ├─test(測試集)</span><br><span class=\"line\">│  ├─train(訓練集)</span><br><span class=\"line\">│  └─val(驗證集)</span><br><span class=\"line\">└─labels</span><br><span class=\"line\">    ├─test</span><br><span class=\"line\">    ├─train</span><br><span class=\"line\">    └─val</span><br></pre></td></tr></table></figure>\n\n<p>8:1:1</p>\n<p><img src=\"/images/image-12-1024x594.png\"></p>\n<p>點擊Open Dir打開訓練集的圖片資料夾。</p>\n<p><img src=\"/images/image-26.png\"></p>\n<p><img src=\"/images/image-14-1024x594.png\"></p>\n<p>接著要選擇剛剛資料夾中的Label資料夾</p>\n<p><img src=\"/images/image-25.png\"></p>\n<p><img src=\"/images/image-16-1024x594.png\"></p>\n<p><img src=\"/images/image-17-1024x593.png\"></p>\n<p>要改成YOLO的格式，就可以開始框了</p>\n<p><img src=\"/images/image-18-1024x542.png\"></p>\n<p>建議開啟這兩個。</p>\n<p>接著下載<a href=\"https://github.com/WongKinYiu/yolov9\">yolov9</a>的專案包，解壓縮後進入資料夾。</p>\n<p>我將yolov9-main改為yolov9，依據個人喜好。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9&gt;pip install -r requirements.txt</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9&gt;pip install -r requirements.txt</span><br></pre></td></tr></table></figure>\n\n<p>接著安裝相關套件，然後進入到PyTorch依據自己的版本下載。</p>\n<p><img src=\"/images/image-21-1024x459.png\"></p>\n<p><img src=\"/images/image-19.png\"></p>\n<p>安裝的過程我們可以先將dataset搬到data底下。</p>\n<p><img src=\"/images/image-20-1024x664.png\"></p>\n<p>接著更改coco.yaml這支檔案我將它改名為datasets.yaml。</p>\n<p><img src=\"/images/image-22-1024x554.png\"></p>\n<h3 id=\"train-py-參數解析：\"><a href=\"#train-py-參數解析：\" class=\"headerlink\" title=\"train.py 參數解析：\"></a>train.py 參數解析：</h3><table>\n<thead>\n<tr>\n<th>參數</th>\n<th>你目前設定值</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>--weights</code></td>\n<td><code>yolov9-c-converted.pt</code></td>\n<td>預訓練權重（模型初始值）</td>\n</tr>\n<tr>\n<td><code>--data</code></td>\n<td><code>data/datasets.yaml</code></td>\n<td>資料集配置（train&#x2F;val 路徑與類別）</td>\n</tr>\n<tr>\n<td><code>--hyp</code></td>\n<td><code>data/hyps/hyp.scratch-high.yaml</code></td>\n<td>超參數設定（學習率、增強等）</td>\n</tr>\n<tr>\n<td><code>--epochs</code></td>\n<td><code>100</code></td>\n<td>訓練回合數</td>\n</tr>\n<tr>\n<td><code>--batch-size</code></td>\n<td><code>4</code></td>\n<td>每次訓練批次（因為 GPU 6GB 限制）</td>\n</tr>\n<tr>\n<td><code>--img</code></td>\n<td><code>512</code></td>\n<td>訓練圖片大小（寬高）</td>\n</tr>\n<tr>\n<td><code>--device</code></td>\n<td><code>0</code></td>\n<td>使用 GPU 0（RTX 2060）</td>\n</tr>\n<tr>\n<td><code>--workers</code></td>\n<td><code>1</code></td>\n<td>資料載入執行緒數量（Windows 建議設低）</td>\n</tr>\n<tr>\n<td><code>--cache</code></td>\n<td>開啟</td>\n<td>預先載入影像，加快訓練速度</td>\n</tr>\n<tr>\n<td><code>--optimizer</code></td>\n<td>預設 <code>SGD</code></td>\n<td>最佳化器（可改為 Adam &#x2F; AdamW）</td>\n</tr>\n<tr>\n<td><code>--freeze</code></td>\n<td><code>[0]</code></td>\n<td>不凍結層（全部訓練）</td>\n</tr>\n<tr>\n<td><code>--single-cls</code></td>\n<td>False</td>\n<td>多類別訓練</td>\n</tr>\n<tr>\n<td><code>--project</code></td>\n<td><code>runs/train</code></td>\n<td>輸出資料夾</td>\n</tr>\n<tr>\n<td><code>--name</code></td>\n<td><code>exp7</code></td>\n<td>訓練結果名稱</td>\n</tr>\n<tr>\n<td><code>--save-period</code></td>\n<td><code>-1</code></td>\n<td>不定期保存模型（僅保存最佳&#x2F;最後）</td>\n</tr>\n<tr>\n<td><code>--noval</code></td>\n<td>False</td>\n<td>每個 epoch 都驗證</td>\n</tr>\n<tr>\n<td><code>--patience</code></td>\n<td><code>100</code></td>\n<td>提前停止條件（未改）</td>\n</tr>\n</tbody></table>\n<h3 id=\"超參數檔（hyp-scratch-high-yaml）主要內容：\"><a href=\"#超參數檔（hyp-scratch-high-yaml）主要內容：\" class=\"headerlink\" title=\"超參數檔（hyp.scratch-high.yaml）主要內容：\"></a>超參數檔（hyp.scratch-high.yaml）主要內容：</h3><table>\n<thead>\n<tr>\n<th>超參數</th>\n<th>你目前設定</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>lr0</code></td>\n<td>0.01</td>\n<td>初始學習率</td>\n</tr>\n<tr>\n<td><code>lrf</code></td>\n<td>0.01</td>\n<td>最終學習率比例</td>\n</tr>\n<tr>\n<td><code>momentum</code></td>\n<td>0.937</td>\n<td>動量（影響更新穩定性）</td>\n</tr>\n<tr>\n<td><code>weight_decay</code></td>\n<td>0.0005</td>\n<td>權重衰減（防止過擬合）</td>\n</tr>\n<tr>\n<td><code>box</code></td>\n<td>7.5</td>\n<td>邊界框損失權重</td>\n</tr>\n<tr>\n<td><code>cls</code></td>\n<td>0.5</td>\n<td>類別損失權重</td>\n</tr>\n<tr>\n<td><code>obj</code></td>\n<td>0.7</td>\n<td>物件置信度損失權重</td>\n</tr>\n<tr>\n<td><code>iou_t</code></td>\n<td>0.2</td>\n<td>IoU 閾值</td>\n</tr>\n<tr>\n<td><code>fl_gamma</code></td>\n<td>0.0</td>\n<td>Focal Loss 參數</td>\n</tr>\n<tr>\n<td><code>hsv_h/s/v</code></td>\n<td>0.015 &#x2F; 0.7 &#x2F; 0.4</td>\n<td>顏色增強（色相、飽和度、亮度）</td>\n</tr>\n<tr>\n<td><code>translate</code></td>\n<td>0.1</td>\n<td>平移比例</td>\n</tr>\n<tr>\n<td><code>scale</code></td>\n<td>0.9</td>\n<td>縮放比例</td>\n</tr>\n<tr>\n<td><code>mixup</code></td>\n<td>0.15</td>\n<td>圖像混合比例</td>\n</tr>\n<tr>\n<td><code>copy_paste</code></td>\n<td>0.3</td>\n<td>分割貼上比例</td>\n</tr>\n</tbody></table>\n<p>調整完後就可以開始訓練。</p>\n<p><img src=\"/images/image-23-1024x448.png\"></p>\n<h2 id=\"二、驗證指令-val-py\"><a href=\"#二、驗證指令-val-py\" class=\"headerlink\" title=\"二、驗證指令 val.py\"></a>二、驗證指令 val.py</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9&gt;python val.py</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Labelimg) C:\\Users\\pudy6\\Desktop\\yolov9&gt;python val.py</span><br></pre></td></tr></table></figure>\n\n<p>跑完後你會在runs\\val\\exp2看到驗證後的圖像。</p>\n<p><img src=\"/images/image-24-1024x604.png\"></p>\n<h2 id=\"YOLOv9-訓練相關問題\"><a href=\"#YOLOv9-訓練相關問題\" class=\"headerlink\" title=\"YOLOv9 訓練相關問題\"></a>YOLOv9 訓練相關問題</h2><h3 id=\"❌-問題-1：File-not-found-data-hyps-hyp-scratch-low-yaml\"><a href=\"#❌-問題-1：File-not-found-data-hyps-hyp-scratch-low-yaml\" class=\"headerlink\" title=\"❌ 問題 1：File not found: data/hyps/hyp.scratch-low.yaml\"></a>❌ 問題 1：<code>File not found: data/hyps/hyp.scratch-low.yaml</code></h3><p><strong>原因：</strong> 檔案路徑錯誤或名稱不一致。</p>\n<p><strong>✅ 解法：</strong><br>確定你有這些檔案：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yolov9/data/hyps/hyp.scratch-low.yaml</span><br><span class=\"line\">yolov9/data/hyps/hyp.scratch-high.yaml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yolov9/data/hyps/hyp.scratch-low.yaml</span><br><span class=\"line\">yolov9/data/hyps/hyp.scratch-high.yaml</span><br></pre></td></tr></table></figure>\n\n<p>如果沒有，從官方 repo 重新下載或複製一份。</p>\n"},{"layout":"post","title":"如何用雲端備份在本地 Local 重建 WordPress","date":"2025-11-14T16:00:00.000Z","top_img":"/images/Gemini_Generated_Image_vfctf8vfctf8vfct.png","cover":"/images/Gemini_Generated_Image_vfctf8vfctf8vfct.png","_content":"\n閱讀這篇文章之前，必須先操作上一篇文章的內容。\n\n[https://stackpenguin.com/blog/wp-cron-backup](https://stackpenguin.com/blog/wp-cron-backup)\n\n我在我的macbook筆電建立一個Local的測試機名字取為BackupReview。\n\n本文章的目的是將我的Linode主機備份後的WordPress檔案，匯入到本地端做測試。\n\n廢話不多說馬上開始吧！\n\n## 下載備份檔案\n\n![](/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png)\n\ndb資料庫的.sql檔案。\n\nmain的話是wp-content所有內容。\n\nuploads包含圖片與檔案，或是其他外掛的檔案內容都在這裡。\n\n這三個內容只要缺一個，就沒辦法完整復原。\n\n## 建立測試機\n\n![](/images/CleanShot-2025-11-15-at-11.44.53@2x-1024x632.png)\n\n先看一下有沒有成功跑起來，看來是有。\n\n接下來要開始復原我的網頁到本地端。\n\n![](/images/CleanShot-2025-11-15-at-12.02.52-1024x611.png)\n\n## 匯入資料庫\n\n來到Database這邊，按下Open AdminNeo就會打開資料庫介面。\n\n![](/images/CleanShot-2025-11-15-at-12.09.41@2x-1024x632.png)\n\n進到資料庫頁面點擊 Local Site: BackupReview 跳轉到資料庫首頁。\n\n![](/images/CleanShot-2025-11-15-at-12.17.01-1024x611.png)\n\n建立資料庫，對應你網站的資料庫名稱，我的是wp\\_zhuangblog。\n\n記得要改成自己的。\n\n![](/images/CleanShot-2025-11-15-at-12.20.47-1024x228.png)\n\n創建完成後要匯入備份的sql檔案。\n\n![](/images/CleanShot-2025-11-15-at-12.21.44-1024x277.png)\n\n執行後會顯示成功匯入，並在左側顯示所有資料表。\n\n![](/images/CleanShot-2025-11-15-at-12.23.00-1024x611.png)\n\n## Local sites 檔案設定\n\n首先回到Local頁面，按下Site folder會進直接跳進你的網頁資料夾．\n\n![](/images/CleanShot-2025-11-15-at-12.24.17@2x-1024x632.png)\n\n將public裡面的所有檔案都先刪除，因為要把備份的轉進來。\n\n![](/images/CleanShot-2025-11-15-at-12.28.08@2x-1024x599.png)\n\n![](/images/CleanShot-2025-11-15-at-12.29.00@2x-1024x599.png)\n\n接著去你備份的main資料夾解壓縮，之後複製所有檔案\n\n![](/images/CleanShot-2025-11-15-at-12.29.35@2x-1024x599.png)\n\n把它複製到剛剛的本地網頁資料夾\n\n![](/images/CleanShot-2025-11-15-at-12.32.25@2x-1024x599.png)\n\n然後我們要修改wp-config.php這一個檔案\n\n![](/images/CleanShot-2025-11-15-at-12.36.18@2x-1024x599.png)\n\n這六個要修正，對應你的資料庫名稱，資料庫帳密，以及本地網址。\n\n```\ndefine( 'DB_NAME', 'wp_zhuangblog' );\n<div></div>\n/** Database username */\ndefine( 'DB_USER', 'root' );\n<div></div>\n/** Database password */\ndefine( 'DB_PASSWORD', 'root' );\n<div></div>\n/** Database hostname */\ndefine( 'DB_HOST', 'localhost' );\n<div></div>\ndefine('WP_HOME', 'http://backupreview.local');\ndefine('WP_SITEURL', 'http://backupreview.local');\n```\n\n```\ndefine( 'DB_NAME', 'wp_zhuangblog' );\n\n/** Database username */\ndefine( 'DB_USER', 'root' );\n\n/** Database password */\ndefine( 'DB_PASSWORD', 'root' );\n\n/** Database hostname */\ndefine( 'DB_HOST', 'localhost' );\n\ndefine('WP_HOME', 'http://backupreview.local');\ndefine('WP_SITEURL', 'http://backupreview.local');\n```\n\n改完之後要重啟一次，資料庫才會被更改。\n\n否則他不會連到本地測試網站。\n\n![](/images/CleanShot-2025-11-15-at-12.48.01@2x-1024x632.png)\n\n然後就可以點擊Open site連到本地網頁裡了。\n\n有時候瀏覽器會因為某些插件，會有快取。\n\n可能會導致之前的網址被記錄下來。\n\n如果進去還是連到正式機網址，那可以開啟無痕模式輸入網址的方式進去。\n\n進去後發現ㄟ ！樣式怎麼都沒有套進來？這是正常的，因為還沒將uploads資料夾放到wp-content。\n\n![](/images/CleanShot-2025-11-15-at-13.26.07-1024x583.png)\n\n這是我備份的uploads資料夾，要把它移動到本地的wp-content資料夾中。\n\n![](/images/CleanShot-2025-11-15-at-13.40.02@2x-1024x599.png)\n\n先將原來的uploads刪除，然後把剛剛的uploads貼過來。\n\n![](/images/CleanShot-2025-11-15-at-13.41.36@2x-1024x606.png)\n\n再過看剛剛的頁面是不是就成功了！\n\n![](/images/CleanShot-2025-11-15-at-13.44.41-1024x611.png)\n\n![](/images/CleanShot-2025-11-15-at-13.44.56-1024x611.png)\n\n以上就是這次的教學。\n","source":"_posts/wp-restore-local.md","raw":"---\nlayout: post\ntitle: 如何用雲端備份在本地 Local 重建 WordPress\ndate: 2025-11-15\ntags:\ncategories:\n  - \"wordpress\"\ntop_img: /images/Gemini_Generated_Image_vfctf8vfctf8vfct.png\ncover: /images/Gemini_Generated_Image_vfctf8vfctf8vfct.png\n---\n\n閱讀這篇文章之前，必須先操作上一篇文章的內容。\n\n[https://stackpenguin.com/blog/wp-cron-backup](https://stackpenguin.com/blog/wp-cron-backup)\n\n我在我的macbook筆電建立一個Local的測試機名字取為BackupReview。\n\n本文章的目的是將我的Linode主機備份後的WordPress檔案，匯入到本地端做測試。\n\n廢話不多說馬上開始吧！\n\n## 下載備份檔案\n\n![](/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png)\n\ndb資料庫的.sql檔案。\n\nmain的話是wp-content所有內容。\n\nuploads包含圖片與檔案，或是其他外掛的檔案內容都在這裡。\n\n這三個內容只要缺一個，就沒辦法完整復原。\n\n## 建立測試機\n\n![](/images/CleanShot-2025-11-15-at-11.44.53@2x-1024x632.png)\n\n先看一下有沒有成功跑起來，看來是有。\n\n接下來要開始復原我的網頁到本地端。\n\n![](/images/CleanShot-2025-11-15-at-12.02.52-1024x611.png)\n\n## 匯入資料庫\n\n來到Database這邊，按下Open AdminNeo就會打開資料庫介面。\n\n![](/images/CleanShot-2025-11-15-at-12.09.41@2x-1024x632.png)\n\n進到資料庫頁面點擊 Local Site: BackupReview 跳轉到資料庫首頁。\n\n![](/images/CleanShot-2025-11-15-at-12.17.01-1024x611.png)\n\n建立資料庫，對應你網站的資料庫名稱，我的是wp\\_zhuangblog。\n\n記得要改成自己的。\n\n![](/images/CleanShot-2025-11-15-at-12.20.47-1024x228.png)\n\n創建完成後要匯入備份的sql檔案。\n\n![](/images/CleanShot-2025-11-15-at-12.21.44-1024x277.png)\n\n執行後會顯示成功匯入，並在左側顯示所有資料表。\n\n![](/images/CleanShot-2025-11-15-at-12.23.00-1024x611.png)\n\n## Local sites 檔案設定\n\n首先回到Local頁面，按下Site folder會進直接跳進你的網頁資料夾．\n\n![](/images/CleanShot-2025-11-15-at-12.24.17@2x-1024x632.png)\n\n將public裡面的所有檔案都先刪除，因為要把備份的轉進來。\n\n![](/images/CleanShot-2025-11-15-at-12.28.08@2x-1024x599.png)\n\n![](/images/CleanShot-2025-11-15-at-12.29.00@2x-1024x599.png)\n\n接著去你備份的main資料夾解壓縮，之後複製所有檔案\n\n![](/images/CleanShot-2025-11-15-at-12.29.35@2x-1024x599.png)\n\n把它複製到剛剛的本地網頁資料夾\n\n![](/images/CleanShot-2025-11-15-at-12.32.25@2x-1024x599.png)\n\n然後我們要修改wp-config.php這一個檔案\n\n![](/images/CleanShot-2025-11-15-at-12.36.18@2x-1024x599.png)\n\n這六個要修正，對應你的資料庫名稱，資料庫帳密，以及本地網址。\n\n```\ndefine( 'DB_NAME', 'wp_zhuangblog' );\n<div></div>\n/** Database username */\ndefine( 'DB_USER', 'root' );\n<div></div>\n/** Database password */\ndefine( 'DB_PASSWORD', 'root' );\n<div></div>\n/** Database hostname */\ndefine( 'DB_HOST', 'localhost' );\n<div></div>\ndefine('WP_HOME', 'http://backupreview.local');\ndefine('WP_SITEURL', 'http://backupreview.local');\n```\n\n```\ndefine( 'DB_NAME', 'wp_zhuangblog' );\n\n/** Database username */\ndefine( 'DB_USER', 'root' );\n\n/** Database password */\ndefine( 'DB_PASSWORD', 'root' );\n\n/** Database hostname */\ndefine( 'DB_HOST', 'localhost' );\n\ndefine('WP_HOME', 'http://backupreview.local');\ndefine('WP_SITEURL', 'http://backupreview.local');\n```\n\n改完之後要重啟一次，資料庫才會被更改。\n\n否則他不會連到本地測試網站。\n\n![](/images/CleanShot-2025-11-15-at-12.48.01@2x-1024x632.png)\n\n然後就可以點擊Open site連到本地網頁裡了。\n\n有時候瀏覽器會因為某些插件，會有快取。\n\n可能會導致之前的網址被記錄下來。\n\n如果進去還是連到正式機網址，那可以開啟無痕模式輸入網址的方式進去。\n\n進去後發現ㄟ ！樣式怎麼都沒有套進來？這是正常的，因為還沒將uploads資料夾放到wp-content。\n\n![](/images/CleanShot-2025-11-15-at-13.26.07-1024x583.png)\n\n這是我備份的uploads資料夾，要把它移動到本地的wp-content資料夾中。\n\n![](/images/CleanShot-2025-11-15-at-13.40.02@2x-1024x599.png)\n\n先將原來的uploads刪除，然後把剛剛的uploads貼過來。\n\n![](/images/CleanShot-2025-11-15-at-13.41.36@2x-1024x606.png)\n\n再過看剛剛的頁面是不是就成功了！\n\n![](/images/CleanShot-2025-11-15-at-13.44.41-1024x611.png)\n\n![](/images/CleanShot-2025-11-15-at-13.44.56-1024x611.png)\n\n以上就是這次的教學。\n","slug":"wp-restore-local","published":1,"updated":"2026-01-28T14:17:25.069Z","_id":"cmkxg0krv000zrb8z7gxsd8dw","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>閱讀這篇文章之前，必須先操作上一篇文章的內容。</p>\n<p><a href=\"https://stackpenguin.com/blog/wp-cron-backup\">https://stackpenguin.com/blog/wp-cron-backup</a></p>\n<p>我在我的macbook筆電建立一個Local的測試機名字取為BackupReview。</p>\n<p>本文章的目的是將我的Linode主機備份後的WordPress檔案，匯入到本地端做測試。</p>\n<p>廢話不多說馬上開始吧！</p>\n<h2 id=\"下載備份檔案\"><a href=\"#下載備份檔案\" class=\"headerlink\" title=\"下載備份檔案\"></a>下載備份檔案</h2><p><img src=\"/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png\"></p>\n<p>db資料庫的.sql檔案。</p>\n<p>main的話是wp-content所有內容。</p>\n<p>uploads包含圖片與檔案，或是其他外掛的檔案內容都在這裡。</p>\n<p>這三個內容只要缺一個，就沒辦法完整復原。</p>\n<h2 id=\"建立測試機\"><a href=\"#建立測試機\" class=\"headerlink\" title=\"建立測試機\"></a>建立測試機</h2><p><img src=\"/images/CleanShot-2025-11-15-at-11.44.53@2x-1024x632.png\"></p>\n<p>先看一下有沒有成功跑起來，看來是有。</p>\n<p>接下來要開始復原我的網頁到本地端。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.02.52-1024x611.png\"></p>\n<h2 id=\"匯入資料庫\"><a href=\"#匯入資料庫\" class=\"headerlink\" title=\"匯入資料庫\"></a>匯入資料庫</h2><p>來到Database這邊，按下Open AdminNeo就會打開資料庫介面。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.09.41@2x-1024x632.png\"></p>\n<p>進到資料庫頁面點擊 Local Site: BackupReview 跳轉到資料庫首頁。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.17.01-1024x611.png\"></p>\n<p>建立資料庫，對應你網站的資料庫名稱，我的是wp_zhuangblog。</p>\n<p>記得要改成自己的。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.20.47-1024x228.png\"></p>\n<p>創建完成後要匯入備份的sql檔案。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.21.44-1024x277.png\"></p>\n<p>執行後會顯示成功匯入，並在左側顯示所有資料表。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.23.00-1024x611.png\"></p>\n<h2 id=\"Local-sites-檔案設定\"><a href=\"#Local-sites-檔案設定\" class=\"headerlink\" title=\"Local sites 檔案設定\"></a>Local sites 檔案設定</h2><p>首先回到Local頁面，按下Site folder會進直接跳進你的網頁資料夾．</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.24.17@2x-1024x632.png\"></p>\n<p>將public裡面的所有檔案都先刪除，因為要把備份的轉進來。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.28.08@2x-1024x599.png\"></p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.29.00@2x-1024x599.png\"></p>\n<p>接著去你備份的main資料夾解壓縮，之後複製所有檔案</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.29.35@2x-1024x599.png\"></p>\n<p>把它複製到剛剛的本地網頁資料夾</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.32.25@2x-1024x599.png\"></p>\n<p>然後我們要修改wp-config.php這一個檔案</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.36.18@2x-1024x599.png\"></p>\n<p>這六個要修正，對應你的資料庫名稱，資料庫帳密，以及本地網址。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define( &#x27;DB_NAME&#x27;, &#x27;wp_zhuangblog&#x27; );</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">/** Database username */</span><br><span class=\"line\">define( &#x27;DB_USER&#x27;, &#x27;root&#x27; );</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">/** Database password */</span><br><span class=\"line\">define( &#x27;DB_PASSWORD&#x27;, &#x27;root&#x27; );</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">/** Database hostname */</span><br><span class=\"line\">define( &#x27;DB_HOST&#x27;, &#x27;localhost&#x27; );</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">define(&#x27;WP_HOME&#x27;, &#x27;http://backupreview.local&#x27;);</span><br><span class=\"line\">define(&#x27;WP_SITEURL&#x27;, &#x27;http://backupreview.local&#x27;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define( &#x27;DB_NAME&#x27;, &#x27;wp_zhuangblog&#x27; );</span><br><span class=\"line\"></span><br><span class=\"line\">/** Database username */</span><br><span class=\"line\">define( &#x27;DB_USER&#x27;, &#x27;root&#x27; );</span><br><span class=\"line\"></span><br><span class=\"line\">/** Database password */</span><br><span class=\"line\">define( &#x27;DB_PASSWORD&#x27;, &#x27;root&#x27; );</span><br><span class=\"line\"></span><br><span class=\"line\">/** Database hostname */</span><br><span class=\"line\">define( &#x27;DB_HOST&#x27;, &#x27;localhost&#x27; );</span><br><span class=\"line\"></span><br><span class=\"line\">define(&#x27;WP_HOME&#x27;, &#x27;http://backupreview.local&#x27;);</span><br><span class=\"line\">define(&#x27;WP_SITEURL&#x27;, &#x27;http://backupreview.local&#x27;);</span><br></pre></td></tr></table></figure>\n\n<p>改完之後要重啟一次，資料庫才會被更改。</p>\n<p>否則他不會連到本地測試網站。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.48.01@2x-1024x632.png\"></p>\n<p>然後就可以點擊Open site連到本地網頁裡了。</p>\n<p>有時候瀏覽器會因為某些插件，會有快取。</p>\n<p>可能會導致之前的網址被記錄下來。</p>\n<p>如果進去還是連到正式機網址，那可以開啟無痕模式輸入網址的方式進去。</p>\n<p>進去後發現ㄟ ！樣式怎麼都沒有套進來？這是正常的，因為還沒將uploads資料夾放到wp-content。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-13.26.07-1024x583.png\"></p>\n<p>這是我備份的uploads資料夾，要把它移動到本地的wp-content資料夾中。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-13.40.02@2x-1024x599.png\"></p>\n<p>先將原來的uploads刪除，然後把剛剛的uploads貼過來。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-13.41.36@2x-1024x606.png\"></p>\n<p>再過看剛剛的頁面是不是就成功了！</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-13.44.41-1024x611.png\"></p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-13.44.56-1024x611.png\"></p>\n<p>以上就是這次的教學。</p>\n","excerpt":"","more":"<p>閱讀這篇文章之前，必須先操作上一篇文章的內容。</p>\n<p><a href=\"https://stackpenguin.com/blog/wp-cron-backup\">https://stackpenguin.com/blog/wp-cron-backup</a></p>\n<p>我在我的macbook筆電建立一個Local的測試機名字取為BackupReview。</p>\n<p>本文章的目的是將我的Linode主機備份後的WordPress檔案，匯入到本地端做測試。</p>\n<p>廢話不多說馬上開始吧！</p>\n<h2 id=\"下載備份檔案\"><a href=\"#下載備份檔案\" class=\"headerlink\" title=\"下載備份檔案\"></a>下載備份檔案</h2><p><img src=\"/images/CleanShot-2025-11-14-at-18.10.07@2x-1024x482.png\"></p>\n<p>db資料庫的.sql檔案。</p>\n<p>main的話是wp-content所有內容。</p>\n<p>uploads包含圖片與檔案，或是其他外掛的檔案內容都在這裡。</p>\n<p>這三個內容只要缺一個，就沒辦法完整復原。</p>\n<h2 id=\"建立測試機\"><a href=\"#建立測試機\" class=\"headerlink\" title=\"建立測試機\"></a>建立測試機</h2><p><img src=\"/images/CleanShot-2025-11-15-at-11.44.53@2x-1024x632.png\"></p>\n<p>先看一下有沒有成功跑起來，看來是有。</p>\n<p>接下來要開始復原我的網頁到本地端。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.02.52-1024x611.png\"></p>\n<h2 id=\"匯入資料庫\"><a href=\"#匯入資料庫\" class=\"headerlink\" title=\"匯入資料庫\"></a>匯入資料庫</h2><p>來到Database這邊，按下Open AdminNeo就會打開資料庫介面。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.09.41@2x-1024x632.png\"></p>\n<p>進到資料庫頁面點擊 Local Site: BackupReview 跳轉到資料庫首頁。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.17.01-1024x611.png\"></p>\n<p>建立資料庫，對應你網站的資料庫名稱，我的是wp_zhuangblog。</p>\n<p>記得要改成自己的。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.20.47-1024x228.png\"></p>\n<p>創建完成後要匯入備份的sql檔案。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.21.44-1024x277.png\"></p>\n<p>執行後會顯示成功匯入，並在左側顯示所有資料表。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.23.00-1024x611.png\"></p>\n<h2 id=\"Local-sites-檔案設定\"><a href=\"#Local-sites-檔案設定\" class=\"headerlink\" title=\"Local sites 檔案設定\"></a>Local sites 檔案設定</h2><p>首先回到Local頁面，按下Site folder會進直接跳進你的網頁資料夾．</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.24.17@2x-1024x632.png\"></p>\n<p>將public裡面的所有檔案都先刪除，因為要把備份的轉進來。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.28.08@2x-1024x599.png\"></p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.29.00@2x-1024x599.png\"></p>\n<p>接著去你備份的main資料夾解壓縮，之後複製所有檔案</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.29.35@2x-1024x599.png\"></p>\n<p>把它複製到剛剛的本地網頁資料夾</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.32.25@2x-1024x599.png\"></p>\n<p>然後我們要修改wp-config.php這一個檔案</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.36.18@2x-1024x599.png\"></p>\n<p>這六個要修正，對應你的資料庫名稱，資料庫帳密，以及本地網址。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define( &#x27;DB_NAME&#x27;, &#x27;wp_zhuangblog&#x27; );</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">/** Database username */</span><br><span class=\"line\">define( &#x27;DB_USER&#x27;, &#x27;root&#x27; );</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">/** Database password */</span><br><span class=\"line\">define( &#x27;DB_PASSWORD&#x27;, &#x27;root&#x27; );</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">/** Database hostname */</span><br><span class=\"line\">define( &#x27;DB_HOST&#x27;, &#x27;localhost&#x27; );</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">define(&#x27;WP_HOME&#x27;, &#x27;http://backupreview.local&#x27;);</span><br><span class=\"line\">define(&#x27;WP_SITEURL&#x27;, &#x27;http://backupreview.local&#x27;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">define( &#x27;DB_NAME&#x27;, &#x27;wp_zhuangblog&#x27; );</span><br><span class=\"line\"></span><br><span class=\"line\">/** Database username */</span><br><span class=\"line\">define( &#x27;DB_USER&#x27;, &#x27;root&#x27; );</span><br><span class=\"line\"></span><br><span class=\"line\">/** Database password */</span><br><span class=\"line\">define( &#x27;DB_PASSWORD&#x27;, &#x27;root&#x27; );</span><br><span class=\"line\"></span><br><span class=\"line\">/** Database hostname */</span><br><span class=\"line\">define( &#x27;DB_HOST&#x27;, &#x27;localhost&#x27; );</span><br><span class=\"line\"></span><br><span class=\"line\">define(&#x27;WP_HOME&#x27;, &#x27;http://backupreview.local&#x27;);</span><br><span class=\"line\">define(&#x27;WP_SITEURL&#x27;, &#x27;http://backupreview.local&#x27;);</span><br></pre></td></tr></table></figure>\n\n<p>改完之後要重啟一次，資料庫才會被更改。</p>\n<p>否則他不會連到本地測試網站。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-12.48.01@2x-1024x632.png\"></p>\n<p>然後就可以點擊Open site連到本地網頁裡了。</p>\n<p>有時候瀏覽器會因為某些插件，會有快取。</p>\n<p>可能會導致之前的網址被記錄下來。</p>\n<p>如果進去還是連到正式機網址，那可以開啟無痕模式輸入網址的方式進去。</p>\n<p>進去後發現ㄟ ！樣式怎麼都沒有套進來？這是正常的，因為還沒將uploads資料夾放到wp-content。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-13.26.07-1024x583.png\"></p>\n<p>這是我備份的uploads資料夾，要把它移動到本地的wp-content資料夾中。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-13.40.02@2x-1024x599.png\"></p>\n<p>先將原來的uploads刪除，然後把剛剛的uploads貼過來。</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-13.41.36@2x-1024x606.png\"></p>\n<p>再過看剛剛的頁面是不是就成功了！</p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-13.44.41-1024x611.png\"></p>\n<p><img src=\"/images/CleanShot-2025-11-15-at-13.44.56-1024x611.png\"></p>\n<p>以上就是這次的教學。</p>\n"},{"layout":"post","title":"利率＆殖利率","date":"2025-11-23T16:00:00.000Z","top_img":"/images/image-12.png","cover":"/images/image-12.png","_content":"\n我是一點基礎概念都沒有的小菜機，希望從今天開始慢慢的增加一些有關投資的相關知識。\n\n基金、股票、保險、定存\n\n利率都是評估獲利的關鍵\n\n利率和殖利率差異？\n\n## 利率 （通常以一年為計算單位）又稱年利率\n\n假設年利率是1%，代表存滿一年可以獲得1%的利息\n\n如果定存時間只設定三個月（1/4年）\n\n![](/images/image-4.png)\n\n假設將10000元放入銀行，年利率1%，放12個月跟放6個月分別如下：\n\n![](/images/image-5.png)\n\n![](/images/image-6.png)\n\n通常時間越短的年利率也相對較低。\n\n如果原本跟銀行講好的定存時間是一年，年利率1%，結果只存了六個月就要用這筆錢。\n\n必須要提前解約，這時候利息變成：\n\n![](/images/image-7-1024x136.png)\n\n## 殖利率（浮動）\n\n舉個例子像是100塊的本金可以拿到5%的利息。\n\n![](/images/image-9.png)\n\n但是本金有可能隨時變大變小，但是利息在一段時間是固定不變的。\n\n假設有一個股票100塊，年利率5塊。\n\n![](/images/image-11.png)\n\n說不定隔天又漲10塊\n\n參考影片：[https://www.youtube.com/watch?v=yd3fZRrjzGM&list=PLrZrfGLGySzcZoVhb4idy5B0XI25ZhnF7&index=1](https://www.youtube.com/watch?v=yd3fZRrjzGM&list=PLrZrfGLGySzcZoVhb4idy5B0XI25ZhnF7&index=1)\n","source":"_posts/interest-and-yield.md","raw":"---\nlayout: post\ntitle: 利率＆殖利率\ndate: 2025-11-24\ntags:\n  - \"利率\"\n  - \"殖利率\"\ncategories:\n  - \"financial\"\ntop_img: /images/image-12.png\ncover: /images/image-12.png\n---\n\n我是一點基礎概念都沒有的小菜機，希望從今天開始慢慢的增加一些有關投資的相關知識。\n\n基金、股票、保險、定存\n\n利率都是評估獲利的關鍵\n\n利率和殖利率差異？\n\n## 利率 （通常以一年為計算單位）又稱年利率\n\n假設年利率是1%，代表存滿一年可以獲得1%的利息\n\n如果定存時間只設定三個月（1/4年）\n\n![](/images/image-4.png)\n\n假設將10000元放入銀行，年利率1%，放12個月跟放6個月分別如下：\n\n![](/images/image-5.png)\n\n![](/images/image-6.png)\n\n通常時間越短的年利率也相對較低。\n\n如果原本跟銀行講好的定存時間是一年，年利率1%，結果只存了六個月就要用這筆錢。\n\n必須要提前解約，這時候利息變成：\n\n![](/images/image-7-1024x136.png)\n\n## 殖利率（浮動）\n\n舉個例子像是100塊的本金可以拿到5%的利息。\n\n![](/images/image-9.png)\n\n但是本金有可能隨時變大變小，但是利息在一段時間是固定不變的。\n\n假設有一個股票100塊，年利率5塊。\n\n![](/images/image-11.png)\n\n說不定隔天又漲10塊\n\n參考影片：[https://www.youtube.com/watch?v=yd3fZRrjzGM&list=PLrZrfGLGySzcZoVhb4idy5B0XI25ZhnF7&index=1](https://www.youtube.com/watch?v=yd3fZRrjzGM&list=PLrZrfGLGySzcZoVhb4idy5B0XI25ZhnF7&index=1)\n","slug":"interest-and-yield","published":1,"updated":"2026-01-28T14:17:25.064Z","_id":"cmkxg0krv0010rb8z8fu66e6l","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>我是一點基礎概念都沒有的小菜機，希望從今天開始慢慢的增加一些有關投資的相關知識。</p>\n<p>基金、股票、保險、定存</p>\n<p>利率都是評估獲利的關鍵</p>\n<p>利率和殖利率差異？</p>\n<h2 id=\"利率-（通常以一年為計算單位）又稱年利率\"><a href=\"#利率-（通常以一年為計算單位）又稱年利率\" class=\"headerlink\" title=\"利率 （通常以一年為計算單位）又稱年利率\"></a>利率 （通常以一年為計算單位）又稱年利率</h2><p>假設年利率是1%，代表存滿一年可以獲得1%的利息</p>\n<p>如果定存時間只設定三個月（1&#x2F;4年）</p>\n<p><img src=\"/images/image-4.png\"></p>\n<p>假設將10000元放入銀行，年利率1%，放12個月跟放6個月分別如下：</p>\n<p><img src=\"/images/image-5.png\"></p>\n<p><img src=\"/images/image-6.png\"></p>\n<p>通常時間越短的年利率也相對較低。</p>\n<p>如果原本跟銀行講好的定存時間是一年，年利率1%，結果只存了六個月就要用這筆錢。</p>\n<p>必須要提前解約，這時候利息變成：</p>\n<p><img src=\"/images/image-7-1024x136.png\"></p>\n<h2 id=\"殖利率（浮動）\"><a href=\"#殖利率（浮動）\" class=\"headerlink\" title=\"殖利率（浮動）\"></a>殖利率（浮動）</h2><p>舉個例子像是100塊的本金可以拿到5%的利息。</p>\n<p><img src=\"/images/image-9.png\"></p>\n<p>但是本金有可能隨時變大變小，但是利息在一段時間是固定不變的。</p>\n<p>假設有一個股票100塊，年利率5塊。</p>\n<p><img src=\"/images/image-11.png\"></p>\n<p>說不定隔天又漲10塊</p>\n<p>參考影片：<a href=\"https://www.youtube.com/watch?v=yd3fZRrjzGM&list=PLrZrfGLGySzcZoVhb4idy5B0XI25ZhnF7&index=1\">https://www.youtube.com/watch?v=yd3fZRrjzGM&list=PLrZrfGLGySzcZoVhb4idy5B0XI25ZhnF7&index=1</a></p>\n","excerpt":"","more":"<p>我是一點基礎概念都沒有的小菜機，希望從今天開始慢慢的增加一些有關投資的相關知識。</p>\n<p>基金、股票、保險、定存</p>\n<p>利率都是評估獲利的關鍵</p>\n<p>利率和殖利率差異？</p>\n<h2 id=\"利率-（通常以一年為計算單位）又稱年利率\"><a href=\"#利率-（通常以一年為計算單位）又稱年利率\" class=\"headerlink\" title=\"利率 （通常以一年為計算單位）又稱年利率\"></a>利率 （通常以一年為計算單位）又稱年利率</h2><p>假設年利率是1%，代表存滿一年可以獲得1%的利息</p>\n<p>如果定存時間只設定三個月（1&#x2F;4年）</p>\n<p><img src=\"/images/image-4.png\"></p>\n<p>假設將10000元放入銀行，年利率1%，放12個月跟放6個月分別如下：</p>\n<p><img src=\"/images/image-5.png\"></p>\n<p><img src=\"/images/image-6.png\"></p>\n<p>通常時間越短的年利率也相對較低。</p>\n<p>如果原本跟銀行講好的定存時間是一年，年利率1%，結果只存了六個月就要用這筆錢。</p>\n<p>必須要提前解約，這時候利息變成：</p>\n<p><img src=\"/images/image-7-1024x136.png\"></p>\n<h2 id=\"殖利率（浮動）\"><a href=\"#殖利率（浮動）\" class=\"headerlink\" title=\"殖利率（浮動）\"></a>殖利率（浮動）</h2><p>舉個例子像是100塊的本金可以拿到5%的利息。</p>\n<p><img src=\"/images/image-9.png\"></p>\n<p>但是本金有可能隨時變大變小，但是利息在一段時間是固定不變的。</p>\n<p>假設有一個股票100塊，年利率5塊。</p>\n<p><img src=\"/images/image-11.png\"></p>\n<p>說不定隔天又漲10塊</p>\n<p>參考影片：<a href=\"https://www.youtube.com/watch?v=yd3fZRrjzGM&list=PLrZrfGLGySzcZoVhb4idy5B0XI25ZhnF7&index=1\">https://www.youtube.com/watch?v=yd3fZRrjzGM&list=PLrZrfGLGySzcZoVhb4idy5B0XI25ZhnF7&index=1</a></p>\n"},{"layout":"post","title":"WordPress 架站與伺服器設定教學紀錄","date":"2025-03-30T16:00:00.000Z","top_img":"/images/64b6bd08-e4f1-4125-aba5-2886b5bc938a.webp","cover":"/images/64b6bd08-e4f1-4125-aba5-2886b5bc938a.webp","_content":"\n## 【一、執行環境設定】\n\n- 使用主機：雲端主機（如 Linode）\n\n- 套件：啟用自動備份功能（如 Linode Backup）\n\n- 作業系統：Ubuntu 24.04 LTS\n\n- SSH Port：預設為 Port 22\n\n- Fail2Ban：已啟用，保護 SSH 登入\n\n- UFW 防火牆狀態： `443/tcp ALLOW 80/tcp ALLOW 22/tcp DENY`\n\n![](/images/image-1.png)\n\n* * *\n\n## 【二、Nginx + PHP + MariaDB 設定】\n\n- **Nginx**：安裝並啟用\n\n- **PHP**：8.3（以 php-fpm 模式運作）\n\n- **MariaDB**：\n    - 資料庫名稱：`wp_project`\n    \n    - 使用者帳號：`wpuser`\n    \n    - 密碼：自訂（建議設定複雜密碼）\n\n![](/images/image-2.png)\n\n* * *\n\n## 【三、安裝與設定 WordPress】\n\n- 部署路徑：`/var/www/yourdomain.com`\n\n- 安裝 WordPress 核心檔案\n\n- 設定 `wp-config.php`：\n\n- `define('DB_NAME', 'wp_project');`\n\n- `define('DB_USER', 'wpuser');`\n\n- `define('DB_PASSWORD', 'your_password');`\n\n- `define('WP_HOME', 'https://yourdomain.com');`\n\n- `define('WP_SITEURL', 'https://yourdomain.com');`\n\n* * *\n\n## 【四、SSL 憑證與 HTTPS 設定】\n\n- 網域：`yourdomain.com`、`www.yourdomain.com`\n\n- 工具：Certbot + Let's Encrypt\n\n- 狀態：\n    - 憑證申請成功\n    \n    - 自動續期任務已設定\n    \n    - 測試續期（dry-run）成功\n\n* * *\n\n## 【五、DNS 設定】\n\n- 網域註冊商：如 Gandi、Namecheap、Google Domains\n\n- DNS 記錄範例：\n    - `A @ your.server.ip.address`\n    \n    - `A www your.server.ip.address`\n\n- CDN/防護：已啟用 Cloudflare（Full SSL 模式）\n\n- DNS 記錄更新後，重新啟用 Certbot 以確保憑證綁定正確\n\n* * *\n\n## 【六、佈署 WordPress 主題與外掛】\n\n- 主題與外掛來源：Git 平台（如 GitHub、Bitbucket）\n\n- 佈署位置：`/opt/wp-deploy/`\n\n- 佈署工具腳本：`deploy.sh`\n    - 功能：支援多主題／多外掛佈署、pull 更新、變更檔案權限\n    \n    - 建議將佈署流程整合進 Git 操作中以利更新\n\n![](/images/image-3.png)\n\n* * *\n\n## 【七、安全性與效能設定】\n\n- **Wordfence**：安裝防護外掛並啟用 2FA 雙重驗證\n\n- **WP Rocket**：安裝快取外掛，配合 Cloudflare 使用（避免設定衝突）\n\n- **Fail2Ban**：SSH 攻擊防禦已啟用（jail 有運作紀錄）\n\n- **Certbot**：憑證自動續期已確認正常運作\n\n- **Cloudflare 整合**：確保資源快取與 HTTPS 模式設定一致\n\n* * *\n\n## 【八、常用伺服器管理指令】\n\n| 功能 | 指令 |\n| --- | --- |\n| 重啟 Nginx | `sudo systemctl restart nginx` |\n| 重啟 PHP-FPM | `sudo systemctl restart php8.3-fpm` |\n| 查看 Nginx 錯誤日誌 | `sudo tail -n 100 /var/log/nginx/error.log` |\n| 執行佈署腳本(個人撰寫指令) | `/opt/wp-deploy/deploy.sh` |\n| 查看 WordPress debug | `sudo tail -n 100 /var/www/yourdomain.com/wp-content/debug.log` |\n| 測試 SSL 自動續期 | `sudo certbot renew --dry-run` |\n| 查看防火牆狀態 | `sudo ufw status` |\n","source":"_posts/wordpress-start.md","raw":"---\nlayout: post\ntitle: WordPress 架站與伺服器設定教學紀錄\ndate: 2025-03-31\ntags:\ncategories:\n  - \"vm-setting\"\n  - \"wordpress\"\ntop_img: /images/64b6bd08-e4f1-4125-aba5-2886b5bc938a.webp\ncover: /images/64b6bd08-e4f1-4125-aba5-2886b5bc938a.webp\n---\n\n## 【一、執行環境設定】\n\n- 使用主機：雲端主機（如 Linode）\n\n- 套件：啟用自動備份功能（如 Linode Backup）\n\n- 作業系統：Ubuntu 24.04 LTS\n\n- SSH Port：預設為 Port 22\n\n- Fail2Ban：已啟用，保護 SSH 登入\n\n- UFW 防火牆狀態： `443/tcp ALLOW 80/tcp ALLOW 22/tcp DENY`\n\n![](/images/image-1.png)\n\n* * *\n\n## 【二、Nginx + PHP + MariaDB 設定】\n\n- **Nginx**：安裝並啟用\n\n- **PHP**：8.3（以 php-fpm 模式運作）\n\n- **MariaDB**：\n    - 資料庫名稱：`wp_project`\n    \n    - 使用者帳號：`wpuser`\n    \n    - 密碼：自訂（建議設定複雜密碼）\n\n![](/images/image-2.png)\n\n* * *\n\n## 【三、安裝與設定 WordPress】\n\n- 部署路徑：`/var/www/yourdomain.com`\n\n- 安裝 WordPress 核心檔案\n\n- 設定 `wp-config.php`：\n\n- `define('DB_NAME', 'wp_project');`\n\n- `define('DB_USER', 'wpuser');`\n\n- `define('DB_PASSWORD', 'your_password');`\n\n- `define('WP_HOME', 'https://yourdomain.com');`\n\n- `define('WP_SITEURL', 'https://yourdomain.com');`\n\n* * *\n\n## 【四、SSL 憑證與 HTTPS 設定】\n\n- 網域：`yourdomain.com`、`www.yourdomain.com`\n\n- 工具：Certbot + Let's Encrypt\n\n- 狀態：\n    - 憑證申請成功\n    \n    - 自動續期任務已設定\n    \n    - 測試續期（dry-run）成功\n\n* * *\n\n## 【五、DNS 設定】\n\n- 網域註冊商：如 Gandi、Namecheap、Google Domains\n\n- DNS 記錄範例：\n    - `A @ your.server.ip.address`\n    \n    - `A www your.server.ip.address`\n\n- CDN/防護：已啟用 Cloudflare（Full SSL 模式）\n\n- DNS 記錄更新後，重新啟用 Certbot 以確保憑證綁定正確\n\n* * *\n\n## 【六、佈署 WordPress 主題與外掛】\n\n- 主題與外掛來源：Git 平台（如 GitHub、Bitbucket）\n\n- 佈署位置：`/opt/wp-deploy/`\n\n- 佈署工具腳本：`deploy.sh`\n    - 功能：支援多主題／多外掛佈署、pull 更新、變更檔案權限\n    \n    - 建議將佈署流程整合進 Git 操作中以利更新\n\n![](/images/image-3.png)\n\n* * *\n\n## 【七、安全性與效能設定】\n\n- **Wordfence**：安裝防護外掛並啟用 2FA 雙重驗證\n\n- **WP Rocket**：安裝快取外掛，配合 Cloudflare 使用（避免設定衝突）\n\n- **Fail2Ban**：SSH 攻擊防禦已啟用（jail 有運作紀錄）\n\n- **Certbot**：憑證自動續期已確認正常運作\n\n- **Cloudflare 整合**：確保資源快取與 HTTPS 模式設定一致\n\n* * *\n\n## 【八、常用伺服器管理指令】\n\n| 功能 | 指令 |\n| --- | --- |\n| 重啟 Nginx | `sudo systemctl restart nginx` |\n| 重啟 PHP-FPM | `sudo systemctl restart php8.3-fpm` |\n| 查看 Nginx 錯誤日誌 | `sudo tail -n 100 /var/log/nginx/error.log` |\n| 執行佈署腳本(個人撰寫指令) | `/opt/wp-deploy/deploy.sh` |\n| 查看 WordPress debug | `sudo tail -n 100 /var/www/yourdomain.com/wp-content/debug.log` |\n| 測試 SSL 自動續期 | `sudo certbot renew --dry-run` |\n| 查看防火牆狀態 | `sudo ufw status` |\n","slug":"wordpress-start","published":1,"updated":"2026-01-28T14:17:25.068Z","_id":"cmkxg0krv0015rb8z8ann4ikr","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h2 id=\"【一、執行環境設定】\"><a href=\"#【一、執行環境設定】\" class=\"headerlink\" title=\"【一、執行環境設定】\"></a>【一、執行環境設定】</h2><ul>\n<li><p>使用主機：雲端主機（如 Linode）</p>\n</li>\n<li><p>套件：啟用自動備份功能（如 Linode Backup）</p>\n</li>\n<li><p>作業系統：Ubuntu 24.04 LTS</p>\n</li>\n<li><p>SSH Port：預設為 Port 22</p>\n</li>\n<li><p>Fail2Ban：已啟用，保護 SSH 登入</p>\n</li>\n<li><p>UFW 防火牆狀態： <code>443/tcp ALLOW 80/tcp ALLOW 22/tcp DENY</code></p>\n</li>\n</ul>\n<p><img src=\"/images/image-1.png\"></p>\n<hr>\n<h2 id=\"【二、Nginx-PHP-MariaDB-設定】\"><a href=\"#【二、Nginx-PHP-MariaDB-設定】\" class=\"headerlink\" title=\"【二、Nginx + PHP + MariaDB 設定】\"></a>【二、Nginx + PHP + MariaDB 設定】</h2><ul>\n<li><p><strong>Nginx</strong>：安裝並啟用</p>\n</li>\n<li><p><strong>PHP</strong>：8.3（以 php-fpm 模式運作）</p>\n</li>\n<li><p><strong>MariaDB</strong>：</p>\n<ul>\n<li><p>資料庫名稱：<code>wp_project</code></p>\n</li>\n<li><p>使用者帳號：<code>wpuser</code></p>\n</li>\n<li><p>密碼：自訂（建議設定複雜密碼）</p>\n</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"/images/image-2.png\"></p>\n<hr>\n<h2 id=\"【三、安裝與設定-WordPress】\"><a href=\"#【三、安裝與設定-WordPress】\" class=\"headerlink\" title=\"【三、安裝與設定 WordPress】\"></a>【三、安裝與設定 WordPress】</h2><ul>\n<li><p>部署路徑：<code>/var/www/yourdomain.com</code></p>\n</li>\n<li><p>安裝 WordPress 核心檔案</p>\n</li>\n<li><p>設定 <code>wp-config.php</code>：</p>\n</li>\n<li><p><code>define(&#39;DB_NAME&#39;, &#39;wp_project&#39;);</code></p>\n</li>\n<li><p><code>define(&#39;DB_USER&#39;, &#39;wpuser&#39;);</code></p>\n</li>\n<li><p><code>define(&#39;DB_PASSWORD&#39;, &#39;your_password&#39;);</code></p>\n</li>\n<li><p><code>define(&#39;WP_HOME&#39;, &#39;https://yourdomain.com&#39;);</code></p>\n</li>\n<li><p><code>define(&#39;WP_SITEURL&#39;, &#39;https://yourdomain.com&#39;);</code></p>\n</li>\n</ul>\n<hr>\n<h2 id=\"【四、SSL-憑證與-HTTPS-設定】\"><a href=\"#【四、SSL-憑證與-HTTPS-設定】\" class=\"headerlink\" title=\"【四、SSL 憑證與 HTTPS 設定】\"></a>【四、SSL 憑證與 HTTPS 設定】</h2><ul>\n<li><p>網域：<code>yourdomain.com</code>、<code>www.yourdomain.com</code></p>\n</li>\n<li><p>工具：Certbot + Let’s Encrypt</p>\n</li>\n<li><p>狀態：</p>\n<ul>\n<li><p>憑證申請成功</p>\n</li>\n<li><p>自動續期任務已設定</p>\n</li>\n<li><p>測試續期（dry-run）成功</p>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"【五、DNS-設定】\"><a href=\"#【五、DNS-設定】\" class=\"headerlink\" title=\"【五、DNS 設定】\"></a>【五、DNS 設定】</h2><ul>\n<li><p>網域註冊商：如 Gandi、Namecheap、Google Domains</p>\n</li>\n<li><p>DNS 記錄範例：</p>\n<ul>\n<li><p><code>A @ your.server.ip.address</code></p>\n</li>\n<li><p><code>A www your.server.ip.address</code></p>\n</li>\n</ul>\n</li>\n<li><p>CDN&#x2F;防護：已啟用 Cloudflare（Full SSL 模式）</p>\n</li>\n<li><p>DNS 記錄更新後，重新啟用 Certbot 以確保憑證綁定正確</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"【六、佈署-WordPress-主題與外掛】\"><a href=\"#【六、佈署-WordPress-主題與外掛】\" class=\"headerlink\" title=\"【六、佈署 WordPress 主題與外掛】\"></a>【六、佈署 WordPress 主題與外掛】</h2><ul>\n<li><p>主題與外掛來源：Git 平台（如 GitHub、Bitbucket）</p>\n</li>\n<li><p>佈署位置：<code>/opt/wp-deploy/</code></p>\n</li>\n<li><p>佈署工具腳本：<code>deploy.sh</code></p>\n<ul>\n<li><p>功能：支援多主題／多外掛佈署、pull 更新、變更檔案權限</p>\n</li>\n<li><p>建議將佈署流程整合進 Git 操作中以利更新</p>\n</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"/images/image-3.png\"></p>\n<hr>\n<h2 id=\"【七、安全性與效能設定】\"><a href=\"#【七、安全性與效能設定】\" class=\"headerlink\" title=\"【七、安全性與效能設定】\"></a>【七、安全性與效能設定】</h2><ul>\n<li><p><strong>Wordfence</strong>：安裝防護外掛並啟用 2FA 雙重驗證</p>\n</li>\n<li><p><strong>WP Rocket</strong>：安裝快取外掛，配合 Cloudflare 使用（避免設定衝突）</p>\n</li>\n<li><p><strong>Fail2Ban</strong>：SSH 攻擊防禦已啟用（jail 有運作紀錄）</p>\n</li>\n<li><p><strong>Certbot</strong>：憑證自動續期已確認正常運作</p>\n</li>\n<li><p><strong>Cloudflare 整合</strong>：確保資源快取與 HTTPS 模式設定一致</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"【八、常用伺服器管理指令】\"><a href=\"#【八、常用伺服器管理指令】\" class=\"headerlink\" title=\"【八、常用伺服器管理指令】\"></a>【八、常用伺服器管理指令】</h2><table>\n<thead>\n<tr>\n<th>功能</th>\n<th>指令</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>重啟 Nginx</td>\n<td><code>sudo systemctl restart nginx</code></td>\n</tr>\n<tr>\n<td>重啟 PHP-FPM</td>\n<td><code>sudo systemctl restart php8.3-fpm</code></td>\n</tr>\n<tr>\n<td>查看 Nginx 錯誤日誌</td>\n<td><code>sudo tail -n 100 /var/log/nginx/error.log</code></td>\n</tr>\n<tr>\n<td>執行佈署腳本(個人撰寫指令)</td>\n<td><code>/opt/wp-deploy/deploy.sh</code></td>\n</tr>\n<tr>\n<td>查看 WordPress debug</td>\n<td><code>sudo tail -n 100 /var/www/yourdomain.com/wp-content/debug.log</code></td>\n</tr>\n<tr>\n<td>測試 SSL 自動續期</td>\n<td><code>sudo certbot renew --dry-run</code></td>\n</tr>\n<tr>\n<td>查看防火牆狀態</td>\n<td><code>sudo ufw status</code></td>\n</tr>\n</tbody></table>\n","excerpt":"","more":"<h2 id=\"【一、執行環境設定】\"><a href=\"#【一、執行環境設定】\" class=\"headerlink\" title=\"【一、執行環境設定】\"></a>【一、執行環境設定】</h2><ul>\n<li><p>使用主機：雲端主機（如 Linode）</p>\n</li>\n<li><p>套件：啟用自動備份功能（如 Linode Backup）</p>\n</li>\n<li><p>作業系統：Ubuntu 24.04 LTS</p>\n</li>\n<li><p>SSH Port：預設為 Port 22</p>\n</li>\n<li><p>Fail2Ban：已啟用，保護 SSH 登入</p>\n</li>\n<li><p>UFW 防火牆狀態： <code>443/tcp ALLOW 80/tcp ALLOW 22/tcp DENY</code></p>\n</li>\n</ul>\n<p><img src=\"/images/image-1.png\"></p>\n<hr>\n<h2 id=\"【二、Nginx-PHP-MariaDB-設定】\"><a href=\"#【二、Nginx-PHP-MariaDB-設定】\" class=\"headerlink\" title=\"【二、Nginx + PHP + MariaDB 設定】\"></a>【二、Nginx + PHP + MariaDB 設定】</h2><ul>\n<li><p><strong>Nginx</strong>：安裝並啟用</p>\n</li>\n<li><p><strong>PHP</strong>：8.3（以 php-fpm 模式運作）</p>\n</li>\n<li><p><strong>MariaDB</strong>：</p>\n<ul>\n<li><p>資料庫名稱：<code>wp_project</code></p>\n</li>\n<li><p>使用者帳號：<code>wpuser</code></p>\n</li>\n<li><p>密碼：自訂（建議設定複雜密碼）</p>\n</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"/images/image-2.png\"></p>\n<hr>\n<h2 id=\"【三、安裝與設定-WordPress】\"><a href=\"#【三、安裝與設定-WordPress】\" class=\"headerlink\" title=\"【三、安裝與設定 WordPress】\"></a>【三、安裝與設定 WordPress】</h2><ul>\n<li><p>部署路徑：<code>/var/www/yourdomain.com</code></p>\n</li>\n<li><p>安裝 WordPress 核心檔案</p>\n</li>\n<li><p>設定 <code>wp-config.php</code>：</p>\n</li>\n<li><p><code>define(&#39;DB_NAME&#39;, &#39;wp_project&#39;);</code></p>\n</li>\n<li><p><code>define(&#39;DB_USER&#39;, &#39;wpuser&#39;);</code></p>\n</li>\n<li><p><code>define(&#39;DB_PASSWORD&#39;, &#39;your_password&#39;);</code></p>\n</li>\n<li><p><code>define(&#39;WP_HOME&#39;, &#39;https://yourdomain.com&#39;);</code></p>\n</li>\n<li><p><code>define(&#39;WP_SITEURL&#39;, &#39;https://yourdomain.com&#39;);</code></p>\n</li>\n</ul>\n<hr>\n<h2 id=\"【四、SSL-憑證與-HTTPS-設定】\"><a href=\"#【四、SSL-憑證與-HTTPS-設定】\" class=\"headerlink\" title=\"【四、SSL 憑證與 HTTPS 設定】\"></a>【四、SSL 憑證與 HTTPS 設定】</h2><ul>\n<li><p>網域：<code>yourdomain.com</code>、<code>www.yourdomain.com</code></p>\n</li>\n<li><p>工具：Certbot + Let’s Encrypt</p>\n</li>\n<li><p>狀態：</p>\n<ul>\n<li><p>憑證申請成功</p>\n</li>\n<li><p>自動續期任務已設定</p>\n</li>\n<li><p>測試續期（dry-run）成功</p>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"【五、DNS-設定】\"><a href=\"#【五、DNS-設定】\" class=\"headerlink\" title=\"【五、DNS 設定】\"></a>【五、DNS 設定】</h2><ul>\n<li><p>網域註冊商：如 Gandi、Namecheap、Google Domains</p>\n</li>\n<li><p>DNS 記錄範例：</p>\n<ul>\n<li><p><code>A @ your.server.ip.address</code></p>\n</li>\n<li><p><code>A www your.server.ip.address</code></p>\n</li>\n</ul>\n</li>\n<li><p>CDN&#x2F;防護：已啟用 Cloudflare（Full SSL 模式）</p>\n</li>\n<li><p>DNS 記錄更新後，重新啟用 Certbot 以確保憑證綁定正確</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"【六、佈署-WordPress-主題與外掛】\"><a href=\"#【六、佈署-WordPress-主題與外掛】\" class=\"headerlink\" title=\"【六、佈署 WordPress 主題與外掛】\"></a>【六、佈署 WordPress 主題與外掛】</h2><ul>\n<li><p>主題與外掛來源：Git 平台（如 GitHub、Bitbucket）</p>\n</li>\n<li><p>佈署位置：<code>/opt/wp-deploy/</code></p>\n</li>\n<li><p>佈署工具腳本：<code>deploy.sh</code></p>\n<ul>\n<li><p>功能：支援多主題／多外掛佈署、pull 更新、變更檔案權限</p>\n</li>\n<li><p>建議將佈署流程整合進 Git 操作中以利更新</p>\n</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"/images/image-3.png\"></p>\n<hr>\n<h2 id=\"【七、安全性與效能設定】\"><a href=\"#【七、安全性與效能設定】\" class=\"headerlink\" title=\"【七、安全性與效能設定】\"></a>【七、安全性與效能設定】</h2><ul>\n<li><p><strong>Wordfence</strong>：安裝防護外掛並啟用 2FA 雙重驗證</p>\n</li>\n<li><p><strong>WP Rocket</strong>：安裝快取外掛，配合 Cloudflare 使用（避免設定衝突）</p>\n</li>\n<li><p><strong>Fail2Ban</strong>：SSH 攻擊防禦已啟用（jail 有運作紀錄）</p>\n</li>\n<li><p><strong>Certbot</strong>：憑證自動續期已確認正常運作</p>\n</li>\n<li><p><strong>Cloudflare 整合</strong>：確保資源快取與 HTTPS 模式設定一致</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"【八、常用伺服器管理指令】\"><a href=\"#【八、常用伺服器管理指令】\" class=\"headerlink\" title=\"【八、常用伺服器管理指令】\"></a>【八、常用伺服器管理指令】</h2><table>\n<thead>\n<tr>\n<th>功能</th>\n<th>指令</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>重啟 Nginx</td>\n<td><code>sudo systemctl restart nginx</code></td>\n</tr>\n<tr>\n<td>重啟 PHP-FPM</td>\n<td><code>sudo systemctl restart php8.3-fpm</code></td>\n</tr>\n<tr>\n<td>查看 Nginx 錯誤日誌</td>\n<td><code>sudo tail -n 100 /var/log/nginx/error.log</code></td>\n</tr>\n<tr>\n<td>執行佈署腳本(個人撰寫指令)</td>\n<td><code>/opt/wp-deploy/deploy.sh</code></td>\n</tr>\n<tr>\n<td>查看 WordPress debug</td>\n<td><code>sudo tail -n 100 /var/www/yourdomain.com/wp-content/debug.log</code></td>\n</tr>\n<tr>\n<td>測試 SSL 自動續期</td>\n<td><code>sudo certbot renew --dry-run</code></td>\n</tr>\n<tr>\n<td>查看防火牆狀態</td>\n<td><code>sudo ufw status</code></td>\n</tr>\n</tbody></table>\n"},{"layout":"post","title":"如何在 Linode 用 Docker 架設 n8n","date":"2025-11-04T16:00:00.000Z","top_img":"/images/n8n-linode.png","cover":"/images/n8n-linode.png","_content":"\n下面是**整趟 n8n on Linode + Cloudflare Tunnel 部署旅程完整總整理**  \n包含每一步、每個踩雷點、每個修法。\n\n## Linode 上部署：\n\n- Docker + Docker Compose\n\n- n8n with persistent volume\n\n- Cloudflare Tunnel (免開 port、HTTPS、domain)\n\n- 安全保護（BasicAuth）\n\n最終網址 : https://n8n.stackpenguin.com (根據你自己的網域)\n\n## 系統前置\n\n### SSH 進 Linode → 更新\n\n```\nsudo apt update && sudo apt upgrade -y\n```\n\n```\nsudo apt update && sudo apt upgrade -y\n```\n\n## 安裝 Docker & Compose（先確認再裝）\n\n### 檢查 Docker\n\n```\ndocker --version\n```\n\n```\ndocker --version\n```\n\n### 沒有就安裝\n\n```\ncurl -fsSL https://get.docker.com | sudo bash\nsudo usermod -aG docker $USER\n```\n\n```\ncurl -fsSL https://get.docker.com | sudo bash\nsudo usermod -aG docker $USER\n```\n\n> ### 檢查 Compose\n\n```\ndocker-compose --version\n```\n\n```\ndocker-compose --version\n```\n\n### 沒有就安裝\n\n```\nsudo apt install docker-compose -y\n```\n\n```\nsudo apt install docker-compose -y\n```\n\n## 建立 n8n 工作資料夾\n\n```\nmkdir -p ~/n8n\ncd ~/n8n\n```\n\n```\nmkdir -p ~/n8n\ncd ~/n8n\n```\n\n## 建立 docker-compose.yml\n\n> 一開始你用 docker run，後來換 compose（正確）\n\n```\nversion: \"3.3\"\n<div></div>\nservices:\n  n8n:\n    image: docker.n8n.io/n8nio/n8n\n    container_name: n8n\n    environment:\n      - GENERIC_TIMEZONE=Asia/Taipei\n      - TZ=Asia/Taipei\n      - N8N_PORT=5678\n      - N8N_HOST=n8n.stackpenguin.com\n      - N8N_EDITOR_BASE_URL=https://n8n.stackpenguin.com\n<div></div>\n      # secure login\n      - N8N_BASIC_AUTH_ACTIVE=true\n      - N8N_BASIC_AUTH_USER=orcajunkai\n      - N8N_BASIC_AUTH_PASSWORD=<你的密碼>\n<div></div>\n    ports:\n      - \"5678:5678\"\n    volumes:\n      - ./data:/home/node/.n8n\n    restart: unless-stopped\n```\n\n```\nversion: \"3.3\"\n\nservices:\n  n8n:\n    image: docker.n8n.io/n8nio/n8n\n    container_name: n8n\n    environment:\n      - GENERIC_TIMEZONE=Asia/Taipei\n      - TZ=Asia/Taipei\n      - N8N_PORT=5678\n      - N8N_HOST=n8n.stackpenguin.com\n      - N8N_EDITOR_BASE_URL=https://n8n.stackpenguin.com\n\n      # secure login\n      - N8N_BASIC_AUTH_ACTIVE=true\n      - N8N_BASIC_AUTH_USER=orcajunkai\n      - N8N_BASIC_AUTH_PASSWORD=<你的密碼>\n\n    ports:\n      - \"5678:5678\"\n    volumes:\n      - ./data:/home/node/.n8n\n    restart: unless-stopped\n```\n\n> ⚠️ 關鍵：**不能放 `N8N_PROTOCOL=https`**（那會 crash）\n\n記得要將防火牆設定允許\n\n```\norcajunkai@localhost:~$ sudo ufw allow 5678\nRule added\nRule added (v6)\norcajunkai@localhost:~$ sudo ufw reload\nFirewall reloaded\n```\n\n```\norcajunkai@localhost:~$ sudo ufw allow 5678\nRule added\nRule added (v6)\norcajunkai@localhost:~$ sudo ufw reload\nFirewall reloaded\n```\n\n## 啟動 n8n\n\n```\ndocker-compose up -d\ndocker ps\ncurl http://localhost:5678\n```\n\n```\ndocker-compose up -d\ndocker ps\ncurl http://localhost:5678\n```\n\n## Cloudflare Tunnel 登入\n\n### 安裝 cloudflared\n\n```\nwget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb\nsudo dpkg -i cloudflared-linux-amd64.deb\n```\n\n```\nwget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb\nsudo dpkg -i cloudflared-linux-amd64.deb\n```\n\n### 登入\n\n```\ncloudflared tunnel login\n```\n\n```\ncloudflared tunnel login\n```\n\n![](/images/image-1-1024x557.png)\n\n* * *\n\n## 建 tunnel\n\n```\ncloudflared tunnel create n8n\n```\n\n```\ncloudflared tunnel create n8n\n```\n\n取得 UUID\n\n## 建 DNS mapping\n\n```\ncloudflared tunnel route dns n8n n8n.stackpenguin.com\n```\n\n```\ncloudflared tunnel route dns n8n n8n.stackpenguin.com\n```\n\n## 建 Cloudflare config\n\n```\nsudo nano /etc/cloudflared/config.yml\n```\n\n```\nsudo nano /etc/cloudflared/config.yml\n```\n\n貼：\n\n```\ntunnel: <UUID>\ncredentials-file: /home/orcajunkai/.cloudflared/<UUID>.json\n<div></div>\ningress:\n  - hostname: n8n.stackpenguin.com\n    service: http://localhost:5678\n  - service: http_status:404\n\n```\n\n```\ntunnel: <UUID>\ncredentials-file: /home/orcajunkai/.cloudflared/<UUID>.json\n\ningress:\n  - hostname: n8n.stackpenguin.com\n    service: http://localhost:5678\n  - service: http_status:404\n```\n\n## 啟動 Tunnel\n\n```\nsudo cloudflared service install\nsudo systemctl enable cloudflared\nsudo systemctl start cloudflared\nsystemctl status cloudflared\n```\n\n```\nsudo cloudflared service install\nsudo systemctl enable cloudflared\nsudo systemctl start cloudflared\nsystemctl status cloudflared\n```\n\n## 遇到的問題 & 解決\n\n| Issue | 解析 | 解法 |\n| --- | --- | --- |\n| 反引號 \\` 在 Ubuntu 不能用 | Windows copy 的 shell | Linux 用 `\\` 換行 |\n| Tunnel 502 | config path / hostname / protocol 錯 | 修 `config.yml` |\n| `UUID.json` not found | `<UUID>` 沒替換 | 改成真 UUID |\n| `curl localhost:5678` failed | n8n crash | remove HTTPS env |\n| `EACCES /home/node/.n8n/config` | volume 權限不對 | `chown 1000:1000 data/` |\n| container restart loop | wrong env / permissions | Fix compose & folder perms |\n| Everyone can access n8n | 公開服務 | 啟 basic auth env |\n\n## 最後驗證\n\n```\norcajunkai@localhost:~/n8n$ curl http://localhost:5678\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot GET /</pre>\n</body>\n</html>\n```\n\n```\norcajunkai@localhost:~/n8n$ curl http://localhost:5678\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot GET /</pre>\n</body>\n</html>\n```\n\nBrowser：https://n8n.stackpenguin.com (自己的網域)\n\n跳出 BasicAuth → Login → 看到 n8n UI ✅\n\n![](/images/螢幕擷取畫面-2025-11-05-163916-1024x606.png)\n\n## Cloudflared 運作原理\n\n你想知道為啥：\n\n```\nhttps://n8n.stackpenguin.com\n\n可以指到你 Linode 上的 n8n\n而且你 沒有開 5678 port、也沒有裝 Nginx/Certbot\n卻 magically 有 HTTPS + domain？\n```\n\n## 🔥 Cloudflare Tunnel 的核心概念\n\n平常網站流程是：\n\n```\nUser → Domain → Public IP → Server → App (n8n)\n```\n\n但 Cloudflare Tunnel 是：\n\n```\nUser → Cloudflare → Tunnel → Your Server → n8n\n```\n\n你的 server 變成**主動連 Cloudflare**，不是 Cloudflare 來找你\n\n這樣：\n\n- 不用開 Port 80/443/5678\n\n- 不用裝 Nginx\n\n- 不用 SSL cert\n\n- 網路封死也能連\n\n超安全又 chill 這就是為什麼 tunnel 是超熱門 DevOps meta hack\n\n## 那「綁定網址」到底做了什麼？\n\n你做了兩件事：\n\n### 1\\. Cloudflare DNS 建立 Route\n\n這條指令：\n\n```\ncloudflared tunnel route dns n8n n8n.stackpenguin.com\n```\n\n```\ncloudflared tunnel route dns n8n n8n.stackpenguin.com\n```\n\n意思：  \n**讓 n8n.stackpenguin.com 指向這條 Cloudflare Tunnel**\n\nCloudflare 幫你塞一條 CNAME 到 DNS：\n\n```\nn8n.stackpenguin.com → <Cloudflare Tunnel endpoint>\n\n不是指向你的 Linode IP\n是指向 Cloudflare 的 secure gateway\n```\n\n### 2\\. Tunnel config 說「這 domain 對應這 app」\n\n你的 `/etc/cloudflared/config.yml`\n\n```\ningress:\n  - hostname: n8n.stackpenguin.com\n    service: http://localhost:5678\n```\n\n```\ningress:\n  - hostname: n8n.stackpenguin.com\n    service: http://localhost:5678\n```\n\n意思：\n\n> 有人打 `n8n.stackpenguin.com`  \n> → Cloudflare 收 request  \n> → 丟給 Tunnel  \n> → Tunnel 轉給你 Linode  \n> → 你的 n8n 回應\n\n完全不露 IP  \n完全不需要開 Port  \n完全不需要 TLS 憑證\n\n* * *\n\n## 一句話版本\n\nCloudflare Tunnel 把你 server 變成：\n\n> **末端加密節點**\n\nCloudflare 當你的「外部大門 + HTTPS + Firewall」  \n你 server 只是「內部房間」\n\n所以 `https://n8n.stackpenguin.com` 是 Cloudflare 給 HTTPS  \n不是你自己做 HTTPS\n\n## 骨架圖（秒懂）\n\n```\n🌍 User Browser\n      ↓ https://n8n.stackpenguin.com\nCloudflare Edge (SSL / Firewall / CDN)\n      ↓ Tunnel (Secure connection)\nLinode VM\n      ↓ localhost:5678\nn8n dashboard\n```\n\n```\n🌍 User Browser\n      ↓ https://n8n.stackpenguin.com\nCloudflare Edge (SSL / Firewall / CDN)\n      ↓ Tunnel (Secure connection)\nLinode VM\n      ↓ localhost:5678\nn8n dashboard\n```\n\n## 現在有什麼？\n\n已經跑在：\n\n💠 Cloudflare Zero Trust Tunnel  \n💠 隱藏原始 IP  \n💠 強制 HTTPS  \n💠 密碼保護 (Basic Auth)  \n💠 沒開任何 external port（最安全）\n\n你走的不是傳統 Web Hosting  \n你走的是 **Zero Trust Architecture**\n","source":"_posts/linode-docker-n8n.md","raw":"---\nlayout: post\ntitle: 如何在 Linode 用 Docker 架設 n8n\ndate: 2025-11-05\ntags:\ncategories:\n  - \"docker\"\n  - \"n8n\"\n  - \"vm-setting\"\ntop_img: /images/n8n-linode.png\ncover: /images/n8n-linode.png\n---\n\n下面是**整趟 n8n on Linode + Cloudflare Tunnel 部署旅程完整總整理**  \n包含每一步、每個踩雷點、每個修法。\n\n## Linode 上部署：\n\n- Docker + Docker Compose\n\n- n8n with persistent volume\n\n- Cloudflare Tunnel (免開 port、HTTPS、domain)\n\n- 安全保護（BasicAuth）\n\n最終網址 : https://n8n.stackpenguin.com (根據你自己的網域)\n\n## 系統前置\n\n### SSH 進 Linode → 更新\n\n```\nsudo apt update && sudo apt upgrade -y\n```\n\n```\nsudo apt update && sudo apt upgrade -y\n```\n\n## 安裝 Docker & Compose（先確認再裝）\n\n### 檢查 Docker\n\n```\ndocker --version\n```\n\n```\ndocker --version\n```\n\n### 沒有就安裝\n\n```\ncurl -fsSL https://get.docker.com | sudo bash\nsudo usermod -aG docker $USER\n```\n\n```\ncurl -fsSL https://get.docker.com | sudo bash\nsudo usermod -aG docker $USER\n```\n\n> ### 檢查 Compose\n\n```\ndocker-compose --version\n```\n\n```\ndocker-compose --version\n```\n\n### 沒有就安裝\n\n```\nsudo apt install docker-compose -y\n```\n\n```\nsudo apt install docker-compose -y\n```\n\n## 建立 n8n 工作資料夾\n\n```\nmkdir -p ~/n8n\ncd ~/n8n\n```\n\n```\nmkdir -p ~/n8n\ncd ~/n8n\n```\n\n## 建立 docker-compose.yml\n\n> 一開始你用 docker run，後來換 compose（正確）\n\n```\nversion: \"3.3\"\n<div></div>\nservices:\n  n8n:\n    image: docker.n8n.io/n8nio/n8n\n    container_name: n8n\n    environment:\n      - GENERIC_TIMEZONE=Asia/Taipei\n      - TZ=Asia/Taipei\n      - N8N_PORT=5678\n      - N8N_HOST=n8n.stackpenguin.com\n      - N8N_EDITOR_BASE_URL=https://n8n.stackpenguin.com\n<div></div>\n      # secure login\n      - N8N_BASIC_AUTH_ACTIVE=true\n      - N8N_BASIC_AUTH_USER=orcajunkai\n      - N8N_BASIC_AUTH_PASSWORD=<你的密碼>\n<div></div>\n    ports:\n      - \"5678:5678\"\n    volumes:\n      - ./data:/home/node/.n8n\n    restart: unless-stopped\n```\n\n```\nversion: \"3.3\"\n\nservices:\n  n8n:\n    image: docker.n8n.io/n8nio/n8n\n    container_name: n8n\n    environment:\n      - GENERIC_TIMEZONE=Asia/Taipei\n      - TZ=Asia/Taipei\n      - N8N_PORT=5678\n      - N8N_HOST=n8n.stackpenguin.com\n      - N8N_EDITOR_BASE_URL=https://n8n.stackpenguin.com\n\n      # secure login\n      - N8N_BASIC_AUTH_ACTIVE=true\n      - N8N_BASIC_AUTH_USER=orcajunkai\n      - N8N_BASIC_AUTH_PASSWORD=<你的密碼>\n\n    ports:\n      - \"5678:5678\"\n    volumes:\n      - ./data:/home/node/.n8n\n    restart: unless-stopped\n```\n\n> ⚠️ 關鍵：**不能放 `N8N_PROTOCOL=https`**（那會 crash）\n\n記得要將防火牆設定允許\n\n```\norcajunkai@localhost:~$ sudo ufw allow 5678\nRule added\nRule added (v6)\norcajunkai@localhost:~$ sudo ufw reload\nFirewall reloaded\n```\n\n```\norcajunkai@localhost:~$ sudo ufw allow 5678\nRule added\nRule added (v6)\norcajunkai@localhost:~$ sudo ufw reload\nFirewall reloaded\n```\n\n## 啟動 n8n\n\n```\ndocker-compose up -d\ndocker ps\ncurl http://localhost:5678\n```\n\n```\ndocker-compose up -d\ndocker ps\ncurl http://localhost:5678\n```\n\n## Cloudflare Tunnel 登入\n\n### 安裝 cloudflared\n\n```\nwget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb\nsudo dpkg -i cloudflared-linux-amd64.deb\n```\n\n```\nwget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb\nsudo dpkg -i cloudflared-linux-amd64.deb\n```\n\n### 登入\n\n```\ncloudflared tunnel login\n```\n\n```\ncloudflared tunnel login\n```\n\n![](/images/image-1-1024x557.png)\n\n* * *\n\n## 建 tunnel\n\n```\ncloudflared tunnel create n8n\n```\n\n```\ncloudflared tunnel create n8n\n```\n\n取得 UUID\n\n## 建 DNS mapping\n\n```\ncloudflared tunnel route dns n8n n8n.stackpenguin.com\n```\n\n```\ncloudflared tunnel route dns n8n n8n.stackpenguin.com\n```\n\n## 建 Cloudflare config\n\n```\nsudo nano /etc/cloudflared/config.yml\n```\n\n```\nsudo nano /etc/cloudflared/config.yml\n```\n\n貼：\n\n```\ntunnel: <UUID>\ncredentials-file: /home/orcajunkai/.cloudflared/<UUID>.json\n<div></div>\ningress:\n  - hostname: n8n.stackpenguin.com\n    service: http://localhost:5678\n  - service: http_status:404\n\n```\n\n```\ntunnel: <UUID>\ncredentials-file: /home/orcajunkai/.cloudflared/<UUID>.json\n\ningress:\n  - hostname: n8n.stackpenguin.com\n    service: http://localhost:5678\n  - service: http_status:404\n```\n\n## 啟動 Tunnel\n\n```\nsudo cloudflared service install\nsudo systemctl enable cloudflared\nsudo systemctl start cloudflared\nsystemctl status cloudflared\n```\n\n```\nsudo cloudflared service install\nsudo systemctl enable cloudflared\nsudo systemctl start cloudflared\nsystemctl status cloudflared\n```\n\n## 遇到的問題 & 解決\n\n| Issue | 解析 | 解法 |\n| --- | --- | --- |\n| 反引號 \\` 在 Ubuntu 不能用 | Windows copy 的 shell | Linux 用 `\\` 換行 |\n| Tunnel 502 | config path / hostname / protocol 錯 | 修 `config.yml` |\n| `UUID.json` not found | `<UUID>` 沒替換 | 改成真 UUID |\n| `curl localhost:5678` failed | n8n crash | remove HTTPS env |\n| `EACCES /home/node/.n8n/config` | volume 權限不對 | `chown 1000:1000 data/` |\n| container restart loop | wrong env / permissions | Fix compose & folder perms |\n| Everyone can access n8n | 公開服務 | 啟 basic auth env |\n\n## 最後驗證\n\n```\norcajunkai@localhost:~/n8n$ curl http://localhost:5678\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot GET /</pre>\n</body>\n</html>\n```\n\n```\norcajunkai@localhost:~/n8n$ curl http://localhost:5678\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>Error</title>\n</head>\n<body>\n<pre>Cannot GET /</pre>\n</body>\n</html>\n```\n\nBrowser：https://n8n.stackpenguin.com (自己的網域)\n\n跳出 BasicAuth → Login → 看到 n8n UI ✅\n\n![](/images/螢幕擷取畫面-2025-11-05-163916-1024x606.png)\n\n## Cloudflared 運作原理\n\n你想知道為啥：\n\n```\nhttps://n8n.stackpenguin.com\n\n可以指到你 Linode 上的 n8n\n而且你 沒有開 5678 port、也沒有裝 Nginx/Certbot\n卻 magically 有 HTTPS + domain？\n```\n\n## 🔥 Cloudflare Tunnel 的核心概念\n\n平常網站流程是：\n\n```\nUser → Domain → Public IP → Server → App (n8n)\n```\n\n但 Cloudflare Tunnel 是：\n\n```\nUser → Cloudflare → Tunnel → Your Server → n8n\n```\n\n你的 server 變成**主動連 Cloudflare**，不是 Cloudflare 來找你\n\n這樣：\n\n- 不用開 Port 80/443/5678\n\n- 不用裝 Nginx\n\n- 不用 SSL cert\n\n- 網路封死也能連\n\n超安全又 chill 這就是為什麼 tunnel 是超熱門 DevOps meta hack\n\n## 那「綁定網址」到底做了什麼？\n\n你做了兩件事：\n\n### 1\\. Cloudflare DNS 建立 Route\n\n這條指令：\n\n```\ncloudflared tunnel route dns n8n n8n.stackpenguin.com\n```\n\n```\ncloudflared tunnel route dns n8n n8n.stackpenguin.com\n```\n\n意思：  \n**讓 n8n.stackpenguin.com 指向這條 Cloudflare Tunnel**\n\nCloudflare 幫你塞一條 CNAME 到 DNS：\n\n```\nn8n.stackpenguin.com → <Cloudflare Tunnel endpoint>\n\n不是指向你的 Linode IP\n是指向 Cloudflare 的 secure gateway\n```\n\n### 2\\. Tunnel config 說「這 domain 對應這 app」\n\n你的 `/etc/cloudflared/config.yml`\n\n```\ningress:\n  - hostname: n8n.stackpenguin.com\n    service: http://localhost:5678\n```\n\n```\ningress:\n  - hostname: n8n.stackpenguin.com\n    service: http://localhost:5678\n```\n\n意思：\n\n> 有人打 `n8n.stackpenguin.com`  \n> → Cloudflare 收 request  \n> → 丟給 Tunnel  \n> → Tunnel 轉給你 Linode  \n> → 你的 n8n 回應\n\n完全不露 IP  \n完全不需要開 Port  \n完全不需要 TLS 憑證\n\n* * *\n\n## 一句話版本\n\nCloudflare Tunnel 把你 server 變成：\n\n> **末端加密節點**\n\nCloudflare 當你的「外部大門 + HTTPS + Firewall」  \n你 server 只是「內部房間」\n\n所以 `https://n8n.stackpenguin.com` 是 Cloudflare 給 HTTPS  \n不是你自己做 HTTPS\n\n## 骨架圖（秒懂）\n\n```\n🌍 User Browser\n      ↓ https://n8n.stackpenguin.com\nCloudflare Edge (SSL / Firewall / CDN)\n      ↓ Tunnel (Secure connection)\nLinode VM\n      ↓ localhost:5678\nn8n dashboard\n```\n\n```\n🌍 User Browser\n      ↓ https://n8n.stackpenguin.com\nCloudflare Edge (SSL / Firewall / CDN)\n      ↓ Tunnel (Secure connection)\nLinode VM\n      ↓ localhost:5678\nn8n dashboard\n```\n\n## 現在有什麼？\n\n已經跑在：\n\n💠 Cloudflare Zero Trust Tunnel  \n💠 隱藏原始 IP  \n💠 強制 HTTPS  \n💠 密碼保護 (Basic Auth)  \n💠 沒開任何 external port（最安全）\n\n你走的不是傳統 Web Hosting  \n你走的是 **Zero Trust Architecture**\n","slug":"linode-docker-n8n","published":1,"updated":"2026-01-28T14:17:25.064Z","_id":"cmkxg0krw0016rb8zd9v92fdq","comments":1,"photos":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><p>下面是<strong>整趟 n8n on Linode + Cloudflare Tunnel 部署旅程完整總整理</strong><br>包含每一步、每個踩雷點、每個修法。</p>\n<h2 id=\"Linode-上部署：\"><a href=\"#Linode-上部署：\" class=\"headerlink\" title=\"Linode 上部署：\"></a>Linode 上部署：</h2><ul>\n<li><p>Docker + Docker Compose</p>\n</li>\n<li><p>n8n with persistent volume</p>\n</li>\n<li><p>Cloudflare Tunnel (免開 port、HTTPS、domain)</p>\n</li>\n<li><p>安全保護（BasicAuth）</p>\n</li>\n</ul>\n<p>最終網址 : <a href=\"https://n8n.stackpenguin.com/\">https://n8n.stackpenguin.com</a> (根據你自己的網域)</p>\n<h2 id=\"系統前置\"><a href=\"#系統前置\" class=\"headerlink\" title=\"系統前置\"></a>系統前置</h2><h3 id=\"SSH-進-Linode-→-更新\"><a href=\"#SSH-進-Linode-→-更新\" class=\"headerlink\" title=\"SSH 進 Linode → 更新\"></a>SSH 進 Linode → 更新</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安裝-Docker-Compose（先確認再裝）\"><a href=\"#安裝-Docker-Compose（先確認再裝）\" class=\"headerlink\" title=\"安裝 Docker &amp; Compose（先確認再裝）\"></a>安裝 Docker &amp; Compose（先確認再裝）</h2><h3 id=\"檢查-Docker\"><a href=\"#檢查-Docker\" class=\"headerlink\" title=\"檢查 Docker\"></a>檢查 Docker</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker --version</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker --version</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"沒有就安裝\"><a href=\"#沒有就安裝\" class=\"headerlink\" title=\"沒有就安裝\"></a>沒有就安裝</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://get.docker.com | sudo bash</span><br><span class=\"line\">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://get.docker.com | sudo bash</span><br><span class=\"line\">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h3 id=\"檢查-Compose\"><a href=\"#檢查-Compose\" class=\"headerlink\" title=\"檢查 Compose\"></a>檢查 Compose</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose --version</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose --version</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"沒有就安裝-1\"><a href=\"#沒有就安裝-1\" class=\"headerlink\" title=\"沒有就安裝\"></a>沒有就安裝</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install docker-compose -y</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install docker-compose -y</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建立-n8n-工作資料夾\"><a href=\"#建立-n8n-工作資料夾\" class=\"headerlink\" title=\"建立 n8n 工作資料夾\"></a>建立 n8n 工作資料夾</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p ~/n8n</span><br><span class=\"line\">cd ~/n8n</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p ~/n8n</span><br><span class=\"line\">cd ~/n8n</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建立-docker-compose-yml\"><a href=\"#建立-docker-compose-yml\" class=\"headerlink\" title=\"建立 docker-compose.yml\"></a>建立 docker-compose.yml</h2><blockquote>\n<p>一開始你用 docker run，後來換 compose（正確）</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3.3&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  n8n:</span><br><span class=\"line\">    image: docker.n8n.io/n8nio/n8n</span><br><span class=\"line\">    container_name: n8n</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - GENERIC_TIMEZONE=Asia/Taipei</span><br><span class=\"line\">      - TZ=Asia/Taipei</span><br><span class=\"line\">      - N8N_PORT=5678</span><br><span class=\"line\">      - N8N_HOST=n8n.stackpenguin.com</span><br><span class=\"line\">      - N8N_EDITOR_BASE_URL=https://n8n.stackpenguin.com</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">      # secure login</span><br><span class=\"line\">      - N8N_BASIC_AUTH_ACTIVE=true</span><br><span class=\"line\">      - N8N_BASIC_AUTH_USER=orcajunkai</span><br><span class=\"line\">      - N8N_BASIC_AUTH_PASSWORD=&lt;你的密碼&gt;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;5678:5678&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./data:/home/node/.n8n</span><br><span class=\"line\">    restart: unless-stopped</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3.3&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\">  n8n:</span><br><span class=\"line\">    image: docker.n8n.io/n8nio/n8n</span><br><span class=\"line\">    container_name: n8n</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - GENERIC_TIMEZONE=Asia/Taipei</span><br><span class=\"line\">      - TZ=Asia/Taipei</span><br><span class=\"line\">      - N8N_PORT=5678</span><br><span class=\"line\">      - N8N_HOST=n8n.stackpenguin.com</span><br><span class=\"line\">      - N8N_EDITOR_BASE_URL=https://n8n.stackpenguin.com</span><br><span class=\"line\"></span><br><span class=\"line\">      # secure login</span><br><span class=\"line\">      - N8N_BASIC_AUTH_ACTIVE=true</span><br><span class=\"line\">      - N8N_BASIC_AUTH_USER=orcajunkai</span><br><span class=\"line\">      - N8N_BASIC_AUTH_PASSWORD=&lt;你的密碼&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;5678:5678&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./data:/home/node/.n8n</span><br><span class=\"line\">    restart: unless-stopped</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>⚠️ 關鍵：**不能放 <code>N8N_PROTOCOL=https</code>**（那會 crash）</p>\n</blockquote>\n<p>記得要將防火牆設定允許</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">orcajunkai@localhost:~$ sudo ufw allow 5678</span><br><span class=\"line\">Rule added</span><br><span class=\"line\">Rule added (v6)</span><br><span class=\"line\">orcajunkai@localhost:~$ sudo ufw reload</span><br><span class=\"line\">Firewall reloaded</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">orcajunkai@localhost:~$ sudo ufw allow 5678</span><br><span class=\"line\">Rule added</span><br><span class=\"line\">Rule added (v6)</span><br><span class=\"line\">orcajunkai@localhost:~$ sudo ufw reload</span><br><span class=\"line\">Firewall reloaded</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"啟動-n8n\"><a href=\"#啟動-n8n\" class=\"headerlink\" title=\"啟動 n8n\"></a>啟動 n8n</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br><span class=\"line\">docker ps</span><br><span class=\"line\">curl http://localhost:5678</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br><span class=\"line\">docker ps</span><br><span class=\"line\">curl http://localhost:5678</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Cloudflare-Tunnel-登入\"><a href=\"#Cloudflare-Tunnel-登入\" class=\"headerlink\" title=\"Cloudflare Tunnel 登入\"></a>Cloudflare Tunnel 登入</h2><h3 id=\"安裝-cloudflared\"><a href=\"#安裝-cloudflared\" class=\"headerlink\" title=\"安裝 cloudflared\"></a>安裝 cloudflared</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb</span><br><span class=\"line\">sudo dpkg -i cloudflared-linux-amd64.deb</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb</span><br><span class=\"line\">sudo dpkg -i cloudflared-linux-amd64.deb</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"登入\"><a href=\"#登入\" class=\"headerlink\" title=\"登入\"></a>登入</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel login</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel login</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/image-1-1024x557.png\"></p>\n<hr>\n<h2 id=\"建-tunnel\"><a href=\"#建-tunnel\" class=\"headerlink\" title=\"建 tunnel\"></a>建 tunnel</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel create n8n</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel create n8n</span><br></pre></td></tr></table></figure>\n\n<p>取得 UUID</p>\n<h2 id=\"建-DNS-mapping\"><a href=\"#建-DNS-mapping\" class=\"headerlink\" title=\"建 DNS mapping\"></a>建 DNS mapping</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel route dns n8n n8n.stackpenguin.com</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel route dns n8n n8n.stackpenguin.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建-Cloudflare-config\"><a href=\"#建-Cloudflare-config\" class=\"headerlink\" title=\"建 Cloudflare config\"></a>建 Cloudflare config</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nano /etc/cloudflared/config.yml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nano /etc/cloudflared/config.yml</span><br></pre></td></tr></table></figure>\n\n<p>貼：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tunnel: &lt;UUID&gt;</span><br><span class=\"line\">credentials-file: /home/orcajunkai/.cloudflared/&lt;UUID&gt;.json</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">ingress:</span><br><span class=\"line\">  - hostname: n8n.stackpenguin.com</span><br><span class=\"line\">    service: http://localhost:5678</span><br><span class=\"line\">  - service: http_status:404</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tunnel: &lt;UUID&gt;</span><br><span class=\"line\">credentials-file: /home/orcajunkai/.cloudflared/&lt;UUID&gt;.json</span><br><span class=\"line\"></span><br><span class=\"line\">ingress:</span><br><span class=\"line\">  - hostname: n8n.stackpenguin.com</span><br><span class=\"line\">    service: http://localhost:5678</span><br><span class=\"line\">  - service: http_status:404</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"啟動-Tunnel\"><a href=\"#啟動-Tunnel\" class=\"headerlink\" title=\"啟動 Tunnel\"></a>啟動 Tunnel</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cloudflared service install</span><br><span class=\"line\">sudo systemctl enable cloudflared</span><br><span class=\"line\">sudo systemctl start cloudflared</span><br><span class=\"line\">systemctl status cloudflared</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cloudflared service install</span><br><span class=\"line\">sudo systemctl enable cloudflared</span><br><span class=\"line\">sudo systemctl start cloudflared</span><br><span class=\"line\">systemctl status cloudflared</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"遇到的問題-解決\"><a href=\"#遇到的問題-解決\" class=\"headerlink\" title=\"遇到的問題 &amp; 解決\"></a>遇到的問題 &amp; 解決</h2><table>\n<thead>\n<tr>\n<th>Issue</th>\n<th>解析</th>\n<th>解法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>反引號 ` 在 Ubuntu 不能用</td>\n<td>Windows copy 的 shell</td>\n<td>Linux 用 <code>\\</code> 換行</td>\n</tr>\n<tr>\n<td>Tunnel 502</td>\n<td>config path &#x2F; hostname &#x2F; protocol 錯</td>\n<td>修 <code>config.yml</code></td>\n</tr>\n<tr>\n<td><code>UUID.json</code> not found</td>\n<td><code>&lt;UUID&gt;</code> 沒替換</td>\n<td>改成真 UUID</td>\n</tr>\n<tr>\n<td><code>curl localhost:5678</code> failed</td>\n<td>n8n crash</td>\n<td>remove HTTPS env</td>\n</tr>\n<tr>\n<td><code>EACCES /home/node/.n8n/config</code></td>\n<td>volume 權限不對</td>\n<td><code>chown 1000:1000 data/</code></td>\n</tr>\n<tr>\n<td>container restart loop</td>\n<td>wrong env &#x2F; permissions</td>\n<td>Fix compose &amp; folder perms</td>\n</tr>\n<tr>\n<td>Everyone can access n8n</td>\n<td>公開服務</td>\n<td>啟 basic auth env</td>\n</tr>\n</tbody></table>\n<h2 id=\"最後驗證\"><a href=\"#最後驗證\" class=\"headerlink\" title=\"最後驗證\"></a>最後驗證</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">orcajunkai@localhost:~/n8n$ curl http://localhost:5678</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;Error&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;pre&gt;Cannot GET /&lt;/pre&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">orcajunkai@localhost:~/n8n$ curl http://localhost:5678</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;Error&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;pre&gt;Cannot GET /&lt;/pre&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>Browser：<a href=\"https://n8n.stackpenguin.com/\">https://n8n.stackpenguin.com</a> (自己的網域)</p>\n<p>跳出 BasicAuth → Login → 看到 n8n UI ✅</p>\n<p><img src=\"/images/%E8%9E%A2%E5%B9%95%E6%93%B7%E5%8F%96%E7%95%AB%E9%9D%A2-2025-11-05-163916-1024x606.png\"></p>\n<h2 id=\"Cloudflared-運作原理\"><a href=\"#Cloudflared-運作原理\" class=\"headerlink\" title=\"Cloudflared 運作原理\"></a>Cloudflared 運作原理</h2><p>你想知道為啥：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://n8n.stackpenguin.com</span><br><span class=\"line\"></span><br><span class=\"line\">可以指到你 Linode 上的 n8n</span><br><span class=\"line\">而且你 沒有開 5678 port、也沒有裝 Nginx/Certbot</span><br><span class=\"line\">卻 magically 有 HTTPS + domain？</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"🔥-Cloudflare-Tunnel-的核心概念\"><a href=\"#🔥-Cloudflare-Tunnel-的核心概念\" class=\"headerlink\" title=\"🔥 Cloudflare Tunnel 的核心概念\"></a>🔥 Cloudflare Tunnel 的核心概念</h2><p>平常網站流程是：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User → Domain → Public IP → Server → App (n8n)</span><br></pre></td></tr></table></figure>\n\n<p>但 Cloudflare Tunnel 是：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User → Cloudflare → Tunnel → Your Server → n8n</span><br></pre></td></tr></table></figure>\n\n<p>你的 server 變成<strong>主動連 Cloudflare</strong>，不是 Cloudflare 來找你</p>\n<p>這樣：</p>\n<ul>\n<li><p>不用開 Port 80&#x2F;443&#x2F;5678</p>\n</li>\n<li><p>不用裝 Nginx</p>\n</li>\n<li><p>不用 SSL cert</p>\n</li>\n<li><p>網路封死也能連</p>\n</li>\n</ul>\n<p>超安全又 chill 這就是為什麼 tunnel 是超熱門 DevOps meta hack</p>\n<h2 id=\"那「綁定網址」到底做了什麼？\"><a href=\"#那「綁定網址」到底做了什麼？\" class=\"headerlink\" title=\"那「綁定網址」到底做了什麼？\"></a>那「綁定網址」到底做了什麼？</h2><p>你做了兩件事：</p>\n<h3 id=\"1-Cloudflare-DNS-建立-Route\"><a href=\"#1-Cloudflare-DNS-建立-Route\" class=\"headerlink\" title=\"1. Cloudflare DNS 建立 Route\"></a>1. Cloudflare DNS 建立 Route</h3><p>這條指令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel route dns n8n n8n.stackpenguin.com</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel route dns n8n n8n.stackpenguin.com</span><br></pre></td></tr></table></figure>\n\n<p>意思：<br><strong>讓 n8n.stackpenguin.com 指向這條 Cloudflare Tunnel</strong></p>\n<p>Cloudflare 幫你塞一條 CNAME 到 DNS：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">n8n.stackpenguin.com → &lt;Cloudflare Tunnel endpoint&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">不是指向你的 Linode IP</span><br><span class=\"line\">是指向 Cloudflare 的 secure gateway</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-Tunnel-config-說「這-domain-對應這-app」\"><a href=\"#2-Tunnel-config-說「這-domain-對應這-app」\" class=\"headerlink\" title=\"2. Tunnel config 說「這 domain 對應這 app」\"></a>2. Tunnel config 說「這 domain 對應這 app」</h3><p>你的 <code>/etc/cloudflared/config.yml</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ingress:</span><br><span class=\"line\">  - hostname: n8n.stackpenguin.com</span><br><span class=\"line\">    service: http://localhost:5678</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ingress:</span><br><span class=\"line\">  - hostname: n8n.stackpenguin.com</span><br><span class=\"line\">    service: http://localhost:5678</span><br></pre></td></tr></table></figure>\n\n<p>意思：</p>\n<blockquote>\n<p>有人打 <code>n8n.stackpenguin.com</code><br>→ Cloudflare 收 request<br>→ 丟給 Tunnel<br>→ Tunnel 轉給你 Linode<br>→ 你的 n8n 回應</p>\n</blockquote>\n<p>完全不露 IP<br>完全不需要開 Port<br>完全不需要 TLS 憑證</p>\n<hr>\n<h2 id=\"一句話版本\"><a href=\"#一句話版本\" class=\"headerlink\" title=\"一句話版本\"></a>一句話版本</h2><p>Cloudflare Tunnel 把你 server 變成：</p>\n<blockquote>\n<p><strong>末端加密節點</strong></p>\n</blockquote>\n<p>Cloudflare 當你的「外部大門 + HTTPS + Firewall」<br>你 server 只是「內部房間」</p>\n<p>所以 <code>https://n8n.stackpenguin.com</code> 是 Cloudflare 給 HTTPS<br>不是你自己做 HTTPS</p>\n<h2 id=\"骨架圖（秒懂）\"><a href=\"#骨架圖（秒懂）\" class=\"headerlink\" title=\"骨架圖（秒懂）\"></a>骨架圖（秒懂）</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">🌍 User Browser</span><br><span class=\"line\">      ↓ https://n8n.stackpenguin.com</span><br><span class=\"line\">Cloudflare Edge (SSL / Firewall / CDN)</span><br><span class=\"line\">      ↓ Tunnel (Secure connection)</span><br><span class=\"line\">Linode VM</span><br><span class=\"line\">      ↓ localhost:5678</span><br><span class=\"line\">n8n dashboard</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">🌍 User Browser</span><br><span class=\"line\">      ↓ https://n8n.stackpenguin.com</span><br><span class=\"line\">Cloudflare Edge (SSL / Firewall / CDN)</span><br><span class=\"line\">      ↓ Tunnel (Secure connection)</span><br><span class=\"line\">Linode VM</span><br><span class=\"line\">      ↓ localhost:5678</span><br><span class=\"line\">n8n dashboard</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"現在有什麼？\"><a href=\"#現在有什麼？\" class=\"headerlink\" title=\"現在有什麼？\"></a>現在有什麼？</h2><p>已經跑在：</p>\n<p>💠 Cloudflare Zero Trust Tunnel<br>💠 隱藏原始 IP<br>💠 強制 HTTPS<br>💠 密碼保護 (Basic Auth)<br>💠 沒開任何 external port（最安全）</p>\n<p>你走的不是傳統 Web Hosting<br>你走的是 <strong>Zero Trust Architecture</strong></p>\n","excerpt":"","more":"<p>下面是<strong>整趟 n8n on Linode + Cloudflare Tunnel 部署旅程完整總整理</strong><br>包含每一步、每個踩雷點、每個修法。</p>\n<h2 id=\"Linode-上部署：\"><a href=\"#Linode-上部署：\" class=\"headerlink\" title=\"Linode 上部署：\"></a>Linode 上部署：</h2><ul>\n<li><p>Docker + Docker Compose</p>\n</li>\n<li><p>n8n with persistent volume</p>\n</li>\n<li><p>Cloudflare Tunnel (免開 port、HTTPS、domain)</p>\n</li>\n<li><p>安全保護（BasicAuth）</p>\n</li>\n</ul>\n<p>最終網址 : <a href=\"https://n8n.stackpenguin.com/\">https://n8n.stackpenguin.com</a> (根據你自己的網域)</p>\n<h2 id=\"系統前置\"><a href=\"#系統前置\" class=\"headerlink\" title=\"系統前置\"></a>系統前置</h2><h3 id=\"SSH-進-Linode-→-更新\"><a href=\"#SSH-進-Linode-→-更新\" class=\"headerlink\" title=\"SSH 進 Linode → 更新\"></a>SSH 進 Linode → 更新</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安裝-Docker-Compose（先確認再裝）\"><a href=\"#安裝-Docker-Compose（先確認再裝）\" class=\"headerlink\" title=\"安裝 Docker &amp; Compose（先確認再裝）\"></a>安裝 Docker &amp; Compose（先確認再裝）</h2><h3 id=\"檢查-Docker\"><a href=\"#檢查-Docker\" class=\"headerlink\" title=\"檢查 Docker\"></a>檢查 Docker</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker --version</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker --version</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"沒有就安裝\"><a href=\"#沒有就安裝\" class=\"headerlink\" title=\"沒有就安裝\"></a>沒有就安裝</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://get.docker.com | sudo bash</span><br><span class=\"line\">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://get.docker.com | sudo bash</span><br><span class=\"line\">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h3 id=\"檢查-Compose\"><a href=\"#檢查-Compose\" class=\"headerlink\" title=\"檢查 Compose\"></a>檢查 Compose</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose --version</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose --version</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"沒有就安裝-1\"><a href=\"#沒有就安裝-1\" class=\"headerlink\" title=\"沒有就安裝\"></a>沒有就安裝</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install docker-compose -y</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt install docker-compose -y</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建立-n8n-工作資料夾\"><a href=\"#建立-n8n-工作資料夾\" class=\"headerlink\" title=\"建立 n8n 工作資料夾\"></a>建立 n8n 工作資料夾</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p ~/n8n</span><br><span class=\"line\">cd ~/n8n</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p ~/n8n</span><br><span class=\"line\">cd ~/n8n</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建立-docker-compose-yml\"><a href=\"#建立-docker-compose-yml\" class=\"headerlink\" title=\"建立 docker-compose.yml\"></a>建立 docker-compose.yml</h2><blockquote>\n<p>一開始你用 docker run，後來換 compose（正確）</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3.3&quot;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  n8n:</span><br><span class=\"line\">    image: docker.n8n.io/n8nio/n8n</span><br><span class=\"line\">    container_name: n8n</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - GENERIC_TIMEZONE=Asia/Taipei</span><br><span class=\"line\">      - TZ=Asia/Taipei</span><br><span class=\"line\">      - N8N_PORT=5678</span><br><span class=\"line\">      - N8N_HOST=n8n.stackpenguin.com</span><br><span class=\"line\">      - N8N_EDITOR_BASE_URL=https://n8n.stackpenguin.com</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">      # secure login</span><br><span class=\"line\">      - N8N_BASIC_AUTH_ACTIVE=true</span><br><span class=\"line\">      - N8N_BASIC_AUTH_USER=orcajunkai</span><br><span class=\"line\">      - N8N_BASIC_AUTH_PASSWORD=&lt;你的密碼&gt;</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;5678:5678&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./data:/home/node/.n8n</span><br><span class=\"line\">    restart: unless-stopped</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &quot;3.3&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">services:</span><br><span class=\"line\">  n8n:</span><br><span class=\"line\">    image: docker.n8n.io/n8nio/n8n</span><br><span class=\"line\">    container_name: n8n</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - GENERIC_TIMEZONE=Asia/Taipei</span><br><span class=\"line\">      - TZ=Asia/Taipei</span><br><span class=\"line\">      - N8N_PORT=5678</span><br><span class=\"line\">      - N8N_HOST=n8n.stackpenguin.com</span><br><span class=\"line\">      - N8N_EDITOR_BASE_URL=https://n8n.stackpenguin.com</span><br><span class=\"line\"></span><br><span class=\"line\">      # secure login</span><br><span class=\"line\">      - N8N_BASIC_AUTH_ACTIVE=true</span><br><span class=\"line\">      - N8N_BASIC_AUTH_USER=orcajunkai</span><br><span class=\"line\">      - N8N_BASIC_AUTH_PASSWORD=&lt;你的密碼&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;5678:5678&quot;</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./data:/home/node/.n8n</span><br><span class=\"line\">    restart: unless-stopped</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>⚠️ 關鍵：**不能放 <code>N8N_PROTOCOL=https</code>**（那會 crash）</p>\n</blockquote>\n<p>記得要將防火牆設定允許</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">orcajunkai@localhost:~$ sudo ufw allow 5678</span><br><span class=\"line\">Rule added</span><br><span class=\"line\">Rule added (v6)</span><br><span class=\"line\">orcajunkai@localhost:~$ sudo ufw reload</span><br><span class=\"line\">Firewall reloaded</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">orcajunkai@localhost:~$ sudo ufw allow 5678</span><br><span class=\"line\">Rule added</span><br><span class=\"line\">Rule added (v6)</span><br><span class=\"line\">orcajunkai@localhost:~$ sudo ufw reload</span><br><span class=\"line\">Firewall reloaded</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"啟動-n8n\"><a href=\"#啟動-n8n\" class=\"headerlink\" title=\"啟動 n8n\"></a>啟動 n8n</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br><span class=\"line\">docker ps</span><br><span class=\"line\">curl http://localhost:5678</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br><span class=\"line\">docker ps</span><br><span class=\"line\">curl http://localhost:5678</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Cloudflare-Tunnel-登入\"><a href=\"#Cloudflare-Tunnel-登入\" class=\"headerlink\" title=\"Cloudflare Tunnel 登入\"></a>Cloudflare Tunnel 登入</h2><h3 id=\"安裝-cloudflared\"><a href=\"#安裝-cloudflared\" class=\"headerlink\" title=\"安裝 cloudflared\"></a>安裝 cloudflared</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb</span><br><span class=\"line\">sudo dpkg -i cloudflared-linux-amd64.deb</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb</span><br><span class=\"line\">sudo dpkg -i cloudflared-linux-amd64.deb</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"登入\"><a href=\"#登入\" class=\"headerlink\" title=\"登入\"></a>登入</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel login</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel login</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/images/image-1-1024x557.png\"></p>\n<hr>\n<h2 id=\"建-tunnel\"><a href=\"#建-tunnel\" class=\"headerlink\" title=\"建 tunnel\"></a>建 tunnel</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel create n8n</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel create n8n</span><br></pre></td></tr></table></figure>\n\n<p>取得 UUID</p>\n<h2 id=\"建-DNS-mapping\"><a href=\"#建-DNS-mapping\" class=\"headerlink\" title=\"建 DNS mapping\"></a>建 DNS mapping</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel route dns n8n n8n.stackpenguin.com</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel route dns n8n n8n.stackpenguin.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"建-Cloudflare-config\"><a href=\"#建-Cloudflare-config\" class=\"headerlink\" title=\"建 Cloudflare config\"></a>建 Cloudflare config</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nano /etc/cloudflared/config.yml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo nano /etc/cloudflared/config.yml</span><br></pre></td></tr></table></figure>\n\n<p>貼：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tunnel: &lt;UUID&gt;</span><br><span class=\"line\">credentials-file: /home/orcajunkai/.cloudflared/&lt;UUID&gt;.json</span><br><span class=\"line\">&lt;div&gt;&lt;/div&gt;</span><br><span class=\"line\">ingress:</span><br><span class=\"line\">  - hostname: n8n.stackpenguin.com</span><br><span class=\"line\">    service: http://localhost:5678</span><br><span class=\"line\">  - service: http_status:404</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tunnel: &lt;UUID&gt;</span><br><span class=\"line\">credentials-file: /home/orcajunkai/.cloudflared/&lt;UUID&gt;.json</span><br><span class=\"line\"></span><br><span class=\"line\">ingress:</span><br><span class=\"line\">  - hostname: n8n.stackpenguin.com</span><br><span class=\"line\">    service: http://localhost:5678</span><br><span class=\"line\">  - service: http_status:404</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"啟動-Tunnel\"><a href=\"#啟動-Tunnel\" class=\"headerlink\" title=\"啟動 Tunnel\"></a>啟動 Tunnel</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cloudflared service install</span><br><span class=\"line\">sudo systemctl enable cloudflared</span><br><span class=\"line\">sudo systemctl start cloudflared</span><br><span class=\"line\">systemctl status cloudflared</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cloudflared service install</span><br><span class=\"line\">sudo systemctl enable cloudflared</span><br><span class=\"line\">sudo systemctl start cloudflared</span><br><span class=\"line\">systemctl status cloudflared</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"遇到的問題-解決\"><a href=\"#遇到的問題-解決\" class=\"headerlink\" title=\"遇到的問題 &amp; 解決\"></a>遇到的問題 &amp; 解決</h2><table>\n<thead>\n<tr>\n<th>Issue</th>\n<th>解析</th>\n<th>解法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>反引號 ` 在 Ubuntu 不能用</td>\n<td>Windows copy 的 shell</td>\n<td>Linux 用 <code>\\</code> 換行</td>\n</tr>\n<tr>\n<td>Tunnel 502</td>\n<td>config path &#x2F; hostname &#x2F; protocol 錯</td>\n<td>修 <code>config.yml</code></td>\n</tr>\n<tr>\n<td><code>UUID.json</code> not found</td>\n<td><code>&lt;UUID&gt;</code> 沒替換</td>\n<td>改成真 UUID</td>\n</tr>\n<tr>\n<td><code>curl localhost:5678</code> failed</td>\n<td>n8n crash</td>\n<td>remove HTTPS env</td>\n</tr>\n<tr>\n<td><code>EACCES /home/node/.n8n/config</code></td>\n<td>volume 權限不對</td>\n<td><code>chown 1000:1000 data/</code></td>\n</tr>\n<tr>\n<td>container restart loop</td>\n<td>wrong env &#x2F; permissions</td>\n<td>Fix compose &amp; folder perms</td>\n</tr>\n<tr>\n<td>Everyone can access n8n</td>\n<td>公開服務</td>\n<td>啟 basic auth env</td>\n</tr>\n</tbody></table>\n<h2 id=\"最後驗證\"><a href=\"#最後驗證\" class=\"headerlink\" title=\"最後驗證\"></a>最後驗證</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">orcajunkai@localhost:~/n8n$ curl http://localhost:5678</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;Error&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;pre&gt;Cannot GET /&lt;/pre&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">orcajunkai@localhost:~/n8n$ curl http://localhost:5678</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class=\"line\">&lt;title&gt;Error&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;pre&gt;Cannot GET /&lt;/pre&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n\n<p>Browser：<a href=\"https://n8n.stackpenguin.com/\">https://n8n.stackpenguin.com</a> (自己的網域)</p>\n<p>跳出 BasicAuth → Login → 看到 n8n UI ✅</p>\n<p><img src=\"/images/%E8%9E%A2%E5%B9%95%E6%93%B7%E5%8F%96%E7%95%AB%E9%9D%A2-2025-11-05-163916-1024x606.png\"></p>\n<h2 id=\"Cloudflared-運作原理\"><a href=\"#Cloudflared-運作原理\" class=\"headerlink\" title=\"Cloudflared 運作原理\"></a>Cloudflared 運作原理</h2><p>你想知道為啥：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://n8n.stackpenguin.com</span><br><span class=\"line\"></span><br><span class=\"line\">可以指到你 Linode 上的 n8n</span><br><span class=\"line\">而且你 沒有開 5678 port、也沒有裝 Nginx/Certbot</span><br><span class=\"line\">卻 magically 有 HTTPS + domain？</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"🔥-Cloudflare-Tunnel-的核心概念\"><a href=\"#🔥-Cloudflare-Tunnel-的核心概念\" class=\"headerlink\" title=\"🔥 Cloudflare Tunnel 的核心概念\"></a>🔥 Cloudflare Tunnel 的核心概念</h2><p>平常網站流程是：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User → Domain → Public IP → Server → App (n8n)</span><br></pre></td></tr></table></figure>\n\n<p>但 Cloudflare Tunnel 是：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User → Cloudflare → Tunnel → Your Server → n8n</span><br></pre></td></tr></table></figure>\n\n<p>你的 server 變成<strong>主動連 Cloudflare</strong>，不是 Cloudflare 來找你</p>\n<p>這樣：</p>\n<ul>\n<li><p>不用開 Port 80&#x2F;443&#x2F;5678</p>\n</li>\n<li><p>不用裝 Nginx</p>\n</li>\n<li><p>不用 SSL cert</p>\n</li>\n<li><p>網路封死也能連</p>\n</li>\n</ul>\n<p>超安全又 chill 這就是為什麼 tunnel 是超熱門 DevOps meta hack</p>\n<h2 id=\"那「綁定網址」到底做了什麼？\"><a href=\"#那「綁定網址」到底做了什麼？\" class=\"headerlink\" title=\"那「綁定網址」到底做了什麼？\"></a>那「綁定網址」到底做了什麼？</h2><p>你做了兩件事：</p>\n<h3 id=\"1-Cloudflare-DNS-建立-Route\"><a href=\"#1-Cloudflare-DNS-建立-Route\" class=\"headerlink\" title=\"1. Cloudflare DNS 建立 Route\"></a>1. Cloudflare DNS 建立 Route</h3><p>這條指令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel route dns n8n n8n.stackpenguin.com</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cloudflared tunnel route dns n8n n8n.stackpenguin.com</span><br></pre></td></tr></table></figure>\n\n<p>意思：<br><strong>讓 n8n.stackpenguin.com 指向這條 Cloudflare Tunnel</strong></p>\n<p>Cloudflare 幫你塞一條 CNAME 到 DNS：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">n8n.stackpenguin.com → &lt;Cloudflare Tunnel endpoint&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">不是指向你的 Linode IP</span><br><span class=\"line\">是指向 Cloudflare 的 secure gateway</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-Tunnel-config-說「這-domain-對應這-app」\"><a href=\"#2-Tunnel-config-說「這-domain-對應這-app」\" class=\"headerlink\" title=\"2. Tunnel config 說「這 domain 對應這 app」\"></a>2. Tunnel config 說「這 domain 對應這 app」</h3><p>你的 <code>/etc/cloudflared/config.yml</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ingress:</span><br><span class=\"line\">  - hostname: n8n.stackpenguin.com</span><br><span class=\"line\">    service: http://localhost:5678</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ingress:</span><br><span class=\"line\">  - hostname: n8n.stackpenguin.com</span><br><span class=\"line\">    service: http://localhost:5678</span><br></pre></td></tr></table></figure>\n\n<p>意思：</p>\n<blockquote>\n<p>有人打 <code>n8n.stackpenguin.com</code><br>→ Cloudflare 收 request<br>→ 丟給 Tunnel<br>→ Tunnel 轉給你 Linode<br>→ 你的 n8n 回應</p>\n</blockquote>\n<p>完全不露 IP<br>完全不需要開 Port<br>完全不需要 TLS 憑證</p>\n<hr>\n<h2 id=\"一句話版本\"><a href=\"#一句話版本\" class=\"headerlink\" title=\"一句話版本\"></a>一句話版本</h2><p>Cloudflare Tunnel 把你 server 變成：</p>\n<blockquote>\n<p><strong>末端加密節點</strong></p>\n</blockquote>\n<p>Cloudflare 當你的「外部大門 + HTTPS + Firewall」<br>你 server 只是「內部房間」</p>\n<p>所以 <code>https://n8n.stackpenguin.com</code> 是 Cloudflare 給 HTTPS<br>不是你自己做 HTTPS</p>\n<h2 id=\"骨架圖（秒懂）\"><a href=\"#骨架圖（秒懂）\" class=\"headerlink\" title=\"骨架圖（秒懂）\"></a>骨架圖（秒懂）</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">🌍 User Browser</span><br><span class=\"line\">      ↓ https://n8n.stackpenguin.com</span><br><span class=\"line\">Cloudflare Edge (SSL / Firewall / CDN)</span><br><span class=\"line\">      ↓ Tunnel (Secure connection)</span><br><span class=\"line\">Linode VM</span><br><span class=\"line\">      ↓ localhost:5678</span><br><span class=\"line\">n8n dashboard</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">🌍 User Browser</span><br><span class=\"line\">      ↓ https://n8n.stackpenguin.com</span><br><span class=\"line\">Cloudflare Edge (SSL / Firewall / CDN)</span><br><span class=\"line\">      ↓ Tunnel (Secure connection)</span><br><span class=\"line\">Linode VM</span><br><span class=\"line\">      ↓ localhost:5678</span><br><span class=\"line\">n8n dashboard</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"現在有什麼？\"><a href=\"#現在有什麼？\" class=\"headerlink\" title=\"現在有什麼？\"></a>現在有什麼？</h2><p>已經跑在：</p>\n<p>💠 Cloudflare Zero Trust Tunnel<br>💠 隱藏原始 IP<br>💠 強制 HTTPS<br>💠 密碼保護 (Basic Auth)<br>💠 沒開任何 external port（最安全）</p>\n<p>你走的不是傳統 Web Hosting<br>你走的是 <strong>Zero Trust Architecture</strong></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cmkxfp4y000117z8zfx6hh8qj","category_id":"cmkxfp4y4002k7z8zbelofcak","_id":"cmkxfp4y4002q7z8zdxslfv2a"},{"post_id":"cmkxfp4y000137z8z3t9th87q","category_id":"cmkxfp4y4002p7z8zbepe5w5i","_id":"cmkxfp4y5003b7z8zcjcwel94"},{"post_id":"cmkxfp4y000137z8z3t9th87q","category_id":"cmkxfp4y500377z8z8fjpblgc","_id":"cmkxfp4y5003d7z8zf4u30rlm"},{"post_id":"cmkxfp4y100167z8z4gr2bg0k","category_id":"cmkxfp4y4002p7z8zbepe5w5i","_id":"cmkxfp4y5003e7z8z4gc72y0o"},{"post_id":"cmkxfp4y100167z8z4gr2bg0k","category_id":"cmkxfp4y500397z8z3sq0bix0","_id":"cmkxfp4y5003g7z8z9v4ogvkp"},{"post_id":"cmkxfp4y1001b7z8zcaey0t99","category_id":"cmkxfp4y4002p7z8zbepe5w5i","_id":"cmkxfp4y5003j7z8z5xn2ewtl"},{"post_id":"cmkxfp4y1001b7z8zcaey0t99","category_id":"cmkxfp4y5003f7z8z9i8h3qax","_id":"cmkxfp4y5003k7z8z2hdd9jde"},{"post_id":"cmkxfp4y1001e7z8z74ma6040","category_id":"cmkxfp4y4002v7z8z25kl0285","_id":"cmkxfp4y5003l7z8z10874rdf"},{"post_id":"cmkxfp4y1001e7z8z74ma6040","category_id":"cmkxfp4y5003c7z8zd2c7ewxr","_id":"cmkxfp4y6003n7z8zfsoo5yx3"},{"post_id":"cmkxfp4y2001g7z8z1oez9cwh","category_id":"cmkxfp4y400307z8zfh6dgkfp","_id":"cmkxfp4y6003p7z8zb2zq3sqw"},{"post_id":"cmkxfp4y2001g7z8z1oez9cwh","category_id":"cmkxfp4y5003i7z8z5i7qapnx","_id":"cmkxfp4y6003q7z8z0rrh5l9k"},{"post_id":"cmkxfp4y2001h7z8z865o9u3l","category_id":"cmkxfp4y400307z8zfh6dgkfp","_id":"cmkxfp4y6003r7z8z1hmx8xk5"},{"post_id":"cmkxfp4y2001h7z8z865o9u3l","category_id":"cmkxfp4y5003i7z8z5i7qapnx","_id":"cmkxfp4y6003s7z8zevuv2g5h"},{"post_id":"cmkxfp4y100187z8z4sbgcp63","category_id":"cmkxfp4y4002v7z8z25kl0285","_id":"cmkxfp4y6003t7z8zhxu4aicg"},{"post_id":"cmkxfp4y100187z8z4sbgcp63","category_id":"cmkxfp4y5003c7z8zd2c7ewxr","_id":"cmkxfp4y6003u7z8zctgp7vxk"},{"post_id":"cmkxfp4y100187z8z4sbgcp63","category_id":"cmkxfp4y6003o7z8zgjsz3wsi","_id":"cmkxfp4y6003v7z8ze7caduq9"},{"post_id":"cmkxfp4y800407z8zfkw46lub","category_id":"cmkxfp4y4002v7z8z25kl0285","_id":"cmkxfp4y9004c7z8z2r6q26ot"},{"post_id":"cmkxfp4y800407z8zfkw46lub","category_id":"cmkxfp4y800467z8zdz5m8bgg","_id":"cmkxfp4y9004f7z8z0p8lahum"},{"post_id":"cmkxfp4y7003w7z8z71oz3hm5","category_id":"cmkxfp4y8003y7z8z058zh03v","_id":"cmkxfp4y9004j7z8zhu3n9z3f"},{"post_id":"cmkxfp4y7003w7z8z71oz3hm5","category_id":"cmkxfp4y9004d7z8z6bldhl90","_id":"cmkxfp4y9004l7z8z7oz1f049"},{"post_id":"cmkxfp4y7003x7z8z5xe58mie","category_id":"cmkxfp4y800437z8zc1lu0cbf","_id":"cmkxfp4y9004n7z8zbyd21b4h"},{"post_id":"cmkxfp4y7003x7z8z5xe58mie","category_id":"cmkxfp4y9004k7z8z7qfw6ena","_id":"cmkxfp4y9004p7z8za8rt0fwx"},{"post_id":"cmkxfp4y800417z8z7gej5qq6","category_id":"cmkxfp4y800497z8z9wfnbo52","_id":"cmkxfp4y9004q7z8z5w178069"},{"post_id":"cmkxfp4y800417z8z7gej5qq6","category_id":"cmkxfp4y9004m7z8z1j7p5c4o","_id":"cmkxfp4y9004r7z8zc10m340v"},{"post_id":"cmkxfp4y800427z8z0vf2czx8","category_id":"cmkxfp4y9004h7z8zdeba5te4","_id":"cmkxfp4y9004s7z8z688nevdj"},{"post_id":"cmkxfp4y800427z8z0vf2czx8","category_id":"cmkxfp4y9004o7z8zdkpp76ue","_id":"cmkxfp4y9004t7z8z75pjbe8h"},{"post_id":"cmkxg0krp0000rb8zhhykesuq","category_id":"cmkxfp4xz000q7z8z1qyp1npp","_id":"cmkxg0krr0004rb8zef5zhyyv"},{"post_id":"cmkxg0krp0000rb8zhhykesuq","category_id":"cmkxfp4y300277z8z58irhc0h","_id":"cmkxg0krs0006rb8z7fgmfwps"},{"post_id":"cmkxg0krr0001rb8z57h7cz7o","category_id":"cmkxfp4xu00047z8z1ptr003s","_id":"cmkxg0krs0009rb8ze1wx7veh"},{"post_id":"cmkxg0krr0002rb8z81849mbt","category_id":"cmkxfp4y3002b7z8z9voa9h2g","_id":"cmkxg0krt000brb8z9yae0g4p"},{"post_id":"cmkxg0krr0003rb8z54um3wrx","category_id":"cmkxfp4xy000m7z8z8h7qbh2c","_id":"cmkxg0krt000drb8zalyla50w"},{"post_id":"cmkxg0krr0003rb8z54um3wrx","category_id":"cmkxfp4y2001p7z8z1rhr7h3h","_id":"cmkxg0krt000frb8z353yasqv"},{"post_id":"cmkxg0krr0005rb8z4t5qgc3p","category_id":"cmkxfp4xz000u7z8zd3zbc6zq","_id":"cmkxg0kru000hrb8z1l195p25"},{"post_id":"cmkxg0krs0008rb8z2kho1yrw","category_id":"cmkxfp4xz000q7z8z1qyp1npp","_id":"cmkxg0kru000krb8zc3i37oir"},{"post_id":"cmkxg0krs0008rb8z2kho1yrw","category_id":"cmkxfp4y300277z8z58irhc0h","_id":"cmkxg0kru000nrb8z6q5vhr58"},{"post_id":"cmkxg0krs000arb8z4n7n35cf","category_id":"cmkxfp4y2001k7z8z3mr83d8w","_id":"cmkxg0kru000prb8z8pmh3es8"},{"post_id":"cmkxg0krs000arb8z4n7n35cf","category_id":"cmkxfp4y400337z8z4ht2fs9r","_id":"cmkxg0kru000qrb8zct9hho14"},{"post_id":"cmkxg0krt000crb8zegou11na","category_id":"cmkxfp4y3002f7z8z9e2jgdat","_id":"cmkxg0kru000rrb8z17vx8qj7"},{"post_id":"cmkxg0krt000erb8zab8nfsfr","category_id":"cmkxfp4xz000q7z8z1qyp1npp","_id":"cmkxg0kru000srb8zex7ufvwf"},{"post_id":"cmkxg0krt000erb8zab8nfsfr","category_id":"cmkxfp4y300277z8z58irhc0h","_id":"cmkxg0kru000trb8z2k6x9yt5"},{"post_id":"cmkxg0krt000grb8zg1csac9w","category_id":"cmkxfp4xu00047z8z1ptr003s","_id":"cmkxg0kru000urb8z4wuu0ag5"},{"post_id":"cmkxg0krt000grb8zg1csac9w","category_id":"cmkxfp4y100197z8zcyoegupe","_id":"cmkxg0kru000vrb8z9mi7d2i3"},{"post_id":"cmkxg0kru000jrb8z6m0nfmey","category_id":"cmkxfp4xx000b7z8zcd0a35qu","_id":"cmkxg0kru000wrb8zdxkkbwhg"},{"post_id":"cmkxg0kru000mrb8z2vwa2log","category_id":"cmkxfp4xz000q7z8z1qyp1npp","_id":"cmkxg0kru000xrb8z2ro9cs9o"},{"post_id":"cmkxg0kru000mrb8z2vwa2log","category_id":"cmkxfp4y300277z8z58irhc0h","_id":"cmkxg0kru000yrb8z88oe0qc1"},{"post_id":"cmkxg0krv000zrb8z7gxsd8dw","category_id":"cmkxfp4y3001v7z8zeser3ztp","_id":"cmkxg0krv0012rb8zgrdigtp1"},{"post_id":"cmkxg0krv0010rb8z8fu66e6l","category_id":"cmkxfp4y300227z8zcqv3g4v4","_id":"cmkxg0krv0014rb8z4bz66i60"},{"post_id":"cmkxg0krv0015rb8z8ann4ikr","category_id":"cmkxfp4xu00047z8z1ptr003s","_id":"cmkxg0krw0017rb8ze0xth8t0"},{"post_id":"cmkxg0krv0015rb8z8ann4ikr","category_id":"cmkxfp4y100197z8zcyoegupe","_id":"cmkxg0krw0018rb8zcwsmeni1"},{"post_id":"cmkxg0krw0016rb8zd9v92fdq","category_id":"cmkxfp4xx000b7z8zcd0a35qu","_id":"cmkxg0krw0019rb8z9nnpcbh3"},{"post_id":"cmkxg0krw0016rb8zd9v92fdq","category_id":"cmkxfp4y2001f7z8zee3j9op2","_id":"cmkxg0krw001arb8zeca26n71"},{"post_id":"cmkxg0krw0016rb8zd9v92fdq","category_id":"cmkxfp4y400317z8z6fvofko1","_id":"cmkxg0krw001brb8z8p87hut4"}],"PostTag":[{"post_id":"cmkxfp4y000117z8zfx6hh8qj","tag_id":"cmkxfp4y2001i7z8z86yw1jd3","_id":"cmkxfp4y2001q7z8zg3x5cctp"},{"post_id":"cmkxfp4y000137z8z3t9th87q","tag_id":"cmkxfp4y2001o7z8z892vhi38","_id":"cmkxfp4y2001t7z8z1z6y8sta"},{"post_id":"cmkxfp4y100167z8z4gr2bg0k","tag_id":"cmkxfp4y2001o7z8z892vhi38","_id":"cmkxfp4y3001x7z8z74fr1zc5"},{"post_id":"cmkxfp4y100187z8z4sbgcp63","tag_id":"cmkxfp4y2001i7z8z86yw1jd3","_id":"cmkxfp4y300217z8z9ugcf8mf"},{"post_id":"cmkxfp4y1001b7z8zcaey0t99","tag_id":"cmkxfp4y2001o7z8z892vhi38","_id":"cmkxfp4y300257z8z4kzdbjgl"},{"post_id":"cmkxfp4y1001e7z8z74ma6040","tag_id":"cmkxfp4y2001i7z8z86yw1jd3","_id":"cmkxfp4y300297z8z9v5acd8j"},{"post_id":"cmkxfp4y2001g7z8z1oez9cwh","tag_id":"cmkxfp4y300287z8z84m3628j","_id":"cmkxfp4y3002d7z8z5gkxhw8i"},{"post_id":"cmkxfp4y2001h7z8z865o9u3l","tag_id":"cmkxfp4y300287z8z84m3628j","_id":"cmkxfp4y3002h7z8za1s9dow0"},{"post_id":"cmkxfp4y7003w7z8z71oz3hm5","tag_id":"cmkxfp4y8003z7z8z4a6l8n37","_id":"cmkxfp4y800457z8zezry84t8"},{"post_id":"cmkxfp4y7003x7z8z5xe58mie","tag_id":"cmkxfp4y800447z8zcquo8sa3","_id":"cmkxfp4y800487z8z6ch9ax1q"},{"post_id":"cmkxfp4y800407z8zfkw46lub","tag_id":"cmkxfp4y800477z8zgkluh9s7","_id":"cmkxfp4y9004b7z8z8jzrfba3"},{"post_id":"cmkxfp4y800417z8z7gej5qq6","tag_id":"cmkxfp4y9004a7z8z3rf51r9w","_id":"cmkxfp4y9004g7z8z54x44ulf"},{"post_id":"cmkxfp4y800427z8z0vf2czx8","tag_id":"cmkxfp4y9004e7z8zd6d2bzvx","_id":"cmkxfp4y9004i7z8z2lq52ib1"},{"post_id":"cmkxg0krr0003rb8z54um3wrx","tag_id":"cmkxfp4xx000c7z8z2y55034f","_id":"cmkxg0krs0007rb8z90emfgs0"},{"post_id":"cmkxg0krt000erb8zab8nfsfr","tag_id":"cmkxfp4y100177z8z0mrfedlr","_id":"cmkxg0kru000irb8zhimd3pnp"},{"post_id":"cmkxg0krt000erb8zab8nfsfr","tag_id":"cmkxfp4y1001d7z8zf3w7dn2l","_id":"cmkxg0kru000lrb8z9lt707xx"},{"post_id":"cmkxg0krt000grb8zg1csac9w","tag_id":"cmkxfp4xz000s7z8zhjen4o9y","_id":"cmkxg0kru000orb8za6ib4zj3"},{"post_id":"cmkxg0krv0010rb8z8fu66e6l","tag_id":"cmkxfp4y0000x7z8za2k55t1n","_id":"cmkxg0krv0011rb8z59ub8a3j"},{"post_id":"cmkxg0krv0010rb8z8fu66e6l","tag_id":"cmkxfp4y000127z8z1qwc69tu","_id":"cmkxg0krv0013rb8zf2fn8x71"}],"Tag":[{"name":"location-app","_id":"cmkxfp4xx000c7z8z2y55034f"},{"name":"wordpress-備份","_id":"cmkxfp4xz000s7z8zhjen4o9y"},{"name":"利率","_id":"cmkxfp4y0000x7z8za2k55t1n"},{"name":"殖利率","_id":"cmkxfp4y000127z8z1qwc69tu"},{"name":"streamlit","_id":"cmkxfp4y100177z8z0mrfedlr"},{"name":"yolo","_id":"cmkxfp4y1001d7z8zf3w7dn2l"},{"name":"Python Django","_id":"cmkxfp4y2001i7z8z86yw1jd3"},{"name":"Line Bot","_id":"cmkxfp4y2001o7z8z892vhi38"},{"name":"CPE","_id":"cmkxfp4y300287z8z84m3628j"},{"name":"C++","_id":"cmkxfp4y8003z7z8z4a6l8n37"},{"name":"開發環境","_id":"cmkxfp4y800447z8zcquo8sa3"},{"name":"Python Email","_id":"cmkxfp4y800477z8zgkluh9s7"},{"name":"Wordpress","_id":"cmkxfp4y9004a7z8z3rf51r9w"},{"name":"Bitbucket","_id":"cmkxfp4y9004e7z8zd6d2bzvx"}]}}